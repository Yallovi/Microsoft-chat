{
  "version": 3,
  "sources": ["../../@microsoft/mgt-element/dist/es6/IBatch.ts", "../../@microsoft/mgt-element/dist/es6/IGraph.ts", "../../@microsoft/microsoft-graph-client/node_modules/tslib/tslib.es6.js", "../../@microsoft/microsoft-graph-client/src/RequestMethod.ts", "../../@microsoft/microsoft-graph-client/src/content/BatchRequestContent.ts", "../../@microsoft/microsoft-graph-client/src/middleware/MiddlewareControl.ts", "../../@microsoft/microsoft-graph-client/src/middleware/MiddlewareUtil.ts", "../../@microsoft/microsoft-graph-client/src/middleware/options/AuthenticationHandlerOptions.ts", "../../@microsoft/microsoft-graph-client/src/middleware/options/TelemetryHandlerOptions.ts", "../../@microsoft/microsoft-graph-client/src/middleware/AuthenticationHandler.ts", "../../@microsoft/microsoft-graph-client/src/middleware/HTTPMessageHandler.ts", "../../@microsoft/microsoft-graph-client/src/middleware/options/RetryHandlerOptions.ts", "../../@microsoft/microsoft-graph-client/src/middleware/RetryHandler.ts", "../../@microsoft/microsoft-graph-client/src/middleware/options/RedirectHandlerOptions.ts", "../../@microsoft/microsoft-graph-client/src/middleware/RedirectHandler.ts", "../../@microsoft/microsoft-graph-client/src/Constants.ts", "../../@microsoft/microsoft-graph-client/src/GraphRequestUtil.ts", "../../@microsoft/microsoft-graph-client/src/Version.ts", "../../@microsoft/microsoft-graph-client/src/middleware/TelemetryHandler.ts", "../../@microsoft/microsoft-graph-client/src/middleware/options/ChaosStrategy.ts", "../../@microsoft/microsoft-graph-client/src/Range.ts", "../../@microsoft/microsoft-graph-client/src/tasks/LargeFileUploadTask.ts", "../../@microsoft/microsoft-graph-client/src/tasks/OneDriveLargeFileUploadTaskUtil.ts", "../../@microsoft/microsoft-graph-client/src/tasks/OneDriveLargeFileUploadTask.ts", "../../@microsoft/microsoft-graph-client/src/CustomAuthenticationProvider.ts", "../../@microsoft/microsoft-graph-client/src/GraphError.ts", "../../@microsoft/microsoft-graph-client/src/GraphErrorHandler.ts", "../../@microsoft/microsoft-graph-client/src/ResponseType.ts", "../../@microsoft/microsoft-graph-client/src/GraphResponseHandler.ts", "../../@microsoft/microsoft-graph-client/src/GraphRequest.ts", "../../@microsoft/microsoft-graph-client/src/HTTPClient.ts", "../../@microsoft/microsoft-graph-client/src/HTTPClientFactory.ts", "../../@microsoft/microsoft-graph-client/src/ValidatePolyFilling.ts", "../../@microsoft/microsoft-graph-client/src/Client.ts", "../../msal/node_modules/tslib/tslib.es6.js", "../../msal/src/utils/CryptoUtils.ts", "../../msal/src/utils/Constants.ts", "../../msal/src/error/AuthError.ts", "../../msal/src/utils/StringUtils.ts", "../../msal/src/error/ClientAuthError.ts", "../../msal/src/error/ClientConfigurationError.ts", "../../msal/src/ScopeSet.ts", "../../msal/src/utils/UrlUtils.ts", "../../msal/src/cache/AccessTokenKey.ts", "../../msal/src/cache/AccessTokenValue.ts", "../../msal/src/packageMetadata.ts", "../../msal/src/ServerRequestParameters.ts", "../../msal/src/XHRClient.ts", "../../msal/src/authority/TrustedAuthority.ts", "../../msal/src/authority/Authority.ts", "../../msal/src/ClientInfo.ts", "../../msal/src/utils/TimeUtils.ts", "../../msal/src/utils/TokenUtils.ts", "../../msal/src/IdToken.ts", "../../msal/src/cache/AccessTokenCacheItem.ts", "../../msal/src/cache/BrowserStorage.ts", "../../msal/src/utils/RequestUtils.ts", "../../msal/src/cache/AuthCache.ts", "../../msal/src/Account.ts", "../../msal/src/utils/WindowUtils.ts", "../../msal/src/utils/ResponseUtils.ts", "../../msal/src/authority/AuthorityFactory.ts", "../../msal/src/Logger.ts", "../../msal/src/Configuration.ts", "../../msal/src/error/ServerError.ts", "../../msal/src/error/InteractionRequiredAuthError.ts", "../../msal/src/AuthResponse.ts", "../../msal/src/telemetry/TelemetryConstants.ts", "../../msal/src/telemetry/TelemetryUtils.ts", "../../msal/src/telemetry/TelemetryEvent.ts", "../../msal/src/telemetry/DefaultEvent.ts", "../../msal/src/telemetry/ApiEvent.ts", "../../msal/src/telemetry/HttpEvent.ts", "../../msal/src/telemetry/TelemetryManager.ts", "../../msal/src/utils/AuthCacheUtils.ts", "../../msal/src/UserAgentApplication.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/index.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/GraphHelpers.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/Batch.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/ComponentMiddlewareOptions.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/SdkVersionMiddleware.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/version.ts", "../../@microsoft/mgt-element/dist/es6/Graph.ts", "../../@microsoft/mgt-element/dist/es6/BetaGraph.ts", "../../lit-html/src/lib/dom.ts", "../../lit-html/src/lib/template.ts", "../../lit-html/src/lib/modify-template.ts", "../../lit-html/src/lib/directive.ts", "../../lit-html/src/lib/part.ts", "../../lit-html/src/lib/template-instance.ts", "../../lit-html/src/lib/template-result.ts", "../../lit-html/src/lib/parts.ts", "../../lit-html/src/lib/template-factory.ts", "../../lit-html/src/lib/render.ts", "../../lit-html/src/lib/default-template-processor.ts", "../../lit-html/src/lit-html.ts", "../../lit-html/src/lib/shady-render.ts", "../../lit-element/src/lib/updating-element.ts", "../../lit-element/src/lib/decorators.ts", "../../lit-element/src/lib/css-tag.ts", "../../lit-element/src/lit-element.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/EventDispatcher.ts", "../../@microsoft/mgt-element/dist/es6/providers/providers/IProvider.ts", "../../@microsoft/mgt-element/dist/es6/providers/providers/Providers.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/LocalizationHelper.ts", "../../@microsoft/mgt-element/dist/es6/components/components/baseComponent.ts", "../../@microsoft/mgt-element/dist/es6/components/components/baseProvider.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/equals.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/TemplateHelper.ts", "../../@microsoft/mgt-element/dist/es6/components/components/templatedComponent.ts", "../../@microsoft/mgt-element/dist/es6/providers/providers/SimpleProvider.ts", "../../idb/build/esm/wrap-idb-value.js", "../../idb/build/esm/index.js", "../../@microsoft/mgt-element/dist/es6/utils/utils/Cache.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/TeamsHelper.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/GraphPageIterator.ts", "../../@microsoft/mgt-element/dist/es6/utils/utils/SessionCache.ts", "../../@microsoft/mgt-element/dist/es6/mock/mock/MockGraph.ts", "../../@microsoft/mgt-element/dist/es6/mock/mock/MockProvider.ts", "../../@microsoft/mgt-element/dist/es6/mock/mock/mgt-mock-provider.ts"],
  "sourcesContent": ["/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * Represents a response from a request executed in a batch\n *\n * @export\n * @class BatchResponse\n */\n// tslint:disable-next-line:max-classes-per-file\nexport class BatchResponse {\n  /**\n   * The index of the requests as it was added to the queue\n   * Use this value if you need to sort the responses\n   * in the order they were added\n   *\n   * @type {number}\n   * @memberof BatchResponse\n   */\n  public index: number;\n\n  /**\n   * The id of the requests\n   *\n   * @type {string}\n   * @memberof BatchResponse\n   */\n  public id: string;\n\n  /**\n   * The content of the response\n   *\n   * @type {*}\n   * @memberof BatchResponse\n   */\n  public content: any;\n  /**\n   * The header of the response\n   * @type {*}\n   * @memberof BatchResponse\n   */\n  public headers: string[];\n}\n\n/**\n * Represents a collection of Graph requests to be sent simultaneously.\n *\n * @export\n * @interface IBatch\n */\nexport interface IBatch {\n  /**\n   * Get whether there are requests that have not been executed\n   *\n   * @readonly\n   * @memberof IBatch\n   */\n  readonly hasRequests: boolean;\n\n  /**\n   * sets new request and scopes\n   *\n   * @param {string} id\n   * @param {string} resource\n   * @param {string[]} [scopes]\n   * @param {{ [header: string]: string }} [headers]\n   * @memberof IBatch\n   */\n  get(id: string, resource: string, scopes?: string[], headers?: { [header: string]: string });\n\n  /**\n   * Execute the next set of requests.\n   * This will execute up to 20 requests at a time\n   *\n   * @returns {Promise<Map<string, BatchResponse>>}\n   * @memberof IBatch\n   */\n  executeNext(): Promise<Map<string, BatchResponse>>;\n\n  /**\n   * Execute all requests, up to 20 at a time until\n   * all requests have been executed\n   *\n   * @returns {Promise<Map<string, BatchResponse>>}\n   * @memberof IBatch\n   */\n  executeAll(): Promise<Map<string, BatchResponse>>;\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { Client, GraphRequest } from '@microsoft/microsoft-graph-client';\nimport { IBatch } from './IBatch';\n\n/**\n * The common functions of the Graph\n *\n * @export\n * @interface IGraph\n */\nexport interface IGraph {\n  /**\n   * the internal client used to make graph calls\n   *\n   * @type {Client}\n   * @memberof IGraph\n   */\n  readonly client: Client;\n\n  /**\n   * the component name appended to Graph request headers\n   *\n   * @type {string}\n   * @memberof IGraph\n   */\n  readonly componentName: string;\n\n  /**\n   * the version of the graph to query\n   *\n   * @type {string}\n   * @memberof IGraph\n   */\n  readonly version: string;\n\n  /**\n   * returns a new instance of the Graph using the same\n   * client within the context of the provider.\n   *\n   * @param {Element} component\n   * @returns {IGraph}\n   * @memberof IGraph\n   */\n  forComponent(component: Element): IGraph;\n\n  /**\n   * use this method to make calls directly to the Graph.\n   *\n   * @param {string} path\n   * @returns {GraphRequest}\n   * @memberof IGraph\n   */\n  api(path: string): GraphRequest;\n\n  /**\n   * creates a new batch request\n   *\n   * @returns {Batch}\n   * @memberof IGraph\n   */\n  createBatch(): IBatch;\n}\n\nexport type GraphEndpoint =\n  | 'https://graph.microsoft.com'\n  | 'https://graph.microsoft.us'\n  | 'https://dod-graph.microsoft.us'\n  | 'https://graph.microsoft.de'\n  | 'https://microsoftgraph.chinacloudapi.cn';\n\nexport const MICROSOFT_GRAPH_ENDPOINTS: Set<GraphEndpoint> = new Set<GraphEndpoint>();\nexport const MICROSOFT_GRAPH_DEFAULT_ENDPOINT: GraphEndpoint = 'https://graph.microsoft.com';\n\n(() => {\n  const endpoints: GraphEndpoint[] = [\n    MICROSOFT_GRAPH_DEFAULT_ENDPOINT,\n    'https://graph.microsoft.us',\n    'https://dod-graph.microsoft.us',\n    'https://graph.microsoft.de',\n    'https://microsoftgraph.chinacloudapi.cn'\n  ];\n  endpoints.forEach(endpoint => MICROSOFT_GRAPH_ENDPOINTS.add(endpoint));\n})();\n", "/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @enum\r\n * Enum for RequestMethods\r\n * @property {string} GET - The get request type\r\n * @property {string} PATCH - The patch request type\r\n * @property {string} POST - The post request type\r\n * @property {string} PUT - The put request type\r\n * @property {string} DELETE - The delete request type\r\n */\r\nexport enum RequestMethod {\r\n\tGET = \"GET\",\r\n\tPATCH = \"PATCH\",\r\n\tPOST = \"POST\",\r\n\tPUT = \"PUT\",\r\n\tDELETE = \"DELETE\",\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module BatchRequestContent\r\n */\r\nimport { RequestMethod } from \"../RequestMethod\";\r\n\r\n/**\r\n * @interface\r\n * Signature to represent the buffer request body parsing method\r\n * @property {Function} buffer - Returns a promise that resolves to a buffer of the request body\r\n */\r\ninterface NodeBody {\r\n\tbuffer(): Promise<Buffer>;\r\n}\r\n\r\n/**\r\n * @interface\r\n * Signature to represent the Request for both Node and browser environments\r\n * @extends Request\r\n * @extends NodeBody\r\n */\r\ninterface IsomorphicRequest extends Request, NodeBody {}\r\n\r\n/**\r\n * @interface\r\n * Signature representing BatchRequestStep data\r\n * @property {string} id - Unique identity for the request, Should not be an empty string\r\n * @property {string[]} [dependsOn] - Array of dependencies\r\n * @property {Request} request - The Request object\r\n */\r\nexport interface BatchRequestStep {\r\n\tid: string;\r\n\tdependsOn?: string[];\r\n\trequest: Request;\r\n}\r\n\r\n/**\r\n * @interface\r\n * Signature representing single request in a Batching\r\n * @extends RequestInit\r\n * @see {@link https://github.com/Microsoft/TypeScript/blob/master/lib/lib.dom.d.ts#L1337} and {@link https://fetch.spec.whatwg.org/#requestinit}\r\n *\r\n * @property {string} url - The url value of the request\r\n */\r\n\r\nexport interface RequestData extends RequestInit {\r\n\turl: string;\r\n}\r\n\r\n/**\r\n * @interface\r\n * Signature representing batch request data\r\n * @property {string} id - Unique identity for the request, Should not be an empty string\r\n * @property {string[]} [dependsOn] - Array of dependencies\r\n */\r\nexport interface BatchRequestData extends RequestData {\r\n\tid: string;\r\n\tdependsOn?: string[];\r\n}\r\n\r\n/**\r\n * @interface\r\n * Signature representing batch request body\r\n * @property {BatchRequestData[]} requests - Array of request data, a json representation of requests for batch\r\n */\r\n\r\nexport interface BatchRequestBody {\r\n\trequests: BatchRequestData[];\r\n}\r\n\r\n/**\r\n * @class\r\n * Class for handling BatchRequestContent\r\n */\r\nexport class BatchRequestContent {\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * Limit for number of requests {@link - https://developer.microsoft.com/en-us/graph/docs/concepts/known_issues#json-batching}\r\n\t */\r\n\tprivate static requestLimit: number = 20;\r\n\r\n\t/**\r\n\t * @public\r\n\t * To keep track of requests, key will be id of the request and value will be the request json\r\n\t */\r\n\tpublic requests: Map<string, BatchRequestStep>;\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * Validates the dependency chain of the requests\r\n\t *\r\n\t * Note:\r\n\t * Individual requests can depend on other individual requests. Currently, requests can only depend on a single other request, and must follow one of these three patterns:\r\n\t * 1. Parallel - no individual request states a dependency in the dependsOn property.\r\n\t * 2. Serial - all individual requests depend on the previous individual request.\r\n\t * 3. Same - all individual requests that state a dependency in the dependsOn property, state the same dependency.\r\n\t * As JSON batching matures, these limitations will be removed.\r\n\t * @see {@link https://developer.microsoft.com/en-us/graph/docs/concepts/known_issues#json-batching}\r\n\t *\r\n\t * @param {Map<string, BatchRequestStep>} requests - The map of requests.\r\n\t * @returns The boolean indicating the validation status\r\n\t */\r\n\r\n\tprivate static validateDependencies(requests: Map<string, BatchRequestStep>): boolean {\r\n\t\tconst isParallel = (reqs: Map<string, BatchRequestStep>): boolean => {\r\n\t\t\tconst iterator = reqs.entries();\r\n\t\t\tlet cur = iterator.next();\r\n\t\t\twhile (!cur.done) {\r\n\t\t\t\tconst curReq = cur.value[1];\r\n\t\t\t\tif (curReq.dependsOn !== undefined && curReq.dependsOn.length > 0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tcur = iterator.next();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tconst isSerial = (reqs: Map<string, BatchRequestStep>): boolean => {\r\n\t\t\tconst iterator = reqs.entries();\r\n\t\t\tlet cur = iterator.next();\r\n\t\t\tconst firstRequest: BatchRequestStep = cur.value[1];\r\n\t\t\tif (firstRequest.dependsOn !== undefined && firstRequest.dependsOn.length > 0) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tlet prev = cur;\r\n\t\t\tcur = iterator.next();\r\n\t\t\twhile (!cur.done) {\r\n\t\t\t\tconst curReq: BatchRequestStep = cur.value[1];\r\n\t\t\t\tif (curReq.dependsOn === undefined || curReq.dependsOn.length !== 1 || curReq.dependsOn[0] !== prev.value[1].id) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tprev = cur;\r\n\t\t\t\tcur = iterator.next();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tconst isSame = (reqs: Map<string, BatchRequestStep>): boolean => {\r\n\t\t\tconst iterator = reqs.entries();\r\n\t\t\tlet cur = iterator.next();\r\n\t\t\tconst firstRequest: BatchRequestStep = cur.value[1];\r\n\t\t\tlet dependencyId: string;\r\n\t\t\tif (firstRequest.dependsOn === undefined || firstRequest.dependsOn.length === 0) {\r\n\t\t\t\tdependencyId = firstRequest.id;\r\n\t\t\t} else {\r\n\t\t\t\tif (firstRequest.dependsOn.length === 1) {\r\n\t\t\t\t\tconst fDependencyId = firstRequest.dependsOn[0];\r\n\t\t\t\t\tif (fDependencyId !== firstRequest.id && reqs.has(fDependencyId)) {\r\n\t\t\t\t\t\tdependencyId = fDependencyId;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcur = iterator.next();\r\n\t\t\twhile (!cur.done) {\r\n\t\t\t\tconst curReq = cur.value[1];\r\n\t\t\t\tif ((curReq.dependsOn === undefined || curReq.dependsOn.length === 0) && dependencyId !== curReq.id) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\tif (curReq.dependsOn !== undefined && curReq.dependsOn.length !== 0) {\r\n\t\t\t\t\tif (curReq.dependsOn.length === 1 && (curReq.id === dependencyId || curReq.dependsOn[0] !== dependencyId)) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (curReq.dependsOn.length > 1) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tcur = iterator.next();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tif (requests.size === 0) {\r\n\t\t\tconst error = new Error(\"Empty requests map, Please provide at least one request.\");\r\n\t\t\terror.name = \"Empty Requests Error\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\treturn isParallel(requests) || isSerial(requests) || isSame(requests);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * @async\r\n\t * Converts Request Object instance to a JSON\r\n\t * @param {IsomorphicRequest} request - The IsomorphicRequest Object instance\r\n\t * @returns A promise that resolves to JSON representation of a request\r\n\t */\r\n\tprivate static async getRequestData(request: IsomorphicRequest): Promise<RequestData> {\r\n\t\tconst requestData: RequestData = {\r\n\t\t\turl: \"\",\r\n\t\t};\r\n\t\tconst hasHttpRegex = new RegExp(\"^https?://\");\r\n\t\t// Stripping off hostname, port and url scheme\r\n\t\trequestData.url = hasHttpRegex.test(request.url) ? \"/\" + request.url.split(/.*?\\/\\/.*?\\//)[1] : request.url;\r\n\t\trequestData.method = request.method;\r\n\t\tconst headers = {};\r\n\t\trequest.headers.forEach((value, key) => {\r\n\t\t\theaders[key] = value;\r\n\t\t});\r\n\t\tif (Object.keys(headers).length) {\r\n\t\t\trequestData.headers = headers;\r\n\t\t}\r\n\t\tif (request.method === RequestMethod.PATCH || request.method === RequestMethod.POST || request.method === RequestMethod.PUT) {\r\n\t\t\trequestData.body = await BatchRequestContent.getRequestBody(request);\r\n\t\t}\r\n\t\t/**\r\n\t\t * TODO: Check any other property needs to be used from the Request object and add them\r\n\t\t */\r\n\t\treturn requestData;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * @async\r\n\t * Gets the body of a Request object instance\r\n\t * @param {IsomorphicRequest} request - The IsomorphicRequest object instance\r\n\t * @returns The Promise that resolves to a body value of a Request\r\n\t */\r\n\tprivate static async getRequestBody(request: IsomorphicRequest): Promise<any> {\r\n\t\tlet bodyParsed: boolean = false;\r\n\t\tlet body;\r\n\t\ttry {\r\n\t\t\tconst cloneReq = request.clone();\r\n\t\t\tbody = await cloneReq.json();\r\n\t\t\tbodyParsed = true;\r\n\t\t} catch (e) {\r\n\t\t\t// tslint:disable-line: no-empty\r\n\t\t}\r\n\t\tif (!bodyParsed) {\r\n\t\t\ttry {\r\n\t\t\t\tif (typeof Blob !== \"undefined\") {\r\n\t\t\t\t\tconst blob = await request.blob();\r\n\t\t\t\t\tconst reader = new FileReader();\r\n\t\t\t\t\tbody = await new Promise((resolve) => {\r\n\t\t\t\t\t\treader.addEventListener(\r\n\t\t\t\t\t\t\t\"load\",\r\n\t\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t\tconst dataURL = reader.result as string;\r\n\t\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t\t * Some valid dataURL schemes:\r\n\t\t\t\t\t\t\t\t *  1. data:text/vnd-example+xyz;foo=bar;base64,R0lGODdh\r\n\t\t\t\t\t\t\t\t *  2. data:text/plain;charset=UTF-8;page=21,the%20data:1234,5678\r\n\t\t\t\t\t\t\t\t *  3. data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\r\n\t\t\t\t\t\t\t\t *  4. data:image/png,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\r\n\t\t\t\t\t\t\t\t *  5. data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==\r\n\t\t\t\t\t\t\t\t * @see Syntax {@link https://en.wikipedia.org/wiki/Data_URI_scheme} for more\r\n\t\t\t\t\t\t\t\t */\r\n\t\t\t\t\t\t\t\tconst regex = new RegExp(\"^s*data:(.+?/.+?(;.+?=.+?)*)?(;base64)?,(.*)s*$\");\r\n\t\t\t\t\t\t\t\tconst segments = regex.exec(dataURL);\r\n\t\t\t\t\t\t\t\tresolve(segments[4]);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\treader.readAsDataURL(blob);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (typeof Buffer !== \"undefined\") {\r\n\t\t\t\t\tconst buffer = await request.buffer();\r\n\t\t\t\t\tbody = buffer.toString(\"base64\");\r\n\t\t\t\t}\r\n\t\t\t\tbodyParsed = true;\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// tslint:disable-line: no-empty\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn body;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Constructs a BatchRequestContent instance\r\n\t * @param {BatchRequestStep[]} [requests] - Array of requests value\r\n\t * @returns An instance of a BatchRequestContent\r\n\t */\r\n\tpublic constructor(requests?: BatchRequestStep[]) {\r\n\t\tthis.requests = new Map();\r\n\t\tif (typeof requests !== \"undefined\") {\r\n\t\t\tconst limit = BatchRequestContent.requestLimit;\r\n\t\t\tif (requests.length > limit) {\r\n\t\t\t\tconst error = new Error(`Maximum requests limit exceeded, Max allowed number of requests are ${limit}`);\r\n\t\t\t\terror.name = \"Limit Exceeded Error\";\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t\tfor (const req of requests) {\r\n\t\t\t\tthis.addRequest(req);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Adds a request to the batch request content\r\n\t * @param {BatchRequestStep} request - The request value\r\n\t * @returns The id of the added request\r\n\t */\r\n\tpublic addRequest(request: BatchRequestStep): string {\r\n\t\tconst limit = BatchRequestContent.requestLimit;\r\n\t\tif (request.id === \"\") {\r\n\t\t\tconst error = new Error(`Id for a request is empty, Please provide an unique id`);\r\n\t\t\terror.name = \"Empty Id For Request\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tif (this.requests.size === limit) {\r\n\t\t\tconst error = new Error(`Maximum requests limit exceeded, Max allowed number of requests are ${limit}`);\r\n\t\t\terror.name = \"Limit Exceeded Error\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tif (this.requests.has(request.id)) {\r\n\t\t\tconst error = new Error(`Adding request with duplicate id ${request.id}, Make the id of the requests unique`);\r\n\t\t\terror.name = \"Duplicate RequestId Error\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tthis.requests.set(request.id, request);\r\n\t\treturn request.id;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Removes request from the batch payload and its dependencies from all dependents\r\n\t * @param {string} requestId - The id of a request that needs to be removed\r\n\t * @returns The boolean indicating removed status\r\n\t */\r\n\tpublic removeRequest(requestId: string): boolean {\r\n\t\tconst deleteStatus = this.requests.delete(requestId);\r\n\t\tconst iterator = this.requests.entries();\r\n\t\tlet cur = iterator.next();\r\n\t\t/**\r\n\t\t * Removing dependencies where this request is present as a dependency\r\n\t\t */\r\n\t\twhile (!cur.done) {\r\n\t\t\tconst dependencies = cur.value[1].dependsOn;\r\n\t\t\tif (typeof dependencies !== \"undefined\") {\r\n\t\t\t\tconst index = dependencies.indexOf(requestId);\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tdependencies.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t\tif (dependencies.length === 0) {\r\n\t\t\t\t\tdelete cur.value[1].dependsOn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcur = iterator.next();\r\n\t\t}\r\n\t\treturn deleteStatus;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Serialize content from BatchRequestContent instance\r\n\t * @returns The body content to make batch request\r\n\t */\r\n\tpublic async getContent(): Promise<BatchRequestBody> {\r\n\t\tconst requests: BatchRequestData[] = [];\r\n\t\tconst requestBody: BatchRequestBody = {\r\n\t\t\trequests,\r\n\t\t};\r\n\t\tconst iterator = this.requests.entries();\r\n\t\tlet cur = iterator.next();\r\n\t\tif (cur.done) {\r\n\t\t\tconst error = new Error(\"No requests added yet, Please add at least one request.\");\r\n\t\t\terror.name = \"Empty Payload\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tif (!BatchRequestContent.validateDependencies(this.requests)) {\r\n\t\t\tconst error = new Error(`Invalid dependency found, Dependency should be:\r\n1. Parallel - no individual request states a dependency in the dependsOn property.\r\n2. Serial - all individual requests depend on the previous individual request.\r\n3. Same - all individual requests that state a dependency in the dependsOn property, state the same dependency.`);\r\n\t\t\terror.name = \"Invalid Dependency\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\twhile (!cur.done) {\r\n\t\t\tconst requestStep: BatchRequestStep = cur.value[1];\r\n\t\t\tconst batchRequestData: BatchRequestData = (await BatchRequestContent.getRequestData(requestStep.request as IsomorphicRequest)) as BatchRequestData;\r\n\t\t\t/**\r\n\t\t\t * @see {@link https://developer.microsoft.com/en-us/graph/docs/concepts/json_batching#request-format}\r\n\t\t\t */\r\n\t\t\tif (batchRequestData.body !== undefined && (batchRequestData.headers === undefined || batchRequestData.headers[\"content-type\"] === undefined)) {\r\n\t\t\t\tconst error = new Error(`Content-type header is not mentioned for request #${requestStep.id}, For request having body, Content-type header should be mentioned`);\r\n\t\t\t\terror.name = \"Invalid Content-type header\";\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t\tbatchRequestData.id = requestStep.id;\r\n\t\t\tif (requestStep.dependsOn !== undefined && requestStep.dependsOn.length > 0) {\r\n\t\t\t\tbatchRequestData.dependsOn = requestStep.dependsOn;\r\n\t\t\t}\r\n\t\t\trequests.push(batchRequestData);\r\n\t\t\tcur = iterator.next();\r\n\t\t}\r\n\t\trequestBody.requests = requests;\r\n\t\treturn requestBody;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Adds a dependency for a given dependent request\r\n\t * @param {string} dependentId - The id of the dependent request\r\n\t * @param {string} [dependencyId] - The id of the dependency request, if not specified the preceding request will be considered as a dependency\r\n\t * @returns Nothing\r\n\t */\r\n\tpublic addDependency(dependentId: string, dependencyId?: string): void {\r\n\t\tif (!this.requests.has(dependentId)) {\r\n\t\t\tconst error = new Error(`Dependent ${dependentId} does not exists, Please check the id`);\r\n\t\t\terror.name = \"Invalid Dependent\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tif (typeof dependencyId !== \"undefined\" && !this.requests.has(dependencyId)) {\r\n\t\t\tconst error = new Error(`Dependency ${dependencyId} does not exists, Please check the id`);\r\n\t\t\terror.name = \"Invalid Dependency\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tif (typeof dependencyId !== \"undefined\") {\r\n\t\t\tconst dependent = this.requests.get(dependentId);\r\n\t\t\tif (dependent.dependsOn === undefined) {\r\n\t\t\t\tdependent.dependsOn = [];\r\n\t\t\t}\r\n\t\t\tif (dependent.dependsOn.indexOf(dependencyId) !== -1) {\r\n\t\t\t\tconst error = new Error(`Dependency ${dependencyId} is already added for the request ${dependentId}`);\r\n\t\t\t\terror.name = \"Duplicate Dependency\";\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t\tdependent.dependsOn.push(dependencyId);\r\n\t\t} else {\r\n\t\t\tconst iterator = this.requests.entries();\r\n\t\t\tlet prev;\r\n\t\t\tlet cur = iterator.next();\r\n\t\t\twhile (!cur.done && cur.value[1].id !== dependentId) {\r\n\t\t\t\tprev = cur;\r\n\t\t\t\tcur = iterator.next();\r\n\t\t\t}\r\n\t\t\tif (typeof prev !== \"undefined\") {\r\n\t\t\t\tconst dId = prev.value[0];\r\n\t\t\t\tif (cur.value[1].dependsOn === undefined) {\r\n\t\t\t\t\tcur.value[1].dependsOn = [];\r\n\t\t\t\t}\r\n\t\t\t\tif (cur.value[1].dependsOn.indexOf(dId) !== -1) {\r\n\t\t\t\t\tconst error = new Error(`Dependency ${dId} is already added for the request ${dependentId}`);\r\n\t\t\t\t\terror.name = \"Duplicate Dependency\";\r\n\t\t\t\t\tthrow error;\r\n\t\t\t\t}\r\n\t\t\t\tcur.value[1].dependsOn.push(dId);\r\n\t\t\t} else {\r\n\t\t\t\tconst error = new Error(`Can't add dependency ${dependencyId}, There is only a dependent request in the batch`);\r\n\t\t\t\terror.name = \"Invalid Dependency Addition\";\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Removes a dependency for a given dependent request id\r\n\t * @param {string} dependentId - The id of the dependent request\r\n\t * @param {string} [dependencyId] - The id of the dependency request, if not specified will remove all the dependencies of that request\r\n\t * @returns The boolean indicating removed status\r\n\t */\r\n\tpublic removeDependency(dependentId: string, dependencyId?: string): boolean {\r\n\t\tconst request = this.requests.get(dependentId);\r\n\t\tif (typeof request === \"undefined\" || request.dependsOn === undefined || request.dependsOn.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (typeof dependencyId !== \"undefined\") {\r\n\t\t\tconst index = request.dependsOn.indexOf(dependencyId);\r\n\t\t\tif (index === -1) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\trequest.dependsOn.splice(index, 1);\r\n\t\t\treturn true;\r\n\t\t} else {\r\n\t\t\tdelete request.dependsOn;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module MiddlewareControl\r\n */\r\n\r\nimport { MiddlewareOptions } from \"./options/IMiddlewareOptions\";\r\n\r\n/**\r\n * @class\r\n * Class representing MiddlewareControl\r\n */\r\nexport class MiddlewareControl {\r\n\t/**\r\n\t * @private\r\n\t * A member holding map of MiddlewareOptions\r\n\t */\r\n\t// tslint:disable-next-line:ban-types\r\n\tprivate middlewareOptions: Map<Function, MiddlewareOptions>;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Creates an instance of MiddlewareControl\r\n\t * @param {MiddlewareOptions[]} [middlewareOptions = []] - The array of middlewareOptions\r\n\t * @returns The instance of MiddlewareControl\r\n\t */\r\n\tpublic constructor(middlewareOptions: MiddlewareOptions[] = []) {\r\n\t\t// tslint:disable-next-line:ban-types\r\n\t\tthis.middlewareOptions = new Map<Function, MiddlewareOptions>();\r\n\t\tfor (const option of middlewareOptions) {\r\n\t\t\tconst fn = option.constructor;\r\n\t\t\tthis.middlewareOptions.set(fn, option);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To get the middleware option using the class of the option\r\n\t * @param {Function} fn - The class of the strongly typed option class\r\n\t * @returns The middleware option\r\n\t * @example\r\n\t * // if you wanted to return the middleware option associated with this class (MiddlewareControl)\r\n\t * // call this function like this:\r\n\t * getMiddlewareOptions(MiddlewareControl)\r\n\t */\r\n\t// tslint:disable-next-line:ban-types\r\n\tpublic getMiddlewareOptions(fn: Function): MiddlewareOptions {\r\n\t\treturn this.middlewareOptions.get(fn);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To set the middleware options using the class of the option\r\n\t * @param {Function} fn - The class of the strongly typed option class\r\n\t * @param {MiddlewareOptions} option - The strongly typed middleware option\r\n\t * @returns nothing\r\n\t */\r\n\t// tslint:disable-next-line:ban-types\r\n\tpublic setMiddlewareOptions(fn: Function, option: MiddlewareOptions): void {\r\n\t\tthis.middlewareOptions.set(fn, option);\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module MiddlewareUtil\r\n */\r\n\r\nimport { FetchOptions } from \"../IFetchOptions\";\r\n\r\n/**\r\n * @constant\r\n * To generate the UUID\r\n * @returns The UUID string\r\n */\r\nexport const generateUUID = (): string => {\r\n\tlet uuid: string = \"\";\r\n\tfor (let j = 0; j < 32; j++) {\r\n\t\tif (j === 8 || j === 12 || j === 16 || j === 20) {\r\n\t\t\tuuid += \"-\";\r\n\t\t}\r\n\t\tuuid += Math.floor(Math.random() * 16).toString(16);\r\n\t}\r\n\treturn uuid;\r\n};\r\n\r\n/**\r\n * @constant\r\n * To get the request header from the request\r\n * @param {RequestInfo} request - The request object or the url string\r\n * @param {FetchOptions|undefined} options - The request options object\r\n * @param {string} key - The header key string\r\n * @returns A header value for the given key from the request\r\n */\r\nexport const getRequestHeader = (request: RequestInfo, options: FetchOptions | undefined, key: string): string | null => {\r\n\tlet value: string = null;\r\n\tif (typeof Request !== \"undefined\" && request instanceof Request) {\r\n\t\tvalue = (request as Request).headers.get(key);\r\n\t} else if (typeof options !== \"undefined\" && options.headers !== undefined) {\r\n\t\tif (typeof Headers !== \"undefined\" && options.headers instanceof Headers) {\r\n\t\t\tvalue = (options.headers as Headers).get(key);\r\n\t\t} else if (options.headers instanceof Array) {\r\n\t\t\tconst headers = options.headers as string[][];\r\n\t\t\tfor (let i = 0, l = headers.length; i < l; i++) {\r\n\t\t\t\tif (headers[i][0] === key) {\r\n\t\t\t\t\tvalue = headers[i][1];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (options.headers[key] !== undefined) {\r\n\t\t\tvalue = options.headers[key];\r\n\t\t}\r\n\t}\r\n\treturn value;\r\n};\r\n\r\n/**\r\n * @constant\r\n * To set the header value to the given request\r\n * @param {RequestInfo} request - The request object or the url string\r\n * @param {FetchOptions|undefined} options - The request options object\r\n * @param {string} key - The header key string\r\n * @param {string } value - The header value string\r\n * @returns Nothing\r\n */\r\nexport const setRequestHeader = (request: RequestInfo, options: FetchOptions | undefined, key: string, value: string): void => {\r\n\tif (typeof Request !== \"undefined\" && request instanceof Request) {\r\n\t\t(request as Request).headers.set(key, value);\r\n\t} else if (typeof options !== \"undefined\") {\r\n\t\tif (options.headers === undefined) {\r\n\t\t\toptions.headers = new Headers({\r\n\t\t\t\t[key]: value,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (typeof Headers !== \"undefined\" && options.headers instanceof Headers) {\r\n\t\t\t\t(options.headers as Headers).set(key, value);\r\n\t\t\t} else if (options.headers instanceof Array) {\r\n\t\t\t\tlet i = 0;\r\n\t\t\t\tconst l = options.headers.length;\r\n\t\t\t\tfor (; i < l; i++) {\r\n\t\t\t\t\tconst header = options.headers[i];\r\n\t\t\t\t\tif (header[0] === key) {\r\n\t\t\t\t\t\theader[1] = value;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (i === l) {\r\n\t\t\t\t\t(options.headers as string[][]).push([key, value]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(options.headers, { [key]: value });\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @constant\r\n * To append the header value to the given request\r\n * @param {RequestInfo} request - The request object or the url string\r\n * @param {FetchOptions|undefined} options - The request options object\r\n * @param {string} key - The header key string\r\n * @param {string } value - The header value string\r\n * @returns Nothing\r\n */\r\nexport const appendRequestHeader = (request: RequestInfo, options: FetchOptions | undefined, key: string, value: string): void => {\r\n\tif (typeof Request !== \"undefined\" && request instanceof Request) {\r\n\t\t(request as Request).headers.append(key, value);\r\n\t} else if (typeof options !== \"undefined\") {\r\n\t\tif (options.headers === undefined) {\r\n\t\t\toptions.headers = new Headers({\r\n\t\t\t\t[key]: value,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (typeof Headers !== \"undefined\" && options.headers instanceof Headers) {\r\n\t\t\t\t(options.headers as Headers).append(key, value);\r\n\t\t\t} else if (options.headers instanceof Array) {\r\n\t\t\t\t(options.headers as string[][]).push([key, value]);\r\n\t\t\t} else if (options.headers === undefined) {\r\n\t\t\t\toptions.headers = { [key]: value };\r\n\t\t\t} else if (options.headers[key] === undefined) {\r\n\t\t\t\toptions.headers[key] = value;\r\n\t\t\t} else {\r\n\t\t\t\toptions.headers[key] += `, ${value}`;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @constant\r\n * To clone the request with the new url\r\n * @param {string} url - The new url string\r\n * @param {Request} request - The request object\r\n * @returns A promise that resolves to request object\r\n */\r\nexport const cloneRequestWithNewUrl = async (newUrl: string, request: Request): Promise<Request> => {\r\n\tconst body = request.headers.get(\"Content-Type\") ? await request.blob() : await Promise.resolve(undefined);\r\n\tconst { method, headers, referrer, referrerPolicy, mode, credentials, cache, redirect, integrity, keepalive, signal } = request;\r\n\treturn new Request(newUrl, { method, headers, body, referrer, referrerPolicy, mode, credentials, cache, redirect, integrity, keepalive, signal });\r\n};\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module AuthenticationHandlerOptions\r\n */\r\n\r\nimport { AuthenticationProvider } from \"../../IAuthenticationProvider\";\r\nimport { AuthenticationProviderOptions } from \"../../IAuthenticationProviderOptions\";\r\n\r\nimport { MiddlewareOptions } from \"./IMiddlewareOptions\";\r\n\r\n/**\r\n * @class\r\n * @implements MiddlewareOptions\r\n * Class representing AuthenticationHandlerOptions\r\n */\r\nexport class AuthenticationHandlerOptions implements MiddlewareOptions {\r\n\t/**\r\n\t * @public\r\n\t * A member holding an instance of an authentication provider\r\n\t */\r\n\tpublic authenticationProvider: AuthenticationProvider;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding an instance of authentication provider options\r\n\t */\r\n\tpublic authenticationProviderOptions: AuthenticationProviderOptions;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * To create an instance of AuthenticationHandlerOptions\r\n\t * @param {AuthenticationProvider} [authenticationProvider] - The authentication provider instance\r\n\t * @param {AuthenticationProviderOptions} [authenticationProviderOptions] - The authentication provider options instance\r\n\t * @returns An instance of AuthenticationHandlerOptions\r\n\t */\r\n\tpublic constructor(authenticationProvider?: AuthenticationProvider, authenticationProviderOptions?: AuthenticationProviderOptions) {\r\n\t\tthis.authenticationProvider = authenticationProvider;\r\n\t\tthis.authenticationProviderOptions = authenticationProviderOptions;\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module TelemetryHandlerOptions\r\n */\r\n\r\nimport { Context } from \"../../IContext\";\r\nimport { MiddlewareControl } from \"../MiddlewareControl\";\r\n\r\nimport { MiddlewareOptions } from \"./IMiddlewareOptions\";\r\n\r\n/**\r\n * @enum\r\n * @property {number} NONE - The hexadecimal flag value for nothing enabled\r\n * @property {number} REDIRECT_HANDLER_ENABLED - The hexadecimal flag value for redirect handler enabled\r\n * @property {number} RETRY_HANDLER_ENABLED - The hexadecimal flag value for retry handler enabled\r\n * @property {number} AUTHENTICATION_HANDLER_ENABLED - The hexadecimal flag value for the authentication handler enabled\r\n */\r\nexport enum FeatureUsageFlag {\r\n\tNONE = 0x0,\r\n\tREDIRECT_HANDLER_ENABLED = 0x1,\r\n\tRETRY_HANDLER_ENABLED = 0x2,\r\n\tAUTHENTICATION_HANDLER_ENABLED = 0x4,\r\n}\r\n\r\n/**\r\n * @class\r\n * @implements MiddlewareOptions\r\n * Class for TelemetryHandlerOptions\r\n */\r\n\r\nexport class TelemetryHandlerOptions implements MiddlewareOptions {\r\n\t/**\r\n\t * @private\r\n\t * A member to hold the OR of feature usage flags\r\n\t */\r\n\tprivate featureUsage: FeatureUsageFlag = FeatureUsageFlag.NONE;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * To update the feature usage in the context object\r\n\t * @param {Context} context - The request context object containing middleware options\r\n\t * @param {FeatureUsageFlag} flag - The flag value\r\n\t * @returns nothing\r\n\t */\r\n\tpublic static updateFeatureUsageFlag(context: Context, flag: FeatureUsageFlag): void {\r\n\t\tlet options: TelemetryHandlerOptions;\r\n\t\tif (context.middlewareControl instanceof MiddlewareControl) {\r\n\t\t\toptions = context.middlewareControl.getMiddlewareOptions(TelemetryHandlerOptions) as TelemetryHandlerOptions;\r\n\t\t} else {\r\n\t\t\tcontext.middlewareControl = new MiddlewareControl();\r\n\t\t}\r\n\t\tif (typeof options === \"undefined\") {\r\n\t\t\toptions = new TelemetryHandlerOptions();\r\n\t\t\tcontext.middlewareControl.setMiddlewareOptions(TelemetryHandlerOptions, options);\r\n\t\t}\r\n\t\toptions.setFeatureUsage(flag);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To set the feature usage flag\r\n\t * @param {FeatureUsageFlag} flag - The flag value\r\n\t * @returns nothing\r\n\t */\r\n\tprivate setFeatureUsage(flag: FeatureUsageFlag): void {\r\n\t\t/* tslint:disable: no-bitwise */\r\n\t\tthis.featureUsage = this.featureUsage | flag;\r\n\t\t/* tslint:enable: no-bitwise */\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To get the feature usage\r\n\t * @returns A feature usage flag as hexadecimal string\r\n\t */\r\n\tpublic getFeatureUsage(): string {\r\n\t\treturn this.featureUsage.toString(16);\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module AuthenticationHandler\r\n */\r\n\r\nimport { AuthenticationProvider } from \"../IAuthenticationProvider\";\r\nimport { AuthenticationProviderOptions } from \"../IAuthenticationProviderOptions\";\r\nimport { Context } from \"../IContext\";\r\n\r\nimport { Middleware } from \"./IMiddleware\";\r\nimport { MiddlewareControl } from \"./MiddlewareControl\";\r\nimport { appendRequestHeader } from \"./MiddlewareUtil\";\r\nimport { AuthenticationHandlerOptions } from \"./options/AuthenticationHandlerOptions\";\r\nimport { FeatureUsageFlag, TelemetryHandlerOptions } from \"./options/TelemetryHandlerOptions\";\r\n\r\n/**\r\n * @class\r\n * @implements Middleware\r\n * Class representing AuthenticationHandler\r\n */\r\nexport class AuthenticationHandler implements Middleware {\r\n\t/**\r\n\t * @private\r\n\t * A member representing the authorization header name\r\n\t */\r\n\tprivate static AUTHORIZATION_HEADER: string = \"Authorization\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member to hold an AuthenticationProvider instance\r\n\t */\r\n\tprivate authenticationProvider: AuthenticationProvider;\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member to hold next middleware in the middleware chain\r\n\t */\r\n\tprivate nextMiddleware: Middleware;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Creates an instance of AuthenticationHandler\r\n\t * @param {AuthenticationProvider} authenticationProvider - The authentication provider for the authentication handler\r\n\t */\r\n\tpublic constructor(authenticationProvider: AuthenticationProvider) {\r\n\t\tthis.authenticationProvider = authenticationProvider;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * To execute the current middleware\r\n\t * @param {Context} context - The context object of the request\r\n\t * @returns A Promise that resolves to nothing\r\n\t */\r\n\tpublic async execute(context: Context): Promise<void> {\r\n\t\ttry {\r\n\t\t\tlet options: AuthenticationHandlerOptions;\r\n\t\t\tif (context.middlewareControl instanceof MiddlewareControl) {\r\n\t\t\t\toptions = context.middlewareControl.getMiddlewareOptions(AuthenticationHandlerOptions) as AuthenticationHandlerOptions;\r\n\t\t\t}\r\n\t\t\tlet authenticationProvider: AuthenticationProvider;\r\n\t\t\tlet authenticationProviderOptions: AuthenticationProviderOptions;\r\n\t\t\tif (typeof options !== \"undefined\") {\r\n\t\t\t\tauthenticationProvider = options.authenticationProvider;\r\n\t\t\t\tauthenticationProviderOptions = options.authenticationProviderOptions;\r\n\t\t\t}\r\n\t\t\tif (typeof authenticationProvider === \"undefined\") {\r\n\t\t\t\tauthenticationProvider = this.authenticationProvider;\r\n\t\t\t}\r\n\t\t\tconst token: string = await authenticationProvider.getAccessToken(authenticationProviderOptions);\r\n\t\t\tconst bearerKey: string = `Bearer ${token}`;\r\n\t\t\tappendRequestHeader(context.request, context.options, AuthenticationHandler.AUTHORIZATION_HEADER, bearerKey);\r\n\t\t\tTelemetryHandlerOptions.updateFeatureUsageFlag(context, FeatureUsageFlag.AUTHENTICATION_HANDLER_ENABLED);\r\n\t\t\treturn await this.nextMiddleware.execute(context);\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To set the next middleware in the chain\r\n\t * @param {Middleware} next - The middleware instance\r\n\t * @returns Nothing\r\n\t */\r\n\tpublic setNext(next: Middleware): void {\r\n\t\tthis.nextMiddleware = next;\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module HTTPMessageHandler\r\n */\r\n\r\nimport { Context } from \"../IContext\";\r\n\r\nimport { Middleware } from \"./IMiddleware\";\r\n\r\n/**\r\n * @class\r\n * @implements Middleware\r\n * Class for HTTPMessageHandler\r\n */\r\nexport class HTTPMessageHandler implements Middleware {\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * To execute the current middleware\r\n\t * @param {Context} context - The request context object\r\n\t * @returns A promise that resolves to nothing\r\n\t */\r\n\tpublic async execute(context: Context): Promise<void> {\r\n\t\ttry {\r\n\t\t\tcontext.response = await fetch(context.request, context.options);\r\n\t\t\treturn;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module RetryHandlerOptions\r\n */\r\n\r\nimport { FetchOptions } from \"../../IFetchOptions\";\r\n\r\nimport { MiddlewareOptions } from \"./IMiddlewareOptions\";\r\n\r\n/**\r\n * @type\r\n * A type declaration for shouldRetry callback\r\n */\r\nexport type ShouldRetry = (delay: number, attempt: number, request: RequestInfo, options: FetchOptions | undefined, response: Response) => boolean;\r\n\r\n/**\r\n * @class\r\n * @implements MiddlewareOptions\r\n * Class for RetryHandlerOptions\r\n */\r\n\r\nexport class RetryHandlerOptions implements MiddlewareOptions {\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding default delay value in seconds\r\n\t */\r\n\tprivate static DEFAULT_DELAY: number = 3;\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding default maxRetries value\r\n\t */\r\n\tprivate static DEFAULT_MAX_RETRIES: number = 3;\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding maximum delay value in seconds\r\n\t */\r\n\tprivate static MAX_DELAY: number = 180;\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding maximum maxRetries value\r\n\t */\r\n\tprivate static MAX_MAX_RETRIES: number = 10;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding delay value in seconds\r\n\t */\r\n\tpublic delay: number;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding maxRetries value\r\n\t */\r\n\tpublic maxRetries: number;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding shouldRetry callback\r\n\t */\r\n\tpublic shouldRetry: ShouldRetry;\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member holding default shouldRetry callback\r\n\t */\r\n\tprivate static DEFAULT_SHOULD_RETRY: ShouldRetry = () => true;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * To create an instance of RetryHandlerOptions\r\n\t * @param {number} [delay = RetryHandlerOptions.DEFAULT_DELAY] - The delay value in seconds\r\n\t * @param {number} [maxRetries = RetryHandlerOptions.DEFAULT_MAX_RETRIES] - The maxRetries value\r\n\t * @param {ShouldRetry} [shouldRetry = RetryHandlerOptions.DEFAULT_SHOULD_RETRY] - The shouldRetry callback function\r\n\t * @returns An instance of RetryHandlerOptions\r\n\t */\r\n\tpublic constructor(delay: number = RetryHandlerOptions.DEFAULT_DELAY, maxRetries: number = RetryHandlerOptions.DEFAULT_MAX_RETRIES, shouldRetry: ShouldRetry = RetryHandlerOptions.DEFAULT_SHOULD_RETRY) {\r\n\t\tif (delay > RetryHandlerOptions.MAX_DELAY && maxRetries > RetryHandlerOptions.MAX_MAX_RETRIES) {\r\n\t\t\tconst error = new Error(`Delay and MaxRetries should not be more than ${RetryHandlerOptions.MAX_DELAY} and ${RetryHandlerOptions.MAX_MAX_RETRIES}`);\r\n\t\t\terror.name = \"MaxLimitExceeded\";\r\n\t\t\tthrow error;\r\n\t\t} else if (delay > RetryHandlerOptions.MAX_DELAY) {\r\n\t\t\tconst error = new Error(`Delay should not be more than ${RetryHandlerOptions.MAX_DELAY}`);\r\n\t\t\terror.name = \"MaxLimitExceeded\";\r\n\t\t\tthrow error;\r\n\t\t} else if (maxRetries > RetryHandlerOptions.MAX_MAX_RETRIES) {\r\n\t\t\tconst error = new Error(`MaxRetries should not be more than ${RetryHandlerOptions.MAX_MAX_RETRIES}`);\r\n\t\t\terror.name = \"MaxLimitExceeded\";\r\n\t\t\tthrow error;\r\n\t\t} else if (delay < 0 && maxRetries < 0) {\r\n\t\t\tconst error = new Error(`Delay and MaxRetries should not be negative`);\r\n\t\t\terror.name = \"MinExpectationNotMet\";\r\n\t\t\tthrow error;\r\n\t\t} else if (delay < 0) {\r\n\t\t\tconst error = new Error(`Delay should not be negative`);\r\n\t\t\terror.name = \"MinExpectationNotMet\";\r\n\t\t\tthrow error;\r\n\t\t} else if (maxRetries < 0) {\r\n\t\t\tconst error = new Error(`MaxRetries should not be negative`);\r\n\t\t\terror.name = \"MinExpectationNotMet\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tthis.delay = Math.min(delay, RetryHandlerOptions.MAX_DELAY);\r\n\t\tthis.maxRetries = Math.min(maxRetries, RetryHandlerOptions.MAX_MAX_RETRIES);\r\n\t\tthis.shouldRetry = shouldRetry;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To get the maximum delay\r\n\t * @returns A maximum delay\r\n\t */\r\n\tpublic getMaxDelay(): number {\r\n\t\treturn RetryHandlerOptions.MAX_DELAY;\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module RetryHandler\r\n */\r\n\r\nimport { Context } from \"../IContext\";\r\nimport { FetchOptions } from \"../IFetchOptions\";\r\nimport { RequestMethod } from \"../RequestMethod\";\r\n\r\nimport { Middleware } from \"./IMiddleware\";\r\nimport { MiddlewareControl } from \"./MiddlewareControl\";\r\nimport { getRequestHeader, setRequestHeader } from \"./MiddlewareUtil\";\r\nimport { RetryHandlerOptions } from \"./options/RetryHandlerOptions\";\r\nimport { FeatureUsageFlag, TelemetryHandlerOptions } from \"./options/TelemetryHandlerOptions\";\r\n\r\n/**\r\n * @class\r\n * @implements Middleware\r\n * Class for RetryHandler\r\n */\r\nexport class RetryHandler implements Middleware {\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A list of status codes that needs to be retried\r\n\t */\r\n\tprivate static RETRY_STATUS_CODES: number[] = [\r\n\t\t429, // Too many requests\r\n\t\t503, // Service unavailable\r\n\t\t504, // Gateway timeout\r\n\t];\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding the name of retry attempt header\r\n\t */\r\n\tprivate static RETRY_ATTEMPT_HEADER: string = \"Retry-Attempt\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding the name of retry after header\r\n\t */\r\n\tprivate static RETRY_AFTER_HEADER: string = \"Retry-After\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member to hold next middleware in the middleware chain\r\n\t */\r\n\tprivate nextMiddleware: Middleware;\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member holding the retry handler options\r\n\t */\r\n\tprivate options: RetryHandlerOptions;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * To create an instance of RetryHandler\r\n\t * @param {RetryHandlerOptions} [options = new RetryHandlerOptions()] - The retry handler options value\r\n\t * @returns An instance of RetryHandler\r\n\t */\r\n\tpublic constructor(options: RetryHandlerOptions = new RetryHandlerOptions()) {\r\n\t\tthis.options = options;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @private\r\n\t * To check whether the response has the retry status code\r\n\t * @param {Response} response - The response object\r\n\t * @returns Whether the response has retry status code or not\r\n\t */\r\n\tprivate isRetry(response: Response): boolean {\r\n\t\treturn RetryHandler.RETRY_STATUS_CODES.indexOf(response.status) !== -1;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To check whether the payload is buffered or not\r\n\t * @param {RequestInfo} request - The url string or the request object value\r\n\t * @param {FetchOptions} options - The options of a request\r\n\t * @returns Whether the payload is buffered or not\r\n\t */\r\n\tprivate isBuffered(request: RequestInfo, options: FetchOptions | undefined): boolean {\r\n\t\tconst method = typeof request === \"string\" ? options.method : (request as Request).method;\r\n\t\tconst isPutPatchOrPost: boolean = method === RequestMethod.PUT || method === RequestMethod.PATCH || method === RequestMethod.POST;\r\n\t\tif (isPutPatchOrPost) {\r\n\t\t\tconst isStream = getRequestHeader(request, options, \"Content-Type\") === \"application/octet-stream\";\r\n\t\t\tif (isStream) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To get the delay for a retry\r\n\t * @param {Response} response - The response object\r\n\t * @param {number} retryAttempts - The current attempt count\r\n\t * @param {number} delay - The delay value in seconds\r\n\t * @returns A delay for a retry\r\n\t */\r\n\tprivate getDelay(response: Response, retryAttempts: number, delay: number): number {\r\n\t\tconst getRandomness = () => Number(Math.random().toFixed(3));\r\n\t\tconst retryAfter = response.headers !== undefined ? response.headers.get(RetryHandler.RETRY_AFTER_HEADER) : null;\r\n\t\tlet newDelay: number;\r\n\t\tif (retryAfter !== null) {\r\n\t\t\t// tslint:disable: prefer-conditional-expression\r\n\t\t\tif (Number.isNaN(Number(retryAfter))) {\r\n\t\t\t\tnewDelay = Math.round((new Date(retryAfter).getTime() - Date.now()) / 1000);\r\n\t\t\t} else {\r\n\t\t\t\tnewDelay = Number(retryAfter);\r\n\t\t\t}\r\n\t\t\t// tslint:enable: prefer-conditional-expression\r\n\t\t} else {\r\n\t\t\t// Adding randomness to avoid retrying at a same\r\n\t\t\tnewDelay = retryAttempts >= 2 ? this.getExponentialBackOffTime(retryAttempts) + delay + getRandomness() : delay + getRandomness();\r\n\t\t}\r\n\t\treturn Math.min(newDelay, this.options.getMaxDelay() + getRandomness());\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To get an exponential back off value\r\n\t * @param {number} attempts - The current attempt count\r\n\t * @returns An exponential back off value\r\n\t */\r\n\tprivate getExponentialBackOffTime(attempts: number): number {\r\n\t\treturn Math.round((1 / 2) * (2 ** attempts - 1));\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @async\r\n\t * To add delay for the execution\r\n\t * @param {number} delaySeconds - The delay value in seconds\r\n\t * @returns Nothing\r\n\t */\r\n\tprivate async sleep(delaySeconds: number): Promise<void> {\r\n\t\tconst delayMilliseconds = delaySeconds * 1000;\r\n\t\treturn new Promise((resolve) => setTimeout(resolve, delayMilliseconds));\r\n\t}\r\n\r\n\tprivate getOptions(context: Context): RetryHandlerOptions {\r\n\t\tlet options: RetryHandlerOptions;\r\n\t\tif (context.middlewareControl instanceof MiddlewareControl) {\r\n\t\t\toptions = context.middlewareControl.getMiddlewareOptions(this.options.constructor) as RetryHandlerOptions;\r\n\t\t}\r\n\t\tif (typeof options === \"undefined\") {\r\n\t\t\toptions = Object.assign(new RetryHandlerOptions(), this.options);\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @async\r\n\t * To execute the middleware with retries\r\n\t * @param {Context} context - The context object\r\n\t * @param {number} retryAttempts - The current attempt count\r\n\t * @param {RetryHandlerOptions} options - The retry middleware options instance\r\n\t * @returns A Promise that resolves to nothing\r\n\t */\r\n\tprivate async executeWithRetry(context: Context, retryAttempts: number, options: RetryHandlerOptions): Promise<void> {\r\n\t\ttry {\r\n\t\t\tawait this.nextMiddleware.execute(context);\r\n\t\t\tif (retryAttempts < options.maxRetries && this.isRetry(context.response) && this.isBuffered(context.request, context.options) && options.shouldRetry(options.delay, retryAttempts, context.request, context.options, context.response)) {\r\n\t\t\t\t++retryAttempts;\r\n\t\t\t\tsetRequestHeader(context.request, context.options, RetryHandler.RETRY_ATTEMPT_HEADER, retryAttempts.toString());\r\n\t\t\t\tconst delay = this.getDelay(context.response, retryAttempts, options.delay);\r\n\t\t\t\tawait this.sleep(delay);\r\n\t\t\t\treturn await this.executeWithRetry(context, retryAttempts, options);\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * To execute the current middleware\r\n\t * @param {Context} context - The context object of the request\r\n\t * @returns A Promise that resolves to nothing\r\n\t */\r\n\tpublic async execute(context: Context): Promise<void> {\r\n\t\ttry {\r\n\t\t\tconst retryAttempts: number = 0;\r\n\t\t\tconst options: RetryHandlerOptions = this.getOptions(context);\r\n\t\t\tTelemetryHandlerOptions.updateFeatureUsageFlag(context, FeatureUsageFlag.RETRY_HANDLER_ENABLED);\r\n\t\t\treturn await this.executeWithRetry(context, retryAttempts, options);\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To set the next middleware in the chain\r\n\t * @param {Middleware} next - The middleware instance\r\n\t * @returns Nothing\r\n\t */\r\n\tpublic setNext(next: Middleware): void {\r\n\t\tthis.nextMiddleware = next;\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module RedirectHandlerOptions\r\n */\r\n\r\nimport { MiddlewareOptions } from \"./IMiddlewareOptions\";\r\n\r\n/**\r\n * @type\r\n * A type declaration for shouldRetry callback\r\n */\r\nexport type ShouldRedirect = (response: Response) => boolean;\r\n\r\n/**\r\n * @class\r\n * @implements MiddlewareOptions\r\n * A class representing RedirectHandlerOptions\r\n */\r\nexport class RedirectHandlerOptions implements MiddlewareOptions {\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding default max redirects value\r\n\t */\r\n\tprivate static DEFAULT_MAX_REDIRECTS: number = 5;\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding maximum max redirects value\r\n\t */\r\n\tprivate static MAX_MAX_REDIRECTS: number = 20;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding max redirects value\r\n\t */\r\n\tpublic maxRedirects: number;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding shouldRedirect callback\r\n\t */\r\n\tpublic shouldRedirect: ShouldRedirect;\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member holding default shouldRedirect callback\r\n\t */\r\n\tprivate static DEFAULT_SHOULD_RETRY: ShouldRedirect = () => true;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * To create an instance of RedirectHandlerOptions\r\n\t * @param {number} [maxRedirects = RedirectHandlerOptions.DEFAULT_MAX_REDIRECTS] - The max redirects value\r\n\t * @param {ShouldRedirect} [shouldRedirect = RedirectHandlerOptions.DEFAULT_SHOULD_RETRY] - The should redirect callback\r\n\t * @returns An instance of RedirectHandlerOptions\r\n\t */\r\n\tpublic constructor(maxRedirects: number = RedirectHandlerOptions.DEFAULT_MAX_REDIRECTS, shouldRedirect: ShouldRedirect = RedirectHandlerOptions.DEFAULT_SHOULD_RETRY) {\r\n\t\tif (maxRedirects > RedirectHandlerOptions.MAX_MAX_REDIRECTS) {\r\n\t\t\tconst error = new Error(`MaxRedirects should not be more than ${RedirectHandlerOptions.MAX_MAX_REDIRECTS}`);\r\n\t\t\terror.name = \"MaxLimitExceeded\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tif (maxRedirects < 0) {\r\n\t\t\tconst error = new Error(`MaxRedirects should not be negative`);\r\n\t\t\terror.name = \"MinExpectationNotMet\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tthis.maxRedirects = maxRedirects;\r\n\t\tthis.shouldRedirect = shouldRedirect;\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module RedirectHandler\r\n */\r\n\r\nimport { Context } from \"../IContext\";\r\nimport { RequestMethod } from \"../RequestMethod\";\r\n\r\nimport { Middleware } from \"./IMiddleware\";\r\nimport { MiddlewareControl } from \"./MiddlewareControl\";\r\nimport { cloneRequestWithNewUrl, setRequestHeader } from \"./MiddlewareUtil\";\r\nimport { RedirectHandlerOptions } from \"./options/RedirectHandlerOptions\";\r\nimport { FeatureUsageFlag, TelemetryHandlerOptions } from \"./options/TelemetryHandlerOptions\";\r\n\r\n/**\r\n * @class\r\n * Class\r\n * @implements Middleware\r\n * Class representing RedirectHandler\r\n */\r\nexport class RedirectHandler implements Middleware {\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding the array of redirect status codes\r\n\t */\r\n\tprivate static REDIRECT_STATUS_CODES: number[] = [\r\n\t\t301, // Moved Permanently\r\n\t\t302, // Found\r\n\t\t303, // See Other\r\n\t\t307, // Temporary Permanently\r\n\t\t308, // Moved Permanently\r\n\t];\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding SeeOther status code\r\n\t */\r\n\tprivate static STATUS_CODE_SEE_OTHER: number = 303;\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding the name of the location header\r\n\t */\r\n\tprivate static LOCATION_HEADER: string = \"Location\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member representing the authorization header name\r\n\t */\r\n\tprivate static AUTHORIZATION_HEADER: string = \"Authorization\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding the manual redirect value\r\n\t */\r\n\tprivate static MANUAL_REDIRECT: RequestRedirect = \"manual\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member holding options to customize the handler behavior\r\n\t */\r\n\tprivate options: RedirectHandlerOptions;\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member to hold next middleware in the middleware chain\r\n\t */\r\n\tprivate nextMiddleware: Middleware;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * To create an instance of RedirectHandler\r\n\t * @param {RedirectHandlerOptions} [options = new RedirectHandlerOptions()] - The redirect handler options instance\r\n\t * @returns An instance of RedirectHandler\r\n\t */\r\n\r\n\tpublic constructor(options: RedirectHandlerOptions = new RedirectHandlerOptions()) {\r\n\t\tthis.options = options;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To check whether the response has the redirect status code or not\r\n\t * @param {Response} response - The response object\r\n\t * @returns A boolean representing whether the response contains the redirect status code or not\r\n\t */\r\n\tprivate isRedirect(response: Response): boolean {\r\n\t\treturn RedirectHandler.REDIRECT_STATUS_CODES.indexOf(response.status) !== -1;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To check whether the response has location header or not\r\n\t * @param {Response} response - The response object\r\n\t * @returns A boolean representing the whether the response has location header or not\r\n\t */\r\n\tprivate hasLocationHeader(response: Response): boolean {\r\n\t\treturn response.headers.has(RedirectHandler.LOCATION_HEADER);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To get the redirect url from location header in response object\r\n\t * @param {Response} response - The response object\r\n\t * @returns A redirect url from location header\r\n\t */\r\n\tprivate getLocationHeader(response: Response): string {\r\n\t\treturn response.headers.get(RedirectHandler.LOCATION_HEADER);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To check whether the given url is a relative url or not\r\n\t * @param {string} url - The url string value\r\n\t * @returns A boolean representing whether the given url is a relative url or not\r\n\t */\r\n\tprivate isRelativeURL(url: string): boolean {\r\n\t\treturn url.indexOf(\"://\") === -1;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To check whether the authorization header in the request should be dropped for consequent redirected requests\r\n\t * @param {string} requestUrl - The request url value\r\n\t * @param {string} redirectUrl - The redirect url value\r\n\t * @returns A boolean representing whether the authorization header in the request should be dropped for consequent redirected requests\r\n\t */\r\n\tprivate shouldDropAuthorizationHeader(requestUrl: string, redirectUrl: string): boolean {\r\n\t\tconst schemeHostRegex: RegExp = /^[A-Za-z].+?:\\/\\/.+?(?=\\/|$)/;\r\n\t\tconst requestMatches: string[] = schemeHostRegex.exec(requestUrl);\r\n\t\tlet requestAuthority: string;\r\n\t\tlet redirectAuthority: string;\r\n\t\tif (requestMatches !== null) {\r\n\t\t\trequestAuthority = requestMatches[0];\r\n\t\t}\r\n\t\tconst redirectMatches: string[] = schemeHostRegex.exec(redirectUrl);\r\n\t\tif (redirectMatches !== null) {\r\n\t\t\tredirectAuthority = redirectMatches[0];\r\n\t\t}\r\n\t\treturn typeof requestAuthority !== \"undefined\" && typeof redirectAuthority !== \"undefined\" && requestAuthority !== redirectAuthority;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @async\r\n\t * To update a request url with the redirect url\r\n\t * @param {string} redirectUrl - The redirect url value\r\n\t * @param {Context} context - The context object value\r\n\t * @returns Nothing\r\n\t */\r\n\tprivate async updateRequestUrl(redirectUrl: string, context: Context): Promise<void> {\r\n\t\tcontext.request = typeof context.request === \"string\" ? redirectUrl : await cloneRequestWithNewUrl(redirectUrl, context.request as Request);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * To get the options for execution of the middleware\r\n\t * @param {Context} context - The context object\r\n\t * @returns A options for middleware execution\r\n\t */\r\n\tprivate getOptions(context: Context): RedirectHandlerOptions {\r\n\t\tlet options: RedirectHandlerOptions;\r\n\t\tif (context.middlewareControl instanceof MiddlewareControl) {\r\n\t\t\toptions = context.middlewareControl.getMiddlewareOptions(RedirectHandlerOptions) as RedirectHandlerOptions;\r\n\t\t}\r\n\t\tif (typeof options === \"undefined\") {\r\n\t\t\toptions = Object.assign(new RedirectHandlerOptions(), this.options);\r\n\t\t}\r\n\t\treturn options;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @async\r\n\t * To execute the next middleware and to handle in case of redirect response returned by the server\r\n\t * @param {Context} context - The context object\r\n\t * @param {number} redirectCount - The redirect count value\r\n\t * @param {RedirectHandlerOptions} options - The redirect handler options instance\r\n\t * @returns A promise that resolves to nothing\r\n\t */\r\n\tprivate async executeWithRedirect(context: Context, redirectCount: number, options: RedirectHandlerOptions): Promise<void> {\r\n\t\ttry {\r\n\t\t\tawait this.nextMiddleware.execute(context);\r\n\t\t\tconst response = context.response;\r\n\t\t\tif (redirectCount < options.maxRedirects && this.isRedirect(response) && this.hasLocationHeader(response) && options.shouldRedirect(response)) {\r\n\t\t\t\t++redirectCount;\r\n\t\t\t\tif (response.status === RedirectHandler.STATUS_CODE_SEE_OTHER) {\r\n\t\t\t\t\tcontext.options.method = RequestMethod.GET;\r\n\t\t\t\t\tdelete context.options.body;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst redirectUrl: string = this.getLocationHeader(response);\r\n\t\t\t\t\tif (!this.isRelativeURL(redirectUrl) && this.shouldDropAuthorizationHeader(response.url, redirectUrl)) {\r\n\t\t\t\t\t\tdelete context.options.headers[RedirectHandler.AUTHORIZATION_HEADER];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tawait this.updateRequestUrl(redirectUrl, context);\r\n\t\t\t\t}\r\n\t\t\t\tawait this.executeWithRedirect(context, redirectCount, options);\r\n\t\t\t} else {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * To execute the current middleware\r\n\t * @param {Context} context - The context object of the request\r\n\t * @returns A Promise that resolves to nothing\r\n\t */\r\n\tpublic async execute(context: Context): Promise<void> {\r\n\t\ttry {\r\n\t\t\tconst redirectCount: number = 0;\r\n\t\t\tconst options = this.getOptions(context);\r\n\t\t\tcontext.options.redirect = RedirectHandler.MANUAL_REDIRECT;\r\n\t\t\tTelemetryHandlerOptions.updateFeatureUsageFlag(context, FeatureUsageFlag.REDIRECT_HANDLER_ENABLED);\r\n\t\t\treturn await this.executeWithRedirect(context, redirectCount, options);\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To set the next middleware in the chain\r\n\t * @param {Middleware} next - The middleware instance\r\n\t * @returns Nothing\r\n\t */\r\n\tpublic setNext(next: Middleware): void {\r\n\t\tthis.nextMiddleware = next;\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module Constants\r\n */\r\n\r\n/**\r\n * @constant\r\n * A Default API endpoint version for a request\r\n */\r\nexport const GRAPH_API_VERSION = \"v1.0\";\r\n\r\n/**\r\n * @constant\r\n * A Default base url for a request\r\n */\r\nexport const GRAPH_BASE_URL = \"https://graph.microsoft.com/\";\r\n\r\n/**\r\n * To hold list of the service root endpoints for Microsoft Graph and Graph Explorer for each national cloud.\r\n * Set(iterable:Object) is not supported in Internet Explorer. The consumer is recommended to use a suitable polyfill.\r\n */\r\nexport const GRAPH_URLS = new Set<string>([\"graph.microsoft.com\", \"graph.microsoft.us\", \"dod-graph.microsoft.us\", \"graph.microsoft.de\", \"microsoftgraph.chinacloudapi.cn\"]);\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module GraphRequestUtil\r\n */\r\nimport { GRAPH_URLS } from \"./Constants\";\r\n/**\r\n * To hold list of OData query params\r\n */\r\nexport const oDataQueryNames = [\"$select\", \"$expand\", \"$orderby\", \"$filter\", \"$top\", \"$skip\", \"$skipToken\", \"$count\"];\r\n\r\n/**\r\n * To construct the URL by appending the segments with \"/\"\r\n * @param {string[]} urlSegments - The array of strings\r\n * @returns The constructed URL string\r\n */\r\nexport const urlJoin = (urlSegments: string[]): string => {\r\n\tconst removePostSlash = (s) => s.replace(/\\/+$/, \"\");\r\n\tconst removePreSlash = (s) => s.replace(/^\\/+/, \"\");\r\n\tconst joiner = (pre, cur) => [removePostSlash(pre), removePreSlash(cur)].join(\"/\");\r\n\tconst parts = Array.prototype.slice.call(urlSegments);\r\n\treturn parts.reduce(joiner);\r\n};\r\n\r\n/**\r\n * Serializes the content\r\n * @param {any} content - The content value that needs to be serialized\r\n * @returns The serialized content\r\n *\r\n * Note:\r\n * This conversion is required due to the following reasons:\r\n * Body parameter of Request method of isomorphic-fetch only accepts Blob, ArrayBuffer, FormData, TypedArrays string.\r\n * Node.js platform does not support Blob, FormData. Javascript File object inherits from Blob so it is also not supported in node. Therefore content of type Blob, File, FormData will only come from browsers.\r\n * Parallel to ArrayBuffer in javascript, node provides Buffer interface. Node's Buffer is able to send the arbitrary binary data to the server successfully for both Browser and Node platform. Whereas sending binary data via ArrayBuffer or TypedArrays was only possible using Browser. To support both Node and Browser, `serializeContent` converts TypedArrays or ArrayBuffer to `Node Buffer`.\r\n * If the data received is in JSON format, `serializeContent` converts the JSON to string.\r\n */\r\n\r\nexport const serializeContent = (content: any): any => {\r\n\tconst className: string = content && content.constructor && content.constructor.name;\r\n\tif (className === \"Buffer\" || className === \"Blob\" || className === \"File\" || className === \"FormData\" || typeof content === \"string\") {\r\n\t\treturn content;\r\n\t}\r\n\tif (className === \"ArrayBuffer\") {\r\n\t\tcontent = Buffer.from(content);\r\n\t} else if (className === \"Int8Array\" || className === \"Int16Array\" || className === \"Int32Array\" || className === \"Uint8Array\" || className === \"Uint16Array\" || className === \"Uint32Array\" || className === \"Uint8ClampedArray\" || className === \"Float32Array\" || className === \"Float64Array\" || className === \"DataView\") {\r\n\t\tcontent = Buffer.from(content.buffer);\r\n\t} else {\r\n\t\ttry {\r\n\t\t\tcontent = JSON.stringify(content);\r\n\t\t} catch (error) {\r\n\t\t\tthrow new Error(\"Unable to stringify the content\");\r\n\t\t}\r\n\t}\r\n\treturn content;\r\n};\r\n\r\n/**\r\n * Checks if the url is one of the service root endpoints for Microsoft Graph and Graph Explorer.\r\n * @param {string} url - The url to be verified\r\n * @returns {boolean} - Returns true if the url is a Graph URL\r\n */\r\nexport const isGraphURL = (url: string): boolean => {\r\n\t// Valid Graph URL pattern - https://graph.microsoft.com/{version}/{resource}?{query-parameters}\r\n\t// Valid Graph URL example - https://graph.microsoft.com/v1.0/\r\n\turl = url.toLowerCase();\r\n\r\n\tif (url.indexOf(\"https://\") !== -1) {\r\n\t\turl = url.replace(\"https://\", \"\");\r\n\r\n\t\t// Find where the host ends\r\n\t\tconst startofPortNoPos = url.indexOf(\":\");\r\n\t\tconst endOfHostStrPos = url.indexOf(\"/\");\r\n\t\tlet hostName = \"\";\r\n\t\tif (endOfHostStrPos !== -1) {\r\n\t\t\tif (startofPortNoPos !== -1 && startofPortNoPos < endOfHostStrPos) {\r\n\t\t\t\thostName = url.substring(0, startofPortNoPos);\r\n\t\t\t\treturn GRAPH_URLS.has(hostName);\r\n\t\t\t}\r\n\t\t\t// Parse out the host\r\n\t\t\thostName = url.substring(0, endOfHostStrPos);\r\n\t\t\treturn GRAPH_URLS.has(hostName);\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n};\r\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n// THIS FILE IS AUTO GENERATED\n// ANY CHANGES WILL BE LOST DURING BUILD\n\n/**\n * @module Version\n */\n\nexport const PACKAGE_VERSION = \"2.2.1\";\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module TelemetryHandler\r\n */\r\nimport { isGraphURL } from \"../GraphRequestUtil\";\r\nimport { Context } from \"../IContext\";\r\nimport { PACKAGE_VERSION } from \"../Version\";\r\n\r\nimport { Middleware } from \"./IMiddleware\";\r\nimport { MiddlewareControl } from \"./MiddlewareControl\";\r\nimport { appendRequestHeader, generateUUID, getRequestHeader, setRequestHeader } from \"./MiddlewareUtil\";\r\nimport { TelemetryHandlerOptions } from \"./options/TelemetryHandlerOptions\";\r\n\r\n/**\r\n * @class\r\n * @implements Middleware\r\n * Class for TelemetryHandler\r\n */\r\nexport class TelemetryHandler implements Middleware {\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding the name of the client request id header\r\n\t */\r\n\tprivate static CLIENT_REQUEST_ID_HEADER = \"client-request-id\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding the name of the sdk version header\r\n\t */\r\n\tprivate static SDK_VERSION_HEADER = \"SdkVersion\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding the language prefix for the sdk version header value\r\n\t */\r\n\tprivate static PRODUCT_NAME = \"graph-js\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * A member holding the key for the feature usage metrics\r\n\t */\r\n\tprivate static FEATURE_USAGE_STRING = \"featureUsage\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member to hold next middleware in the middleware chain\r\n\t */\r\n\tprivate nextMiddleware: Middleware;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * To execute the current middleware\r\n\t * @param {Context} context - The context object of the request\r\n\t * @returns A Promise that resolves to nothing\r\n\t */\r\n\tpublic async execute(context: Context): Promise<void> {\r\n\t\ttry {\r\n\t\t\tconst url = typeof context.request === \"string\" ? context.request : context.request.url;\r\n\t\t\tif (isGraphURL(url)) {\r\n\t\t\t\t// Add telemetry only if the request url is a Graph URL.\r\n\t\t\t\t// Errors are reported as in issue #265 if headers are present when redirecting to a non Graph URL\r\n\t\t\t\tlet clientRequestId: string = getRequestHeader(context.request, context.options, TelemetryHandler.CLIENT_REQUEST_ID_HEADER);\r\n\t\t\t\tif (!clientRequestId) {\r\n\t\t\t\t\tclientRequestId = generateUUID();\r\n\t\t\t\t\tsetRequestHeader(context.request, context.options, TelemetryHandler.CLIENT_REQUEST_ID_HEADER, clientRequestId);\r\n\t\t\t\t}\r\n\t\t\t\tlet sdkVersionValue: string = `${TelemetryHandler.PRODUCT_NAME}/${PACKAGE_VERSION}`;\r\n\t\t\t\tlet options: TelemetryHandlerOptions;\r\n\t\t\t\tif (context.middlewareControl instanceof MiddlewareControl) {\r\n\t\t\t\t\toptions = context.middlewareControl.getMiddlewareOptions(TelemetryHandlerOptions) as TelemetryHandlerOptions;\r\n\t\t\t\t}\r\n\t\t\t\tif (options) {\r\n\t\t\t\t\tconst featureUsage: string = options.getFeatureUsage();\r\n\t\t\t\t\tsdkVersionValue += ` (${TelemetryHandler.FEATURE_USAGE_STRING}=${featureUsage})`;\r\n\t\t\t\t}\r\n\t\t\t\tappendRequestHeader(context.request, context.options, TelemetryHandler.SDK_VERSION_HEADER, sdkVersionValue);\r\n\t\t\t} else {\r\n\t\t\t\t// Remove telemetry headers if present during redirection.\r\n\t\t\t\tdelete context.options.headers[TelemetryHandler.CLIENT_REQUEST_ID_HEADER];\r\n\t\t\t\tdelete context.options.headers[TelemetryHandler.SDK_VERSION_HEADER];\r\n\t\t\t}\r\n\t\t\treturn await this.nextMiddleware.execute(context);\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To set the next middleware in the chain\r\n\t * @param {Middleware} next - The middleware instance\r\n\t * @returns Nothing\r\n\t */\r\n\tpublic setNext(next: Middleware): void {\r\n\t\tthis.nextMiddleware = next;\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module ChaosStrategy\r\n */\r\n\r\n/**\r\n * Strategy used for Testing Handler\r\n * @enum\r\n */\r\nexport enum ChaosStrategy {\r\n\tMANUAL,\r\n\tRANDOM,\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module Range\r\n */\r\n\r\n/**\r\n * @class\r\n * Class representing Range\r\n */\r\nexport class Range {\r\n\t/**\r\n\t * @public\r\n\t * The minimum value of the range\r\n\t */\r\n\tpublic minValue: number;\r\n\r\n\t/**\r\n\t * @public\r\n\t * The maximum value of the range\r\n\t */\r\n\tpublic maxValue: number;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Creates a range for given min and max values\r\n\t * @param {number} [minVal = -1] - The minimum value.\r\n\t * @param {number} [maxVal = -1] - The maximum value.\r\n\t * @returns An instance of a Range\r\n\t */\r\n\tpublic constructor(minVal: number = -1, maxVal: number = -1) {\r\n\t\tthis.minValue = minVal;\r\n\t\tthis.maxValue = maxVal;\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module LargeFileUploadTask\r\n */\r\n\r\nimport { Client } from \"../index\";\r\nimport { Range } from \"../Range\";\r\n\r\n/**\r\n * @interface\r\n * Signature to representing key value pairs\r\n * @property {[key: string] : string | number} - The Key value pair\r\n */\r\ninterface KeyValuePairObjectStringNumber {\r\n\t[key: string]: string | number;\r\n}\r\n\r\n/**\r\n * @interface\r\n * Signature to represent the resulting response in the status enquiry request\r\n * @property {string} expirationDateTime - The expiration time of the upload session\r\n * @property {string[]} nextExpectedRanges - The ranges expected in next consecutive request in the upload\r\n */\r\ninterface UploadStatusResponse {\r\n\texpirationDateTime: string;\r\n\tnextExpectedRanges: string[];\r\n}\r\n\r\n/**\r\n * @interface\r\n * Signature to define options for upload task\r\n * @property {number} [rangeSize = LargeFileUploadTask.DEFAULT_FILE_SIZE] - Specifies the range chunk size\r\n */\r\nexport interface LargeFileUploadTaskOptions {\r\n\trangeSize?: number;\r\n}\r\n\r\n/**\r\n * @interface\r\n * Signature to represent upload session resulting from the session creation in the server\r\n * @property {string} url - The URL to which the file upload is made\r\n * @property {Date} expiry - The expiration of the time of the upload session\r\n */\r\nexport interface LargeFileUploadSession {\r\n\turl: string;\r\n\texpiry: Date;\r\n}\r\n\r\n/**\r\n * @interface\r\n * Signature to define the properties and content of the file in upload task\r\n * @property {ArrayBuffer | File} content - The actual file content\r\n * @property {string} name - Specifies the file name with extension\r\n * @property {number} size - Specifies size of the file\r\n */\r\nexport interface FileObject {\r\n\tcontent: ArrayBuffer | File;\r\n\tname: string;\r\n\tsize: number;\r\n}\r\n\r\n/**\r\n * @class\r\n * Class representing LargeFileUploadTask\r\n */\r\nexport class LargeFileUploadTask {\r\n\t/**\r\n\t * @private\r\n\t * Default value for the rangeSize\r\n\t */\r\n\tprivate DEFAULT_FILE_SIZE: number = 5 * 1024 * 1024;\r\n\r\n\t/**\r\n\t * @protected\r\n\t * The GraphClient instance\r\n\t */\r\n\tprotected client: Client;\r\n\r\n\t/**\r\n\t * @protected\r\n\t * The object holding file details\r\n\t */\r\n\tprotected file: FileObject;\r\n\r\n\t/**\r\n\t * @protected\r\n\t * The object holding options for the task\r\n\t */\r\n\tprotected options: LargeFileUploadTaskOptions;\r\n\r\n\t/**\r\n\t * @protected\r\n\t * The object for upload session\r\n\t */\r\n\tprotected uploadSession: LargeFileUploadSession;\r\n\r\n\t/**\r\n\t * @protected\r\n\t * The next range needs to be uploaded\r\n\t */\r\n\tprotected nextRange: Range;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * @async\r\n\t * Makes request to the server to create an upload session\r\n\t * @param {Client} client - The GraphClient instance\r\n\t * @param {any} payload - The payload that needs to be sent\r\n\t * @param {KeyValuePairObjectStringNumber} headers - The headers that needs to be sent\r\n\t * @returns The promise that resolves to LargeFileUploadSession\r\n\t */\r\n\tpublic static async createUploadSession(client: Client, requestUrl: string, payload: any, headers: KeyValuePairObjectStringNumber = {}): Promise<any> {\r\n\t\ttry {\r\n\t\t\tconst session = await client\r\n\t\t\t\t.api(requestUrl)\r\n\t\t\t\t.headers(headers)\r\n\t\t\t\t.post(payload);\r\n\t\t\tconst largeFileUploadSession: LargeFileUploadSession = {\r\n\t\t\t\turl: session.uploadUrl,\r\n\t\t\t\texpiry: new Date(session.expirationDateTime),\r\n\t\t\t};\r\n\t\t\treturn largeFileUploadSession;\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Constructs a LargeFileUploadTask\r\n\t * @param {Client} client - The GraphClient instance\r\n\t * @param {FileObject} file - The FileObject holding details of a file that needs to be uploaded\r\n\t * @param {LargeFileUploadSession} uploadSession - The upload session to which the upload has to be done\r\n\t * @param {LargeFileUploadTaskOptions} options - The upload task options\r\n\t * @returns An instance of LargeFileUploadTask\r\n\t */\r\n\tpublic constructor(client: Client, file: FileObject, uploadSession: LargeFileUploadSession, options: LargeFileUploadTaskOptions = {}) {\r\n\t\tthis.client = client;\r\n\t\tthis.file = file;\r\n\t\tif (options.rangeSize === undefined) {\r\n\t\t\toptions.rangeSize = this.DEFAULT_FILE_SIZE;\r\n\t\t}\r\n\t\tthis.options = options;\r\n\t\tthis.uploadSession = uploadSession;\r\n\t\tthis.nextRange = new Range(0, this.options.rangeSize - 1);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Parses given range string to the Range instance\r\n\t * @param {string[]} ranges - The ranges value\r\n\t * @returns The range instance\r\n\t */\r\n\tprivate parseRange(ranges: string[]): Range {\r\n\t\tconst rangeStr = ranges[0];\r\n\t\tif (typeof rangeStr === \"undefined\" || rangeStr === \"\") {\r\n\t\t\treturn new Range();\r\n\t\t}\r\n\t\tconst firstRange = rangeStr.split(\"-\");\r\n\t\tconst minVal = parseInt(firstRange[0], 10);\r\n\t\tlet maxVal = parseInt(firstRange[1], 10);\r\n\t\tif (Number.isNaN(maxVal)) {\r\n\t\t\tmaxVal = this.file.size - 1;\r\n\t\t}\r\n\t\treturn new Range(minVal, maxVal);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Updates the expiration date and the next range\r\n\t * @param {UploadStatusResponse} response - The response of the upload status\r\n\t * @returns Nothing\r\n\t */\r\n\tprivate updateTaskStatus(response: UploadStatusResponse): void {\r\n\t\tthis.uploadSession.expiry = new Date(response.expirationDateTime);\r\n\t\tthis.nextRange = this.parseRange(response.nextExpectedRanges);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Gets next range that needs to be uploaded\r\n\t * @returns The range instance\r\n\t */\r\n\tpublic getNextRange(): Range {\r\n\t\tif (this.nextRange.minValue === -1) {\r\n\t\t\treturn this.nextRange;\r\n\t\t}\r\n\t\tconst minVal = this.nextRange.minValue;\r\n\t\tlet maxValue = minVal + this.options.rangeSize - 1;\r\n\t\tif (maxValue >= this.file.size) {\r\n\t\t\tmaxValue = this.file.size - 1;\r\n\t\t}\r\n\t\treturn new Range(minVal, maxValue);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Slices the file content to the given range\r\n\t * @param {Range} range - The range value\r\n\t * @returns The sliced ArrayBuffer or Blob\r\n\t */\r\n\tpublic sliceFile(range: Range): ArrayBuffer | Blob {\r\n\t\tconst blob = this.file.content.slice(range.minValue, range.maxValue + 1);\r\n\t\treturn blob;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Uploads file to the server in a sequential order by slicing the file\r\n\t * @returns The promise resolves to uploaded response\r\n\t */\r\n\tpublic async upload(): Promise<any> {\r\n\t\ttry {\r\n\t\t\twhile (true) {\r\n\t\t\t\tconst nextRange = this.getNextRange();\r\n\t\t\t\tif (nextRange.maxValue === -1) {\r\n\t\t\t\t\tconst err = new Error(\"Task with which you are trying to upload is already completed, Please check for your uploaded file\");\r\n\t\t\t\t\terr.name = \"Invalid Session\";\r\n\t\t\t\t\tthrow err;\r\n\t\t\t\t}\r\n\t\t\t\tconst fileSlice = this.sliceFile(nextRange);\r\n\t\t\t\tconst response = await this.uploadSlice(fileSlice, nextRange, this.file.size);\r\n\t\t\t\t// Upon completion of upload process incase of onedrive, driveItem is returned, which contains id\r\n\t\t\t\tif (response.id !== undefined) {\r\n\t\t\t\t\treturn response;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.updateTaskStatus(response);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Uploads given slice to the server\r\n\t * @param {ArrayBuffer | Blob | File} fileSlice - The file slice\r\n\t * @param {Range} range - The range value\r\n\t * @param {number} totalSize - The total size of a complete file\r\n\t */\r\n\tpublic async uploadSlice(fileSlice: ArrayBuffer | Blob | File, range: Range, totalSize: number): Promise<any> {\r\n\t\ttry {\r\n\t\t\treturn await this.client\r\n\t\t\t\t.api(this.uploadSession.url)\r\n\t\t\t\t.headers({\r\n\t\t\t\t\t\"Content-Length\": `${range.maxValue - range.minValue + 1}`,\r\n\t\t\t\t\t\"Content-Range\": `bytes ${range.minValue}-${range.maxValue}/${totalSize}`,\r\n\t\t\t\t})\r\n\t\t\t\t.put(fileSlice);\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Deletes upload session in the server\r\n\t * @returns The promise resolves to cancelled response\r\n\t */\r\n\tpublic async cancel(): Promise<any> {\r\n\t\ttry {\r\n\t\t\treturn await this.client.api(this.uploadSession.url).delete();\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Gets status for the upload session\r\n\t * @returns The promise resolves to the status enquiry response\r\n\t */\r\n\tpublic async getStatus(): Promise<any> {\r\n\t\ttry {\r\n\t\t\tconst response = await this.client.api(this.uploadSession.url).get();\r\n\t\t\tthis.updateTaskStatus(response);\r\n\t\t\treturn response;\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Resumes upload session and continue uploading the file from the last sent range\r\n\t * @returns The promise resolves to the uploaded response\r\n\t */\r\n\tpublic async resume(): Promise<any> {\r\n\t\ttry {\r\n\t\t\tawait this.getStatus();\r\n\t\t\treturn await this.upload();\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module OneDriveLargeFileUploadTaskUtil\r\n */\r\n\r\n/**\r\n * @constant\r\n * Default value for the rangeSize\r\n * Recommended size is between 5 - 10 MB {@link https://developer.microsoft.com/en-us/graph/docs/api-reference/v1.0/api/driveitem_createuploadsession#best-practices}\r\n */\r\nconst DEFAULT_FILE_SIZE: number = 5 * 1024 * 1024;\r\n\r\n/**\r\n * @constant\r\n * Rounds off the given value to a multiple of 320 KB\r\n * @param {number} value - The value\r\n * @returns The rounded off value\r\n */\r\nconst roundTo320KB = (value: number): number => {\r\n\tif (value > 320 * 1024) {\r\n\t\tvalue = Math.floor(value / (320 * 1024)) * 320 * 1024;\r\n\t}\r\n\treturn value;\r\n};\r\n\r\n/**\r\n * @constant\r\n * Get the valid rangeSize for a file slicing (validity is based on the constrains mentioned in here\r\n * {@link https://developer.microsoft.com/en-us/graph/docs/api-reference/v1.0/api/driveitem_createuploadsession#upload-bytes-to-the-upload-session})\r\n *\r\n * @param {number} [rangeSize = DEFAULT_FILE_SIZE] - The rangeSize value.\r\n * @returns The valid rangeSize\r\n */\r\nexport const getValidRangeSize = (rangeSize: number = DEFAULT_FILE_SIZE): number => {\r\n\tconst sixtyMB = 60 * 1024 * 1024;\r\n\tif (rangeSize > sixtyMB) {\r\n\t\trangeSize = sixtyMB;\r\n\t}\r\n\treturn roundTo320KB(rangeSize);\r\n};\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module OneDriveLargeFileUploadTask\r\n */\r\n\r\nimport { Client } from \"../index\";\r\n\r\nimport { FileObject, LargeFileUploadSession, LargeFileUploadTask, LargeFileUploadTaskOptions } from \"./LargeFileUploadTask\";\r\nimport { getValidRangeSize } from \"./OneDriveLargeFileUploadTaskUtil\";\r\n\r\n/**\r\n * @interface\r\n * Signature to define options when creating an upload task\r\n * @property {string} fileName - Specifies the name of a file to be uploaded (with extension)\r\n * @property {string} [path] - The path to which the file needs to be uploaded\r\n * @property {number} [rangeSize] - Specifies the range chunk size\r\n */\r\ninterface OneDriveLargeFileUploadOptions {\r\n\tfileName: string;\r\n\tpath?: string;\r\n\trangeSize?: number;\r\n}\r\n\r\n/**\r\n * @class\r\n * Class representing OneDriveLargeFileUploadTask\r\n */\r\nexport class OneDriveLargeFileUploadTask extends LargeFileUploadTask {\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * Default path for the file being uploaded\r\n\t */\r\n\tprivate static DEFAULT_UPLOAD_PATH: string = \"/\";\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * Constructs the create session url for Onedrive\r\n\t * @param {string} fileName - The name of the file\r\n\t * @param {path} [path = OneDriveLargeFileUploadTask.DEFAULT_UPLOAD_PATH] - The path for the upload\r\n\t * @returns The constructed create session url\r\n\t */\r\n\tprivate static constructCreateSessionUrl(fileName: string, path: string = OneDriveLargeFileUploadTask.DEFAULT_UPLOAD_PATH): string {\r\n\t\tfileName = fileName.trim();\r\n\t\tpath = path.trim();\r\n\t\tif (path === \"\") {\r\n\t\t\tpath = \"/\";\r\n\t\t}\r\n\t\tif (path[0] !== \"/\") {\r\n\t\t\tpath = `/${path}`;\r\n\t\t}\r\n\t\tif (path[path.length - 1] !== \"/\") {\r\n\t\t\tpath = `${path}/`;\r\n\t\t}\r\n\t\t// we choose to encode each component of the file path separately because when encoding full URI\r\n\t\t// with encodeURI, special characters like # or % in the file name doesn't get encoded as desired\r\n\t\treturn `/me/drive/root:${path\r\n\t\t\t.split(\"/\")\r\n\t\t\t.map((p) => encodeURIComponent(p))\r\n\t\t\t.join(\"/\")}${encodeURIComponent(fileName)}:/createUploadSession`;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * @async\r\n\t * Creates a OneDriveLargeFileUploadTask\r\n\t * @param {Client} client - The GraphClient instance\r\n\t * @param {Blob | Buffer | File} file - File represented as Blob, Buffer or File\r\n\t * @param {OneDriveLargeFileUploadOptions} options - The options for upload task\r\n\t * @returns The promise that will be resolves to OneDriveLargeFileUploadTask instance\r\n\t */\r\n\tpublic static async create(client: Client, file: Blob | Buffer | File, options: OneDriveLargeFileUploadOptions): Promise<any> {\r\n\t\tconst name: string = options.fileName;\r\n\t\tlet content;\r\n\t\tlet size;\r\n\t\tif (typeof Blob !== \"undefined\" && file instanceof Blob) {\r\n\t\t\tcontent = new File([file as Blob], name);\r\n\t\t\tsize = content.size;\r\n\t\t} else if (typeof File !== \"undefined\" && file instanceof File) {\r\n\t\t\tcontent = file as File;\r\n\t\t\tsize = content.size;\r\n\t\t} else if (typeof Buffer !== \"undefined\" && file instanceof Buffer) {\r\n\t\t\tconst b = file as Buffer;\r\n\t\t\tsize = b.byteLength - b.byteOffset;\r\n\t\t\tcontent = b.buffer.slice(b.byteOffset, b.byteOffset + b.byteLength);\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst requestUrl = OneDriveLargeFileUploadTask.constructCreateSessionUrl(options.fileName, options.path);\r\n\t\t\tconst session = await OneDriveLargeFileUploadTask.createUploadSession(client, requestUrl, options.fileName);\r\n\t\t\tconst rangeSize = getValidRangeSize(options.rangeSize);\r\n\t\t\tconst fileObj: FileObject = {\r\n\t\t\t\tname,\r\n\t\t\t\tcontent,\r\n\t\t\t\tsize,\r\n\t\t\t};\r\n\t\t\treturn new OneDriveLargeFileUploadTask(client, fileObj, session, {\r\n\t\t\t\trangeSize,\r\n\t\t\t});\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * @async\r\n\t * Makes request to the server to create an upload session\r\n\t * @param {Client} client - The GraphClient instance\r\n\t * @param {string} requestUrl - The URL to create the upload session\r\n\t * @param {string} fileName - The name of a file to upload, (with extension)\r\n\t * @returns The promise that resolves to LargeFileUploadSession\r\n\t */\r\n\tpublic static async createUploadSession(client: Client, requestUrl: string, fileName: string): Promise<any> {\r\n\t\tconst payload = {\r\n\t\t\titem: {\r\n\t\t\t\t\"@microsoft.graph.conflictBehavior\": \"rename\",\r\n\t\t\t\tname: fileName,\r\n\t\t\t},\r\n\t\t};\r\n\t\ttry {\r\n\t\t\treturn super.createUploadSession(client, requestUrl, payload);\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Constructs a OneDriveLargeFileUploadTask\r\n\t * @param {Client} client - The GraphClient instance\r\n\t * @param {FileObject} file - The FileObject holding details of a file that needs to be uploaded\r\n\t * @param {LargeFileUploadSession} uploadSession - The upload session to which the upload has to be done\r\n\t * @param {LargeFileUploadTaskOptions} options - The upload task options\r\n\t * @returns An instance of OneDriveLargeFileUploadTask\r\n\t */\r\n\tpublic constructor(client: Client, file: FileObject, uploadSession: LargeFileUploadSession, options: LargeFileUploadTaskOptions) {\r\n\t\tsuper(client, file, uploadSession, options);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Commits upload session to end uploading\r\n\t * @param {string} requestUrl - The URL to commit the upload session\r\n\t * @returns The promise resolves to committed response\r\n\t */\r\n\tpublic async commit(requestUrl: string): Promise<any> {\r\n\t\ttry {\r\n\t\t\tconst payload = {\r\n\t\t\t\tname: this.file.name,\r\n\t\t\t\t\"@microsoft.graph.conflictBehavior\": \"rename\",\r\n\t\t\t\t\"@microsoft.graph.sourceUrl\": this.uploadSession.url,\r\n\t\t\t};\r\n\t\t\treturn await this.client.api(requestUrl).put(payload);\r\n\t\t} catch (err) {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module CustomAuthenticationProvider\r\n */\r\n\r\nimport { AuthenticationProvider } from \"./IAuthenticationProvider\";\r\nimport { AuthProvider } from \"./IAuthProvider\";\r\n\r\n/**\r\n * @class\r\n * Class representing CustomAuthenticationProvider\r\n * @extends AuthenticationProvider\r\n */\r\nexport class CustomAuthenticationProvider implements AuthenticationProvider {\r\n\t/**\r\n\t * @private\r\n\t * A member to hold authProvider callback\r\n\t */\r\n\tprivate provider: AuthProvider;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Creates an instance of CustomAuthenticationProvider\r\n\t * @param {AuthProviderCallback} provider - An authProvider function\r\n\t * @returns An instance of CustomAuthenticationProvider\r\n\t */\r\n\tpublic constructor(provider: AuthProvider) {\r\n\t\tthis.provider = provider;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * To get the access token\r\n\t * @returns The promise that resolves to an access token\r\n\t */\r\n\tpublic async getAccessToken(): Promise<any> {\r\n\t\treturn new Promise((resolve: (accessToken: string) => void, reject: (error: any) => void) => {\r\n\t\t\tthis.provider((error: any, accessToken: string | null) => {\r\n\t\t\t\tif (accessToken) {\r\n\t\t\t\t\tresolve(accessToken);\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(error);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module GraphError\r\n */\r\n\r\n/**\r\n * @class\r\n * Class for GraphError\r\n * @NOTE: This is NOT what is returned from the Graph\r\n * GraphError is created from parsing JSON errors returned from the graph\r\n * Some fields are renamed ie, \"request-id\" => requestId so you can use dot notation\r\n */\r\n\r\nexport class GraphError extends Error {\r\n\t/**\r\n\t * @public\r\n\t * A member holding status code of the error\r\n\t */\r\n\tpublic statusCode: number;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding code i.e name of the error\r\n\t */\r\n\tpublic code: string | null;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding request-id i.e identifier of the request\r\n\t */\r\n\tpublic requestId: string | null;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding processed date and time of the request\r\n\t */\r\n\tpublic date: Date;\r\n\r\n\t/**\r\n\t * @public\r\n\t * A member holding original error response by the graph service\r\n\t */\r\n\tpublic body: any;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Creates an instance of GraphError\r\n\t * @param {number} [statusCode = -1] - The status code of the error\r\n\t * @returns An instance of GraphError\r\n\t */\r\n\tpublic constructor(statusCode: number = -1, message?: string, baseError?: Error) {\r\n\t\tsuper(message || (baseError && baseError.message));\r\n\t\t// https://github.com/Microsoft/TypeScript/wiki/Breaking-Changes#extending-built-ins-like-error-array-and-map-may-no-longer-work\r\n\t\tObject.setPrototypeOf(this, GraphError.prototype);\r\n\t\tthis.statusCode = statusCode;\r\n\t\tthis.code = null;\r\n\t\tthis.requestId = null;\r\n\t\tthis.date = new Date();\r\n\t\tthis.body = null;\r\n\t\tthis.stack = baseError ? baseError.stack : this.stack;\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module GraphErrorHandler\r\n */\r\n\r\nimport { GraphError } from \"./GraphError\";\r\nimport { GraphRequestCallback } from \"./IGraphRequestCallback\";\r\n\r\n/**\r\n * @class\r\n * Class for GraphErrorHandler\r\n */\r\n\r\nexport class GraphErrorHandler {\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * Populates the GraphError instance with Error instance values\r\n\t * @param {Error} error - The error returned by graph service or some native error\r\n\t * @param {number} [statusCode] - The status code of the response\r\n\t * @returns The GraphError instance\r\n\t */\r\n\tprivate static constructError(error: Error, statusCode?: number): GraphError {\r\n\t\tconst gError = new GraphError(statusCode, \"\", error);\r\n\t\tif (error.name !== undefined) {\r\n\t\t\tgError.code = error.name;\r\n\t\t}\r\n\t\tgError.body = error.toString();\r\n\t\tgError.date = new Date();\r\n\t\treturn gError;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * @async\r\n\t * Populates the GraphError instance from the Error returned by graph service\r\n\t * @param {any} error - The error returned by graph service or some native error\r\n\t * @param {number} statusCode - The status code of the response\r\n\t * @returns A promise that resolves to GraphError instance\r\n\t *\r\n\t * Example error for https://graph.microsoft.com/v1.0/me/events?$top=3&$search=foo\r\n\t * {\r\n\t *      \"error\": {\r\n\t *          \"code\": \"SearchEvents\",\r\n\t *          \"message\": \"The parameter $search is not currently supported on the Events resource.\",\r\n\t *          \"innerError\": {\r\n\t *              \"request-id\": \"b31c83fd-944c-4663-aa50-5d9ceb367e19\",\r\n\t *              \"date\": \"2016-11-17T18:37:45\"\r\n\t *          }\r\n\t *      }\r\n\t *  }\r\n\t */\r\n\tprivate static constructErrorFromResponse(error: any, statusCode: number): GraphError {\r\n\t\terror = error.error;\r\n\t\tconst gError = new GraphError(statusCode, error.message);\r\n\t\tgError.code = error.code;\r\n\t\tif (error.innerError !== undefined) {\r\n\t\t\tgError.requestId = error.innerError[\"request-id\"];\r\n\t\t\tgError.date = new Date(error.innerError.date);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tgError.body = JSON.stringify(error);\r\n\t\t} catch (error) {\r\n\t\t\t// tslint:disable-line: no-empty\r\n\t\t}\r\n\t\treturn gError;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * @async\r\n\t * To get the GraphError object\r\n\t * @param {any} [error = null] - The error returned by graph service or some native error\r\n\t * @param {number} [statusCode = -1] - The status code of the response\r\n\t * @param {GraphRequestCallback} [callback] - The graph request callback function\r\n\t * @returns A promise that resolves to GraphError instance\r\n\t */\r\n\tpublic static async getError(error: any = null, statusCode: number = -1, callback?: GraphRequestCallback): Promise<GraphError> {\r\n\t\tlet gError: GraphError;\r\n\t\tif (error && error.error) {\r\n\t\t\tgError = GraphErrorHandler.constructErrorFromResponse(error, statusCode);\r\n\t\t} else if (typeof Error !== \"undefined\" && error instanceof Error) {\r\n\t\t\tgError = GraphErrorHandler.constructError(error, statusCode);\r\n\t\t} else {\r\n\t\t\tgError = new GraphError(statusCode);\r\n\t\t}\r\n\t\tif (typeof callback === \"function\") {\r\n\t\t\tcallback(gError, null);\r\n\t\t} else {\r\n\t\t\treturn gError;\r\n\t\t}\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @enum\r\n * Enum for ResponseType values\r\n * @property {string} ARRAYBUFFER - To download response content as an [ArrayBuffer]{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer}\r\n * @property {string} BLOB - To download content as a [binary/blob] {@link https://developer.mozilla.org/en-US/docs/Web/API/Blob}\r\n * @property {string} DOCUMENT - This downloads content as a document or stream\r\n * @property {string} JSON - To download response content as a json\r\n * @property {string} STREAM - To download response as a [stream]{@link https://nodejs.org/api/stream.html}\r\n * @property {string} TEXT - For downloading response as a text\r\n */\r\n\r\nexport enum ResponseType {\r\n\tARRAYBUFFER = \"arraybuffer\",\r\n\tBLOB = \"blob\",\r\n\tDOCUMENT = \"document\",\r\n\tJSON = \"json\",\r\n\tRAW = \"raw\",\r\n\tSTREAM = \"stream\",\r\n\tTEXT = \"text\",\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module GraphResponseHandler\r\n */\r\n\r\nimport { GraphRequestCallback } from \"./IGraphRequestCallback\";\r\nimport { ResponseType } from \"./ResponseType\";\r\n\r\n/**\r\n * @enum\r\n * Enum for document types\r\n * @property {string} TEXT_HTML - The text/html content type\r\n * @property {string} TEXT_XML - The text/xml content type\r\n * @property {string} APPLICATION_XML - The application/xml content type\r\n * @property {string} APPLICATION_XHTML - The application/xhml+xml content type\r\n */\r\nexport enum DocumentType {\r\n\tTEXT_HTML = \"text/html\",\r\n\tTEXT_XML = \"text/xml\",\r\n\tAPPLICATION_XML = \"application/xml\",\r\n\tAPPLICATION_XHTML = \"application/xhtml+xml\",\r\n}\r\n\r\n/**\r\n * @enum\r\n * Enum for Content types\r\n * @property {string} TEXT_PLAIN - The text/plain content type\r\n * @property {string} APPLICATION_JSON - The application/json content type\r\n */\r\n\r\nenum ContentType {\r\n\tTEXT_PLAIN = \"text/plain\",\r\n\tAPPLICATION_JSON = \"application/json\",\r\n}\r\n\r\n/**\r\n * @enum\r\n * Enum for Content type regex\r\n * @property {string} DOCUMENT - The regex to match document content types\r\n * @property {string} IMAGE - The regex to match image content types\r\n */\r\nenum ContentTypeRegexStr {\r\n\tDOCUMENT = \"^(text\\\\/(html|xml))|(application\\\\/(xml|xhtml\\\\+xml))$\",\r\n\tIMAGE = \"^image\\\\/.+\",\r\n}\r\n\r\n/**\r\n * @class\r\n * Class for GraphResponseHandler\r\n */\r\n\r\nexport class GraphResponseHandler {\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * To parse Document response\r\n\t * @param {Response} rawResponse - The response object\r\n\t * @param {DocumentType} type - The type to which the document needs to be parsed\r\n\t * @returns A promise that resolves to a document content\r\n\t */\r\n\tprivate static parseDocumentResponse(rawResponse: Response, type: DocumentType): Promise<any> {\r\n\t\ttry {\r\n\t\t\tif (typeof DOMParser !== \"undefined\") {\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\trawResponse.text().then((xmlString) => {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst parser = new DOMParser();\r\n\t\t\t\t\t\t\tconst xmlDoc = parser.parseFromString(xmlString, type);\r\n\t\t\t\t\t\t\tresolve(xmlDoc);\r\n\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\treject(error);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn Promise.resolve(rawResponse.body);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @static\r\n\t * @async\r\n\t * To convert the native Response to response content\r\n\t * @param {Response} rawResponse - The response object\r\n\t * @param {ResponseType} [responseType] - The response type value\r\n\t * @returns A promise that resolves to the converted response content\r\n\t */\r\n\tprivate static async convertResponse(rawResponse: Response, responseType?: ResponseType): Promise<any> {\r\n\t\tif (rawResponse.status === 204) {\r\n\t\t\t// NO CONTENT\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\t\tlet responseValue: any;\r\n\t\ttry {\r\n\t\t\tswitch (responseType) {\r\n\t\t\t\tcase ResponseType.ARRAYBUFFER:\r\n\t\t\t\t\tresponseValue = await rawResponse.arrayBuffer();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResponseType.BLOB:\r\n\t\t\t\t\tresponseValue = await rawResponse.blob();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResponseType.DOCUMENT:\r\n\t\t\t\t\tresponseValue = await GraphResponseHandler.parseDocumentResponse(rawResponse, DocumentType.TEXT_XML);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResponseType.JSON:\r\n\t\t\t\t\tresponseValue = await rawResponse.json();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResponseType.STREAM:\r\n\t\t\t\t\tresponseValue = await Promise.resolve(rawResponse.body);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase ResponseType.TEXT:\r\n\t\t\t\t\tresponseValue = await rawResponse.text();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconst contentType = rawResponse.headers.get(\"Content-type\");\r\n\t\t\t\t\tif (contentType !== null) {\r\n\t\t\t\t\t\tconst mimeType = contentType.split(\";\")[0];\r\n\t\t\t\t\t\tif (new RegExp(ContentTypeRegexStr.DOCUMENT).test(mimeType)) {\r\n\t\t\t\t\t\t\tresponseValue = await GraphResponseHandler.parseDocumentResponse(rawResponse, mimeType as DocumentType);\r\n\t\t\t\t\t\t} else if (new RegExp(ContentTypeRegexStr.IMAGE).test(mimeType)) {\r\n\t\t\t\t\t\t\tresponseValue = rawResponse.blob();\r\n\t\t\t\t\t\t} else if (mimeType === ContentType.TEXT_PLAIN) {\r\n\t\t\t\t\t\t\tresponseValue = await rawResponse.text();\r\n\t\t\t\t\t\t} else if (mimeType === ContentType.APPLICATION_JSON) {\r\n\t\t\t\t\t\t\tresponseValue = await rawResponse.json();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresponseValue = Promise.resolve(rawResponse.body);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * RFC specification {@link https://tools.ietf.org/html/rfc7231#section-3.1.1.5} says:\r\n\t\t\t\t\t\t *  A sender that generates a message containing a payload body SHOULD\r\n\t\t\t\t\t\t *  generate a Content-Type header field in that message unless the\r\n\t\t\t\t\t\t *  intended media type of the enclosed representation is unknown to the\r\n\t\t\t\t\t\t *  sender.  If a Content-Type header field is not present, the recipient\r\n\t\t\t\t\t\t *  MAY either assume a media type of \"application/octet-stream\"\r\n\t\t\t\t\t\t *  ([RFC2046], Section 4.5.1) or examine the data to determine its type.\r\n\t\t\t\t\t\t *\r\n\t\t\t\t\t\t *  So assuming it as a stream type so returning the body.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tresponseValue = Promise.resolve(rawResponse.body);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\treturn responseValue;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * @async\r\n\t * To get the parsed response\r\n\t * @param {Response} rawResponse - The response object\r\n\t * @param {ResponseType} [responseType] - The response type value\r\n\t * @param {GraphRequestCallback} [callback] - The graph request callback function\r\n\t * @returns The parsed response\r\n\t */\r\n\tpublic static async getResponse(rawResponse: Response, responseType?: ResponseType, callback?: GraphRequestCallback): Promise<any> {\r\n\t\ttry {\r\n\t\t\tif (responseType === ResponseType.RAW) {\r\n\t\t\t\treturn Promise.resolve(rawResponse);\r\n\t\t\t} else {\r\n\t\t\t\tconst response = await GraphResponseHandler.convertResponse(rawResponse, responseType);\r\n\t\t\t\tif (rawResponse.ok) {\r\n\t\t\t\t\t// Status Code 2XX\r\n\t\t\t\t\tif (typeof callback === \"function\") {\r\n\t\t\t\t\t\tcallback(null, response);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn response;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// NOT OK Response\r\n\t\t\t\t\tthrow response;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module GraphRequest\r\n */\r\n\r\nimport { GraphError } from \"./GraphError\";\r\nimport { GraphErrorHandler } from \"./GraphErrorHandler\";\r\nimport { oDataQueryNames, serializeContent, urlJoin } from \"./GraphRequestUtil\";\r\nimport { GraphResponseHandler } from \"./GraphResponseHandler\";\r\nimport { HTTPClient } from \"./HTTPClient\";\r\nimport { ClientOptions } from \"./IClientOptions\";\r\nimport { Context } from \"./IContext\";\r\nimport { FetchOptions } from \"./IFetchOptions\";\r\nimport { GraphRequestCallback } from \"./IGraphRequestCallback\";\r\nimport { MiddlewareControl } from \"./middleware/MiddlewareControl\";\r\nimport { MiddlewareOptions } from \"./middleware/options/IMiddlewareOptions\";\r\nimport { RequestMethod } from \"./RequestMethod\";\r\nimport { ResponseType } from \"./ResponseType\";\r\n/**\r\n * @interface\r\n * Signature to representing key value pairs\r\n * @property {[key: string] : string | number} - The Key value pair\r\n */\r\ninterface KeyValuePairObjectStringNumber {\r\n\t[key: string]: string | number;\r\n}\r\n\r\n/**\r\n * @interface\r\n * Signature to define URL components\r\n * @template http://graph.microsoft.com/VERSION/PATH?QUERYSTRING&OTHER_QUERY_PARAMS\r\n *\r\n * @property {string} host - The host to which the request needs to be made\r\n * @property {string} version - Version of the graph endpoint\r\n * @property {string} [path] - The path of the resource request\r\n * @property {KeyValuePairObjectStringNumber} oDataQueryParams - The oData Query Params\r\n * @property {KeyValuePairObjectStringNumber} otherURLQueryParams - The other query params for a request\r\n * @property {string[]} otherURLQueryOptions - The non key-value query parameters. Example- '/me?$whatif'\r\n */\r\nexport interface URLComponents {\r\n\thost: string;\r\n\tversion: string;\r\n\tpath?: string;\r\n\toDataQueryParams: KeyValuePairObjectStringNumber;\r\n\totherURLQueryParams: KeyValuePairObjectStringNumber;\r\n\totherURLQueryOptions?: string[];\r\n}\r\n\r\n/**\r\n * @class\r\n * A Class representing GraphRequest\r\n */\r\nexport class GraphRequest {\r\n\t/**\r\n\t * @private\r\n\t * A member variable to hold HTTPClient instance\r\n\t */\r\n\tprivate httpClient: HTTPClient;\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member variable to hold client options\r\n\t */\r\n\tprivate config: ClientOptions;\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member to hold URL Components data\r\n\t */\r\n\tprivate urlComponents: URLComponents;\r\n\r\n\t/* tslint:disable: variable-name */\r\n\t/**\r\n\t * @private\r\n\t * A member to hold custom header options for a request\r\n\t */\r\n\tprivate _headers: HeadersInit;\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member to hold custom options for a request\r\n\t */\r\n\tprivate _options: FetchOptions;\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member to hold the array of middleware options for a request\r\n\t */\r\n\tprivate _middlewareOptions: MiddlewareOptions[];\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member to hold custom response type for a request\r\n\t */\r\n\tprivate _responseType: ResponseType;\r\n\t/* tslint:enable: variable-name */\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Creates an instance of GraphRequest\r\n\t * @param {HTTPClient} httpClient - The HTTPClient instance\r\n\t * @param {ClientOptions} config - The options for making request\r\n\t * @param {string} path - A path string\r\n\t */\r\n\tpublic constructor(httpClient: HTTPClient, config: ClientOptions, path: string) {\r\n\t\tthis.httpClient = httpClient;\r\n\t\tthis.config = config;\r\n\t\tthis.urlComponents = {\r\n\t\t\thost: this.config.baseUrl,\r\n\t\t\tversion: this.config.defaultVersion,\r\n\t\t\toDataQueryParams: {},\r\n\t\t\totherURLQueryParams: {},\r\n\t\t\totherURLQueryOptions: [],\r\n\t\t};\r\n\t\tthis._headers = {};\r\n\t\tthis._options = {};\r\n\t\tthis._middlewareOptions = [];\r\n\t\tthis.parsePath(path);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Parses the path string and creates URLComponents out of it\r\n\t * @param {string} path - The request path string\r\n\t * @returns Nothing\r\n\t */\r\n\tprivate parsePath = (path: string): void => {\r\n\t\t// Strips out the base of the url if they passed in\r\n\t\tif (path.indexOf(\"https://\") !== -1) {\r\n\t\t\tpath = path.replace(\"https://\", \"\");\r\n\r\n\t\t\t// Find where the host ends\r\n\t\t\tconst endOfHostStrPos = path.indexOf(\"/\");\r\n\t\t\tif (endOfHostStrPos !== -1) {\r\n\t\t\t\t// Parse out the host\r\n\t\t\t\tthis.urlComponents.host = \"https://\" + path.substring(0, endOfHostStrPos);\r\n\t\t\t\t// Strip the host from path\r\n\t\t\t\tpath = path.substring(endOfHostStrPos + 1, path.length);\r\n\t\t\t}\r\n\r\n\t\t\t// Remove the following version\r\n\t\t\tconst endOfVersionStrPos = path.indexOf(\"/\");\r\n\t\t\tif (endOfVersionStrPos !== -1) {\r\n\t\t\t\t// Parse out the version\r\n\t\t\t\tthis.urlComponents.version = path.substring(0, endOfVersionStrPos);\r\n\t\t\t\t// Strip version from path\r\n\t\t\t\tpath = path.substring(endOfVersionStrPos + 1, path.length);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Strip out any leading \"/\"\r\n\t\tif (path.charAt(0) === \"/\") {\r\n\t\t\tpath = path.substr(1);\r\n\t\t}\r\n\r\n\t\tconst queryStrPos = path.indexOf(\"?\");\r\n\t\tif (queryStrPos === -1) {\r\n\t\t\t// No query string\r\n\t\t\tthis.urlComponents.path = path;\r\n\t\t} else {\r\n\t\t\tthis.urlComponents.path = path.substr(0, queryStrPos);\r\n\r\n\t\t\t// Capture query string into oDataQueryParams and otherURLQueryParams\r\n\t\t\tconst queryParams = path.substring(queryStrPos + 1, path.length).split(\"&\");\r\n\t\t\tfor (const queryParam of queryParams) {\r\n\t\t\t\tthis.parseQueryParameter(queryParam);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t/**\r\n\t * @private\r\n\t * Adds the query parameter as comma separated values\r\n\t * @param {string} propertyName - The name of a property\r\n\t * @param {string|string[]} propertyValue - The vale of a property\r\n\t * @param {IArguments} additionalProperties - The additional properties\r\n\t * @returns Nothing\r\n\t */\r\n\tprivate addCsvQueryParameter(propertyName: string, propertyValue: string | string[], additionalProperties: IArguments): void {\r\n\t\t// If there are already $propertyName value there, append a \",\"\r\n\t\tthis.urlComponents.oDataQueryParams[propertyName] = this.urlComponents.oDataQueryParams[propertyName] ? this.urlComponents.oDataQueryParams[propertyName] + \",\" : \"\";\r\n\r\n\t\tlet allValues: string[] = [];\r\n\r\n\t\tif (additionalProperties.length > 1 && typeof propertyValue === \"string\") {\r\n\t\t\tallValues = Array.prototype.slice.call(additionalProperties);\r\n\t\t} else if (typeof propertyValue === \"string\") {\r\n\t\t\tallValues.push(propertyValue);\r\n\t\t} else {\r\n\t\t\tallValues = allValues.concat(propertyValue);\r\n\t\t}\r\n\r\n\t\tthis.urlComponents.oDataQueryParams[propertyName] += allValues.join(\",\");\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Builds the full url from the URLComponents to make a request\r\n\t * @returns The URL string that is qualified to make a request to graph endpoint\r\n\t */\r\n\tprivate buildFullUrl(): string {\r\n\t\tconst url = urlJoin([this.urlComponents.host, this.urlComponents.version, this.urlComponents.path]) + this.createQueryString();\r\n\r\n\t\tif (this.config.debugLogging) {\r\n\t\t\tconsole.log(url); // tslint:disable-line: no-console\r\n\t\t}\r\n\t\treturn url;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Builds the query string from the URLComponents\r\n\t * @returns The Constructed query string\r\n\t */\r\n\tprivate createQueryString(): string {\r\n\t\t// Combining query params from oDataQueryParams and otherURLQueryParams\r\n\t\tconst urlComponents = this.urlComponents;\r\n\t\tconst query: string[] = [];\r\n\t\tif (Object.keys(urlComponents.oDataQueryParams).length !== 0) {\r\n\t\t\tfor (const property in urlComponents.oDataQueryParams) {\r\n\t\t\t\tif (urlComponents.oDataQueryParams.hasOwnProperty(property)) {\r\n\t\t\t\t\tquery.push(property + \"=\" + urlComponents.oDataQueryParams[property]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Object.keys(urlComponents.otherURLQueryParams).length !== 0) {\r\n\t\t\tfor (const property in urlComponents.otherURLQueryParams) {\r\n\t\t\t\tif (urlComponents.otherURLQueryParams.hasOwnProperty(property)) {\r\n\t\t\t\t\tquery.push(property + \"=\" + urlComponents.otherURLQueryParams[property]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (urlComponents.otherURLQueryOptions.length !== 0) {\r\n\t\t\tfor (const str of urlComponents.otherURLQueryOptions) {\r\n\t\t\t\tquery.push(str);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn query.length > 0 ? \"?\" + query.join(\"&\") : \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Parses the query parameters to set the urlComponents property of the GraphRequest object\r\n\t * @param {string|KeyValuePairObjectStringNumber} queryDictionaryOrString - The query parameter\r\n\t * @returns The same GraphRequest instance that is being called with\r\n\t */\r\n\tprivate parseQueryParameter(queryDictionaryOrString: string | KeyValuePairObjectStringNumber): GraphRequest {\r\n\t\tif (typeof queryDictionaryOrString === \"string\") {\r\n\t\t\tif (queryDictionaryOrString.charAt(0) === \"?\") {\r\n\t\t\t\tqueryDictionaryOrString = queryDictionaryOrString.substring(1);\r\n\t\t\t}\r\n\r\n\t\t\tif (queryDictionaryOrString.indexOf(\"&\") !== -1) {\r\n\t\t\t\tconst queryParams = queryDictionaryOrString.split(\"&\");\r\n\t\t\t\tfor (const str of queryParams) {\r\n\t\t\t\t\tthis.parseQueryParamenterString(str);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.parseQueryParamenterString(queryDictionaryOrString);\r\n\t\t\t}\r\n\t\t} else if (queryDictionaryOrString.constructor === Object) {\r\n\t\t\tfor (const key in queryDictionaryOrString) {\r\n\t\t\t\tif (queryDictionaryOrString.hasOwnProperty(key)) {\r\n\t\t\t\t\tthis.setURLComponentsQueryParamater(key, queryDictionaryOrString[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Parses the query parameter of string type to set the urlComponents property of the GraphRequest object\r\n\t * @param {string} queryParameter - the query parameters\r\n\t * returns nothing\r\n\t */\r\n\tprivate parseQueryParamenterString(queryParameter: string): void {\r\n\t\t/* The query key-value pair must be split on the first equals sign to avoid errors in parsing nested query parameters.\r\n\t\t\t\t Example-> \"/me?$expand=home($select=city)\" */\r\n\t\tif (this.isValidQueryKeyValuePair(queryParameter)) {\r\n\t\t\tconst indexOfFirstEquals = queryParameter.indexOf(\"=\");\r\n\t\t\tconst paramKey = queryParameter.substring(0, indexOfFirstEquals);\r\n\t\t\tconst paramValue = queryParameter.substring(indexOfFirstEquals + 1);\r\n\t\t\tthis.setURLComponentsQueryParamater(paramKey, paramValue);\r\n\t\t} else {\r\n\t\t\t/* Push values which are not of key-value structure.\r\n\t\t\tExample-> Handle an invalid input->.query(test), .query($select($select=name)) and let the Graph API respond with the error in the URL*/\r\n\t\t\tthis.urlComponents.otherURLQueryOptions.push(queryParameter);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Sets values into the urlComponents property of GraphRequest object.\r\n\t * @param {string} paramKey - the query parameter key\r\n\t * @param {string} paramValue - the query paramter value\r\n\t * @returns nothing\r\n\t */\r\n\tprivate setURLComponentsQueryParamater(paramKey: string, paramValue: string | number): void {\r\n\t\tif (oDataQueryNames.indexOf(paramKey) !== -1) {\r\n\t\t\tconst currentValue = this.urlComponents.oDataQueryParams[paramKey];\r\n\t\t\tconst isValueAppendable = currentValue && (paramKey === \"$expand\" || paramKey === \"$select\" || paramKey === \"$orderby\");\r\n\t\t\tthis.urlComponents.oDataQueryParams[paramKey] = isValueAppendable ? currentValue + \",\" + paramValue : paramValue;\r\n\t\t} else {\r\n\t\t\tthis.urlComponents.otherURLQueryParams[paramKey] = paramValue;\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @private\r\n\t * Check if the query parameter string has a valid key-value structure\r\n\t * @param {string} queryString - the query parameter string. Example -> \"name=value\"\r\n\t * #returns true if the query string has a valid key-value structure else false\r\n\t */\r\n\tprivate isValidQueryKeyValuePair(queryString: string): boolean {\r\n\t\tconst indexofFirstEquals = queryString.indexOf(\"=\");\r\n\t\tif (indexofFirstEquals === -1) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tconst indexofOpeningParanthesis = queryString.indexOf(\"(\");\r\n\t\tif (indexofOpeningParanthesis !== -1 && queryString.indexOf(\"(\") < indexofFirstEquals) {\r\n\t\t\t// Example -> .query($select($expand=true));\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Updates the custom headers and options for a request\r\n\t * @param {FetchOptions} options - The request options object\r\n\t * @returns Nothing\r\n\t */\r\n\tprivate updateRequestOptions(options: FetchOptions): void {\r\n\t\tconst optionsHeaders: HeadersInit = { ...options.headers };\r\n\t\tif (this.config.fetchOptions !== undefined) {\r\n\t\t\tconst fetchOptions: FetchOptions = { ...this.config.fetchOptions };\r\n\t\t\tObject.assign(options, fetchOptions);\r\n\t\t\tif (typeof this.config.fetchOptions.headers !== undefined) {\r\n\t\t\t\toptions.headers = { ...this.config.fetchOptions.headers };\r\n\t\t\t}\r\n\t\t}\r\n\t\tObject.assign(options, this._options);\r\n\t\tif (options.headers !== undefined) {\r\n\t\t\tObject.assign(optionsHeaders, options.headers);\r\n\t\t}\r\n\t\tObject.assign(optionsHeaders, this._headers);\r\n\t\toptions.headers = optionsHeaders;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @async\r\n\t * Adds the custom headers and options to the request and makes the HTTPClient send request call\r\n\t * @param {RequestInfo} request - The request url string or the Request object value\r\n\t * @param {FetchOptions} options - The options to make a request\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the response content\r\n\t */\r\n\tprivate async send(request: RequestInfo, options: FetchOptions, callback?: GraphRequestCallback): Promise<any> {\r\n\t\tlet rawResponse: Response;\r\n\t\tconst middlewareControl = new MiddlewareControl(this._middlewareOptions);\r\n\t\tthis.updateRequestOptions(options);\r\n\t\ttry {\r\n\t\t\tconst context: Context = await this.httpClient.sendRequest({\r\n\t\t\t\trequest,\r\n\t\t\t\toptions,\r\n\t\t\t\tmiddlewareControl,\r\n\t\t\t});\r\n\t\t\trawResponse = context.response;\r\n\t\t\tconst response: any = await GraphResponseHandler.getResponse(rawResponse, this._responseType, callback);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tlet statusCode: number;\r\n\t\t\tif (typeof rawResponse !== \"undefined\") {\r\n\t\t\t\tstatusCode = rawResponse.status;\r\n\t\t\t}\r\n\t\t\tconst gError: GraphError = await GraphErrorHandler.getError(error, statusCode, callback);\r\n\t\t\tthrow gError;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Checks if the content-type is present in the _headers property. If not present, defaults the content-type to application/json\r\n\t * @param none\r\n\t * @returns nothing\r\n\t */\r\n\tprivate setHeaderContentType(): void {\r\n\t\tif (!this._headers) {\r\n\t\t\tthis.header(\"Content-Type\", \"application/json\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst headerKeys = Object.keys(this._headers);\r\n\t\tfor (const headerKey of headerKeys) {\r\n\t\t\tif (headerKey.toLowerCase() === \"content-type\") {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// Default the content-type to application/json in case the content-type is not present in the header\r\n\t\tthis.header(\"Content-Type\", \"application/json\");\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Sets the custom header for a request\r\n\t * @param {string} headerKey - A header key\r\n\t * @param {string} headerValue - A header value\r\n\t * @returns The same GraphRequest instance that is being called with\r\n\t */\r\n\tpublic header(headerKey: string, headerValue: string): GraphRequest {\r\n\t\tthis._headers[headerKey] = headerValue;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Sets the custom headers for a request\r\n\t * @param {KeyValuePairObjectStringNumber | HeadersInit} headers - The request headers\r\n\t * @returns The same GraphRequest instance that is being called with\r\n\t */\r\n\tpublic headers(headers: KeyValuePairObjectStringNumber | HeadersInit): GraphRequest {\r\n\t\tfor (const key in headers) {\r\n\t\t\tif (headers.hasOwnProperty(key)) {\r\n\t\t\t\tthis._headers[key] = headers[key] as string;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Sets the option for making a request\r\n\t * @param {string} key - The key value\r\n\t * @param {any} value - The value\r\n\t * @returns The same GraphRequest instance that is being called with\r\n\t */\r\n\tpublic option(key: string, value: any): GraphRequest {\r\n\t\tthis._options[key] = value;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Sets the options for making a request\r\n\t * @param {{ [key: string]: any }} options - The options key value pair\r\n\t * @returns The same GraphRequest instance that is being called with\r\n\t */\r\n\tpublic options(options: { [key: string]: any }): GraphRequest {\r\n\t\tfor (const key in options) {\r\n\t\t\tif (options.hasOwnProperty(key)) {\r\n\t\t\t\tthis._options[key] = options[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Sets the middleware options for a request\r\n\t * @param {MiddlewareOptions[]} options - The array of middleware options\r\n\t * @returns The same GraphRequest instance that is being called with\r\n\t */\r\n\tpublic middlewareOptions(options: MiddlewareOptions[]): GraphRequest {\r\n\t\tthis._middlewareOptions = options;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Sets the api endpoint version for a request\r\n\t * @param {string} version - The version value\r\n\t * @returns The same GraphRequest instance that is being called with\r\n\t */\r\n\tpublic version(version: string): GraphRequest {\r\n\t\tthis.urlComponents.version = version;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Sets the api endpoint version for a request\r\n\t * @param {ResponseType} responseType - The response type value\r\n\t * @returns The same GraphRequest instance that is being called with\r\n\t */\r\n\tpublic responseType(responseType: ResponseType): GraphRequest {\r\n\t\tthis._responseType = responseType;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To add properties for select OData Query param\r\n\t * @param {string|string[]} properties - The Properties value\r\n\t * @returns The same GraphRequest instance that is being called with, after adding the properties for $select query\r\n\t */\r\n\t/*\r\n\t * Accepts .select(\"displayName,birthday\")\r\n\t *     and .select([\"displayName\", \"birthday\"])\r\n\t *     and .select(\"displayName\", \"birthday\")\r\n\t *\r\n\t */\r\n\tpublic select(properties: string | string[]): GraphRequest {\r\n\t\tthis.addCsvQueryParameter(\"$select\", properties, arguments);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To add properties for expand OData Query param\r\n\t * @param {string|string[]} properties - The Properties value\r\n\t * @returns The same GraphRequest instance that is being called with, after adding the properties for $expand query\r\n\t */\r\n\tpublic expand(properties: string | string[]): GraphRequest {\r\n\t\tthis.addCsvQueryParameter(\"$expand\", properties, arguments);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To add properties for orderby OData Query param\r\n\t * @param {string|string[]} properties - The Properties value\r\n\t * @returns The same GraphRequest instance that is being called with, after adding the properties for $orderby query\r\n\t */\r\n\tpublic orderby(properties: string | string[]): GraphRequest {\r\n\t\tthis.addCsvQueryParameter(\"$orderby\", properties, arguments);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To add query string for filter OData Query param. The request URL accepts only one $filter Odata Query option and its value is set to the most recently passed filter query string.\r\n\t * @param {string} filterStr - The filter query string\r\n\t * @returns The same GraphRequest instance that is being called with, after adding the $filter query\r\n\t */\r\n\tpublic filter(filterStr: string): GraphRequest {\r\n\t\tthis.urlComponents.oDataQueryParams.$filter = filterStr;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To add criterion for search OData Query param. The request URL accepts only one $search Odata Query option and its value is set to the most recently passed search criterion string.\r\n\t * @param {string} searchStr - The search criterion string\r\n\t * @returns The same GraphRequest instance that is being called with, after adding the $search query criteria\r\n\t */\r\n\tpublic search(searchStr: string): GraphRequest {\r\n\t\tthis.urlComponents.oDataQueryParams.$search = searchStr;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To add number for top OData Query param. The request URL accepts only one $top Odata Query option and its value is set to the most recently passed number value.\r\n\t * @param {number} n - The number value\r\n\t * @returns The same GraphRequest instance that is being called with, after adding the number for $top query\r\n\t */\r\n\tpublic top(n: number): GraphRequest {\r\n\t\tthis.urlComponents.oDataQueryParams.$top = n;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To add number for skip OData Query param. The request URL accepts only one $skip Odata Query option and its value is set to the most recently passed number value.\r\n\t * @param {number} n - The number value\r\n\t * @returns The same GraphRequest instance that is being called with, after adding the number for the $skip query\r\n\t */\r\n\tpublic skip(n: number): GraphRequest {\r\n\t\tthis.urlComponents.oDataQueryParams.$skip = n;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To add token string for skipToken OData Query param. The request URL accepts only one $skipToken Odata Query option and its value is set to the most recently passed token value.\r\n\t * @param {string} token - The token value\r\n\t * @returns The same GraphRequest instance that is being called with, after adding the token string for $skipToken query option\r\n\t */\r\n\tpublic skipToken(token: string): GraphRequest {\r\n\t\tthis.urlComponents.oDataQueryParams.$skipToken = token;\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * To add boolean for count OData Query param. The URL accepts only one $count Odata Query option and its value is set to the most recently passed boolean value.\r\n\t * @param {boolean} isCount - The count boolean\r\n\t * @returns The same GraphRequest instance that is being called with, after adding the boolean value for the $count query option\r\n\t */\r\n\tpublic count(isCount: boolean = false): GraphRequest {\r\n\t\tthis.urlComponents.oDataQueryParams.$count = isCount.toString();\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Appends query string to the urlComponent\r\n\t * @param {string|KeyValuePairObjectStringNumber} queryDictionaryOrString - The query value\r\n\t * @returns The same GraphRequest instance that is being called with, after appending the query string to the url component\r\n\t */\r\n\t/*\r\n\t * Accepts .query(\"displayName=xyz\")\r\n\t *     and .select({ name: \"value\" })\r\n\t */\r\n\tpublic query(queryDictionaryOrString: string | KeyValuePairObjectStringNumber): GraphRequest {\r\n\t\treturn this.parseQueryParameter(queryDictionaryOrString);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Makes a http request with GET method\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the get response\r\n\t */\r\n\tpublic async get(callback?: GraphRequestCallback): Promise<any> {\r\n\t\tconst url = this.buildFullUrl();\r\n\t\tconst options: FetchOptions = {\r\n\t\t\tmethod: RequestMethod.GET,\r\n\t\t};\r\n\t\ttry {\r\n\t\t\tconst response = await this.send(url, options, callback);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Makes a http request with POST method\r\n\t * @param {any} content - The content that needs to be sent with the request\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the post response\r\n\t */\r\n\tpublic async post(content: any, callback?: GraphRequestCallback): Promise<any> {\r\n\t\tconst url = this.buildFullUrl();\r\n\t\tconst options: FetchOptions = {\r\n\t\t\tmethod: RequestMethod.POST,\r\n\t\t\tbody: serializeContent(content),\r\n\t\t};\r\n\t\tconst className: string = content && content.constructor && content.constructor.name;\r\n\t\tif (className === \"FormData\") {\r\n\t\t\t// Content-Type headers should not be specified in case the of FormData type content\r\n\t\t\toptions.headers = {};\r\n\t\t} else {\r\n\t\t\tthis.setHeaderContentType();\r\n\t\t\toptions.headers = this._headers;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst response = await this.send(url, options, callback);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Alias for Post request call\r\n\t * @param {any} content - The content that needs to be sent with the request\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the post response\r\n\t */\r\n\tpublic async create(content: any, callback?: GraphRequestCallback): Promise<any> {\r\n\t\ttry {\r\n\t\t\treturn await this.post(content, callback);\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Makes http request with PUT method\r\n\t * @param {any} content - The content that needs to be sent with the request\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the put response\r\n\t */\r\n\tpublic async put(content: any, callback?: GraphRequestCallback): Promise<any> {\r\n\t\tconst url = this.buildFullUrl();\r\n\t\tthis.setHeaderContentType();\r\n\t\tconst options: FetchOptions = {\r\n\t\t\tmethod: RequestMethod.PUT,\r\n\t\t\tbody: serializeContent(content),\r\n\t\t};\r\n\t\ttry {\r\n\t\t\tconst response = await this.send(url, options, callback);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Makes http request with PATCH method\r\n\t * @param {any} content - The content that needs to be sent with the request\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the patch response\r\n\t */\r\n\tpublic async patch(content: any, callback?: GraphRequestCallback): Promise<any> {\r\n\t\tconst url = this.buildFullUrl();\r\n\t\tthis.setHeaderContentType();\r\n\t\tconst options: FetchOptions = {\r\n\t\t\tmethod: RequestMethod.PATCH,\r\n\t\t\tbody: serializeContent(content),\r\n\t\t};\r\n\t\ttry {\r\n\t\t\tconst response = await this.send(url, options, callback);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Alias for PATCH request\r\n\t * @param {any} content - The content that needs to be sent with the request\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the patch response\r\n\t */\r\n\tpublic async update(content: any, callback?: GraphRequestCallback): Promise<any> {\r\n\t\ttry {\r\n\t\t\treturn await this.patch(content, callback);\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Makes http request with DELETE method\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the delete response\r\n\t */\r\n\tpublic async delete(callback?: GraphRequestCallback): Promise<any> {\r\n\t\tconst url = this.buildFullUrl();\r\n\t\tconst options: FetchOptions = {\r\n\t\t\tmethod: RequestMethod.DELETE,\r\n\t\t};\r\n\t\ttry {\r\n\t\t\tconst response = await this.send(url, options, callback);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Alias for delete request call\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the delete response\r\n\t */\r\n\tpublic async del(callback?: GraphRequestCallback): Promise<any> {\r\n\t\ttry {\r\n\t\t\treturn await this.delete(callback);\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Makes a http request with GET method to read response as a stream.\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the getStream response\r\n\t */\r\n\tpublic async getStream(callback?: GraphRequestCallback): Promise<any> {\r\n\t\tconst url = this.buildFullUrl();\r\n\t\tconst options = {\r\n\t\t\tmethod: RequestMethod.GET,\r\n\t\t};\r\n\t\tthis.responseType(ResponseType.STREAM);\r\n\t\ttry {\r\n\t\t\tconst stream = await this.send(url, options, callback);\r\n\t\t\treturn stream;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * Makes a http request with GET method to read response as a stream.\r\n\t * @param {any} stream - The stream instance\r\n\t * @param {GraphRequestCallback} [callback] - The callback function to be called in response with async call\r\n\t * @returns A promise that resolves to the putStream response\r\n\t */\r\n\tpublic async putStream(stream: any, callback?: GraphRequestCallback): Promise<any> {\r\n\t\tconst url = this.buildFullUrl();\r\n\t\tconst options = {\r\n\t\t\tmethod: RequestMethod.PUT,\r\n\t\t\theaders: {\r\n\t\t\t\t\"Content-Type\": \"application/octet-stream\",\r\n\t\t\t},\r\n\t\t\tbody: stream,\r\n\t\t};\r\n\t\ttry {\r\n\t\t\tconst response = await this.send(url, options, callback);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module HTTPClient\r\n */\r\n\r\nimport { Context } from \"./IContext\";\r\nimport { Middleware } from \"./middleware/IMiddleware\";\r\n\r\n/**\r\n * @class\r\n * Class representing HTTPClient\r\n */\r\nexport class HTTPClient {\r\n\t/**\r\n\t * @private\r\n\t * A member holding first middleware of the middleware chain\r\n\t */\r\n\tprivate middleware: Middleware;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @constructor\r\n\t * Creates an instance of a HTTPClient\r\n\t * @param {...Middleware} middleware - The first middleware of the middleware chain or a sequence of all the Middleware handlers\r\n\t */\r\n\tpublic constructor(...middleware: Middleware[]) {\r\n\t\tif (!middleware || !middleware.length) {\r\n\t\t\tconst error = new Error();\r\n\t\t\terror.name = \"InvalidMiddlewareChain\";\r\n\t\t\terror.message = \"Please provide a default middleware chain or custom middleware chain\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tthis.setMiddleware(...middleware);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Processes the middleware parameter passed to set this.middleware property\r\n\t * The calling function should validate if middleware is not undefined or not empty.\r\n\t * @param {...Middleware} middleware - The middleware passed\r\n\t * @returns Nothing\r\n\t */\r\n\tprivate setMiddleware(...middleware: Middleware[]): void {\r\n\t\tif (middleware.length > 1) {\r\n\t\t\tthis.parseMiddleWareArray(middleware);\r\n\t\t} else {\r\n\t\t\tthis.middleware = middleware[0];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Processes the middleware array to construct the chain\r\n\t * and sets this.middleware property to the first middlware handler of the array\r\n\t * The calling function should validate if middleware is not undefined or not empty\r\n\t * @param {Middleware[]} middlewareArray - The array of middleware handlers\r\n\t * @returns Nothing\r\n\t */\r\n\tprivate parseMiddleWareArray(middlewareArray: Middleware[]) {\r\n\t\tmiddlewareArray.forEach((element, index) => {\r\n\t\t\tif (index < middlewareArray.length - 1) {\r\n\t\t\t\telement.setNext(middlewareArray[index + 1]);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.middleware = middlewareArray[0];\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @async\r\n\t * To send the request through the middleware chain\r\n\t * @param {Context} context - The context of a request\r\n\t * @returns A promise that resolves to the Context\r\n\t */\r\n\tpublic async sendRequest(context: Context): Promise<Context> {\r\n\t\ttry {\r\n\t\t\tif (typeof context.request === \"string\" && context.options === undefined) {\r\n\t\t\t\tconst error = new Error();\r\n\t\t\t\terror.name = \"InvalidRequestOptions\";\r\n\t\t\t\terror.message = \"Unable to execute the middleware, Please provide valid options for a request\";\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t\tawait this.middleware.execute(context);\r\n\t\t\treturn context;\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module HTTPClientFactory\r\n */\r\n\r\nimport { HTTPClient } from \"./HTTPClient\";\r\nimport { AuthenticationProvider } from \"./IAuthenticationProvider\";\r\nimport { AuthenticationHandler } from \"./middleware/AuthenticationHandler\";\r\nimport { HTTPMessageHandler } from \"./middleware/HTTPMessageHandler\";\r\nimport { Middleware } from \"./middleware/IMiddleware\";\r\nimport { RedirectHandlerOptions } from \"./middleware/options/RedirectHandlerOptions\";\r\nimport { RetryHandlerOptions } from \"./middleware/options/RetryHandlerOptions\";\r\nimport { RedirectHandler } from \"./middleware/RedirectHandler\";\r\nimport { RetryHandler } from \"./middleware/RetryHandler\";\r\nimport { TelemetryHandler } from \"./middleware/TelemetryHandler\";\r\n\r\n/**\r\n * @private\r\n * To check whether the environment is node or not\r\n * @returns A boolean representing the environment is node or not\r\n */\r\nconst isNodeEnvironment = (): boolean => {\r\n\treturn typeof process === \"object\" && typeof require === \"function\";\r\n};\r\n\r\n/**\r\n * @class\r\n * Class representing HTTPClientFactory\r\n */\r\nexport class HTTPClientFactory {\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * Creates HTTPClient with default middleware chain\r\n\t * @param {AuthenticationProvider} authProvider - The authentication provider instance\r\n\t * @returns A HTTPClient instance\r\n\t *\r\n\t * NOTE: These are the things that we need to remember while doing modifications in the below default pipeline.\r\n\t * \t\t* HTTPMessageHander should be the last one in the middleware pipeline, because this makes the actual network call of the request\r\n\t * \t\t* TelemetryHandler should be the one prior to the last middleware in the chain, because this is the one which actually collects and appends the usage flag and placing this handler \t*\t\t  before making the actual network call ensures that the usage of all features are recorded in the flag.\r\n\t * \t\t* The best place for AuthenticationHandler is in the starting of the pipeline, because every other handler might have to work for multiple times for a request but the auth token for\r\n\t * \t\t  them will remain same. For example, Retry and Redirect handlers might be working multiple times for a request based on the response but their auth token would remain same.\r\n\t */\r\n\tpublic static createWithAuthenticationProvider(authProvider: AuthenticationProvider): HTTPClient {\r\n\t\tconst authenticationHandler = new AuthenticationHandler(authProvider);\r\n\t\tconst retryHandler = new RetryHandler(new RetryHandlerOptions());\r\n\t\tconst telemetryHandler = new TelemetryHandler();\r\n\t\tconst httpMessageHandler = new HTTPMessageHandler();\r\n\r\n\t\tauthenticationHandler.setNext(retryHandler);\r\n\t\tif (isNodeEnvironment()) {\r\n\t\t\tconst redirectHandler = new RedirectHandler(new RedirectHandlerOptions());\r\n\t\t\tretryHandler.setNext(redirectHandler);\r\n\t\t\tredirectHandler.setNext(telemetryHandler);\r\n\t\t} else {\r\n\t\t\tretryHandler.setNext(telemetryHandler);\r\n\t\t}\r\n\t\ttelemetryHandler.setNext(httpMessageHandler);\r\n\t\treturn HTTPClientFactory.createWithMiddleware(authenticationHandler);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * Creates a middleware chain with the given one\r\n\t * @property {...Middleware} middleware - The first middleware of the middleware chain or a sequence of all the Middleware handlers\r\n\t * @returns A HTTPClient instance\r\n\t */\r\n\tpublic static createWithMiddleware(...middleware: Middleware[]): HTTPClient {\r\n\t\t// Middleware should not empty or undefined. This is check is present in the HTTPClient constructor.\r\n\t\treturn new HTTPClient(...middleware);\r\n\t}\r\n}\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @constant\r\n * @function\r\n * Validates availability of Promise and fetch in global context\r\n * @returns The true in case the Promise and fetch available, otherwise throws error\r\n */\r\n\r\nexport const validatePolyFilling = (): boolean => {\r\n\tif (typeof Promise === \"undefined\" && typeof fetch === \"undefined\") {\r\n\t\tconst error = new Error(\"Library cannot function without Promise and fetch. So, please provide polyfill for them.\");\r\n\t\terror.name = \"PolyFillNotAvailable\";\r\n\t\tthrow error;\r\n\t} else if (typeof Promise === \"undefined\") {\r\n\t\tconst error = new Error(\"Library cannot function without Promise. So, please provide polyfill for it.\");\r\n\t\terror.name = \"PolyFillNotAvailable\";\r\n\t\tthrow error;\r\n\t} else if (typeof fetch === \"undefined\") {\r\n\t\tconst error = new Error(\"Library cannot function without fetch. So, please provide polyfill for it.\");\r\n\t\terror.name = \"PolyFillNotAvailable\";\r\n\t\tthrow error;\r\n\t}\r\n\treturn true;\r\n};\r\n", "/**\r\n * -------------------------------------------------------------------------------------------\r\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\r\n * See License in the project root for license information.\r\n * -------------------------------------------------------------------------------------------\r\n */\r\n\r\n/**\r\n * @module Client\r\n */\r\n\r\nimport { GRAPH_API_VERSION, GRAPH_BASE_URL } from \"./Constants\";\r\nimport { CustomAuthenticationProvider } from \"./CustomAuthenticationProvider\";\r\nimport { GraphRequest } from \"./GraphRequest\";\r\nimport { HTTPClient } from \"./HTTPClient\";\r\nimport { HTTPClientFactory } from \"./HTTPClientFactory\";\r\nimport { ClientOptions } from \"./IClientOptions\";\r\nimport { Options } from \"./IOptions\";\r\nimport { validatePolyFilling } from \"./ValidatePolyFilling\";\r\n\r\nexport class Client {\r\n\t/**\r\n\t * @private\r\n\t * A member which stores the Client instance options\r\n\t */\r\n\tprivate config: ClientOptions = {\r\n\t\tbaseUrl: GRAPH_BASE_URL,\r\n\t\tdebugLogging: false,\r\n\t\tdefaultVersion: GRAPH_API_VERSION,\r\n\t};\r\n\r\n\t/**\r\n\t * @private\r\n\t * A member which holds the HTTPClient instance\r\n\t */\r\n\tprivate httpClient: HTTPClient;\r\n\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * To create a client instance with options and initializes the default middleware chain\r\n\t * @param {Options} options - The options for client instance\r\n\t * @returns The Client instance\r\n\t */\r\n\tpublic static init(options: Options): Client {\r\n\t\tconst clientOptions: ClientOptions = {};\r\n\t\tfor (const i in options) {\r\n\t\t\tif (options.hasOwnProperty(i)) {\r\n\t\t\t\tclientOptions[i] = i === \"authProvider\" ? new CustomAuthenticationProvider(options[i]) : options[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn Client.initWithMiddleware(clientOptions);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @static\r\n\t * To create a client instance with the Client Options\r\n\t * @param {ClientOptions} clientOptions - The options object for initializing the client\r\n\t * @returns The Client instance\r\n\t */\r\n\tpublic static initWithMiddleware(clientOptions: ClientOptions): Client {\r\n\t\ttry {\r\n\t\t\treturn new Client(clientOptions);\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @constructor\r\n\t * Creates an instance of Client\r\n\t * @param {ClientOptions} clientOptions - The options to instantiate the client object\r\n\t */\r\n\tprivate constructor(clientOptions: ClientOptions) {\r\n\t\ttry {\r\n\t\t\tvalidatePolyFilling();\r\n\t\t} catch (error) {\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tfor (const key in clientOptions) {\r\n\t\t\tif (clientOptions.hasOwnProperty(key)) {\r\n\t\t\t\tthis.config[key] = clientOptions[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet httpClient: HTTPClient;\r\n\t\tif (clientOptions.authProvider !== undefined && clientOptions.middleware !== undefined) {\r\n\t\t\tconst error = new Error();\r\n\t\t\terror.name = \"AmbiguityInInitialization\";\r\n\t\t\terror.message = \"Unable to Create Client, Please provide either authentication provider for default middleware chain or custom middleware chain not both\";\r\n\t\t\tthrow error;\r\n\t\t} else if (clientOptions.authProvider !== undefined) {\r\n\t\t\thttpClient = HTTPClientFactory.createWithAuthenticationProvider(clientOptions.authProvider);\r\n\t\t} else if (clientOptions.middleware !== undefined) {\r\n\t\t\thttpClient = new HTTPClient(...[].concat(clientOptions.middleware));\r\n\t\t} else {\r\n\t\t\tconst error = new Error();\r\n\t\t\terror.name = \"InvalidMiddlewareChain\";\r\n\t\t\terror.message = \"Unable to Create Client, Please provide either authentication provider for default middleware chain or custom middleware chain\";\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t\tthis.httpClient = httpClient;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Entry point to make requests\r\n\t * @param {string} path - The path string value\r\n\t * @returns The graph request instance\r\n\t */\r\n\tpublic api(path: string): GraphRequest {\r\n\t\treturn new GraphRequest(this.httpClient, this.config, path);\r\n\t}\r\n}\r\n", "/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\n/**\n * @hidden\n */\nexport class CryptoUtils {\n\n    /**\n     * Creates a new random GUID\n     * @returns string (GUID)\n     */\n    static createNewGuid(): string {\n        /*\n         * RFC4122: The version 4 UUID is meant for generating UUIDs from truly-random or\n         * pseudo-random numbers.\n         * The algorithm is as follows:\n         *     Set the two most significant bits (bits 6 and 7) of the\n         *        clock_seq_hi_and_reserved to zero and one, respectively.\n         *     Set the four most significant bits (bits 12 through 15) of the\n         *        time_hi_and_version field to the 4-bit version number from\n         *        Section 4.1.3. Version4\n         *     Set all the other bits to randomly (or pseudo-randomly) chosen\n         *     values.\n         * UUID                   = time-low \"-\" time-mid \"-\"time-high-and-version \"-\"clock-seq-reserved and low(2hexOctet)\"-\" node\n         * time-low               = 4hexOctet\n         * time-mid               = 2hexOctet\n         * time-high-and-version  = 2hexOctet\n         * clock-seq-and-reserved = hexOctet:\n         * clock-seq-low          = hexOctet\n         * node                   = 6hexOctet\n         * Format: xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\n         * y could be 1000, 1001, 1010, 1011 since most significant two bits needs to be 10\n         * y values are 8, 9, A, B\n         */\n\n        const cryptoObj: Crypto = window.crypto; // for IE 11\n        if (cryptoObj && cryptoObj.getRandomValues) {\n            const buffer: Uint8Array = new Uint8Array(16);\n            cryptoObj.getRandomValues(buffer);\n\n            // buffer[6] and buffer[7] represents the time_hi_and_version field. We will set the four most significant bits (4 through 7) of buffer[6] to represent decimal number 4 (UUID version number).\n            buffer[6] |= 0x40; // buffer[6] | 01000000 will set the 6 bit to 1.\n            buffer[6] &= 0x4f; // buffer[6] & 01001111 will set the 4, 5, and 7 bit to 0 such that bits 4-7 == 0100 = \"4\".\n\n            // buffer[8] represents the clock_seq_hi_and_reserved field. We will set the two most significant bits (6 and 7) of the clock_seq_hi_and_reserved to zero and one, respectively.\n            buffer[8] |= 0x80; // buffer[8] | 10000000 will set the 7 bit to 1.\n            buffer[8] &= 0xbf; // buffer[8] & 10111111 will set the 6 bit to 0.\n\n            return CryptoUtils.decimalToHex(buffer[0]) + CryptoUtils.decimalToHex(buffer[1])\n                + CryptoUtils.decimalToHex(buffer[2]) + CryptoUtils.decimalToHex(buffer[3])\n                + \"-\" + CryptoUtils.decimalToHex(buffer[4]) + CryptoUtils.decimalToHex(buffer[5])\n                + \"-\" + CryptoUtils.decimalToHex(buffer[6]) + CryptoUtils.decimalToHex(buffer[7])\n                + \"-\" + CryptoUtils.decimalToHex(buffer[8]) + CryptoUtils.decimalToHex(buffer[9])\n                + \"-\" + CryptoUtils.decimalToHex(buffer[10]) + CryptoUtils.decimalToHex(buffer[11])\n                + CryptoUtils.decimalToHex(buffer[12]) + CryptoUtils.decimalToHex(buffer[13])\n                + CryptoUtils.decimalToHex(buffer[14]) + CryptoUtils.decimalToHex(buffer[15]);\n        }\n        else {\n            const guidHolder: string = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\";\n            const hex: string = \"0123456789abcdef\";\n            let r: number = 0;\n            let guidResponse: string = \"\";\n            for (let i: number = 0; i < 36; i++) {\n                if (guidHolder[i] !== \"-\" && guidHolder[i] !== \"4\") {\n                    // each x and y needs to be random\n                    r = Math.random() * 16 | 0;\n                }\n                if (guidHolder[i] === \"x\") {\n                    guidResponse += hex[r];\n                } else if (guidHolder[i] === \"y\") {\n                    // clock-seq-and-reserved first hex is filtered and remaining hex values are random\n                    r &= 0x3; // bit and with 0011 to set pos 2 to zero ?0??\n                    r |= 0x8; // set pos 3 to 1 as 1???\n                    guidResponse += hex[r];\n                } else {\n                    guidResponse += guidHolder[i];\n                }\n            }\n            return guidResponse;\n        }\n    }\n\n    /**\n     * verifies if a string is  GUID\n     * @param guid\n     */\n    static isGuid(guid: string): boolean {\n        const regexGuid = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n        return regexGuid.test(guid);\n    }\n\n    /**\n     * Decimal to Hex\n     *\n     * @param num\n     */\n    static decimalToHex(num: number): string {\n        let hex: string = num.toString(16);\n        while (hex.length < 2) {\n            hex = \"0\" + hex;\n        }\n        return hex;\n    }\n\n    // See: https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#Solution_4_%E2%80%93_escaping_the_string_before_encoding_it\n\n    /**\n     * encoding string to base64 - platform specific check\n     *\n     * @param input\n     */\n    static base64Encode(input: string): string {\n        return btoa(encodeURIComponent(input).replace(/%([0-9A-F]{2})/g,\n            function toSolidBytes(match, p1) {\n                return String.fromCharCode(Number(\"0x\" + p1));\n            }));\n    }\n\n    /**\n     * Decodes a base64 encoded string.\n     *\n     * @param input\n     */\n    static base64Decode(input: string): string {\n        let encodedString = input.replace(/-/g, \"+\").replace(/_/g, \"/\");\n        switch (encodedString.length % 4) {\n            case 0:\n                break;\n            case 2:\n                encodedString += \"==\";\n                break;\n            case 3:\n                encodedString += \"=\";\n                break;\n            default:\n                throw new Error(\"Invalid base64 string\");\n        }\n\n        return decodeURIComponent(atob(encodedString).split(\"\").map(function (c) {\n            return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n        }).join(\"\"));\n    }\n\n    /**\n     * deserialize a string\n     *\n     * @param query\n     */\n    static deserialize(query: string): object {\n        let match: Array<string>; // Regex for replacing addition symbol with a space\n        const pl = /\\+/g;\n        const search = /([^&=]+)=([^&]*)/g;\n        const decode = (s: string) => decodeURIComponent(s.replace(pl, \" \"));\n        const obj: {} = {};\n        match = search.exec(query);\n        while (match) {\n            obj[decode(match[1])] = decode(match[2]);\n            match = search.exec(query);\n        }\n        return obj;\n    }\n\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\n/**\n * @hidden\n * Constants\n */\nexport class Constants {\n    static get libraryName(): string { return \"Msal.js\"; } // used in telemetry sdkName\n    static get claims(): string { return \"claims\"; }\n    static get clientId(): string { return \"clientId\"; }\n\n    static get adalIdToken(): string { return \"adal.idtoken\"; }\n    static get cachePrefix(): string { return \"msal\"; }\n    static get scopes(): string { return \"scopes\"; }\n\n    static get no_account(): string { return \"NO_ACCOUNT\"; }\n    static get upn(): string { return \"upn\"; }\n    static get domain_hint(): string { return \"domain_hint\"; }\n\n    static get prompt_select_account(): string { return \"&prompt=select_account\"; }\n    static get prompt_none(): string { return \"&prompt=none\"; }\n    static get prompt(): string { return \"prompt\"; }\n\n    static get response_mode_fragment(): string { return \"&response_mode=fragment\"; }\n    static get resourceDelimiter(): string { return \"|\"; }\n    static get cacheDelimiter(): string { return \".\"; }\n\n    private static _popUpWidth: number = 483;\n    static get popUpWidth(): number { return this._popUpWidth; }\n    static set popUpWidth(width: number) {\n        this._popUpWidth = width;\n    }\n    private static _popUpHeight: number = 600;\n    static get popUpHeight(): number { return this._popUpHeight; }\n    static set popUpHeight(height: number) {\n        this._popUpHeight = height;\n    }\n\n    static get login(): string { return \"LOGIN\"; }\n    static get renewToken(): string { return \"RENEW_TOKEN\"; }\n    static get unknown(): string { return \"UNKNOWN\"; }\n\n    static get ADFS(): string { return \"adfs\"; }\n\n    static get homeAccountIdentifier(): string { return \"homeAccountIdentifier\"; }\n\n    static get common(): string { return \"common\"; }\n    static get openidScope(): string { return \"openid\"; }\n    static get profileScope(): string { return \"profile\"; }\n    static get oidcScopes(): Array<string> { return [this.openidScope, this.profileScope] ;}\n\n    static get interactionTypeRedirect(): InteractionType { return \"redirectInteraction\"; }\n    static get interactionTypePopup(): InteractionType { return \"popupInteraction\"; }\n    static get interactionTypeSilent(): InteractionType { return \"silentInteraction\"; }\n    static get inProgress(): string { return \"inProgress\"; }\n}\n\nexport const SESSION_STORAGE = \"sessionStorage\";\n\n/**\n * Keys in the hashParams\n */\nexport enum ServerHashParamKeys {\n    SCOPE = \"scope\",\n    STATE = \"state\",\n    ERROR = \"error\",\n    ERROR_DESCRIPTION = \"error_description\",\n    ACCESS_TOKEN = \"access_token\",\n    ID_TOKEN = \"id_token\",\n    EXPIRES_IN = \"expires_in\",\n    SESSION_STATE = \"session_state\",\n    CLIENT_INFO = \"client_info\"\n}\n\n/**\n * @hidden\n * @ignore\n * response_type from OpenIDConnect\n * References: https://openid.net/specs/oauth-v2-multiple-response-types-1_0.html & https://tools.ietf.org/html/rfc6749#section-4.2.1\n *\n */\nexport const ResponseTypes = {\n    id_token: \"id_token\",\n    token: \"token\",\n    id_token_token: \"id_token token\"\n};\n\n/**\n * @hidden\n * CacheKeys for MSAL\n */\nexport enum TemporaryCacheKeys {\n    AUTHORITY = \"authority\",\n    ACQUIRE_TOKEN_ACCOUNT = \"acquireTokenAccount\",\n    SESSION_STATE = \"session.state\",\n    STATE_LOGIN = \"state.login\",\n    STATE_ACQ_TOKEN = \"state.acquireToken\",\n    STATE_RENEW = \"state.renew\",\n    NONCE_IDTOKEN = \"nonce.idtoken\",\n    LOGIN_REQUEST = \"login.request\",\n    RENEW_STATUS = \"token.renew.status\",\n    URL_HASH = \"urlHash\",\n    INTERACTION_STATUS = \"interaction.status\",\n    REDIRECT_REQUEST = \"redirect_request\"\n}\n\nexport enum PersistentCacheKeys {\n    IDTOKEN = \"idtoken\",\n    CLIENT_INFO = \"client.info\"\n}\n\nexport enum ErrorCacheKeys {\n    LOGIN_ERROR = \"login.error\",\n    ERROR = \"error\",\n    ERROR_DESC = \"error.description\"\n}\n\nexport const DEFAULT_AUTHORITY: string = \"https://login.microsoftonline.com/common/\";\nexport const AAD_INSTANCE_DISCOVERY_ENDPOINT: string = `${DEFAULT_AUTHORITY}/discovery/instance?api-version=1.1&authorization_endpoint=`;\nexport const WELL_KNOWN_SUFFIX: string = \".well-known/openid-configuration\";\n\n/**\n * @hidden\n * SSO Types - generated to populate hints\n */\nexport enum SSOTypes {\n    ACCOUNT = \"account\",\n    SID = \"sid\",\n    LOGIN_HINT = \"login_hint\",\n    ORGANIZATIONS = \"organizations\",\n    CONSUMERS = \"consumers\",\n    ID_TOKEN =\"id_token\",\n    ACCOUNT_ID = \"accountIdentifier\",\n    HOMEACCOUNT_ID = \"homeAccountIdentifier\"\n}\n\n/**\n * @hidden\n */\nexport const BlacklistedEQParams = [\n    SSOTypes.SID,\n    SSOTypes.LOGIN_HINT\n];\n\nexport type InteractionType = \"redirectInteraction\" | \"popupInteraction\" | \"silentInteraction\";\n\nexport const NetworkRequestType = {\n    GET: \"GET\",\n    POST: \"POST\"\n};\n\n/**\n * we considered making this \"enum\" in the request instead of string, however it looks like the allowed list of\n * prompt values kept changing over past couple of years. There are some undocumented prompt values for some\n * internal partners too, hence the choice of generic \"string\" type instead of the \"enum\"\n * @hidden\n */\nexport const PromptState = {\n    LOGIN: \"login\",\n    SELECT_ACCOUNT: \"select_account\",\n    CONSENT: \"consent\",\n    NONE: \"none\"\n};\n\n/**\n * Frame name prefixes for the hidden iframe created in silent frames\n */\nexport const FramePrefix = {\n    ID_TOKEN_FRAME: \"msalIdTokenFrame\",\n    TOKEN_FRAME: \"msalRenewFrame\"\n};\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nexport const AuthErrorMessage = {\n    unexpectedError: {\n        code: \"unexpected_error\",\n        desc: \"Unexpected error in authentication.\"\n    },\n    noWindowObjectError: {\n        code: \"no_window_object\",\n        desc: \"No window object available. Details:\"\n    }\n};\n\n/**\n * General error class thrown by the MSAL.js library.\n */\nexport class AuthError extends Error {\n\n    errorCode: string;\n    errorMessage: string;\n\n    constructor(errorCode: string, errorMessage?: string) {\n        super(errorMessage);\n        Object.setPrototypeOf(this, AuthError.prototype);\n\n        this.errorCode = errorCode;\n        this.errorMessage = errorMessage;\n        this.name = \"AuthError\";\n    }\n\n    static createUnexpectedError(errDesc: string): AuthError {\n        return new AuthError(AuthErrorMessage.unexpectedError.code, `${AuthErrorMessage.unexpectedError.desc}: ${errDesc}`);\n    }\n\n    static createNoWindowObjectError(errDesc: string): AuthError {\n        return new AuthError(AuthErrorMessage.noWindowObjectError.code, `${AuthErrorMessage.noWindowObjectError.desc} ${errDesc}`);\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { AccessTokenKey } from \"../cache/AccessTokenKey\";\n\n/**\n * @hidden\n */\nexport class StringUtils {\n    /**\n     * Check if a string is empty\n     *\n     * @param str\n     */\n    static isEmpty(str: string): boolean {\n        return (typeof str === \"undefined\" || !str || 0 === str.length);\n    }\n\n    /**\n     * Check if a string's value is a valid JSON object\n     *\n     * @param str\n     */\n    static validateAndParseJsonCacheKey(str: string): AccessTokenKey {\n        try {\n            const parsedKey = JSON.parse(str);\n            /**\n             * There are edge cases in which JSON.parse will successfully parse a non-valid JSON object \n             * (e.g. JSON.parse will parse an escaped string into an unescaped string), so adding a type check\n             * of the parsed value is necessary in order to be certain that the string represents a valid JSON object.\n             *\n             */\n            return (parsedKey && typeof parsedKey === \"object\") ? parsedKey : null;\n        } catch (error) {\n            return null;\n        }\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { AuthError } from \"./AuthError\";\nimport { IdToken } from \"../IdToken\";\nimport { StringUtils } from \"../utils/StringUtils\";\n\nexport const ClientAuthErrorMessage = {\n    endpointResolutionError: {\n        code: \"endpoints_resolution_error\",\n        desc: \"Error: could not resolve endpoints. Please check network and try again.\"\n    },\n    popUpWindowError: {\n        code: \"popup_window_error\",\n        desc: \"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.\"\n    },\n    tokenRenewalError: {\n        code: \"token_renewal_error\",\n        desc: \"Token renewal operation failed due to timeout.\"\n    },\n    invalidIdToken: {\n        code: \"invalid_id_token\",\n        desc: \"Invalid ID token format.\"\n    },\n    invalidStateError: {\n        code: \"invalid_state_error\",\n        desc: \"Invalid state.\"\n    },\n    nonceMismatchError: {\n        code: \"nonce_mismatch_error\",\n        desc: \"Nonce is not matching, Nonce received: \"\n    },\n    loginProgressError: {\n        code: \"login_progress_error\",\n        desc: \"Login_In_Progress: Error during login call - login is already in progress.\"\n    },\n    acquireTokenProgressError: {\n        code: \"acquiretoken_progress_error\",\n        desc: \"AcquireToken_In_Progress: Error during login call - login is already in progress.\"\n    },\n    userCancelledError: {\n        code: \"user_cancelled\",\n        desc: \"User cancelled the flow.\"\n    },\n    callbackError: {\n        code: \"callback_error\",\n        desc: \"Error occurred in token received callback function.\"\n    },\n    userLoginRequiredError: {\n        code: \"user_login_error\",\n        desc: \"User login is required. For silent calls, request must contain either sid or login_hint\"\n    },\n    userDoesNotExistError: {\n        code: \"user_non_existent\",\n        desc: \"User object does not exist. Please call a login API.\"\n    },\n    clientInfoDecodingError: {\n        code: \"client_info_decoding_error\",\n        desc: \"The client info could not be parsed/decoded correctly. Please review the trace to determine the root cause.\"\n    },\n    clientInfoNotPopulatedError: {\n        code: \"client_info_not_populated_error\",\n        desc: \"The service did not populate client_info in the response, Please verify with the service team\"\n    },\n    nullOrEmptyIdToken: {\n        code: \"null_or_empty_id_token\",\n        desc: \"The idToken is null or empty. Please review the trace to determine the root cause.\"\n    },\n    idTokenNotParsed: {\n        code: \"id_token_parsing_error\",\n        desc: \"ID token cannot be parsed. Please review stack trace to determine root cause.\"\n    },\n    tokenEncodingError: {\n        code: \"token_encoding_error\",\n        desc: \"The token to be decoded is not encoded correctly.\"\n    },\n    invalidInteractionType: {\n        code: \"invalid_interaction_type\",\n        desc: \"The interaction type passed to the handler was incorrect or unknown\"\n    },\n    cacheParseError: {\n        code: \"cannot_parse_cache\",\n        desc: \"The cached token key is not a valid JSON and cannot be parsed\"\n    },\n    blockTokenRequestsInHiddenIframe: {\n        code: \"block_token_requests\",\n        desc: \"Token calls are blocked in hidden iframes\"\n    }\n};\n\n/**\n * Error thrown when there is an error in the client code running on the browser.\n */\nexport class ClientAuthError extends AuthError {\n\n    constructor(errorCode: string, errorMessage?: string) {\n        super(errorCode, errorMessage);\n        this.name = \"ClientAuthError\";\n\n        Object.setPrototypeOf(this, ClientAuthError.prototype);\n    }\n\n    static createEndpointResolutionError(errDetail?: string): ClientAuthError {\n        let errorMessage = ClientAuthErrorMessage.endpointResolutionError.desc;\n        if (errDetail && !StringUtils.isEmpty(errDetail)) {\n            errorMessage += ` Details: ${errDetail}`;\n        }\n        return new ClientAuthError(ClientAuthErrorMessage.endpointResolutionError.code, errorMessage);\n    }\n\n    static createPopupWindowError(errDetail?: string): ClientAuthError {\n        let errorMessage = ClientAuthErrorMessage.popUpWindowError.desc;\n        if (errDetail && !StringUtils.isEmpty(errDetail)) {\n            errorMessage += ` Details: ${errDetail}`;\n        }\n        return new ClientAuthError(ClientAuthErrorMessage.popUpWindowError.code, errorMessage);\n    }\n\n    static createTokenRenewalTimeoutError(): ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.tokenRenewalError.code, ClientAuthErrorMessage.tokenRenewalError.desc);\n    }\n\n    static createInvalidIdTokenError(idToken: IdToken) : ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.invalidIdToken.code,\n            `${ClientAuthErrorMessage.invalidIdToken.desc} Given token: ${idToken}`);\n    }\n\n    // TODO: Is this not a security flaw to send the user the state expected??\n    static createInvalidStateError(invalidState: string, actualState: string): ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.invalidStateError.code,\n            `${ClientAuthErrorMessage.invalidStateError.desc} ${invalidState}, state expected : ${actualState}.`);\n    }\n\n    // TODO: Is this not a security flaw to send the user the Nonce expected??\n    static createNonceMismatchError(invalidNonce: string, actualNonce: string): ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.nonceMismatchError.code,\n            `${ClientAuthErrorMessage.nonceMismatchError.desc} ${invalidNonce}, nonce expected : ${actualNonce}.`);\n    }\n\n    static createLoginInProgressError(): ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.loginProgressError.code,\n            ClientAuthErrorMessage.loginProgressError.desc);\n    }\n\n    static createAcquireTokenInProgressError(): ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.acquireTokenProgressError.code,\n            ClientAuthErrorMessage.acquireTokenProgressError.desc);\n    }\n\n    static createUserCancelledError(): ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.userCancelledError.code,\n            ClientAuthErrorMessage.userCancelledError.desc);\n    }\n\n    static createErrorInCallbackFunction(errorDesc: string): ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.callbackError.code,\n            `${ClientAuthErrorMessage.callbackError.desc} ${errorDesc}.`);\n    }\n\n    static createUserLoginRequiredError() : ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.userLoginRequiredError.code,\n            ClientAuthErrorMessage.userLoginRequiredError.desc);\n    }\n\n    static createUserDoesNotExistError() : ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.userDoesNotExistError.code,\n            ClientAuthErrorMessage.userDoesNotExistError.desc);\n    }\n\n    static createClientInfoDecodingError(caughtError: string) : ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.clientInfoDecodingError.code,\n            `${ClientAuthErrorMessage.clientInfoDecodingError.desc} Failed with error: ${caughtError}`);\n    }\n\n    static createClientInfoNotPopulatedError(caughtError: string) : ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.clientInfoNotPopulatedError.code,\n            `${ClientAuthErrorMessage.clientInfoNotPopulatedError.desc} Failed with error: ${caughtError}`);\n    }\n\n    static createIdTokenNullOrEmptyError(invalidRawTokenString: string) : ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.nullOrEmptyIdToken.code,\n            `${ClientAuthErrorMessage.nullOrEmptyIdToken.desc} Raw ID Token Value: ${invalidRawTokenString}`);\n    }\n\n    static createIdTokenParsingError(caughtParsingError: string) : ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.idTokenNotParsed.code,\n            `${ClientAuthErrorMessage.idTokenNotParsed.desc} Failed with error: ${caughtParsingError}`);\n    }\n\n    static createTokenEncodingError(incorrectlyEncodedToken: string) : ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.tokenEncodingError.code,\n            `${ClientAuthErrorMessage.tokenEncodingError.desc} Attempted to decode: ${incorrectlyEncodedToken}`);\n    }\n\n    static createInvalidInteractionTypeError() : ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.invalidInteractionType.code,\n            ClientAuthErrorMessage.invalidInteractionType.desc);\n    }\n\n    static createCacheParseError(key: string) : ClientAuthError {\n        const errorMessage = `invalid key: ${key}, ${ClientAuthErrorMessage.cacheParseError.desc}`;\n        return new ClientAuthError(ClientAuthErrorMessage.cacheParseError.code,\n            errorMessage);\n    }\n\n    static createBlockTokenRequestsInHiddenIframeError(): ClientAuthError {\n        return new ClientAuthError(ClientAuthErrorMessage.blockTokenRequestsInHiddenIframe.code,\n            ClientAuthErrorMessage.blockTokenRequestsInHiddenIframe.desc);\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { ClientAuthError } from \"./ClientAuthError\";\nimport { TelemetryOptions } from \"../Configuration\";\n\ninterface IClientConfigurationErrorMessage {\n    code: string,\n    desc: string\n}\n\nexport const ClientConfigurationErrorMessage: Record<string, IClientConfigurationErrorMessage> = {\n    configurationNotSet: {\n        code: \"no_config_set\",\n        desc: \"Configuration has not been set. Please call the UserAgentApplication constructor with a valid Configuration object.\"\n    },\n    storageNotSupported: {\n        code: \"storage_not_supported\",\n        desc: \"The value for the cacheLocation is not supported.\"\n    },\n    noRedirectCallbacksSet: {\n        code: \"no_redirect_callbacks\",\n        desc: \"No redirect callbacks have been set. Please call handleRedirectCallback() with the appropriate function arguments before continuing. \" +\n            \"More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics.\"\n    },\n    invalidCallbackObject: {\n        code: \"invalid_callback_object\",\n        desc: \"The object passed for the callback was invalid. \" +\n          \"More information is available here: https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki/MSAL-basics.\"\n    },\n    scopesRequired: {\n        code: \"scopes_required\",\n        desc: \"Scopes are required to obtain an access token.\"\n    },\n    emptyScopes: {\n        code: \"empty_input_scopes_error\",\n        desc: \"Scopes cannot be passed as empty array.\"\n    },\n    nonArrayScopes: {\n        code: \"nonarray_input_scopes_error\",\n        desc: \"Scopes cannot be passed as non-array.\"\n    },\n    invalidPrompt: {\n        code: \"invalid_prompt_value\",\n        desc: \"Supported prompt values are 'login', 'select_account', 'consent' and 'none'\",\n    },\n    invalidAuthorityType: {\n        code: \"invalid_authority_type\",\n        desc: \"The given authority is not a valid type of authority supported by MSAL. Please see here for valid authorities: <insert URL here>.\"\n    },\n    authorityUriInsecure: {\n        code: \"authority_uri_insecure\",\n        desc: \"Authority URIs must use https.\"\n    },\n    authorityUriInvalidPath: {\n        code: \"authority_uri_invalid_path\",\n        desc: \"Given authority URI is invalid.\"\n    },\n    unsupportedAuthorityValidation: {\n        code: \"unsupported_authority_validation\",\n        desc: \"The authority validation is not supported for this authority type.\"\n    },\n    untrustedAuthority: {\n        code: \"untrusted_authority\",\n        desc: \"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter or set validateAuthority=false.\"\n    },\n    b2cAuthorityUriInvalidPath: {\n        code: \"b2c_authority_uri_invalid_path\",\n        desc: \"The given URI for the B2C authority is invalid.\"\n    },\n    b2cKnownAuthoritiesNotSet: {\n        code: \"b2c_known_authorities_not_set\",\n        desc: \"Must set known authorities when validateAuthority is set to True and using B2C\"\n    },\n    claimsRequestParsingError: {\n        code: \"claims_request_parsing_error\",\n        desc: \"Could not parse the given claims request object.\"\n    },\n    emptyRequestError: {\n        code: \"empty_request_error\",\n        desc: \"Request object is required.\"\n    },\n    invalidCorrelationIdError: {\n        code: \"invalid_guid_sent_as_correlationId\",\n        desc: \"Please set the correlationId as a valid guid\"\n    },\n    telemetryConfigError: {\n        code: \"telemetry_config_error\",\n        desc: \"Telemetry config is not configured with required values\"\n    },\n    ssoSilentError: {\n        code: \"sso_silent_error\",\n        desc: \"request must contain either sid or login_hint\"\n    },\n    invalidAuthorityMetadataError: {\n        code: \"authority_metadata_error\",\n        desc: \"Invalid authorityMetadata. Must be a JSON object containing authorization_endpoint, end_session_endpoint, and issuer fields.\"\n    }\n};\n\n/**\n * Error thrown when there is an error in configuration of the .js library.\n */\nexport class ClientConfigurationError extends ClientAuthError {\n\n    constructor(errorCode: string, errorMessage?: string) {\n        super(errorCode, errorMessage);\n        this.name = \"ClientConfigurationError\";\n        Object.setPrototypeOf(this, ClientConfigurationError.prototype);\n    }\n\n    static createNoSetConfigurationError(): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.configurationNotSet.code,\n            `${ClientConfigurationErrorMessage.configurationNotSet.desc}`);\n    }\n\n    static createStorageNotSupportedError(givenCacheLocation: string) : ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.storageNotSupported.code,\n            `${ClientConfigurationErrorMessage.storageNotSupported.desc} Given location: ${givenCacheLocation}`);\n    }\n\n    static createRedirectCallbacksNotSetError(): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.noRedirectCallbacksSet.code, ClientConfigurationErrorMessage.noRedirectCallbacksSet.desc);\n    }\n\n    static createInvalidCallbackObjectError(callbackObject: object): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.invalidCallbackObject.code,\n            `${ClientConfigurationErrorMessage.invalidCallbackObject.desc} Given value for callback function: ${callbackObject}`);\n    }\n\n    static createEmptyScopesArrayError(scopesValue: string): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.emptyScopes.code,\n            `${ClientConfigurationErrorMessage.emptyScopes.desc} Given value: ${scopesValue}.`);\n    }\n\n    static createScopesNonArrayError(scopesValue: string): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.nonArrayScopes.code,\n            `${ClientConfigurationErrorMessage.nonArrayScopes.desc} Given value: ${scopesValue}.`);\n    }\n\n    static createScopesRequiredError(scopesValue: string[]): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.scopesRequired.code,\n            `${ClientConfigurationErrorMessage.scopesRequired.desc} Given value: ${scopesValue}`);\n    }\n\n    static createInvalidPromptError(promptValue: string): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.invalidPrompt.code,\n            `${ClientConfigurationErrorMessage.invalidPrompt.desc} Given value: ${promptValue}`);\n    }\n\n    static createClaimsRequestParsingError(claimsRequestParseError: string): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.claimsRequestParsingError.code,\n            `${ClientConfigurationErrorMessage.claimsRequestParsingError.desc} Given value: ${claimsRequestParseError}`);\n    }\n\n    static createEmptyRequestError(): ClientConfigurationError {\n        const { code, desc } = ClientConfigurationErrorMessage.emptyRequestError;\n        return new ClientConfigurationError(code, desc);\n    }\n\n    static createInvalidCorrelationIdError(): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.invalidCorrelationIdError.code,\n            ClientConfigurationErrorMessage.invalidCorrelationIdError.desc);\n    }\n\n    static createKnownAuthoritiesNotSetError(): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.b2cKnownAuthoritiesNotSet.code,\n            ClientConfigurationErrorMessage.b2cKnownAuthoritiesNotSet.desc);\n    }\n\n    static createInvalidAuthorityTypeError(): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.invalidAuthorityType.code,\n            ClientConfigurationErrorMessage.invalidAuthorityType.desc);\n    }\n\n    static createUntrustedAuthorityError(host: string): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.untrustedAuthority.code,\n            `${ClientConfigurationErrorMessage.untrustedAuthority.desc} Provided Authority: ${host}`);\n    }\n\n    static createTelemetryConfigError(config: TelemetryOptions): ClientConfigurationError {\n        const { code, desc } = ClientConfigurationErrorMessage.telemetryConfigError;\n        const requiredKeys = {\n            applicationName: \"string\",\n            applicationVersion: \"string\",\n            telemetryEmitter: \"function\"\n        };\n\n        const missingKeys = Object.keys(requiredKeys)\n            .reduce((keys, key) => {\n                return config[key] ? keys : keys.concat([ `${key} (${requiredKeys[key]})` ]);\n            }, []);\n\n        return new ClientConfigurationError(code, `${desc} mising values: ${missingKeys.join(\",\")}`);\n    }\n\n    static createSsoSilentError(): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.ssoSilentError.code,\n            ClientConfigurationErrorMessage.ssoSilentError.desc);\n    }\n\n    static createInvalidAuthorityMetadataError(): ClientConfigurationError {\n        return new ClientConfigurationError(ClientConfigurationErrorMessage.invalidAuthorityMetadataError.code, ClientConfigurationErrorMessage.invalidAuthorityMetadataError.desc);\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { ClientConfigurationError } from \"./error/ClientConfigurationError\";\nimport { Constants } from \"./utils/Constants\";\n\nexport class ScopeSet {\n\n    /**\n     * Check if there are dup scopes in a given request\n     *\n     * @param cachedScopes\n     * @param scopes\n     */\n    // TODO: Rename this, intersecting scopes isn't a great name for duplicate checker\n    static isIntersectingScopes(cachedScopes: Array<string>, scopes: Array<string>): boolean {\n        const convertedCachedScopes = this.trimAndConvertArrayToLowerCase([...cachedScopes]);\n        const requestScopes = this.trimAndConvertArrayToLowerCase([...scopes]);\n        for (let i = 0; i < requestScopes.length; i++) {\n            if (convertedCachedScopes.indexOf(requestScopes[i].toLowerCase()) > -1) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    /**\n     * Check if a given scope is present in the request\n     *\n     * @param cachedScopes\n     * @param scopes\n     */\n    static containsScope(cachedScopes: Array<string>, scopes: Array<string>): boolean {\n        const convertedCachedScopes = this.trimAndConvertArrayToLowerCase([...cachedScopes]);\n        const requestScopes = this.trimAndConvertArrayToLowerCase([...scopes]);\n        return requestScopes.every((value: string): boolean => convertedCachedScopes.indexOf(value.toString().toLowerCase()) >= 0);\n    }\n\n    /**\n     *  Trims and converts string to lower case\n     *\n     * @param scopes\n     */\n    // TODO: Rename this, too generic name for a function that only deals with scopes\n    static trimAndConvertToLowerCase(scope: string): string {\n        return scope.trim().toLowerCase();\n    }\n\n    /**\n     * Performs trimAndConvertToLowerCase on string array\n     * @param scopes \n     */\n    static trimAndConvertArrayToLowerCase(scopes: Array<string>): Array<string> {\n        return scopes.map(scope => this.trimAndConvertToLowerCase(scope));\n    }\n\n    /**\n     * Trims each scope in scopes array\n     * @param scopes \n     */\n    static trimScopes(scopes: Array<string>): Array<string> {\n        return scopes.map(scope => scope.trim());\n    }\n\n    /**\n     * Remove one element from a scope array\n     *\n     * @param scopes\n     * @param scope\n     */\n    // TODO: Rename this, too generic name for a function that only deals with scopes\n    static removeElement(scopes: Array<string>, scope: string): Array<string> {\n        const scopeVal = this.trimAndConvertToLowerCase(scope);\n        return scopes.filter(value => value !== scopeVal);\n    }\n\n    /**\n     * Parse the scopes into a formatted scopeList\n     * @param scopes\n     */\n    static parseScope(scopes: Array<string>): string {\n        let scopeList: string = \"\";\n        if (scopes) {\n            for (let i: number = 0; i < scopes.length; ++i) {\n                scopeList += (i !== scopes.length - 1) ? scopes[i] + \" \" : scopes[i];\n            }\n        }\n\n        return scopeList;\n    }\n\n    /**\n     * @hidden\n     *\n     * Used to validate the scopes input parameter requested  by the developer.\n     * @param {Array<string>} scopes - Developer requested permissions. Not all scopes are guaranteed to be included in the access token returned.\n     * @param {boolean} scopesRequired - Boolean indicating whether the scopes array is required or not\n     * @ignore\n     */\n    static validateInputScope(scopes: Array<string>, scopesRequired: boolean): void {\n        if (!scopes) {\n            if (scopesRequired) {\n                throw ClientConfigurationError.createScopesRequiredError(scopes);\n            } else {\n                return;\n            }\n        }\n\n        // Check that scopes is an array object (also throws error if scopes == null)\n        if (!Array.isArray(scopes)) {\n            throw ClientConfigurationError.createScopesNonArrayError(scopes);\n        }\n\n        // Check that scopes is not an empty array\n        if (scopes.length < 1 && scopesRequired) {\n            throw ClientConfigurationError.createEmptyScopesArrayError(scopes.toString());\n        }\n    }\n\n    /**\n     * @hidden\n     *\n     * Extracts scope value from the state sent with the authentication request.\n     * @param {string} state\n     * @returns {string} scope.\n     * @ignore\n     */\n    static getScopeFromState(state: string): string {\n        if (state) {\n            const splitIndex = state.indexOf(Constants.resourceDelimiter);\n            if (splitIndex > -1 && splitIndex + 1 < state.length) {\n                return state.substring(splitIndex + 1);\n            }\n        }\n        return \"\";\n    }\n\n    /**\n     * @ignore\n     * Appends extraScopesToConsent if passed\n     * @param {@link AuthenticationParameters}\n     */\n    static appendScopes(reqScopes: Array<string>, reqExtraScopesToConsent: Array<string>): Array<string> {\n        if (reqScopes) {\n            const convertedExtraScopes = reqExtraScopesToConsent ? this.trimAndConvertArrayToLowerCase([...reqExtraScopesToConsent]) : null;\n            const convertedReqScopes = this.trimAndConvertArrayToLowerCase([...reqScopes]);\n            return convertedExtraScopes ? [...convertedReqScopes, ...convertedExtraScopes] : convertedReqScopes;\n        }\n        return null;\n    }\n\n    // #endregion\n\n    /**\n     * @ignore\n     * Returns true if the scopes array only contains openid and/or profile\n     */\n    static onlyContainsOidcScopes(scopes: Array<string>): boolean {\n        const scopesCount = scopes.length;\n        let oidcScopesFound = 0;\n\n        if (scopes.indexOf(Constants.openidScope) > -1) {\n            oidcScopesFound += 1;\n        }\n\n        if (scopes.indexOf(Constants.profileScope) > -1) {\n            oidcScopesFound += 1;\n        }\n\n        return (scopesCount > 0 && scopesCount === oidcScopesFound);\n    }\n\n    /**\n     * @ignore\n     * Returns true if the scopes array only contains openid and/or profile\n     */\n    static containsAnyOidcScopes(scopes: Array<string>): boolean {\n        const containsOpenIdScope = scopes.indexOf(Constants.openidScope) > -1;\n        const containsProfileScope = scopes.indexOf(Constants.profileScope) > -1;\n\n        return (containsOpenIdScope || containsProfileScope);\n    }\n\n    /**\n     * @ignore\n     * Returns true if the clientId is the only scope in the array\n     */\n    static onlyContainsClientId(scopes: Array<String>, clientId: string): boolean {\n        // Double negation to force false value returned in case scopes is null\n        return !!scopes && (scopes.indexOf(clientId) > -1 && scopes.length === 1);\n    }\n\n    /**\n     * @ignore\n     * Adds missing OIDC scopes to scopes array without duplication. Since STS requires OIDC scopes for\n     * all implicit flow requests, 'openid' and 'profile' should always be included in the final request\n     */\n    static appendDefaultScopes(scopes: Array<string>): Array<string> {\n        const extendedScopes = scopes;\n        if (extendedScopes.indexOf(Constants.openidScope) === -1) {\n            extendedScopes.push(Constants.openidScope);\n        }\n\n        if(extendedScopes.indexOf(Constants.profileScope) === -1) {\n            extendedScopes.push(Constants.profileScope);\n        }\n\n        return extendedScopes;\n    }\n\n    /**\n     * @ignore\n     * Removes present OIDC scopes from scopes array.\n     */\n    static removeDefaultScopes(scopes: Array<string>): Array<string> {\n        return scopes.filter(scope => {\n            return (scope !== Constants.openidScope && scope !== Constants.profileScope);\n        });\n    }\n\n    /**\n     * @ignore\n     * Removes clientId from scopes array if included as only scope. If it's not the only scope, it is treated as a resource scope.\n     * @param scopes Array<string>: Pre-normalized scopes array\n     * @param clientId string: The application's clientId that is searched for in the scopes array\n     */\n    static translateClientIdIfSingleScope(scopes: Array<string>, clientId: string): Array<string> {\n        return this.onlyContainsClientId(scopes, clientId) ? Constants.oidcScopes : scopes;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { IUri } from \"../IUri\";\nimport { Constants, SSOTypes, ServerHashParamKeys } from \"./Constants\";\nimport { ServerRequestParameters } from \"../ServerRequestParameters\";\nimport { ScopeSet } from \"../ScopeSet\";\nimport { StringUtils } from \"./StringUtils\";\nimport { CryptoUtils } from \"./CryptoUtils\";\n\n/**\n * @hidden\n */\nexport class UrlUtils {\n\n    /**\n     * generates the URL with QueryString Parameters\n     * @param scopes\n     */\n    static createNavigateUrl(serverRequestParams: ServerRequestParameters): string {\n        const str = this.createNavigationUrlString(serverRequestParams);\n        let authEndpoint: string = serverRequestParams.authorityInstance.AuthorizationEndpoint;\n        // if the endpoint already has queryparams, lets add to it, otherwise add the first one\n        if (authEndpoint.indexOf(\"?\") < 0) {\n            authEndpoint += \"?\";\n        } else {\n            authEndpoint += \"&\";\n        }\n\n        const requestUrl: string = `${authEndpoint}${str.join(\"&\")}`;\n        return requestUrl;\n    }\n\n    /**\n     * Generate the array of all QueryStringParams to be sent to the server\n     * @param scopes\n     */\n    static createNavigationUrlString(serverRequestParams: ServerRequestParameters): Array<string> {\n        const scopes = ScopeSet.appendDefaultScopes(serverRequestParams.scopes);\n\n        const str: Array<string> = [];\n        str.push(\"response_type=\" + serverRequestParams.responseType);\n        str.push(\"scope=\" + encodeURIComponent(ScopeSet.parseScope(scopes)));\n        str.push(\"client_id=\" + encodeURIComponent(serverRequestParams.clientId));\n        str.push(\"redirect_uri=\" + encodeURIComponent(serverRequestParams.redirectUri));\n\n        str.push(\"state=\" + encodeURIComponent(serverRequestParams.state));\n        str.push(\"nonce=\" + encodeURIComponent(serverRequestParams.nonce));\n\n        str.push(\"client_info=1\");\n        str.push(`x-client-SKU=${serverRequestParams.xClientSku}`);\n        str.push(`x-client-Ver=${serverRequestParams.xClientVer}`);\n        if (serverRequestParams.promptValue) {\n            str.push(\"prompt=\" + encodeURIComponent(serverRequestParams.promptValue));\n        }\n\n        if (serverRequestParams.claimsValue) {\n            str.push(\"claims=\" + encodeURIComponent(serverRequestParams.claimsValue));\n        }\n\n        if (serverRequestParams.queryParameters) {\n            str.push(serverRequestParams.queryParameters);\n        }\n\n        if (serverRequestParams.extraQueryParameters) {\n            str.push(serverRequestParams.extraQueryParameters);\n        }\n\n        str.push(\"client-request-id=\" + encodeURIComponent(serverRequestParams.correlationId));\n        return str;\n    }\n\n    /**\n     * Returns current window URL as redirect uri\n     */\n    static getCurrentUrl(): string {\n        return window.location.href.split(\"?\")[0].split(\"#\")[0];\n    }\n\n    /**\n     * Returns given URL with query string removed\n     */\n    static removeHashFromUrl(url: string): string {\n        return url.split(\"#\")[0];\n    }\n\n    /**\n     * Given a url like https://a:b/common/d?e=f#g, and a tenantId, returns https://a:b/tenantId/d\n     * @param href The url\n     * @param tenantId The tenant id to replace\n     */\n    static replaceTenantPath(url: string, tenantId: string): string {\n        const lowerCaseUrl = url.toLowerCase();\n        const urlObject = this.GetUrlComponents(lowerCaseUrl);\n        const pathArray = urlObject.PathSegments;\n        if (tenantId && (pathArray.length !== 0 && (pathArray[0] === Constants.common || pathArray[0] === SSOTypes.ORGANIZATIONS || pathArray[0] === SSOTypes.CONSUMERS))) {\n            pathArray[0] = tenantId;\n        }\n        return this.constructAuthorityUriFromObject(urlObject, pathArray);\n    }\n\n    static constructAuthorityUriFromObject(urlObject: IUri, pathArray: string[]): string {\n        return this.CanonicalizeUri(urlObject.Protocol + \"//\" + urlObject.HostNameAndPort + \"/\" + pathArray.join(\"/\"));\n    }\n    \n    /**\n     * Checks if an authority is common (ex. https://a:b/common/)\n     * @param url The url\n     * @returns true if authority is common and false otherwise \n     */\n    static isCommonAuthority(url: string): boolean {\n        const authority =  this.CanonicalizeUri(url);\n        const pathArray = this.GetUrlComponents(authority).PathSegments;\n        return (pathArray.length !== 0 && pathArray[0] === Constants.common);\n    }\n\n    /**\n     * Checks if an authority is for organizations (ex. https://a:b/organizations/)\n     * @param url The url\n     * @returns true if authority is for  and false otherwise \n     */\n    static isOrganizationsAuthority(url: string): boolean {\n        const authority =  this.CanonicalizeUri(url);\n        const pathArray = this.GetUrlComponents(authority).PathSegments;\n        return (pathArray.length !== 0 && pathArray[0] === SSOTypes.ORGANIZATIONS);\n    }\n\n    /**\n     * Checks if an authority is for consumers (ex. https://a:b/consumers/)\n     * @param url The url\n     * @returns true if authority is for  and false otherwise \n     */\n    static isConsumersAuthority(url: string): boolean {\n        const authority =  this.CanonicalizeUri(url);\n        const pathArray = this.GetUrlComponents(authority).PathSegments;\n        return (pathArray.length !== 0 && pathArray[0] === SSOTypes.CONSUMERS);\n    }\n\n    /**\n     * Parses out the components from a url string.\n     * @returns An object with the various components. Please cache this value insted of calling this multiple times on the same url.\n     */\n    static GetUrlComponents(url: string): IUri {\n        if (!url) {\n            throw \"Url required\";\n        }\n\n        // https://gist.github.com/curtisz/11139b2cfcaef4a261e0\n        const regEx = RegExp(\"^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\\\?([^#]*))?(#(.*))?\");\n\n        const match = url.match(regEx);\n\n        if (!match || match.length < 6) {\n            throw \"Valid url required\";\n        }\n\n        const urlComponents = <IUri>{\n            Protocol: match[1],\n            HostNameAndPort: match[4],\n            AbsolutePath: match[5]\n        };\n\n        let pathSegments = urlComponents.AbsolutePath.split(\"/\");\n        pathSegments = pathSegments.filter((val) => val && val.length > 0); // remove empty elements\n        urlComponents.PathSegments = pathSegments;\n\n        if (match[6]){\n            urlComponents.Search = match[6];\n        }\n        if (match[8]){\n            urlComponents.Hash = match[8];\n        }\n        \n        return urlComponents;\n    }\n\n    /**\n     * Given a url or path, append a trailing slash if one doesnt exist\n     *\n     * @param url\n     */\n    static CanonicalizeUri(url: string): string {\n        if (url) {\n            let lowerCaseUrl = url.toLowerCase();\n\n            if (!UrlUtils.endsWith(lowerCaseUrl, \"/\")) {\n                lowerCaseUrl += \"/\";\n            }\n\n            return lowerCaseUrl;\n        }\n\n        return url;\n    }\n\n    /**\n     * Checks to see if the url ends with the suffix\n     * Required because we are compiling for es5 instead of es6\n     * @param url\n     * @param str\n     */\n    // TODO: Rename this, not clear what it is supposed to do\n    static endsWith(url: string, suffix: string): boolean {\n        if (!url || !suffix) {\n            return false;\n        }\n\n        return url.indexOf(suffix, url.length - suffix.length) !== -1;\n    }\n\n    /**\n     * Utils function to remove the login_hint and domain_hint from the i/p extraQueryParameters\n     * @param url\n     * @param name\n     */\n    static urlRemoveQueryStringParameter(url: string, name: string): string {\n        if (StringUtils.isEmpty(url)) {\n            return url;\n        }\n\n        let updatedUrl = url;\n        let regex = new RegExp(\"(\\\\&\" + name + \"=)[^\\&]+\");\n        updatedUrl = url.replace(regex, \"\");\n        // name=value&\n        regex = new RegExp(\"(\" + name + \"=)[^\\&]+&\");\n        updatedUrl = url.replace(regex, \"\");\n        // name=value\n        regex = new RegExp(\"(\" + name + \"=)[^\\&]+\");\n        updatedUrl = url.replace(regex, \"\");\n        return updatedUrl;\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     *\n     * Returns the anchor part(#) of the URL\n     */\n    static getHashFromUrl(urlStringOrFragment: string): string {\n        const hashIndex1 = urlStringOrFragment.indexOf(\"#\");\n        const hashIndex2 = urlStringOrFragment.indexOf(\"#/\");\n        if (hashIndex2 > -1) {\n            return urlStringOrFragment.substring(hashIndex2 + 2);\n        } else if (hashIndex1 > -1) {\n            return urlStringOrFragment.substring(hashIndex1 + 1);\n        }\n        return urlStringOrFragment;\n    }\n\n    /**\n     * @hidden\n     * Check if the url contains a hash with known properties\n     * @ignore\n     */\n    static urlContainsHash(urlString: string): boolean {\n        const parameters = UrlUtils.deserializeHash(urlString);\n        return (\n            parameters.hasOwnProperty(ServerHashParamKeys.ERROR_DESCRIPTION) ||\n            parameters.hasOwnProperty(ServerHashParamKeys.ERROR) ||\n            parameters.hasOwnProperty(ServerHashParamKeys.ACCESS_TOKEN) ||\n            parameters.hasOwnProperty(ServerHashParamKeys.ID_TOKEN)\n        );\n    }\n\n    /**\n     * @hidden\n     * Returns deserialized portion of URL hash\n     * @ignore\n     */\n    static deserializeHash(urlFragment: string): object {\n        const hash = UrlUtils.getHashFromUrl(urlFragment);\n        return CryptoUtils.deserialize(hash);\n    }\n\n    /**\n     * @ignore\n     * @param {string} URI\n     * @returns {string} host from the URI\n     *\n     * extract URI from the host\n     */\n    static getHostFromUri(uri: string): string {\n        // remove http:// or https:// from uri\n        let extractedUri = String(uri).replace(/^(https?:)\\/\\//, \"\");\n        extractedUri = extractedUri.split(\"/\")[0];\n        return extractedUri;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { CryptoUtils } from \"../utils/CryptoUtils\";\nimport { UrlUtils } from \"../utils/UrlUtils\";\n\n/**\n * @hidden\n */\nexport class AccessTokenKey {\n\n    authority: string;\n    clientId: string;\n    scopes: string;\n    homeAccountIdentifier: string;\n\n    constructor(authority: string, clientId: string, scopes: string, uid: string, utid: string) {\n        this.authority = UrlUtils.CanonicalizeUri(authority);\n        this.clientId = clientId;\n        this.scopes = scopes;\n        this.homeAccountIdentifier = CryptoUtils.base64Encode(uid) + \".\" + CryptoUtils.base64Encode(utid);\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\n/**\n * @hidden\n */\nexport class AccessTokenValue {\n\n    accessToken: string;\n    idToken: string;\n    expiresIn: string;\n    homeAccountIdentifier: string;\n\n    constructor(accessToken: string, idToken: string, expiresIn: string, homeAccountIdentifier: string) {\n        this.accessToken = accessToken;\n        this.idToken = idToken;\n        this.expiresIn = expiresIn;\n        this.homeAccountIdentifier = homeAccountIdentifier;\n    }\n}\n", "/* eslint-disable header/header */\nexport const name = \"msal\";\nexport const version = \"1.4.17\";\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Authority } from \"./authority/Authority\";\nimport { CryptoUtils } from \"./utils/CryptoUtils\";\nimport { AuthenticationParameters } from \"./AuthenticationParameters\";\nimport { StringDict } from \"./MsalTypes\";\nimport { Account } from \"./Account\";\nimport { SSOTypes, Constants, PromptState, ResponseTypes } from \"./utils/Constants\";\nimport { ScopeSet } from \"./ScopeSet\";\nimport { version as libraryVersion } from \"./packageMetadata\";\n\n/**\n * Nonce: OIDC Nonce definition: https://openid.net/specs/openid-connect-core-1_0.html#IDToken\n * State: OAuth Spec: https://tools.ietf.org/html/rfc6749#section-10.12\n * @hidden\n */\nexport class ServerRequestParameters {\n\n    authorityInstance: Authority;\n    clientId: string;\n    scopes: Array<string>;\n\n    nonce: string;\n    state: string;\n\n    // telemetry information\n    xClientVer: string;\n    xClientSku: string;\n    correlationId: string;\n\n    responseType: string;\n    redirectUri: string;\n\n    promptValue: string;\n    claimsValue: string;\n\n    queryParameters: string;\n    extraQueryParameters: string;\n\n    public get authority(): string {\n        return this.authorityInstance ? this.authorityInstance.CanonicalAuthority : null;\n    }\n\n    /**\n     * Constructor\n     * @param authority\n     * @param clientId\n     * @param scope\n     * @param responseType\n     * @param redirectUri\n     * @param state\n     */\n    constructor (authority: Authority, clientId: string, responseType: string, redirectUri: string, scopes: Array<string>, state: string, correlationId: string) {\n        this.authorityInstance = authority;\n        this.clientId = clientId;\n        this.nonce = CryptoUtils.createNewGuid();\n\n        // set scope to clientId if null\n        this.scopes = scopes ? [ ...scopes] : Constants.oidcScopes;\n        this.scopes = ScopeSet.trimScopes(this.scopes);\n\n        // set state (already set at top level)\n        this.state = state;\n\n        // set correlationId\n        this.correlationId = correlationId;\n\n        // telemetry information\n        this.xClientSku = \"MSAL.JS\";\n        this.xClientVer = libraryVersion;\n\n        this.responseType = responseType;\n        this.redirectUri = redirectUri;\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     *\n     * Utility to populate QueryParameters and ExtraQueryParameters to ServerRequestParamerers\n     * @param request\n     * @param serverAuthenticationRequest\n     */\n    populateQueryParams(account: Account, request: AuthenticationParameters|null, adalIdTokenObject?: object, silentCall?: boolean): void {\n        let queryParameters: StringDict = {};\n\n        if (request) {\n            // add the prompt parameter to serverRequestParameters if passed\n            if (request.prompt) {\n                this.promptValue = request.prompt;\n            }\n\n            // Add claims challenge to serverRequestParameters if passed\n            if (request.claimsRequest) {\n                this.claimsValue = request.claimsRequest;\n            }\n\n            // if the developer provides one of these, give preference to developer choice\n            if (ServerRequestParameters.isSSOParam(request)) {\n                queryParameters = this.constructUnifiedCacheQueryParameter(request, null);\n            }\n        }\n\n        if (adalIdTokenObject) {\n            queryParameters = this.constructUnifiedCacheQueryParameter(null, adalIdTokenObject);\n        }\n\n        /*\n         * adds sid/login_hint if not populated\n         * this.logger.verbose(\"Calling addHint parameters\");\n         */\n        queryParameters = this.addHintParameters(account, queryParameters);\n\n        // sanity check for developer passed extraQueryParameters\n        const eQParams: StringDict|null = request ? request.extraQueryParameters : null;\n\n        // Populate the extraQueryParameters to be sent to the server\n        this.queryParameters = ServerRequestParameters.generateQueryParametersString(queryParameters);\n        this.extraQueryParameters = ServerRequestParameters.generateQueryParametersString(eQParams, silentCall);\n    }\n\n    // #region QueryParam helpers\n\n    /**\n     * Constructs extraQueryParameters to be sent to the server for the AuthenticationParameters set by the developer\n     * in any login() or acquireToken() calls\n     * @param idTokenObject\n     * @param extraQueryParameters\n     * @param sid\n     * @param loginHint\n     */\n    // TODO: check how this behaves when domain_hint only is sent in extraparameters and idToken has no upn.\n    private constructUnifiedCacheQueryParameter(request: AuthenticationParameters, idTokenObject: object): StringDict {\n\n        // preference order: account > sid > login_hint\n        let ssoType;\n        let ssoData;\n        let serverReqParam: StringDict = {};\n        // if account info is passed, account.login_hint claim > account.sid > account.username\n        if (request) {\n            if (request.account) {\n                const account: Account = request.account;\n                if (account.idTokenClaims?.login_hint) {\n                    ssoType = SSOTypes.LOGIN_HINT;\n                    ssoData = account.idTokenClaims.login_hint;\n                } else if (account.sid) {\n                    ssoType = SSOTypes.SID;\n                    ssoData = account.sid;\n                }\n                else if (account.userName) {\n                    ssoType = SSOTypes.LOGIN_HINT;\n                    ssoData = account.userName;\n                }\n            }\n            // sid from request\n            else if (request.sid) {\n                ssoType = SSOTypes.SID;\n                ssoData = request.sid;\n            }\n            // loginHint from request\n            else if (request.loginHint) {\n                ssoType = SSOTypes.LOGIN_HINT;\n                ssoData = request.loginHint;\n            }\n        }\n        // adalIdToken retrieved from cache\n        else if (idTokenObject) {\n            if (idTokenObject.hasOwnProperty(Constants.upn)) {\n                ssoType = SSOTypes.ID_TOKEN;\n                ssoData = idTokenObject[\"upn\"];\n            }\n        }\n\n        serverReqParam = this.addSSOParameter(ssoType, ssoData);\n        return serverReqParam;\n    }\n\n    /**\n     * @hidden\n     *\n     * Adds login_hint to authorization URL which is used to pre-fill the username field of sign in page for the user if known ahead of time\n     * domain_hint if added skips the email based discovery process of the user - only supported for interactive calls in implicit_flow\n     * domain_req utid received as part of the clientInfo\n     * login_req uid received as part of clientInfo\n     * Also does a sanity check for extraQueryParameters passed by the user to ensure no repeat queryParameters\n     *\n     * @param {@link Account} account - Account for which the token is requested\n     * @param queryparams\n     * @param {@link ServerRequestParameters}\n     * @ignore\n     */\n    private addHintParameters(account: Account, params: StringDict): StringDict {\n    /*\n     * This is a final check for all queryParams added so far; preference order: sid > login_hint\n     * sid cannot be passed along with login_hint or domain_hint, hence we check both are not populated yet in queryParameters\n     */\n        let qParams = params;\n        if (account) {\n            if (!qParams[SSOTypes.SID] && !qParams[SSOTypes.LOGIN_HINT]) {\n                if (account.idTokenClaims?.login_hint) {\n                    // Use login_hint claim if available over sid or email/upn\n                    qParams = this.addSSOParameter(SSOTypes.LOGIN_HINT, account.idTokenClaims?.login_hint, qParams);\n                } else if (account.sid && this.promptValue === PromptState.NONE) {\n                    // sid - populate only if login_hint is not already populated and the account has sid\n                    qParams = this.addSSOParameter(SSOTypes.SID, account.sid, qParams);\n                } else if (account.userName) {\n                    // Add username/upn as loginHint if nothing else available\n                    qParams = this.addSSOParameter(SSOTypes.LOGIN_HINT, account.userName, qParams);\n                }\n            }\n        }\n\n        return qParams;\n    }\n\n    /**\n     * Add SID to extraQueryParameters\n     * @param sid\n     */\n    private addSSOParameter(ssoType: string, ssoData: string, params?: StringDict): StringDict {\n        const ssoParam = params || {};\n\n        if (!ssoData) {\n            return ssoParam;\n        }\n\n        switch (ssoType) {\n            case SSOTypes.SID: {\n                ssoParam[SSOTypes.SID] = ssoData;\n                break;\n            }\n            case SSOTypes.ID_TOKEN: {\n                ssoParam[SSOTypes.LOGIN_HINT] = ssoData;\n                break;\n            }\n            case SSOTypes.LOGIN_HINT: {\n                ssoParam[SSOTypes.LOGIN_HINT] = ssoData;\n                break;\n            }\n        }\n\n        return ssoParam;\n    }\n\n    /**\n     * Utility to generate a QueryParameterString from a Key-Value mapping of extraQueryParameters passed\n     * @param extraQueryParameters\n     */\n    static generateQueryParametersString(queryParameters?: StringDict, silentCall?: boolean): string|null {\n        let paramsString: string|null = null;\n\n        if (queryParameters) {\n            Object.keys(queryParameters).forEach((key: string) => {\n                // sid cannot be passed along with login_hint or domain_hint\n                if(key === Constants.domain_hint && (silentCall || queryParameters[SSOTypes.SID])) {\n                    return;\n                }\n\n                if (!paramsString) {\n                    paramsString = `${key}=${encodeURIComponent(queryParameters[key])}`;\n                }\n                else {\n                    paramsString += `&${key}=${encodeURIComponent(queryParameters[key])}`;\n                }\n            });\n        }\n\n        return paramsString;\n    }\n    // #endregion\n\n    /**\n     * Check to see if there are SSO params set in the Request\n     * @param request\n     */\n    static isSSOParam(request: AuthenticationParameters): boolean {\n        return !!(request && (request.account || request.sid || request.loginHint));\n    }\n\n    /**\n     * Returns the correct response_type string attribute for an acquireToken request configuration\n     * @param accountsMatch boolean: Determines whether the account in the request matches the cached account\n     * @param scopes Array<string>: AuthenticationRequest scopes configuration\n     * @param loginScopesOnly boolean: True if the scopes array ONLY contains the clientId or any combination of OIDC scopes, without resource scopes\n     */\n    static determineResponseType(accountsMatch: boolean, scopes: Array<string>): string {\n        // Supports getting an id_token by sending in clientId as only scope or OIDC scopes as only scopes\n        if (ScopeSet.onlyContainsOidcScopes(scopes)) {\n            return ResponseTypes.id_token;\n        }\n        // If accounts match, check if OIDC scopes are included, otherwise return id_token_token\n        return (accountsMatch) ? this.responseTypeForMatchingAccounts(scopes) : ResponseTypes.id_token_token;\n    }\n\n    /**\n     * Returns the correct response_type string attribute for an acquireToken request configuration that contains an\n     * account that matches the account in the MSAL cache.\n     * @param scopes Array<string>: AuthenticationRequest scopes configuration\n     */\n    private static responseTypeForMatchingAccounts(scopes: Array<string>): string {\n        // Opt-into also requesting an ID token by sending in 'openid', 'profile' or both along with resource scopes when login is not necessary.\n        return (ScopeSet.containsAnyOidcScopes(scopes)) ? ResponseTypes.id_token_token : ResponseTypes.token;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { NetworkRequestType } from \"./utils/Constants\";\n\n/**\n * XHR client for JSON endpoints\n * https://www.npmjs.com/package/async-promise\n * @hidden\n */\n\nexport class XhrClient {\n\n    public sendRequestAsync(url: string, method: string, enableCaching?: boolean): Promise<XhrResponse> {\n        return new Promise<XhrResponse>((resolve, reject) => {\n            const xhr = new XMLHttpRequest();\n            xhr.open(method, url, /* async: */ true);\n            if (enableCaching) {\n                /*\n                 * TODO: (shivb) ensure that this can be cached\n                 * xhr.setRequestHeader(\"Cache-Control\", \"Public\");\n                 */\n            }\n\n            xhr.onload = () => {\n                if (xhr.status < 200 || xhr.status >= 300) {\n                    reject(this.handleError(xhr.responseText));\n                }\n                let jsonResponse;\n                try {\n                    jsonResponse = JSON.parse(xhr.responseText);\n                } catch (e) {\n                    reject(this.handleError(xhr.responseText));\n                }\n                const response: XhrResponse = {\n                    statusCode: xhr.status,\n                    body: jsonResponse\n                };\n                resolve(response);\n            };\n\n            xhr.onerror = () => {\n                reject(xhr.status);\n            };\n\n            if (method === NetworkRequestType.GET) {\n                xhr.send();\n            }\n            else {\n                throw \"not implemented\";\n            }\n        });\n    }\n\n    protected handleError(responseText: string): string {\n        let jsonResponse: object;\n        try {\n            jsonResponse = JSON.parse(responseText);\n            if (jsonResponse[\"error\"]) {\n                return jsonResponse[\"error\"];\n            } else {\n                throw responseText;\n            }\n        } catch (e) {\n            return responseText;\n        }\n    }\n}\n\nexport type XhrResponse = {\n    body: object,\n    statusCode: number\n};\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport TelemetryManager from \"../telemetry/TelemetryManager\";\nimport { XhrClient, XhrResponse } from \"../XHRClient\";\nimport HttpEvent from \"../telemetry/HttpEvent\";\nimport { AAD_INSTANCE_DISCOVERY_ENDPOINT, NetworkRequestType } from \"../utils/Constants\";\nimport { UrlUtils } from \"../utils/UrlUtils\";\n\nexport class TrustedAuthority {\n    private static TrustedHostList: Array<string> = [];\n\n    /**\n     * \n     * @param validateAuthority \n     * @param knownAuthorities \n     */\n    public static setTrustedAuthoritiesFromConfig(validateAuthority: boolean, knownAuthorities: Array<string>): void{\n        if (validateAuthority && !this.getTrustedHostList().length){\n            knownAuthorities.forEach(function(authority) {\n                TrustedAuthority.TrustedHostList.push(authority.toLowerCase());\n            });\n        }\n    }\n\n    /**\n     * \n     * @param telemetryManager \n     * @param correlationId \n     */\n    private static async getAliases(authorityToVerify: string, telemetryManager: TelemetryManager, correlationId?: string): Promise<Array<object>> {\n        const client: XhrClient = new XhrClient();\n\n        const httpMethod = NetworkRequestType.GET;\n        const instanceDiscoveryEndpoint = `${AAD_INSTANCE_DISCOVERY_ENDPOINT}${authorityToVerify}oauth2/v2.0/authorize`;\n        const httpEvent: HttpEvent = telemetryManager.createAndStartHttpEvent(correlationId, httpMethod, instanceDiscoveryEndpoint, \"getAliases\");\n        return client.sendRequestAsync(instanceDiscoveryEndpoint, httpMethod, true)\n            .then((response: XhrResponse) => {\n                httpEvent.httpResponseStatus = response.statusCode;\n                telemetryManager.stopEvent(httpEvent);\n                return response.body[\"metadata\"];\n            })\n            .catch(err => {\n                httpEvent.serverErrorCode = err;\n                telemetryManager.stopEvent(httpEvent);\n                throw err;\n            });\n    }\n\n    /**\n     * \n     * @param telemetryManager \n     * @param correlationId \n     */\n    public static async setTrustedAuthoritiesFromNetwork(authorityToVerify: string, telemetryManager: TelemetryManager, correlationId?: string): Promise<void> {\n        const metadata = await this.getAliases(authorityToVerify, telemetryManager, correlationId);\n        metadata.forEach(function(entry: object){\n            const authorities: Array<string> = entry[\"aliases\"];\n            authorities.forEach(function(authority: string) {\n                TrustedAuthority.TrustedHostList.push(authority.toLowerCase());\n            });\n        });\n\n        const host = UrlUtils.GetUrlComponents(authorityToVerify).HostNameAndPort;\n        if (TrustedAuthority.getTrustedHostList().length && !TrustedAuthority.IsInTrustedHostList(host)){\n            // Custom Domain scenario, host is trusted because Instance Discovery call succeeded\n            TrustedAuthority.TrustedHostList.push(host.toLowerCase());\n        }\n    } \n\n    public static getTrustedHostList(): Array<string> {\n        return this.TrustedHostList;\n    }\n\n    /**\n     * Checks to see if the host is in a list of trusted hosts\n     * @param host \n     */\n    public static IsInTrustedHostList(host: string): boolean {\n        return this.TrustedHostList.indexOf(host.toLowerCase()) > -1;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { IUri } from \"../IUri\";\nimport { ITenantDiscoveryResponse } from \"./ITenantDiscoveryResponse\";\nimport { ClientConfigurationErrorMessage, ClientConfigurationError } from \"../error/ClientConfigurationError\";\nimport { XhrClient, XhrResponse } from \"../XHRClient\";\nimport { UrlUtils } from \"../utils/UrlUtils\";\nimport TelemetryManager from \"../telemetry/TelemetryManager\";\nimport HttpEvent from \"../telemetry/HttpEvent\";\nimport { TrustedAuthority } from \"./TrustedAuthority\";\nimport { NetworkRequestType, Constants, WELL_KNOWN_SUFFIX } from \"../utils/Constants\";\n\n/**\n * @hidden\n */\nexport enum AuthorityType {\n    Default,\n    Adfs\n}\n\n/**\n * @hidden\n */\nexport class Authority {\n    constructor(authority: string, validateAuthority: boolean, authorityMetadata?: ITenantDiscoveryResponse) {\n        this.IsValidationEnabled = validateAuthority;\n        this.CanonicalAuthority = authority;\n\n        this.validateAsUri();\n        this.tenantDiscoveryResponse = authorityMetadata;\n    }\n\n    public static isAdfs(authorityUrl: string): boolean {\n        const components = UrlUtils.GetUrlComponents(authorityUrl);\n        const pathSegments = components.PathSegments;\n\n        return (pathSegments.length && pathSegments[0].toLowerCase() === Constants.ADFS);\n    }\n\n    public get AuthorityType(): AuthorityType {\n        return Authority.isAdfs(this.canonicalAuthority)? AuthorityType.Adfs : AuthorityType.Default;\n    }\n\n    public IsValidationEnabled: boolean;\n\n    public get Tenant(): string {\n        return this.CanonicalAuthorityUrlComponents.PathSegments[0];\n    }\n\n    private tenantDiscoveryResponse: ITenantDiscoveryResponse;\n\n    public get AuthorizationEndpoint(): string {\n        this.validateResolved();\n        return this.tenantDiscoveryResponse.AuthorizationEndpoint.replace(/{tenant}|{tenantid}/g, this.Tenant);\n    }\n\n    public get EndSessionEndpoint(): string {\n        this.validateResolved();\n        return this.tenantDiscoveryResponse.EndSessionEndpoint.replace(/{tenant}|{tenantid}/g, this.Tenant);\n    }\n\n    public get SelfSignedJwtAudience(): string {\n        this.validateResolved();\n        return this.tenantDiscoveryResponse.Issuer.replace(/{tenant}|{tenantid}/g, this.Tenant);\n    }\n\n    private validateResolved() {\n        if (!this.hasCachedMetadata()) {\n            throw \"Please call ResolveEndpointsAsync first\";\n        }\n    }\n\n    /**\n     * A URL that is the authority set by the developer\n     */\n    public get CanonicalAuthority(): string {\n        return this.canonicalAuthority;\n    }\n\n    public set CanonicalAuthority(url: string) {\n        this.canonicalAuthority = UrlUtils.CanonicalizeUri(url);\n        this.canonicalAuthorityUrlComponents = null;\n    }\n\n    private canonicalAuthority: string;\n    private canonicalAuthorityUrlComponents: IUri;\n\n    public get CanonicalAuthorityUrlComponents(): IUri {\n        if (!this.canonicalAuthorityUrlComponents) {\n            this.canonicalAuthorityUrlComponents = UrlUtils.GetUrlComponents(this.CanonicalAuthority);\n        }\n\n        return this.canonicalAuthorityUrlComponents;\n    }\n\n    // http://openid.net/specs/openid-connect-discovery-1_0.html#ProviderMetadata\n    protected get DefaultOpenIdConfigurationEndpoint(): string {\n        return (this.AuthorityType === AuthorityType.Adfs)? `${this.CanonicalAuthority}${WELL_KNOWN_SUFFIX}` : `${this.CanonicalAuthority}v2.0/${WELL_KNOWN_SUFFIX}`;\n    }\n\n    /**\n     * Given a string, validate that it is of the form https://domain/path\n     */\n    private validateAsUri() {\n        let components;\n        try {\n            components = this.CanonicalAuthorityUrlComponents;\n        } catch (e) {\n            throw ClientConfigurationErrorMessage.invalidAuthorityType;\n        }\n\n        if (!components.Protocol || components.Protocol.toLowerCase() !== \"https:\") {\n            throw ClientConfigurationErrorMessage.authorityUriInsecure;\n        }\n\n        if (!components.PathSegments || components.PathSegments.length < 1) {\n            throw ClientConfigurationErrorMessage.authorityUriInvalidPath;\n        }\n    }\n\n    /**\n     * Calls the OIDC endpoint and returns the response\n     */\n    private DiscoverEndpoints(openIdConfigurationEndpoint: string, telemetryManager: TelemetryManager, correlationId: string): Promise<ITenantDiscoveryResponse> {\n        const client = new XhrClient();\n\n        const httpMethod = NetworkRequestType.GET;\n        const httpEvent: HttpEvent = telemetryManager.createAndStartHttpEvent(correlationId, httpMethod, openIdConfigurationEndpoint, \"openIdConfigurationEndpoint\");\n\n        return client.sendRequestAsync(openIdConfigurationEndpoint, httpMethod, /* enableCaching: */ true)\n            .then((response: XhrResponse) => {\n                httpEvent.httpResponseStatus = response.statusCode;\n                telemetryManager.stopEvent(httpEvent);\n                return <ITenantDiscoveryResponse>{\n                    AuthorizationEndpoint: response.body[\"authorization_endpoint\"],\n                    EndSessionEndpoint: response.body[\"end_session_endpoint\"],\n                    Issuer: response.body[\"issuer\"]\n                };\n            })\n            .catch(err => {\n                httpEvent.serverErrorCode = err;\n                telemetryManager.stopEvent(httpEvent);\n                throw err;\n            });\n    }\n\n    /**\n     * Returns a promise.\n     * Checks to see if the authority is in the cache\n     * Discover endpoints via openid-configuration\n     * If successful, caches the endpoint for later use in OIDC\n     */\n    public async resolveEndpointsAsync(telemetryManager: TelemetryManager, correlationId: string): Promise<ITenantDiscoveryResponse> {\n        if (this.IsValidationEnabled) {\n            const host = this.canonicalAuthorityUrlComponents.HostNameAndPort;\n            if (TrustedAuthority.getTrustedHostList().length === 0) {\n                await TrustedAuthority.setTrustedAuthoritiesFromNetwork(this.canonicalAuthority, telemetryManager, correlationId);\n            }\n\n            if (!TrustedAuthority.IsInTrustedHostList(host)) {\n                throw ClientConfigurationError.createUntrustedAuthorityError(host);\n            }\n        }\n        const openIdConfigurationEndpointResponse = this.GetOpenIdConfigurationEndpoint();\n        this.tenantDiscoveryResponse = await this.DiscoverEndpoints(openIdConfigurationEndpointResponse, telemetryManager, correlationId);\n\n        return this.tenantDiscoveryResponse;\n    }\n\n    /**\n     * Checks if there is a cached tenant discovery response with required fields.\n     */\n    public hasCachedMetadata(): boolean {\n        return !!(this.tenantDiscoveryResponse &&\n            this.tenantDiscoveryResponse.AuthorizationEndpoint &&\n            this.tenantDiscoveryResponse.EndSessionEndpoint &&\n            this.tenantDiscoveryResponse.Issuer);\n    }\n\n    /**\n     * Returns a promise which resolves to the OIDC endpoint\n     * Only responds with the endpoint\n     */\n    public GetOpenIdConfigurationEndpoint(): string {\n        return this.DefaultOpenIdConfigurationEndpoint;\n    }\n}\n", "\uFEFF/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { CryptoUtils } from \"./utils/CryptoUtils\";\nimport { ClientAuthError } from \"./error/ClientAuthError\";\nimport { StringUtils } from \"./utils/StringUtils\";\nimport { IdToken } from \"./IdToken\";\n\n/**\n * @hidden\n */\nexport class ClientInfo {\n\n    private _uid: string;\n    get uid(): string {\n        return this._uid ? this._uid : \"\";\n    }\n\n    set uid(uid: string) {\n        this._uid = uid;\n    }\n\n    private _utid: string;\n    get utid(): string {\n        return this._utid ? this._utid : \"\";\n    }\n\n    set utid(utid: string) {\n        this._utid = utid;\n    }\n\n    static createClientInfoFromIdToken(idToken:IdToken, authority: string): ClientInfo {\n        const clientInfo = {\n            uid: idToken.subject, \n            utid: \"\"\n        };\n\n        return new ClientInfo(CryptoUtils.base64Encode(JSON.stringify(clientInfo)), authority);\n    }\n\n    constructor(rawClientInfo: string, authority: string) {\n        if (!rawClientInfo || StringUtils.isEmpty(rawClientInfo)) {\n            this.uid = \"\";\n            this.utid = \"\";\n            return;\n        }\n\n        try {\n            const decodedClientInfo: string = CryptoUtils.base64Decode(rawClientInfo);\n            const clientInfo: ClientInfo = <ClientInfo>JSON.parse(decodedClientInfo);\n            if (clientInfo) {\n                if (clientInfo.hasOwnProperty(\"uid\")) {\n                    this.uid = authority ? ClientInfo.stripPolicyFromUid(clientInfo.uid, authority): clientInfo.uid;\n                }\n\n                if (clientInfo.hasOwnProperty(\"utid\")) {\n                    this.utid = clientInfo.utid;\n                }\n            }\n        } catch (e) {\n            throw ClientAuthError.createClientInfoDecodingError(e);\n        }\n    }\n\n    static stripPolicyFromUid(uid: string, authority: string): string {\n        const uidSegments = uid.split(\"-\");\n        // Reverse the url segments so the last one is more easily accessible\n        const urlSegments = authority.split(\"/\").reverse();\n        let policy = \"\";\n\n        if (!StringUtils.isEmpty(urlSegments[0])) {\n            policy = urlSegments[0];\n        } else if (urlSegments.length > 1) {\n            // If the original url had a trailing slash, urlSegments[0] would be \"\" so take the next element\n            policy = urlSegments[1];\n        }\n\n        if (uidSegments[uidSegments.length - 1] ===  policy) {\n            // If the last segment of uid matches the last segment of authority url, remove the last segment of uid\n            return uidSegments.slice(0, uidSegments.length - 1).join(\"-\");\n        }\n\n        return uid;\n    }\n\n    public encodeClientInfo(): string {\n        const clientInfo = JSON.stringify({uid: this.uid, utid: this.utid});\n\n        return CryptoUtils.base64Encode(clientInfo);\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\n/**\n * @hidden\n */\nexport class TimeUtils {\n    /**\n     * Returns time in seconds for expiration based on string value passed in.\n     *\n     * @param expiresIn\n     */\n    static parseExpiresIn(expiresIn: string): number {\n        // if AAD did not send \"expires_in\" property, use default expiration of 3599 seconds, for some reason AAD sends 3599 as \"expires_in\" value instead of 3600\n        const expires = expiresIn || \"3599\";\n        return parseInt(expires, 10);\n    }\n\n    /**\n     * Return the current time in Unix time (seconds). Date.getTime() returns in milliseconds.\n     */\n    static now(): number {\n        return Math.round(new Date().getTime() / 1000.0);\n    }\n\n    /**\n     * Returns the amount of time in milliseconds since the page loaded.\n     */\n    static relativeNowMs(): number {\n        return window.performance.now();\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { CryptoUtils } from \"./CryptoUtils\";\nimport { StringUtils } from \"./StringUtils\";\nimport { TimeUtils } from \"./TimeUtils\";\n\n/**\n * @hidden\n */\nexport class TokenUtils {\n\n    /**\n     * decode a JWT\n     *\n     * @param jwtToken\n     */\n    static decodeJwt(jwtToken: string): object {\n        if (StringUtils.isEmpty(jwtToken)) {\n            return null;\n        }\n        const idTokenPartsRegex = /^([^\\.\\s]*)\\.([^\\.\\s]+)\\.([^\\.\\s]*)$/;\n        const matches = idTokenPartsRegex.exec(jwtToken);\n        if (!matches || matches.length < 4) {\n            // this._requestContext.logger.warn(\"The returned id_token is not parseable.\");\n            return null;\n        }\n        const crackedToken = {\n            header: matches[1],\n            JWSPayload: matches[2],\n            JWSSig: matches[3]\n        };\n        return crackedToken;\n    }\n\n    /**\n     * Evaluates whether token cache item expiration is within expiration offset range\n     * @param tokenCacheItem \n     */\n    static validateExpirationIsWithinOffset(expiration: number, tokenRenewalOffsetSeconds: number): Boolean {\n        const offset = tokenRenewalOffsetSeconds || 300;\n        return expiration && (expiration > TimeUtils.now() + offset);\n    }\n\n    /**\n     * Extract IdToken by decoding the RAWIdToken\n     *\n     * @param encodedIdToken\n     */\n    static extractIdToken(encodedIdToken: string): object {\n    // id token will be decoded to get the username\n        const decodedToken = this.decodeJwt(encodedIdToken);\n        if (!decodedToken) {\n            return null;\n        }\n        try {\n            const base64IdToken = decodedToken[\"JWSPayload\"];\n            const base64Decoded = CryptoUtils.base64Decode(base64IdToken);\n            if (!base64Decoded) {\n                // this._requestContext.logger.info(\"The returned id_token could not be base64 url safe decoded.\");\n                return null;\n            }\n            // ECMA script has JSON built-in support\n            return JSON.parse(base64Decoded);\n        } catch (err) {\n            // this._requestContext.logger.error(\"The returned id_token could not be decoded\" + err);\n        }\n\n        return null;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { ClientAuthError } from \"./error/ClientAuthError\";\nimport { TokenUtils } from \"./utils/TokenUtils\";\nimport { StringDict } from \"./MsalTypes\";\nimport { StringUtils } from \"./utils/StringUtils\";\n\n/**\n * @hidden\n */\nexport class IdToken {\n\n    issuer: string;\n    objectId: string;\n    subject: string;\n    tenantId: string;\n    version: string;\n    preferredName: string;\n    name: string;\n    homeObjectId: string;\n    nonce: string;\n    expiration: string;\n    rawIdToken: string;\n    claims: StringDict;\n    sid: string;\n    cloudInstance: string;\n    /* tslint:disable:no-string-literal */\n    constructor(rawIdToken: string) {\n        if (StringUtils.isEmpty(rawIdToken)) {\n            throw ClientAuthError.createIdTokenNullOrEmptyError(rawIdToken);\n        }\n        try {\n            this.rawIdToken = rawIdToken;\n            this.claims = TokenUtils.extractIdToken(rawIdToken) as StringDict;\n            if (this.claims) {\n                if (this.claims.hasOwnProperty(\"iss\")) {\n                    this.issuer = this.claims[\"iss\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"oid\")) {\n                    this.objectId = this.claims[\"oid\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"sub\")) {\n                    this.subject = this.claims[\"sub\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"tid\")) {\n                    this.tenantId = this.claims[\"tid\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"ver\")) {\n                    this.version = this.claims[\"ver\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"preferred_username\")) {\n                    this.preferredName = this.claims[\"preferred_username\"];\n                } else if (this.claims.hasOwnProperty(\"upn\")) {\n                    this.preferredName = this.claims[\"upn\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"name\")) {\n                    this.name = this.claims[\"name\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"nonce\")) {\n                    this.nonce = this.claims[\"nonce\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"exp\")) {\n                    this.expiration = this.claims[\"exp\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"home_oid\")) {\n                    this.homeObjectId = this.claims[\"home_oid\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"sid\")) {\n                    this.sid = this.claims[\"sid\"];\n                }\n\n                if (this.claims.hasOwnProperty(\"cloud_instance_host_name\")) {\n                    this.cloudInstance = this.claims[\"cloud_instance_host_name\"];\n                }\n                /* tslint:enable:no-string-literal */\n            }\n        } catch (e) {\n            /*\n             * TODO: This error here won't really every be thrown, since extractIdToken() returns null if the decodeJwt() fails.\n             * Need to add better error handling here to account for being unable to decode jwts.\n             */\n            throw ClientAuthError.createIdTokenParsingError(e);\n        }\n    }\n\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { AccessTokenKey } from \"./AccessTokenKey\";\nimport { AccessTokenValue } from \"./AccessTokenValue\";\n\n/**\n * @hidden\n */\nexport class AccessTokenCacheItem {\n\n    key: AccessTokenKey;\n    value: AccessTokenValue;\n\n    constructor(key: AccessTokenKey, value: AccessTokenValue) {\n        this.key = key;\n        this.value = value;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { CacheLocation } from \"../Configuration\";\nimport { ClientConfigurationError } from \"../error/ClientConfigurationError\";\nimport { AuthError } from \"../error/AuthError\";\n\n/**\n * @hidden\n */\nexport class BrowserStorage {// Singleton\n\n    protected cacheLocation: CacheLocation;\n\n    constructor(cacheLocation: CacheLocation) {\n        if (!window) {\n            throw AuthError.createNoWindowObjectError(\"Browser storage class could not find window object\");\n        }\n\n        const storageSupported = typeof window[cacheLocation] !== \"undefined\" && window[cacheLocation] !== null;\n        if (!storageSupported) {\n            throw ClientConfigurationError.createStorageNotSupportedError(cacheLocation);\n        }\n        this.cacheLocation = cacheLocation;\n    }\n\n    /**\n     * add value to storage\n     * @param key\n     * @param value\n     * @param enableCookieStorage\n     */\n    setItem(key: string, value: string, enableCookieStorage?: boolean): void {\n        window[this.cacheLocation].setItem(key, value);\n        if (enableCookieStorage) {\n            this.setItemCookie(key, value);\n        }\n    }\n\n    /**\n     * get one item by key from storage\n     * @param key\n     * @param enableCookieStorage\n     */\n    getItem(key: string, enableCookieStorage?: boolean): string {\n        if (enableCookieStorage && this.getItemCookie(key)) {\n            return this.getItemCookie(key);\n        }\n        return window[this.cacheLocation].getItem(key);\n    }\n\n    /**\n     * remove value from storage\n     * @param key\n     */\n    removeItem(key: string): void {\n        return window[this.cacheLocation].removeItem(key);\n    }\n\n    /**\n     * clear storage (remove all items from it)\n     */\n    clear(): void {\n        return window[this.cacheLocation].clear();\n    }\n\n    /**\n     * add value to cookies\n     * @param cName\n     * @param cValue\n     * @param expires\n     */\n    setItemCookie(cName: string, cValue: string, expires?: number): void {\n        let cookieStr = encodeURIComponent(cName) + \"=\" + encodeURIComponent(cValue) + \";path=/;\";\n        if (expires) {\n            const expireTime = this.getCookieExpirationTime(expires);\n            cookieStr += \"expires=\" + expireTime + \";\";\n        }\n\n        document.cookie = cookieStr;\n    }\n\n    /**\n     * get one item by key from cookies\n     * @param cName\n     */\n    getItemCookie(cName: string): string {\n        const name = encodeURIComponent(cName) + \"=\";\n        const ca = document.cookie.split(\";\");\n        for (let i = 0; i < ca.length; i++) {\n            let c = ca[i];\n            while (c.charAt(0) === \" \") {\n                c = c.substring(1);\n            }\n            if (c.indexOf(name) === 0) {\n                return decodeURIComponent(c.substring(name.length, c.length));\n            }\n        }\n        return \"\";\n    }\n\n    /**\n     * Clear an item in the cookies by key\n     * @param cName\n     */\n    clearItemCookie(cName: string): void {\n        this.setItemCookie(cName, \"\", -1);\n    }\n\n    /**\n     * Get cookie expiration time\n     * @param cookieLifeDays\n     */\n    getCookieExpirationTime(cookieLifeDays: number): string {\n        const today = new Date();\n        const expr = new Date(today.getTime() + cookieLifeDays * 24 * 60 * 60 * 1000);\n        return expr.toUTCString();\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { AuthenticationParameters } from \"../AuthenticationParameters\";\nimport { Constants, PromptState, BlacklistedEQParams, InteractionType } from \"./Constants\";\nimport { ClientConfigurationError } from \"../error/ClientConfigurationError\";\nimport { ScopeSet } from \"../ScopeSet\";\nimport { StringDict } from \"../MsalTypes\";\nimport { StringUtils } from \"./StringUtils\";\nimport { CryptoUtils } from \"./CryptoUtils\";\nimport { TimeUtils } from \"./TimeUtils\";\nimport { ClientAuthError } from \"../error/ClientAuthError\";\n\nexport type LibraryStateObject = {\n    id: string,\n    ts: number\n    method: string\n};\n\n/**\n * @hidden\n */\nexport class RequestUtils {\n\n    /**\n     * @ignore\n     *\n     * @param request\n     * @param isLoginCall\n     * @param cacheStorage\n     * @param clientId\n     *\n     * validates all request parameters and generates a consumable request object\n     */\n    static validateRequest(request: AuthenticationParameters, isLoginCall: boolean, clientId: string, interactionType: InteractionType): AuthenticationParameters {\n\n        // Throw error if request is empty for acquire * calls\n        if(!isLoginCall && !request) {\n            throw ClientConfigurationError.createEmptyRequestError();\n        }\n\n        let scopes: Array<string>;\n        let extraQueryParameters: StringDict;\n\n        if(request) {\n            // if extraScopesToConsent is passed in loginCall, append them to the login request; Validate and filter scopes (the validate function will throw if validation fails)\n            scopes = isLoginCall ? ScopeSet.appendScopes(request.scopes, request.extraScopesToConsent) : request.scopes;\n            ScopeSet.validateInputScope(scopes, !isLoginCall);\n            scopes = ScopeSet.translateClientIdIfSingleScope(scopes, clientId);\n\n            // validate prompt parameter\n            this.validatePromptParameter(request.prompt);\n\n            // validate extraQueryParameters\n            extraQueryParameters = this.validateEQParameters(request.extraQueryParameters, request.claimsRequest);\n\n            // validate claimsRequest\n            this.validateClaimsRequest(request.claimsRequest);\n        }\n\n        // validate and generate state and correlationId\n        const state = this.validateAndGenerateState(request && request.state, interactionType);\n        const correlationId = this.validateAndGenerateCorrelationId(request && request.correlationId);\n\n        const validatedRequest: AuthenticationParameters = {\n            ...request,\n            extraQueryParameters,\n            scopes,\n            state,\n            correlationId\n        };\n        \n        return validatedRequest;\n    }\n\n    /**\n     * @ignore\n     *\n     * Utility to test if valid prompt value is passed in the request\n     * @param request\n     */\n    static validatePromptParameter (prompt: string): void {\n        if(prompt) {\n            if ([PromptState.LOGIN, PromptState.SELECT_ACCOUNT, PromptState.CONSENT, PromptState.NONE].indexOf(prompt) < 0) {\n                throw ClientConfigurationError.createInvalidPromptError(prompt);\n            }\n        }\n    }\n\n    /**\n     * @ignore\n     *\n     * Removes unnecessary or duplicate query parameters from extraQueryParameters\n     * @param request\n     */\n    static validateEQParameters(extraQueryParameters: StringDict, claimsRequest: string) : StringDict {\n        const eQParams : StringDict = { ...extraQueryParameters};\n        if (!eQParams) {\n            return null;\n        }\n        if (claimsRequest) {\n            // this.logger.warning(\"Removed duplicate claims from extraQueryParameters. Please use either the claimsRequest field OR pass as extraQueryParameter - not both.\");\n            delete eQParams[Constants.claims];\n        }\n        BlacklistedEQParams.forEach(param => {\n            if (eQParams[param]) {\n                // this.logger.warning(\"Removed duplicate \" + param + \" from extraQueryParameters. Please use the \" + param + \" field in request object.\");\n                delete eQParams[param];\n            }\n        });\n\n        return eQParams;\n    }\n\n    /**\n     * @ignore\n     *\n     * Validates the claims passed in request is a JSON\n     * TODO: More validation will be added when the server team tells us how they have actually implemented claims\n     * @param claimsRequest\n     */\n    static validateClaimsRequest(claimsRequest: string): void {\n        if (!claimsRequest) {\n            return;\n        }\n        try {\n            JSON.parse(claimsRequest);\n        } catch (e) {\n            throw ClientConfigurationError.createClaimsRequestParsingError(e);\n        }\n    }\n\n    /**\n     * @ignore\n     *\n     * generate unique state per request\n     * @param userState User-provided state value\n     * @returns State string include library state and user state\n     */\n    static validateAndGenerateState(userState: string, interactionType: InteractionType): string {\n        return !StringUtils.isEmpty(userState) ? `${RequestUtils.generateLibraryState(interactionType)}${Constants.resourceDelimiter}${userState}` : RequestUtils.generateLibraryState(interactionType);\n    }\n\n    /**\n     * Generates the state value used by the library.\n     *\n     * @returns Base64 encoded string representing the state\n     */\n    static generateLibraryState(interactionType: InteractionType): string {\n        const stateObject: LibraryStateObject = {\n            id: CryptoUtils.createNewGuid(),\n            ts: TimeUtils.now(),\n            method: interactionType\n        };\n\n        const stateString = JSON.stringify(stateObject);\n\n        return CryptoUtils.base64Encode(stateString);\n    }\n\n    /**\n     * Decodes the state value into a StateObject\n     *\n     * @param state State value returned in the request\n     * @returns Parsed values from the encoded state value\n     */\n    static parseLibraryState(state: string): LibraryStateObject {\n        const libraryState = decodeURIComponent(state).split(Constants.resourceDelimiter)[0];\n\n        if (CryptoUtils.isGuid(libraryState)) {\n            // If state is guid, assume timestamp is now and is redirect, as redirect should be only method where this can happen.\n            return {\n                id: libraryState,\n                ts: TimeUtils.now(),\n                method: Constants.interactionTypeRedirect\n            };\n        }\n\n        try {\n            const stateString = CryptoUtils.base64Decode(libraryState);\n\n            const stateObject = JSON.parse(stateString);\n\n            return stateObject;\n        } catch (e) {\n            throw ClientAuthError.createInvalidStateError(state, null);\n        }\n    }\n\n    /**\n     * @ignore\n     *\n     * validate correlationId and generate if not valid or not set by the user\n     * @param correlationId\n     */\n    static validateAndGenerateCorrelationId(correlationId: string): string {\n        // validate user set correlationId or set one for the user if null\n        if(correlationId && !CryptoUtils.isGuid(correlationId)) {\n            throw ClientConfigurationError.createInvalidCorrelationIdError();\n        }\n        return CryptoUtils.isGuid(correlationId)? correlationId : CryptoUtils.createNewGuid();\n    }\n\n    /**\n     * Create a request signature\n     * @param request\n     */\n    static createRequestSignature(request: AuthenticationParameters): string {\n        return `${request.scopes.join(\" \").toLowerCase()}${Constants.resourceDelimiter}${request.authority}`;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Constants, PersistentCacheKeys, TemporaryCacheKeys, ErrorCacheKeys, ServerHashParamKeys, SESSION_STORAGE} from \"../utils/Constants\";\nimport { AccessTokenCacheItem } from \"./AccessTokenCacheItem\";\nimport { CacheLocation } from \"../Configuration\";\nimport { BrowserStorage } from \"./BrowserStorage\";\nimport { RequestUtils } from \"../utils/RequestUtils\";\nimport { AccessTokenKey } from \"./AccessTokenKey\";\nimport { StringUtils } from \"../utils/StringUtils\";\nimport { IdToken } from \"../IdToken\";\nimport { ClientAuthError } from \"../error/ClientAuthError\";\n\n/**\n * @hidden\n */\nexport class AuthCache extends BrowserStorage {// Singleton\n\n    private clientId: string;\n    private rollbackEnabled: boolean;\n    private temporaryCache: BrowserStorage;\n\n    constructor(clientId: string, cacheLocation: CacheLocation, storeAuthStateInCookie: boolean) {\n        super(cacheLocation);\n        this.temporaryCache = new BrowserStorage(SESSION_STORAGE);\n        this.clientId = clientId;\n        // This is hardcoded to true for now. We may make this configurable in the future\n        this.rollbackEnabled = true;\n        this.migrateCacheEntries(storeAuthStateInCookie);\n    }\n\n    /**\n     * Support roll back to old cache schema until the next major release: true by default now\n     * @param storeAuthStateInCookie\n     */\n    private migrateCacheEntries(storeAuthStateInCookie: boolean) {\n\n        const idTokenKey = `${Constants.cachePrefix}.${PersistentCacheKeys.IDTOKEN}`;\n        const clientInfoKey = `${Constants.cachePrefix}.${PersistentCacheKeys.CLIENT_INFO}`;\n        const errorKey = `${Constants.cachePrefix}.${ErrorCacheKeys.ERROR}`;\n        const errorDescKey = `${Constants.cachePrefix}.${ErrorCacheKeys.ERROR_DESC}`;\n\n        const idTokenValue = super.getItem(idTokenKey);\n\n        let idToken;\n\n        if (idTokenValue) {\n            try {\n                idToken = new IdToken(idTokenValue);\n            } catch (e) {\n                return;\n            }\n        }\n\n        if (idToken && idToken.claims && idToken.claims.aud === this.clientId) {\n            const clientInfoValue = super.getItem(clientInfoKey);\n            const errorValue = super.getItem(errorKey);\n            const errorDescValue = super.getItem(errorDescKey);\n\n            const values = [idTokenValue, clientInfoValue, errorValue, errorDescValue];\n            const keysToMigrate = [PersistentCacheKeys.IDTOKEN, PersistentCacheKeys.CLIENT_INFO,ErrorCacheKeys.ERROR, ErrorCacheKeys.ERROR_DESC];\n\n            keysToMigrate.forEach((cacheKey, index) => this.duplicateCacheEntry(cacheKey, values[index], storeAuthStateInCookie));\n        }\n    }\n\n    /**\n     * Utility function to help with roll back keys\n     * @param newKey\n     * @param value\n     * @param storeAuthStateInCookie\n     */\n    private duplicateCacheEntry(newKey: string, value: string, storeAuthStateInCookie?: boolean) {\n        if (value) {\n            this.setItem(newKey, value, storeAuthStateInCookie);\n        }\n    }\n\n    /**\n     * Prepend msal.<client-id> to each key; Skip for any JSON object as Key (defined schemas do not need the key appended: AccessToken Keys or the upcoming schema)\n     * @param key\n     * @param addInstanceId\n     */\n    private generateCacheKey(key: string, addInstanceId: boolean): string {\n        try {\n            // Defined schemas do not need the key appended\n            JSON.parse(key);\n            return key;\n        } catch (e) {\n            if (key.indexOf(`${Constants.cachePrefix}`) === 0 || key.indexOf(Constants.adalIdToken) === 0){\n                return key;\n            }\n            return addInstanceId ? `${Constants.cachePrefix}.${this.clientId}.${key}` : `${Constants.cachePrefix}.${key}`;\n        }\n    }\n\n    /**\n     * Validates that the input cache key contains the account search terms (clientId and homeAccountIdentifier) and\n     * then whether or not it contains the \"scopes\", depending on the token type being searched for. With matching account\n     * search terms, Access Token search tries to match the \"scopes\" keyword, while Id Token search expects \"scopes\" to not be included.\n     * @param key \n     * @param clientId \n     * @param homeAccountIdentifier \n     * @param tokenType \n     */\n    private matchKeyForType(key:string, clientId: string, homeAccountIdentifier: string, tokenType: string): AccessTokenKey {\n        // All valid token cache item keys are valid JSON objects, ignore keys that aren't\n        const parsedKey = StringUtils.validateAndParseJsonCacheKey(key);\n\n        if (!parsedKey) {\n            return null;\n        }\n\n        // Does the cache item match the request account\n        const accountMatches = key.match(clientId) && key.match(homeAccountIdentifier);\n        // Does the cache item match the requested token type\n        let tokenTypeMatches = false;\n\n        switch (tokenType) {\n            case ServerHashParamKeys.ACCESS_TOKEN:\n                // Cache item is an access token if scopes are included in the cache item key\n                tokenTypeMatches = !!key.match(Constants.scopes);\n                break;\n            case ServerHashParamKeys.ID_TOKEN:\n                // Cache may be an ID token if scopes are NOT included in the cache item key\n                tokenTypeMatches = !key.match(Constants.scopes);\n                break;\n        }\n\n        return (accountMatches && tokenTypeMatches) ? parsedKey : null;\n    }\n\n    /**\n     * add value to storage\n     * @param key\n     * @param value\n     * @param enableCookieStorage\n     */\n    setItem(key: string, value: string, enableCookieStorage?: boolean): void {\n        super.setItem(this.generateCacheKey(key, true), value, enableCookieStorage);\n\n        // Values stored in cookies will have rollback disabled to minimize cookie length\n        if (this.rollbackEnabled && !enableCookieStorage) {\n            super.setItem(this.generateCacheKey(key, false), value, enableCookieStorage);\n        }\n    }\n\n    /**\n     * get one item by key from storage\n     * @param key\n     * @param enableCookieStorage\n     */\n    getItem(key: string, enableCookieStorage?: boolean): string {\n        return super.getItem(this.generateCacheKey(key, true), enableCookieStorage);\n    }\n\n    /**\n     * remove value from storage\n     * @param key\n     */\n    removeItem(key: string): void {\n        this.temporaryCache.removeItem(this.generateCacheKey(key, true));\n        super.removeItem(this.generateCacheKey(key, true));\n        if (this.rollbackEnabled) {\n            super.removeItem(this.generateCacheKey(key, false));\n        }\n    }\n\n    /**\n     * Sets temporary cache value\n     * @param key \n     * @param value \n     * @param enableCookieStorage \n     */\n    setTemporaryItem(key: string, value: string, enableCookieStorage?: boolean): void {\n        this.temporaryCache.setItem(this.generateCacheKey(key, true), value, enableCookieStorage);\n    }\n\n    /**\n     * Gets temporary cache value\n     * @param key \n     * @param enableCookieStorage \n     */\n    getTemporaryItem(key: string, enableCookieStorage?: boolean): string {\n        return this.temporaryCache.getItem(this.generateCacheKey(key, true), enableCookieStorage);\n    }\n\n    /**\n     * Reset the cache items\n     */\n    resetCacheItems(): void {\n        const storage = window[this.cacheLocation];\n        let key: string;\n        for (key in storage) {\n            // Check if key contains msal prefix; For now, we are clearing all cache items created by MSAL.js\n            if (storage.hasOwnProperty(key) && (key.indexOf(Constants.cachePrefix) !== -1)) {\n                super.removeItem(key);\n                // TODO: Clear cache based on client id (clarify use cases where this is needed)\n            }\n        }\n    }\n\n    /**\n     * Reset all temporary cache items\n     */\n    resetTempCacheItems(state?: string): void {\n        const stateId = state && RequestUtils.parseLibraryState(state).id;\n        const isTokenRenewalInProgress = this.tokenRenewalInProgress(state);\n\n        const storage = window[this.cacheLocation];\n        // check state and remove associated cache\n        if (stateId && !isTokenRenewalInProgress) {\n            Object.keys(storage).forEach(key => {\n                if (key.indexOf(stateId) !== -1) {\n                    this.removeItem(key);\n                    super.clearItemCookie(key);\n                }\n            });\n        }\n        // delete the interaction status cache\n        this.setInteractionInProgress(false);\n        this.removeItem(TemporaryCacheKeys.REDIRECT_REQUEST);\n    }\n\n    /**\n     * Set cookies for IE\n     * @param cName\n     * @param cValue\n     * @param expires\n     */\n    setItemCookie(cName: string, cValue: string, expires?: number): void {\n        super.setItemCookie(this.generateCacheKey(cName, true), cValue, expires);\n        if (this.rollbackEnabled) {\n            super.setItemCookie(this.generateCacheKey(cName, false), cValue, expires);\n        }\n    }\n\n    clearItemCookie(cName: string): void {\n        super.clearItemCookie(this.generateCacheKey(cName, true));\n        if (this.rollbackEnabled) {\n            super.clearItemCookie(this.generateCacheKey(cName, false));\n        }\n    }\n\n    /**\n     * get one item by key from cookies\n     * @param cName\n     */\n    getItemCookie(cName: string): string {\n        return super.getItemCookie(this.generateCacheKey(cName, true));\n    }\n\n    /**\n     * Get all tokens of a certain type from the cache\n     * @param clientId \n     * @param homeAccountIdentifier \n     * @param tokenType\n     */\n    getAllTokensByType(clientId: string, homeAccountIdentifier: string, tokenType: string): Array<AccessTokenCacheItem> {\n        const results = Object.keys(window[this.cacheLocation]).reduce((tokens, key) => {\n            const matchedTokenKey: AccessTokenKey = this.matchKeyForType(key, clientId, homeAccountIdentifier, tokenType);\n            if (matchedTokenKey) {\n                const value = this.getItem(key);\n                if (value) {\n                    try {\n                        const newAccessTokenCacheItem = new AccessTokenCacheItem(matchedTokenKey, JSON.parse(value));\n                        return tokens.concat([ newAccessTokenCacheItem ]);\n                    } catch (err) {\n                        // Skip cache items with non-valid JSON values\n                        return tokens;\n                    }\n                }\n            }\n\n            return tokens;\n        }, []);\n        return results;\n    }\n\n    /**\n     * Get all access tokens in the cache\n     * @param clientId\n     * @param homeAccountIdentifier\n     */\n    getAllAccessTokens(clientId: string, homeAccountIdentifier: string): Array<AccessTokenCacheItem> {\n        return this.getAllTokensByType(clientId, homeAccountIdentifier, ServerHashParamKeys.ACCESS_TOKEN);\n    }\n\n    /**\n     * Get all id tokens in the cache in the form of AccessTokenCacheItem objects so they are \n     * in a normalized format and can make use of the existing cached access token validation logic\n     */\n    getAllIdTokens(clientId: string, homeAccountIdentifier: string): Array<AccessTokenCacheItem> {\n        return this.getAllTokensByType(clientId, homeAccountIdentifier, ServerHashParamKeys.ID_TOKEN);\n    }\n\n    /**\n     * Get all access and ID tokens in the cache\n     * @param clientId \n     * @param homeAccountIdentifier \n     */\n    getAllTokens(clientId: string, homeAccountIdentifier: string): Array<AccessTokenCacheItem> {\n        const accessTokens = this.getAllAccessTokens(clientId, homeAccountIdentifier);\n        const idTokens =  this.getAllIdTokens(clientId, homeAccountIdentifier);\n        return [...accessTokens, ...idTokens];\n    }\n\n    /**\n     * Returns whether or not interaction is currently in progress. Optionally scope it to just this clientId\n     * @param forThisClient \n     */\n    isInteractionInProgress(matchClientId: boolean): boolean {\n        const clientId = this.getInteractionInProgress();\n        if (matchClientId) {\n            return clientId === this.clientId;\n        } else {\n            return !!clientId;\n        }\n    }\n\n    /**\n     * Returns the clientId of the interaction currently in progress\n     */\n    getInteractionInProgress(): string {\n        return this.getTemporaryItem(this.generateCacheKey(TemporaryCacheKeys.INTERACTION_STATUS, false));\n    }\n\n    /**\n     * Sets interaction in progress state\n     * @param isInProgress \n     */\n    setInteractionInProgress(newInProgressValue: boolean): void {\n        if (newInProgressValue) {\n            if (this.isInteractionInProgress(false)) {\n                throw ClientAuthError.createAcquireTokenInProgressError();\n            } else {\n                // Ensure we don't overwrite interaction in progress for a different clientId\n                this.setTemporaryItem(this.generateCacheKey(TemporaryCacheKeys.INTERACTION_STATUS, false), this.clientId);\n            }\n        } else if (!newInProgressValue && this.isInteractionInProgress(true)) {\n            // Only remove if the current in progress interaction is for this clientId\n            this.removeItem(this.generateCacheKey(TemporaryCacheKeys.INTERACTION_STATUS, false));\n        }\n    }\n\n    /**\n     * Return if the token renewal is still in progress\n     * \n     * @param stateValue\n     */\n    private tokenRenewalInProgress(stateValue: string): boolean {\n        const renewStatus = this.getItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.RENEW_STATUS, stateValue));\n        return !!(renewStatus && renewStatus === Constants.inProgress);\n    }\n\n    /**\n     * Clear all cookies\n     */\n    public clearMsalCookie(state?: string): void {\n        /*\n         * If state is truthy, remove values associated with that request.\n         * Otherwise, remove all MSAL cookies.\n         */\n        if (state) {\n            this.clearItemCookie(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.NONCE_IDTOKEN, state));\n            this.clearItemCookie(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.STATE_LOGIN, state));\n            this.clearItemCookie(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.LOGIN_REQUEST, state));\n            this.clearItemCookie(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.STATE_ACQ_TOKEN, state));\n        } else {\n            const cookies = document.cookie.split(\";\");\n            cookies.forEach(cookieString => {\n                const [\n                    cookieName\n                ] = cookieString.trim().split(\"=\");\n\n                if (cookieName.indexOf(Constants.cachePrefix) > -1) {\n                    super.clearItemCookie(cookieName);\n                }\n            });\n        }\n    }\n\n    /**\n     * Create acquireTokenAccountKey to cache account object\n     * @param accountId\n     * @param state\n     */\n    public static generateAcquireTokenAccountKey(accountId: string, state: string): string {\n        const stateId = RequestUtils.parseLibraryState(state).id;\n        return `${TemporaryCacheKeys.ACQUIRE_TOKEN_ACCOUNT}${Constants.resourceDelimiter}${accountId}${Constants.resourceDelimiter}${stateId}`;\n    }\n\n    /**\n     * Create authorityKey to cache authority\n     * @param state\n     */\n    public static generateAuthorityKey(state: string): string {\n        return AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.AUTHORITY, state);\n    }\n\n    /**\n     * Generates the cache key for temporary cache items, using request state\n     * @param tempCacheKey Cache key prefix\n     * @param state Request state value\n     */\n    public static generateTemporaryCacheKey(tempCacheKey: TemporaryCacheKeys, state: string): string {\n        // Use the state id (a guid), in the interest of shorter key names, which is important for cookies.\n        const stateId = RequestUtils.parseLibraryState(state).id;\n        return `${tempCacheKey}${Constants.resourceDelimiter}${stateId}`;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { ClientInfo } from \"./ClientInfo\";\nimport { IdToken } from \"./IdToken\";\nimport { CryptoUtils } from \"./utils/CryptoUtils\";\nimport { StringUtils } from \"./utils/StringUtils\";\nimport { StringDict } from \"./MsalTypes\";\n\n/**\n * accountIdentifier       combination of idToken.uid and idToken.utid\n * homeAccountIdentifier   combination of clientInfo.uid and clientInfo.utid\n * userName                idToken.preferred_username\n * name                    idToken.name\n * idToken                 idToken\n * sid                     idToken.sid - session identifier\n * environment             idtoken.issuer (the authority that issues the token)\n */\nexport class Account {\n\n    accountIdentifier: string;\n    homeAccountIdentifier: string;\n    userName: string;\n    name: string;\n    idToken: StringDict; // will be deprecated soon\n    idTokenClaims: StringDict;\n    sid: string;\n    environment: string;\n\n    /**\n     * Creates an Account Object\n     * @praram accountIdentifier\n     * @param homeAccountIdentifier\n     * @param userName\n     * @param name\n     * @param idToken\n     * @param sid\n     * @param environment\n     */\n    constructor(accountIdentifier: string, homeAccountIdentifier: string, userName: string, name: string, idTokenClaims: StringDict, sid: string,  environment: string) {\n        this.accountIdentifier = accountIdentifier;\n        this.homeAccountIdentifier = homeAccountIdentifier;\n        this.userName = userName;\n        this.name = name;\n        // will be deprecated soon\n        this.idToken = idTokenClaims;\n        this.idTokenClaims = idTokenClaims;\n        this.sid = sid;\n        this.environment = environment;\n    }\n\n    /**\n     * @hidden\n     * @param idToken\n     * @param clientInfo\n     */\n    static createAccount(idToken: IdToken, clientInfo: ClientInfo): Account {\n\n        // create accountIdentifier\n        const accountIdentifier: string = idToken.objectId ||  idToken.subject;\n\n        // create homeAccountIdentifier\n        const uid: string = clientInfo ? clientInfo.uid : \"\";\n        const utid: string = clientInfo ? clientInfo.utid : \"\";\n\n        let homeAccountIdentifier: string;\n        if (!StringUtils.isEmpty(uid)) {\n            homeAccountIdentifier = StringUtils.isEmpty(utid)? CryptoUtils.base64Encode(uid): CryptoUtils.base64Encode(uid) + \".\" + CryptoUtils.base64Encode(utid);\n        }\n        return new Account(accountIdentifier, homeAccountIdentifier, idToken.preferredName, idToken.name, idToken.claims, idToken.sid, idToken.issuer);\n    }\n\n    /**\n     * Utils function to compare two Account objects - used to check if the same user account is logged in\n     *\n     * @param a1: Account object\n     * @param a2: Account object\n     */\n    static compareAccounts(a1: Account, a2: Account): boolean {\n        if (!a1 || !a2) {\n            return false;\n        }\n        if (a1.homeAccountIdentifier && a2.homeAccountIdentifier) {\n            if (a1.homeAccountIdentifier === a2.homeAccountIdentifier) {\n                return true;\n            }\n        }\n        return false;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { ClientAuthError } from \"../error/ClientAuthError\";\nimport { UrlUtils } from \"./UrlUtils\";\nimport { Logger } from \"../Logger\";\nimport { AuthCache } from \"../cache/AuthCache\";\nimport { TemporaryCacheKeys, Constants } from \"./Constants\";\nimport { TimeUtils } from \"./TimeUtils\";\n\nexport class WindowUtils {\n    /**\n     * @hidden\n     * Interval in milliseconds that we poll a window\n     * @ignore\n     */\n    private static POLLING_INTERVAL_MS = 50;\n\n    /**\n     * @hidden\n     * Checks if the current page is running in an iframe.\n     * @ignore\n     */\n    static isInIframe(): boolean {\n        return window.parent !== window;\n    }\n\n    /**\n     * @hidden\n     * Check if the current page is running in a popup.\n     * @ignore\n     */\n    static isInPopup(): boolean {\n        return !!(window.opener && window.opener !== window);\n    }\n\n    /**\n     * @hidden\n     * @param prefix\n     * @param scopes\n     * @param authority\n     */\n    static generateFrameName(prefix: string, requestSignature: string): string {\n        return `${prefix}${Constants.resourceDelimiter}${requestSignature}`;\n    }\n\n    /**\n     * @hidden\n     * Polls an iframe until it loads a url with a hash\n     * @ignore\n     */\n    static monitorIframeForHash(contentWindow: Window, timeout: number, urlNavigate: string, logger: Logger): Promise<string> {\n        return new Promise((resolve, reject) => {\n            /*\n             * Polling for iframes can be purely timing based,\n             * since we don't need to account for interaction.\n             */\n            const nowMark = TimeUtils.relativeNowMs();\n            const timeoutMark = nowMark + timeout;\n\n            logger.verbose(\"monitorWindowForIframe polling started\");\n\n            const intervalId = setInterval(() => {\n                if (TimeUtils.relativeNowMs() > timeoutMark) {\n                    logger.error(\"monitorIframeForHash unable to find hash in url, timing out\");\n                    logger.errorPii(`monitorIframeForHash polling timed out for url: ${urlNavigate}`);\n                    clearInterval(intervalId);\n                    reject(ClientAuthError.createTokenRenewalTimeoutError());\n                    return;\n                }\n\n                let href;\n\n                try {\n                    /*\n                     * Will throw if cross origin,\n                     * which should be caught and ignored\n                     * since we need the interval to keep running while on STS UI.\n                     */\n                    href = contentWindow.location.href;\n                } catch (e) {}\n\n                if (href && UrlUtils.urlContainsHash(href)) {\n                    logger.verbose(\"monitorIframeForHash found url in hash\");\n                    clearInterval(intervalId);\n                    resolve(contentWindow.location.hash);\n                } \n            }, WindowUtils.POLLING_INTERVAL_MS);\n        });\n    }\n\n    /**\n     * @hidden\n     * Polls a popup until it loads a url with a hash\n     * @ignore\n     */\n    static monitorPopupForHash(contentWindow: Window, timeout: number, urlNavigate: string, logger: Logger): Promise<string> {\n        return new Promise((resolve, reject) => {\n            /*\n             * Polling for popups needs to be tick-based,\n             * since a non-trivial amount of time can be spent on interaction (which should not count against the timeout).\n             */\n            const maxTicks = timeout / WindowUtils.POLLING_INTERVAL_MS;\n            let ticks = 0;\n\n            logger.verbose(\"monitorWindowForHash polling started\");\n\n            const intervalId = setInterval(() => {\n                if (contentWindow.closed) {\n                    logger.error(\"monitorWindowForHash window closed\");\n                    clearInterval(intervalId);\n                    reject(ClientAuthError.createUserCancelledError());\n                    return;\n                }\n\n                let href;\n                try {\n                    /*\n                     * Will throw if cross origin,\n                     * which should be caught and ignored\n                     * since we need the interval to keep running while on STS UI.\n                     */\n                    href = contentWindow.location.href;\n                } catch (e) {}\n\n                // Don't process blank pages or cross domain\n                if (!href || href === \"about:blank\") {\n                    return;\n                }\n\n                /*\n                 * Only run clock when we are on same domain for popups\n                 * as popup operations can take a long time.\n                 */\n                ticks++;\n\n                if (href && UrlUtils.urlContainsHash(href)) {\n                    logger.verbose(\"monitorPopupForHash found url in hash\");\n                    clearInterval(intervalId);\n                    const hash = contentWindow.location.hash;\n                    WindowUtils.clearUrlFragment(contentWindow);\n                    resolve(hash);\n                } else if (ticks > maxTicks) {\n                    logger.error(\"monitorPopupForHash unable to find hash in url, timing out\");\n                    logger.errorPii(`monitorPopupForHash polling timed out for url: ${urlNavigate}`);\n                    clearInterval(intervalId);\n                    reject(ClientAuthError.createTokenRenewalTimeoutError());\n                }\n            }, WindowUtils.POLLING_INTERVAL_MS);\n        });\n    }\n\n    /**\n     * @hidden\n     * Loads iframe with authorization endpoint URL\n     * @ignore\n     */\n    static loadFrame(urlNavigate: string, frameName: string, timeoutMs: number, logger: Logger): Promise<HTMLIFrameElement> {\n        /*\n         * This trick overcomes iframe navigation in IE\n         * IE does not load the page consistently in iframe\n         */\n        logger.infoPii(\"LoadFrame: \" + frameName);\n\n        return new Promise((resolve, reject) => {\n            setTimeout(() => {\n                const frameHandle = this.loadFrameSync(urlNavigate, frameName, logger);\n\n                if (!frameHandle) {\n                    reject(`Unable to load iframe with name: ${frameName}`);\n                    return;\n                }\n\n                resolve(frameHandle);\n            }, timeoutMs);\n        });\n    }\n\n    /**\n     * @hidden\n     * Loads the iframe synchronously when the navigateTimeFrame is set to `0`\n     * @param urlNavigate\n     * @param frameName\n     * @param logger\n     */\n    static loadFrameSync(urlNavigate: string, frameName: string, logger: Logger): HTMLIFrameElement{\n        const frameHandle = WindowUtils.addHiddenIFrame(frameName, logger);\n\n        // returning to handle null in loadFrame, also to avoid null object access errors\n        if (!frameHandle) {\n            return null;\n        }\n        else if (frameHandle.src === \"\" || frameHandle.src === \"about:blank\") {\n            frameHandle.src = urlNavigate;\n            logger.infoPii(\"Frame Name : \" + frameName + \" Navigated to: \" + urlNavigate);\n        }\n\n        return frameHandle;\n    }\n\n    /**\n     * @hidden\n     * Adds the hidden iframe for silent token renewal.\n     * @ignore\n     */\n    static addHiddenIFrame(iframeId: string, logger: Logger): HTMLIFrameElement {\n        if (typeof iframeId === \"undefined\") {\n            return null;\n        }\n        \n        logger.info(\"Add msal iframe to document\");\n        logger.infoPii(\"Add msal frame to document:\" + iframeId);\n        let adalFrame = document.getElementById(iframeId) as HTMLIFrameElement;\n        if (!adalFrame) {\n            logger.verbose(\"Add msal iframe does not exist\");\n            const ifr = document.createElement(\"iframe\");\n            ifr.setAttribute(\"id\", iframeId);\n            ifr.setAttribute(\"aria-hidden\", \"true\");\n            ifr.style.visibility = \"hidden\";\n            ifr.style.position = \"absolute\";\n            ifr.style.width = ifr.style.height = \"0\";\n            ifr.style.border = \"0\";\n            ifr.setAttribute(\"sandbox\", \"allow-scripts allow-same-origin allow-forms\");\n            adalFrame = (document.getElementsByTagName(\"body\")[0].appendChild(ifr) as HTMLIFrameElement);\n        } else {\n            logger.verbose(\"Add msal iframe already exists\");\n        }\n\n        return adalFrame;\n    }\n\n    /**\n     * @hidden\n     * Removes a hidden iframe from the page.\n     * @ignore\n     */\n    static removeHiddenIframe(iframe: HTMLIFrameElement): void {\n        if (document.body === iframe.parentNode) {\n            document.body.removeChild(iframe);\n        }\n    }\n\n    /**\n     * @hidden\n     * Find and return the iframe element with the given hash\n     * @ignore\n     */\n    static getIframeWithHash(hash: string): HTMLIFrameElement {\n        const iframes = document.getElementsByTagName(\"iframe\");\n        const iframeArray: Array<HTMLIFrameElement> = Array.apply(null, Array(iframes.length)).map((iframe: HTMLIFrameElement, index: number) => iframes.item(index)); // eslint-disable-line prefer-spread\n\n        return iframeArray.filter((iframe: HTMLIFrameElement) => {\n            try {\n                return iframe.contentWindow.location.hash === hash;\n            } catch (e) {\n                return false;\n            }\n        })[0];\n    }\n\n    /**\n     * @hidden\n     * Returns an array of all the popups opened by MSAL\n     * @ignore\n     */\n    static getPopups(): Array<Window> {\n        if (!window.openedWindows) {\n            window.openedWindows = [];\n        }\n\n        return window.openedWindows;\n    }\n\n    /**\n     * @hidden\n     * Find and return the popup with the given hash\n     * @ignore\n     */\n    static getPopUpWithHash(hash: string): Window {\n        return WindowUtils.getPopups().filter(popup => {\n            try {\n                return popup.location.hash === hash;\n            } catch (e) {\n                return false;\n            }\n        })[0];\n    }\n\n    /**\n     * @hidden\n     * Add the popup to the known list of popups\n     * @ignore\n     */\n    static trackPopup(popup: Window): void {\n        WindowUtils.getPopups().push(popup);\n    }\n\n    /**\n     * @hidden\n     * Close all popups\n     * @ignore\n     */\n    static closePopups(): void {\n        WindowUtils.getPopups().forEach(popup => popup.close());\n    }\n\n    /**\n     * @ignore\n     *\n     * blocks any login/acquireToken calls to reload from within a hidden iframe (generated for silent calls)\n     */\n    static blockReloadInHiddenIframes(): void {\n        // return an error if called from the hidden iframe created by the msal js silent calls\n        if (UrlUtils.urlContainsHash(window.location.hash) && WindowUtils.isInIframe()) {\n            throw ClientAuthError.createBlockTokenRequestsInHiddenIframeError();\n        }\n    }\n\n    /**\n     *\n     * @param cacheStorage\n     */\n    static checkIfBackButtonIsPressed(cacheStorage: AuthCache): void {\n        const redirectCache = cacheStorage.getItem(TemporaryCacheKeys.REDIRECT_REQUEST);\n\n        // if redirect request is set and there is no hash\n        if(redirectCache && !UrlUtils.urlContainsHash(window.location.hash)) {\n            const splitCache = redirectCache.split(Constants.resourceDelimiter);\n            splitCache.shift();\n            const state = splitCache.length > 0 ? splitCache.join(Constants.resourceDelimiter): null;\n            cacheStorage.resetTempCacheItems(state);\n        }\n    }\n\n    /**\n     * Removes url fragment from browser url\n     */\n    static clearUrlFragment(contentWindow: Window): void {\n        contentWindow.location.hash = \"\";\n        // Office.js sets history.replaceState to null\n        if (typeof contentWindow.history.replaceState === \"function\") {\n            // Full removes \"#\" from url\n            contentWindow.history.replaceState(null, null, `${contentWindow.location.pathname}${contentWindow.location.search}`);\n        }\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { AuthResponse } from \"../AuthResponse\";\nimport { Account } from \"../Account\";\nimport { IdToken } from \"../IdToken\";\nimport { ResponseTypes, ServerHashParamKeys } from \"./Constants\";\nimport { ServerRequestParameters } from \"../ServerRequestParameters\";\n\n/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\n/**\n * @hidden\n */\nexport class ResponseUtils {\n\n    static setResponseIdToken(originalResponse: AuthResponse, idTokenObj: IdToken) : AuthResponse {\n        if (!originalResponse) {\n            return null;\n        } else if (!idTokenObj) {\n            return originalResponse;\n        }\n\n        const exp = Number(idTokenObj.expiration);\n        if (exp && !originalResponse.expiresOn) {\n            originalResponse.expiresOn = new Date(exp * 1000);\n        }\n    \n        return {\n            ...originalResponse,\n            idToken: idTokenObj,\n            idTokenClaims: idTokenObj.claims,\n            uniqueId: idTokenObj.objectId || idTokenObj.subject,\n            tenantId: idTokenObj.tenantId,\n        };\n    }\n\n    static buildAuthResponse(idToken: IdToken, authResponse: AuthResponse, serverAuthenticationRequest: ServerRequestParameters, account: Account, scopes: Array<string>, accountState: string): AuthResponse {\n        switch(serverAuthenticationRequest.responseType) {\n            case ResponseTypes.id_token:\n                let idTokenResponse: AuthResponse = {\n                    ...authResponse,\n                    tokenType: ServerHashParamKeys.ID_TOKEN,\n                    account: account,\n                    scopes: scopes,\n                    accountState: accountState\n                };\n                \n                idTokenResponse = ResponseUtils.setResponseIdToken(idTokenResponse, idToken);\n                return (idTokenResponse.idToken) ? idTokenResponse : null;\n            case ResponseTypes.id_token_token:\n                const idTokeTokenResponse = ResponseUtils.setResponseIdToken(authResponse, idToken);\n                return (idTokeTokenResponse && idTokeTokenResponse.accessToken && idTokeTokenResponse.idToken) ? idTokeTokenResponse : null;\n            case ResponseTypes.token:\n                const tokenResponse = ResponseUtils.setResponseIdToken(authResponse, idToken);\n                return tokenResponse;\n            default: \n                return null;\n        }\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\n/**\n * @hidden\n */\nimport { Authority } from \"./Authority\";\nimport { StringUtils } from \"../utils/StringUtils\";\nimport { ClientConfigurationError } from \"../error/ClientConfigurationError\";\nimport { ITenantDiscoveryResponse, OpenIdConfiguration } from \"./ITenantDiscoveryResponse\";\nimport TelemetryManager from \"../telemetry/TelemetryManager\";\n\nexport class AuthorityFactory {\n    private static metadataMap = new Map<string, ITenantDiscoveryResponse>();\n\n    public static async saveMetadataFromNetwork(authorityInstance: Authority, telemetryManager: TelemetryManager, correlationId: string): Promise<ITenantDiscoveryResponse> {\n        const metadata = await authorityInstance.resolveEndpointsAsync(telemetryManager, correlationId);\n        this.metadataMap.set(authorityInstance.CanonicalAuthority, metadata);\n        return metadata;\n    }\n\n    public static getMetadata(authorityUrl: string): ITenantDiscoveryResponse {\n        return this.metadataMap.get(authorityUrl);\n    }\n\n    public static saveMetadataFromConfig(authorityUrl: string, authorityMetadataJson: string): void {\n        try {\n            if (authorityMetadataJson) {\n                const parsedMetadata = JSON.parse(authorityMetadataJson) as OpenIdConfiguration;\n\n                if (!parsedMetadata.authorization_endpoint || !parsedMetadata.end_session_endpoint || !parsedMetadata.issuer) {\n                    throw ClientConfigurationError.createInvalidAuthorityMetadataError();\n                }\n\n                this.metadataMap.set(authorityUrl, {\n                    AuthorizationEndpoint: parsedMetadata.authorization_endpoint,\n                    EndSessionEndpoint: parsedMetadata.end_session_endpoint,\n                    Issuer: parsedMetadata.issuer\n                });\n            }\n        } catch (e) {\n            throw ClientConfigurationError.createInvalidAuthorityMetadataError();\n        }\n    }\n\n    /**\n     * Create an authority object of the correct type based on the url\n     * Performs basic authority validation - checks to see if the authority is of a valid type (eg aad, b2c)\n     */\n    public static CreateInstance(authorityUrl: string, validateAuthority: boolean, authorityMetadata?: string): Authority {\n        if (StringUtils.isEmpty(authorityUrl)) {\n            return null;\n        }\n\n        if (authorityMetadata) {\n            // todo: log statements\n            this.saveMetadataFromConfig(authorityUrl, authorityMetadata);\n        }\n        return new Authority(authorityUrl, validateAuthority, this.metadataMap.get(authorityUrl));\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { StringUtils } from \"./utils/StringUtils\";\nimport { version as libraryVersion } from \"./packageMetadata\";\n\nexport interface ILoggerCallback {\n    (level: LogLevel, message: string, containsPii: boolean): void;\n}\n\nexport enum LogLevel {\n    Error,\n    Warning,\n    Info,\n    Verbose\n}\n\nexport class Logger {// Singleton Class\n\n    /**\n     * @hidden\n     */\n    // TODO: This does not seem to be a singleton!! Change or Delete.\n    private static instance: Logger;\n\n    /**\n     * @hidden\n     */\n    private correlationId: string;\n\n    /**\n     * @hidden\n     */\n    private level: LogLevel = LogLevel.Info;\n\n    /**\n     * @hidden\n     */\n    private piiLoggingEnabled: boolean;\n\n    /**\n     * @hidden\n     */\n    private localCallback: ILoggerCallback;\n\n    constructor(localCallback: ILoggerCallback,\n        options:\n        {\n            correlationId?: string,\n            level?: LogLevel,\n            piiLoggingEnabled?: boolean,\n        } = {}) {\n        const {\n            correlationId = \"\",\n            level = LogLevel.Info,\n            piiLoggingEnabled = false\n        } = options;\n\n        this.localCallback = localCallback;\n        this.correlationId = correlationId;\n        this.level = level;\n        this.piiLoggingEnabled = piiLoggingEnabled;\n    }\n\n    /**\n     * @hidden\n     */\n    private logMessage(logLevel: LogLevel, logMessage: string, containsPii: boolean): void {\n        if ((logLevel > this.level) || (!this.piiLoggingEnabled && containsPii)) {\n            return;\n        }\n        const timestamp = new Date().toUTCString();\n        let log: string;\n        if (!StringUtils.isEmpty(this.correlationId)) {\n            log = timestamp + \":\" + this.correlationId + \"-\" + libraryVersion + \"-\" + LogLevel[logLevel] + (containsPii ? \"-pii\" : \"\") + \" \" + logMessage;\n        }\n        else {\n            log = timestamp + \":\" + libraryVersion + \"-\" + LogLevel[logLevel] + (containsPii ? \"-pii\" : \"\") + \" \" + logMessage;\n        }\n        this.executeCallback(logLevel, log, containsPii);\n    }\n\n    /**\n     * @hidden\n     */\n    executeCallback(level: LogLevel, message: string, containsPii: boolean): void {\n        if (this.localCallback) {\n            this.localCallback(level, message, containsPii);\n        }\n    }\n\n    /**\n     * @hidden\n     */\n    error(message: string): void {\n        this.logMessage(LogLevel.Error, message, false);\n    }\n\n    /**\n     * @hidden\n     */\n    errorPii(message: string): void {\n        this.logMessage(LogLevel.Error, message, true);\n    }\n\n    /**\n     * @hidden\n     */\n    warning(message: string): void {\n        this.logMessage(LogLevel.Warning, message, false);\n    }\n\n    /**\n     * @hidden\n     */\n    warningPii(message: string): void {\n        this.logMessage(LogLevel.Warning, message, true);\n    }\n\n    /**\n     * @hidden\n     */\n    info(message: string): void {\n        this.logMessage(LogLevel.Info, message, false);\n    }\n\n    /**\n     * @hidden\n     */\n    infoPii(message: string): void {\n        this.logMessage(LogLevel.Info, message, true);\n    }\n\n    /**\n     * @hidden\n     */\n    verbose(message: string): void {\n        this.logMessage(LogLevel.Verbose, message, false);\n    }\n\n    /**\n     * @hidden\n     */\n    verbosePii(message: string): void {\n        this.logMessage(LogLevel.Verbose, message, true);\n    }\n\n    isPiiLoggingEnabled(): boolean {\n        return this.piiLoggingEnabled;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Logger } from \"./Logger\";\nimport { UrlUtils } from \"./utils/UrlUtils\";\nimport { TelemetryEmitter } from \"./telemetry/TelemetryTypes\";\n\n/**\n * Cache location options supported by MSAL are:\n * - local storage: MSAL uses browsers local storage to store its cache\n * - session storage: MSAL uses the browsers session storage to store its cache\n */\nexport type CacheLocation = \"localStorage\" | \"sessionStorage\";\n\n/**\n * Defaults for the Configuration Options\n */\nconst FRAME_TIMEOUT = 6000;\nconst OFFSET = 300;\nconst NAVIGATE_FRAME_WAIT = 500;\n\n/**\n * @type AuthOptions: Use this to configure the auth options in the Configuration object\n *\n *  - clientId                    - Client ID of your app registered with our Application registration portal : https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredAppsPreview in Microsoft Identity Platform\n *  - authority                   - You can configure a specific authority, defaults to \" \" or \"https://login.microsoftonline.com/common\"\n *  - validateAuthority           - Used to turn authority validation on/off. When set to true (default), MSAL will compare the application's authority against well-known URLs templates representing well-formed authorities. It is useful when the authority is obtained at run time to prevent MSAL from displaying authentication prompts from malicious pages.\n *  - authorityMetadata           - OpenID configuration metadata for the configured authority. Must be passed as a JSON string.\n *  - knownAuthorities            - If validateAuthority is set to True, this will be used to set the Trusted Host list. Defaults to empty array\n *  - redirectUri                 - The redirect URI of the application, this should be same as the value in the application registration portal.Defaults to `window.location.href`.\n *  - postLogoutRedirectUri       - Used to redirect the user to this location after logout. Defaults to `window.location.href`.\n *  - navigateToLoginRequestUrl   - Used to turn off default navigation to start page after login. Default is true. This is used only for redirect flows.\n *\n */\nexport type AuthOptions = {\n    clientId: string;\n    authority?: string;\n    validateAuthority?: boolean;\n    authorityMetadata?: string;\n    knownAuthorities?: Array<string>;\n    redirectUri?: string | (() => string);\n    postLogoutRedirectUri?: string | (() => string);\n    navigateToLoginRequestUrl?: boolean;\n};\n\n/**\n * Use this to configure the below cache configuration options:\n *\n * - cacheLocation            - Used to specify the cacheLocation user wants to set. Valid values are \"localStorage\" and \"sessionStorage\"\n * - storeAuthStateInCookie   - If set, MSAL store's the auth request state required for validation of the auth flows in the browser cookies. By default this flag is set to false.\n */\nexport type CacheOptions = {\n    cacheLocation?: CacheLocation;\n    storeAuthStateInCookie?: boolean;\n};\n\n/**\n * Telemetry Config Options\n * - applicationName              - Name of the consuming apps application\n * - applicationVersion           - Verison of the consuming application\n * - telemetryEmitter             - Function where telemetry events are flushed to\n */\nexport type TelemetryOptions = {\n    applicationName: string;\n    applicationVersion: string;\n    telemetryEmitter: TelemetryEmitter\n    // TODO, add onlyAddFailureTelemetry option\n};\n\n/**\n * Library Specific Options\n *\n * - logger                       - Used to initialize the Logger object; TODO: Expand on logger details or link to the documentation on logger\n * - loadFrameTimeout             - maximum time the library should wait for a frame to load\n * - tokenRenewalOffsetSeconds    - sets the window of offset needed to renew the token before expiry\n * - navigateFrameWait            - sets the wait time for hidden iFrame navigation\n */\nexport type SystemOptions = {\n    logger?: Logger;\n    loadFrameTimeout?: number;\n    tokenRenewalOffsetSeconds?: number;\n    navigateFrameWait?: number;\n    telemetry?: TelemetryOptions\n};\n\n/**\n * App/Framework specific environment support\n *\n * - isAngular                - flag set to determine if it is Angular Framework. MSAL uses this to broadcast tokens. More to come here: detangle this dependency from core.\n * - unprotectedResources     - Array of URI's which are unprotected resources. MSAL will not attach a token to outgoing requests that have these URI. Defaults to 'null'.\n * - protectedResourceMap     - This is mapping of resources to scopes used by MSAL for automatically attaching access tokens in web API calls.A single access token is obtained for the resource. So you can map a specific resource path as follows: {\"https://graph.microsoft.com/v1.0/me\", [\"user.read\"]}, or the app URL of the resource as: {\"https://graph.microsoft.com/\", [\"user.read\", \"mail.send\"]}. This is required for CORS calls.\n *\n */\nexport type FrameworkOptions = {\n    isAngular?: boolean;\n    unprotectedResources?: Array<string>;\n    protectedResourceMap?: Map<string, Array<string>>;\n};\n\n/**\n * Use the configuration object to configure MSAL and initialize the UserAgentApplication.\n *\n * This object allows you to configure important elements of MSAL functionality:\n * - auth: this is where you configure auth elements like clientID,  authority used for authenticating against the Microsoft Identity Platform\n * - cache: this is where you configure cache location and whether to store cache in cookies\n * - system: this is where you can configure the logger, frame timeout etc.\n * - framework: this is where you can configure the running mode of angular. More to come here soon.\n */\nexport type Configuration = {\n    auth: AuthOptions,\n    cache?: CacheOptions,\n    system?: SystemOptions,\n    framework?: FrameworkOptions\n};\n\nconst DEFAULT_AUTH_OPTIONS: AuthOptions = {\n    clientId: \"\",\n    authority: null,\n    validateAuthority: true,\n    authorityMetadata: \"\",\n    knownAuthorities: [],\n    redirectUri: () => UrlUtils.getCurrentUrl(),\n    postLogoutRedirectUri: () => UrlUtils.getCurrentUrl(),\n    navigateToLoginRequestUrl: true\n};\n\nconst DEFAULT_CACHE_OPTIONS: CacheOptions = {\n    cacheLocation: \"sessionStorage\",\n    storeAuthStateInCookie: false\n};\n\nconst DEFAULT_SYSTEM_OPTIONS: SystemOptions = {\n    logger: new Logger(null),\n    loadFrameTimeout: FRAME_TIMEOUT,\n    tokenRenewalOffsetSeconds: OFFSET,\n    navigateFrameWait: NAVIGATE_FRAME_WAIT\n};\n\nconst DEFAULT_FRAMEWORK_OPTIONS: FrameworkOptions = {\n    isAngular: false,\n    unprotectedResources: new Array<string>(),\n    protectedResourceMap: new Map<string, Array<string>>()\n};\n\n/**\n * MSAL function that sets the default options when not explicitly configured from app developer\n *\n * @param TAuthOptions\n * @param TCacheOptions\n * @param TSystemOptions\n * @param TFrameworkOptions\n * @param TAuthorityDataOptions\n *\n * @returns TConfiguration object\n */\n\nexport function buildConfiguration({ auth, cache = {}, system = {}, framework = {}}: Configuration): Configuration {\n    const overlayedConfig: Configuration = {\n        auth: { ...DEFAULT_AUTH_OPTIONS, ...auth },\n        cache: { ...DEFAULT_CACHE_OPTIONS, ...cache },\n        system: { ...DEFAULT_SYSTEM_OPTIONS, ...system },\n        framework: { ...DEFAULT_FRAMEWORK_OPTIONS, ...framework }\n    };\n    return overlayedConfig;\n}\n\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { AuthError } from \"./AuthError\";\n\nexport const ServerErrorMessage = {\n    serverUnavailable: {\n        code: \"server_unavailable\",\n        desc: \"Server is temporarily unavailable.\"\n    },\n    unknownServerError: {\n        code: \"unknown_server_error\"\n    },\n};\n\n/**\n * Error thrown when there is an error with the server code, for example, unavailability.\n */\nexport class ServerError extends AuthError {\n\n    constructor(errorCode: string, errorMessage?: string) {\n        super(errorCode, errorMessage);\n        this.name = \"ServerError\";\n\n        Object.setPrototypeOf(this, ServerError.prototype);\n    }\n\n    static createServerUnavailableError(): ServerError {\n        return new ServerError(ServerErrorMessage.serverUnavailable.code,\n            ServerErrorMessage.serverUnavailable.desc);\n    }\n\n    static createUnknownServerError(errorDesc: string): ServerError {\n        return new ServerError(ServerErrorMessage.unknownServerError.code,\n            errorDesc);\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { ServerError } from \"./ServerError\";\n\nexport const InteractionRequiredAuthErrorMessage = {\n    interactionRequired: {\n        code: \"interaction_required\"\n    },\n    consentRequired: {\n        code: \"consent_required\"\n    },\n    loginRequired: {\n        code: \"login_required\"\n    },\n};\n\n/**\n * Error thrown when the user is required to perform an interactive token request.\n */\nexport class InteractionRequiredAuthError extends ServerError {\n\n    constructor(errorCode: string, errorMessage?: string) {\n        super(errorCode, errorMessage);\n        this.name = \"InteractionRequiredAuthError\";\n\n        Object.setPrototypeOf(this, InteractionRequiredAuthError.prototype);\n    }\n\n    static isInteractionRequiredError(errorString: string) : boolean {\n        const interactionRequiredCodes = [\n            InteractionRequiredAuthErrorMessage.interactionRequired.code,\n            InteractionRequiredAuthErrorMessage.consentRequired.code,\n            InteractionRequiredAuthErrorMessage.loginRequired.code\n        ];\n\n        return errorString && interactionRequiredCodes.indexOf(errorString) > -1;\n    }\n\n    static createLoginRequiredAuthError(errorDesc: string): InteractionRequiredAuthError {\n        return new InteractionRequiredAuthError(InteractionRequiredAuthErrorMessage.loginRequired.code, errorDesc);\n    }\n\n    static createInteractionRequiredAuthError(errorDesc: string): InteractionRequiredAuthError {\n        return new InteractionRequiredAuthError(InteractionRequiredAuthErrorMessage.interactionRequired.code, errorDesc);\n    }\n\n    static createConsentRequiredAuthError(errorDesc: string): InteractionRequiredAuthError {\n        return new InteractionRequiredAuthError(InteractionRequiredAuthErrorMessage.consentRequired.code, errorDesc);\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { Account } from \"./Account\";\nimport { IdToken } from \"./IdToken\";\nimport { StringDict } from \"./MsalTypes\";\n\nexport type AuthResponse = {\n    uniqueId: string;\n    tenantId: string;\n    tokenType: string;\n    idToken: IdToken;\n    idTokenClaims: StringDict;\n    accessToken: string;\n    scopes: Array<string>;\n    expiresOn: Date;\n    account: Account;\n    accountState: string;\n    fromCache: boolean\n};\n\nexport function buildResponseStateOnly(state: string) : AuthResponse {\n    return {\n        uniqueId: \"\",\n        tenantId: \"\",\n        tokenType: \"\",\n        idToken: null,\n        idTokenClaims: null,\n        accessToken: \"\",\n        scopes: null,\n        expiresOn: null,\n        account: null,\n        accountState: state,\n        fromCache: false\n    };\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nexport const EVENT_NAME_PREFIX = \"msal.\";\nexport const EVENT_NAME_KEY = \"event_name\";\nexport const START_TIME_KEY = \"start_time\";\nexport const ELAPSED_TIME_KEY  = \"elapsed_time\";\n\nexport const TELEMETRY_BLOB_EVENT_NAMES =  {\n    MsalCorrelationIdConstStrKey: \"Microsoft.MSAL.correlation_id\",\n    ApiTelemIdConstStrKey: \"msal.api_telem_id\",\n    ApiIdConstStrKey: \"msal.api_id\",\n    BrokerAppConstStrKey: \"Microsoft_MSAL_broker_app\",\n    CacheEventCountConstStrKey: \"Microsoft_MSAL_cache_event_count\",\n    HttpEventCountTelemetryBatchKey: \"Microsoft_MSAL_http_event_count\",\n    IdpConstStrKey: \"Microsoft_MSAL_idp\",\n    IsSilentTelemetryBatchKey: \"\",\n    IsSuccessfulConstStrKey: \"Microsoft_MSAL_is_successful\",\n    ResponseTimeConstStrKey: \"Microsoft_MSAL_response_time\",\n    TenantIdConstStrKey: \"Microsoft_MSAL_tenant_id\",\n    UiEventCountTelemetryBatchKey: \"Microsoft_MSAL_ui_event_count\"\n};\n\n// This is used to replace the real tenant in telemetry info\nexport const TENANT_PLACEHOLDER = \"<tenant>\";\n\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { TENANT_PLACEHOLDER, EVENT_NAME_PREFIX } from \"./TelemetryConstants\";\nimport { CryptoUtils } from \"../utils/CryptoUtils\";\nimport { UrlUtils } from \"../utils/UrlUtils\";\nimport { Authority } from \"../authority/Authority\";\n\nexport const scrubTenantFromUri = (uri: string): String => {\n\n    const url = UrlUtils.GetUrlComponents(uri);\n\n    // validate trusted host\n    if (Authority.isAdfs(uri)) {\n        /**\n         * returning what was passed because the library needs to work with uris that are non\n         * AAD trusted but passed by users such as B2C or others.\n         * HTTP Events for instance can take a url to the open id config endpoint\n         */\n        return uri;\n    }\n\n    const pathParams = url.PathSegments;\n\n    if (pathParams && pathParams.length >= 2) {\n        const tenantPosition = pathParams[1] ===  \"tfp\" ? 2 : 1;\n        if (tenantPosition < pathParams.length) {\n            pathParams[tenantPosition] = TENANT_PLACEHOLDER;\n        }\n    }\n\n    return  `${url.Protocol}//${url.HostNameAndPort}/${pathParams.join(\"/\")}`;\n};\n\nexport const hashPersonalIdentifier = (valueToHash: string): string => {\n    /*\n     * TODO sha256 this\n     * Current test runner is being funny with node libs that are webpacked anyway\n     * need a different solution\n     */\n    return CryptoUtils.base64Encode(valueToHash);\n};\n\nexport const prependEventNamePrefix = (suffix: string): string => `${EVENT_NAME_PREFIX}${suffix || \"\"}`;\n\nexport const supportsBrowserPerformance = (): boolean => !!(\n    typeof window !== \"undefined\" &&\n        \"performance\" in window &&\n        window.performance.mark && \n        window.performance.measure\n);\n\nexport const endBrowserPerformanceMeasurement = (measureName: string, startMark: string, endMark: string): void => {\n    if (supportsBrowserPerformance()) {\n        window.performance.mark(endMark);\n        window.performance.measure(measureName, startMark, endMark);\n\n        window.performance.clearMeasures(measureName);\n        window.performance.clearMarks(startMark);\n        window.performance.clearMarks(endMark);\n    }\n};\n\nexport const startBrowserPerformanceMeasurement = (startMark: string): void => {\n    if (supportsBrowserPerformance()) {\n        window.performance.mark(startMark);\n    }\n};\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport {\n    TELEMETRY_BLOB_EVENT_NAMES,\n    EVENT_NAME_KEY,\n    START_TIME_KEY,\n    ELAPSED_TIME_KEY\n} from \"./TelemetryConstants\";\nimport { prependEventNamePrefix, startBrowserPerformanceMeasurement, endBrowserPerformanceMeasurement } from \"./TelemetryUtils\";\nimport { CryptoUtils } from \"../utils/CryptoUtils\";\n\nexport default class TelemetryEvent {\n\n    private startTimestamp: number;\n    // eslint-disable-next-line\n    protected event: any; // TODO TYPE THIS\n    public eventId: string;\n    private label: string;\n\n    constructor(eventName: string, correlationId: string, eventLabel: string) {\n        this.eventId = CryptoUtils.createNewGuid();\n        this.label = eventLabel;\n        this.event = {\n            [prependEventNamePrefix(EVENT_NAME_KEY)]: eventName,\n            [prependEventNamePrefix(ELAPSED_TIME_KEY)]: -1,\n            [`${TELEMETRY_BLOB_EVENT_NAMES.MsalCorrelationIdConstStrKey}`]: correlationId\n        };\n    }\n\n    private setElapsedTime(time: Number): void {\n        this.event[prependEventNamePrefix(ELAPSED_TIME_KEY)] = time;\n    }\n\n    public stop(): void {\n        // Set duration of event\n        this.setElapsedTime(+Date.now() - +this.startTimestamp);\n\n        endBrowserPerformanceMeasurement(this.displayName, this.perfStartMark, this.perfEndMark);\n    }\n\n    public start(): void {\n        this.startTimestamp = Date.now();\n        this.event[prependEventNamePrefix(START_TIME_KEY)] = this.startTimestamp;\n\n        startBrowserPerformanceMeasurement(this.perfStartMark);\n    }\n\n    public get telemetryCorrelationId(): string {\n        return this.event[`${TELEMETRY_BLOB_EVENT_NAMES.MsalCorrelationIdConstStrKey}`];\n    }\n\n    public set telemetryCorrelationId(value: string) {\n        this.event[`${TELEMETRY_BLOB_EVENT_NAMES.MsalCorrelationIdConstStrKey}`] = value;\n    }\n\n    public get eventName(): string {\n        return this.event[prependEventNamePrefix(EVENT_NAME_KEY)];\n    }\n\n    public get(): object {\n        return {\n            ...this.event,\n            eventId: this.eventId\n        };\n    }\n\n    public get key(): string {\n        return `${this.telemetryCorrelationId}_${this.eventId}-${this.eventName}`;\n    }\n\n    public get displayName(): string {\n        return `Msal-${this.label}-${this.telemetryCorrelationId}`;\n    }\n\n    private get perfStartMark() {\n        return `start-${this.key}`;\n    }\n\n    private get perfEndMark() {\n        return `end-${this.key}`;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { TELEMETRY_BLOB_EVENT_NAMES } from \"./TelemetryConstants\";\nimport TelemetryEvent from \"./TelemetryEvent\";\nimport { EventCount, TelemetryPlatform } from \"./TelemetryTypes\";\nimport { prependEventNamePrefix } from \"./TelemetryUtils\";\n\nexport default class DefaultEvent extends TelemetryEvent {\n    // TODO Platform Type\n    constructor(platform: TelemetryPlatform, correlationId: string, clientId: string, eventCount: EventCount) {\n        super(prependEventNamePrefix(\"default_event\"), correlationId, \"DefaultEvent\");\n        this.event[prependEventNamePrefix(\"client_id\")] = clientId;\n        this.event[prependEventNamePrefix(\"sdk_plaform\")] = platform.sdk;\n        this.event[prependEventNamePrefix(\"sdk_version\")] = platform.sdkVersion;\n        this.event[prependEventNamePrefix(\"application_name\")] = platform.applicationName;\n        this.event[prependEventNamePrefix(\"application_version\")] = platform.applicationVersion;\n        this.event[prependEventNamePrefix(\"effective_connection_speed\")] = platform.networkInformation && platform.networkInformation.connectionSpeed;\n        this.event[`${TELEMETRY_BLOB_EVENT_NAMES.UiEventCountTelemetryBatchKey}`] = this.getEventCount(prependEventNamePrefix(\"ui_event\"), eventCount);\n        this.event[`${TELEMETRY_BLOB_EVENT_NAMES.HttpEventCountTelemetryBatchKey}`] = this.getEventCount(prependEventNamePrefix(\"http_event\"), eventCount);\n        this.event[`${TELEMETRY_BLOB_EVENT_NAMES.CacheEventCountConstStrKey}`] = this.getEventCount(prependEventNamePrefix(\"cache_event\"), eventCount);\n        // / Device id?\n    }\n\n    private getEventCount(eventName: string, eventCount: EventCount): number {\n        if (!eventCount[eventName]) {\n            return 0;\n        }\n        return eventCount[eventName];\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport TelemetryEvent from \"./TelemetryEvent\";\nimport { TELEMETRY_BLOB_EVENT_NAMES } from \"./TelemetryConstants\";\nimport { scrubTenantFromUri, hashPersonalIdentifier, prependEventNamePrefix } from \"./TelemetryUtils\";\n\nexport const EVENT_KEYS = {\n    AUTHORITY: prependEventNamePrefix(\"authority\"),\n    AUTHORITY_TYPE: prependEventNamePrefix(\"authority_type\"),\n    PROMPT: prependEventNamePrefix(\"ui_behavior\"),\n    TENANT_ID: prependEventNamePrefix(\"tenant_id\"),\n    USER_ID: prependEventNamePrefix(\"user_id\"),\n    WAS_SUCESSFUL: prependEventNamePrefix(\"was_successful\"),\n    API_ERROR_CODE: prependEventNamePrefix(\"api_error_code\"),\n    LOGIN_HINT: prependEventNamePrefix(\"login_hint\")\n};\n\nexport enum API_CODE {\n    AcquireTokenRedirect = 2001,\n    AcquireTokenSilent = 2002,\n    AcquireTokenPopup = 2003,\n    LoginRedirect = 2004,\n    LoginPopup = 2005,\n    Logout = 2006\n}\n\nexport enum API_EVENT_IDENTIFIER {\n    AcquireTokenRedirect = \"AcquireTokenRedirect\",\n    AcquireTokenSilent = \"AcquireTokenSilent\",\n    AcquireTokenPopup = \"AcquireTokenPopup\",\n    LoginRedirect = \"LoginRedirect\",\n    LoginPopup = \"LoginPopup\",\n    Logout = \"Logout\"\n}\n\nconst mapEventIdentiferToCode = {\n    [API_EVENT_IDENTIFIER.AcquireTokenSilent]: API_CODE.AcquireTokenSilent,\n    [API_EVENT_IDENTIFIER.AcquireTokenPopup]: API_CODE.AcquireTokenPopup,\n    [API_EVENT_IDENTIFIER.AcquireTokenRedirect]: API_CODE.AcquireTokenRedirect,\n    [API_EVENT_IDENTIFIER.LoginPopup]: API_CODE.LoginPopup,\n    [API_EVENT_IDENTIFIER.LoginRedirect]: API_CODE.LoginRedirect,\n    [API_EVENT_IDENTIFIER.Logout]: API_CODE.Logout\n};\n\nexport default class ApiEvent extends TelemetryEvent {\n\n    private piiEnabled: boolean;\n\n    constructor(correlationId: string, piiEnabled: boolean, apiEventIdentifier?: API_EVENT_IDENTIFIER) {\n        super(prependEventNamePrefix(\"api_event\"), correlationId, apiEventIdentifier);\n        if (apiEventIdentifier) {\n            this.apiCode = mapEventIdentiferToCode[apiEventIdentifier];\n            this.apiEventIdentifier = apiEventIdentifier;\n        }\n        this.piiEnabled = piiEnabled;\n    }\n\n    public set apiEventIdentifier(apiEventIdentifier: string) {\n        this.event[TELEMETRY_BLOB_EVENT_NAMES.ApiTelemIdConstStrKey] = apiEventIdentifier;\n    }\n\n    public set apiCode(apiCode: number) {\n        this.event[TELEMETRY_BLOB_EVENT_NAMES.ApiIdConstStrKey] = apiCode;\n    }\n\n    public set authority(uri: string) {\n        this.event[EVENT_KEYS.AUTHORITY] = scrubTenantFromUri(uri).toLowerCase();\n    }\n\n    public set apiErrorCode(errorCode: string) {\n        this.event[EVENT_KEYS.API_ERROR_CODE] = errorCode;\n    }\n\n    public set tenantId(tenantId: string) {\n        this.event[EVENT_KEYS.TENANT_ID] = this.piiEnabled && tenantId ?\n            hashPersonalIdentifier(tenantId)\n            : null;\n    }\n\n    public set accountId(accountId: string) {\n        this.event[EVENT_KEYS.USER_ID] = this.piiEnabled && accountId ?\n            hashPersonalIdentifier(accountId)\n            : null;\n    }\n\n    public set wasSuccessful(wasSuccessful: boolean) {\n        this.event[EVENT_KEYS.WAS_SUCESSFUL] = wasSuccessful;\n    }\n\n    public get wasSuccessful(): boolean {\n        return this.event[EVENT_KEYS.WAS_SUCESSFUL] === true;\n    }\n\n    public set loginHint(loginHint: string) {\n        this.event[EVENT_KEYS.LOGIN_HINT] = this.piiEnabled && loginHint ?\n            hashPersonalIdentifier(loginHint)\n            : null;\n    }\n\n    public set authorityType(authorityType: string) {\n        this.event[EVENT_KEYS.AUTHORITY_TYPE] = authorityType.toLowerCase();\n    }\n\n    public set promptType(promptType: string) {\n        this.event[EVENT_KEYS.PROMPT] = promptType.toLowerCase();\n    }\n\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport TelemetryEvent from \"./TelemetryEvent\";\nimport { scrubTenantFromUri, prependEventNamePrefix } from \"./TelemetryUtils\";\nimport { ServerRequestParameters } from \"../ServerRequestParameters\";\nimport { StringDict } from \"../MsalTypes\";\n\nexport const EVENT_KEYS = {\n    HTTP_PATH: prependEventNamePrefix(\"http_path\"),\n    USER_AGENT: prependEventNamePrefix(\"user_agent\"),\n    QUERY_PARAMETERS: prependEventNamePrefix(\"query_parameters\"),\n    API_VERSION: prependEventNamePrefix(\"api_version\"),\n    RESPONSE_CODE: prependEventNamePrefix(\"response_code\"),\n    O_AUTH_ERROR_CODE: prependEventNamePrefix(\"oauth_error_code\"),\n    HTTP_METHOD: prependEventNamePrefix(\"http_method\"),\n    REQUEST_ID_HEADER: prependEventNamePrefix(\"request_id_header\"),\n    SPE_INFO: prependEventNamePrefix(\"spe_info\"),\n    SERVER_ERROR_CODE: prependEventNamePrefix(\"server_error_code\"),\n    SERVER_SUB_ERROR_CODE: prependEventNamePrefix(\"server_sub_error_code\"),\n    URL: prependEventNamePrefix(\"url\")\n};\n\nexport default class HttpEvent extends TelemetryEvent {\n\n    constructor(correlationId: string, eventLabel: string) {\n        super(prependEventNamePrefix(\"http_event\"), correlationId, eventLabel);\n    }\n\n    public set url(url: string) {\n        const scrubbedUri = scrubTenantFromUri(url);\n        this.event[EVENT_KEYS.URL] = scrubbedUri && scrubbedUri.toLowerCase();\n    }\n\n    public set httpPath(httpPath: string) {\n        this.event[EVENT_KEYS.HTTP_PATH] = scrubTenantFromUri(httpPath).toLowerCase();\n    }\n\n    public set userAgent(userAgent: string) {\n        this.event[EVENT_KEYS.USER_AGENT] = userAgent;\n    }\n\n    public set queryParams(queryParams: StringDict) {\n        this.event[EVENT_KEYS.QUERY_PARAMETERS] = ServerRequestParameters.generateQueryParametersString(queryParams);\n    }\n\n    public set apiVersion(apiVersion: string) {\n        this.event[EVENT_KEYS.API_VERSION] = apiVersion.toLowerCase();\n    }\n\n    public set httpResponseStatus(statusCode: number) {\n        this.event[EVENT_KEYS.RESPONSE_CODE] = statusCode;\n    }\n\n    public set oAuthErrorCode(errorCode: string) {\n        this.event[EVENT_KEYS.O_AUTH_ERROR_CODE] = errorCode;\n    }\n\n    public set httpMethod(httpMethod: string) {\n        this.event[EVENT_KEYS.HTTP_METHOD] = httpMethod;\n    }\n\n    public set requestIdHeader(requestIdHeader: string) {\n        this.event[EVENT_KEYS.REQUEST_ID_HEADER] = requestIdHeader;\n    }\n\n    /**\n     * Indicates whether the request was executed on a ring serving SPE traffic.\n     * An empty string indicates this occurred on an outer ring, and the string \"I\"\n     * indicates the request occurred on the inner ring\n     */\n    public set speInfo(speInfo: string) {\n        this.event[EVENT_KEYS.SPE_INFO] = speInfo;\n    }\n\n    public set serverErrorCode(errorCode: string) {\n        this.event[EVENT_KEYS.SERVER_ERROR_CODE] = errorCode;\n    }\n\n    public set serverSubErrorCode(subErrorCode: string) {\n        this.event[EVENT_KEYS.SERVER_SUB_ERROR_CODE] = subErrorCode;\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport TelemetryEvent from \"./TelemetryEvent\";\nimport {\n    CompletedEvents,\n    EventCount,\n    EventCountByCorrelationId,\n    InProgressEvents,\n    TelemetryConfig,\n    TelemetryPlatform,\n    TelemetryEmitter\n} from \"./TelemetryTypes\";\nimport DefaultEvent from \"./DefaultEvent\";\nimport { Constants } from \"../utils/Constants\";\nimport ApiEvent, { API_EVENT_IDENTIFIER } from \"./ApiEvent\";\nimport { Logger } from \"../Logger\";\nimport HttpEvent from \"./HttpEvent\";\nimport { version as libraryVersion } from \"../packageMetadata\";\n\nexport default class TelemetryManager {\n\n    // correlation Id to list of events\n    private completedEvents: CompletedEvents = {};\n    // event key to event\n    private inProgressEvents: InProgressEvents = {};\n    // correlation id to map of eventname to count\n    private eventCountByCorrelationId: EventCountByCorrelationId = {};\n\n    // Implement after API EVENT\n    private onlySendFailureTelemetry: boolean = false;\n    private telemetryPlatform: TelemetryPlatform;\n    private clientId: string;\n    private telemetryEmitter: TelemetryEmitter;\n    private logger: Logger;\n\n    constructor(config: TelemetryConfig, telemetryEmitter: TelemetryEmitter, logger: Logger) {\n        // TODO THROW if bad options\n        this.telemetryPlatform = {\n            sdk: Constants.libraryName,\n            sdkVersion: libraryVersion,\n            networkInformation: {\n                // @ts-ignore\n                connectionSpeed: typeof navigator !== \"undefined\" && navigator.connection && navigator.connection.effectiveType\n            },\n            ...config.platform\n        };\n        this.clientId = config.clientId;\n        this.onlySendFailureTelemetry = config.onlySendFailureTelemetry;\n        /*\n         * TODO, when i get to wiring this through, think about what it means if\n         * a developer does not implement telem at all, we still instrument, but telemetryEmitter can be\n         * optional?\n         */\n        this.telemetryEmitter = telemetryEmitter;\n        this.logger = logger;\n    }\n\n    static getTelemetrymanagerStub(clientId: string, logger: Logger) : TelemetryManager {\n        const applicationName = \"UnSetStub\";\n        const applicationVersion = \"0.0\";\n        const telemetryEmitter = () => {};\n        const telemetryPlatform: TelemetryPlatform = {\n            applicationName,\n            applicationVersion\n        };\n        const telemetryManagerConfig: TelemetryConfig = {\n            platform: telemetryPlatform,\n            clientId: clientId\n        };\n\n        return new this(telemetryManagerConfig, telemetryEmitter, logger);\n    }\n\n    startEvent(event: TelemetryEvent): void {\n        this.logger.verbose(`Telemetry Event started: ${event.key}`);\n\n        if (!this.telemetryEmitter) {\n            return;\n        }\n\n        event.start();\n        this.inProgressEvents[event.key] = event;\n    }\n\n    stopEvent(event: TelemetryEvent): void {\n        this.logger.verbose(`Telemetry Event stopped: ${event.key}`);\n\n        if (!this.telemetryEmitter || !this.inProgressEvents[event.key]) {\n            return;\n        }\n        event.stop();\n        this.incrementEventCount(event);\n\n        const completedEvents = this.completedEvents[event.telemetryCorrelationId];\n\n        this.completedEvents[event.telemetryCorrelationId] = [...(completedEvents || []), event];\n\n        delete this.inProgressEvents[event.key];\n    }\n\n    flush(correlationId: string): void {\n        this.logger.verbose(`Flushing telemetry events: ${correlationId}`);\n\n        // If there is only unfinished events should this still return them?\n        if (!this.telemetryEmitter || !this.completedEvents[correlationId]) {\n            return;\n        }\n\n        const orphanedEvents = this.getOrphanedEvents(correlationId);\n        orphanedEvents.forEach(event => this.incrementEventCount(event));\n        const eventsToFlush: Array<TelemetryEvent> = [\n            ...this.completedEvents[correlationId],\n            ...orphanedEvents\n        ];\n\n        delete this.completedEvents[correlationId];\n        const eventCountsToFlush: EventCount = this.eventCountByCorrelationId[correlationId];\n\n        delete this.eventCountByCorrelationId[correlationId];\n        // TODO add funcitonality for onlyFlushFailures after implementing api event? ??\n\n        if (!eventsToFlush || !eventsToFlush.length) {\n            return;\n        }\n\n        const defaultEvent: DefaultEvent = new DefaultEvent(\n            this.telemetryPlatform,\n            correlationId,\n            this.clientId,\n            eventCountsToFlush\n        );\n\n        const eventsWithDefaultEvent = [ ...eventsToFlush, defaultEvent ];\n\n        this.telemetryEmitter(eventsWithDefaultEvent.map(e => e.get()));\n    }\n\n    createAndStartApiEvent(correlationId: string, apiEventIdentifier: API_EVENT_IDENTIFIER): ApiEvent {\n        const apiEvent = new ApiEvent(correlationId, this.logger.isPiiLoggingEnabled(), apiEventIdentifier);\n        this.startEvent(apiEvent);\n        return apiEvent;\n    }\n\n    stopAndFlushApiEvent(correlationId: string, apiEvent: ApiEvent, wasSuccessful: boolean, errorCode?: string): void {\n        apiEvent.wasSuccessful = wasSuccessful;\n        if (errorCode) {\n            apiEvent.apiErrorCode = errorCode;\n        }\n        this.stopEvent(apiEvent);\n        this.flush(correlationId);\n    }\n\n    createAndStartHttpEvent(correlation: string, httpMethod: string, url: string, eventLabel: string): HttpEvent {\n        const httpEvent = new HttpEvent(correlation, eventLabel);\n        httpEvent.url = url;\n        httpEvent.httpMethod = httpMethod;\n        this.startEvent(httpEvent);\n        return httpEvent;\n    }\n\n    private incrementEventCount(event: TelemetryEvent): void {\n        /*\n         * TODO, name cache event different?\n         * if type is cache event, change name\n         */\n        const eventName = event.eventName;\n        const eventCount = this.eventCountByCorrelationId[event.telemetryCorrelationId];\n        if (!eventCount) {\n            this.eventCountByCorrelationId[event.telemetryCorrelationId] = {\n                [eventName]: 1\n            };\n        } else {\n            eventCount[eventName] = eventCount[eventName] ? eventCount[eventName] + 1 : 1;\n        }\n    }\n\n    private getOrphanedEvents(correlationId: string): Array<TelemetryEvent> {\n        return Object.keys(this.inProgressEvents)\n            .reduce((memo, eventKey) => {\n                if (eventKey.indexOf(correlationId) !== -1) {\n                    const event = this.inProgressEvents[eventKey];\n                    delete this.inProgressEvents[eventKey];\n                    return [...memo, event];\n                }\n                return memo;\n            }, []);\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { AccessTokenCacheItem } from \"../cache/AccessTokenCacheItem\";\nimport { ScopeSet } from \"../ScopeSet\";\nimport { UrlUtils } from \"./UrlUtils\"; \n\n/**\n * @hidden\n */\nexport class AuthCacheUtils {\n    static filterTokenCacheItemsByScope(tokenCacheItems: Array<AccessTokenCacheItem>, requestScopes: string []): Array<AccessTokenCacheItem> {\n        return tokenCacheItems.filter((cacheItem: AccessTokenCacheItem) => {\n            const cachedScopes = cacheItem.key.scopes.split(\" \");\n            const searchScopes = ScopeSet.removeDefaultScopes(requestScopes);\n\n            // If requestScopes contain only default scopes search for default scopes otherwise search for everything but default scopes\n            return searchScopes.length === 0 ? ScopeSet.containsScope(cachedScopes, requestScopes): ScopeSet.containsScope(cachedScopes, searchScopes);\n        });\n\n    }\n\n    static filterTokenCacheItemsByAuthority(tokenCacheItems: Array<AccessTokenCacheItem>, authority: string): Array<AccessTokenCacheItem> {\n        return tokenCacheItems.filter((cacheItem: AccessTokenCacheItem) => UrlUtils.CanonicalizeUri(cacheItem.key.authority) === authority);\n    }\n\n    static filterTokenCacheItemsByDomain(tokenCacheItems: Array<AccessTokenCacheItem>, requestDomain: string): Array<AccessTokenCacheItem> {\n        return tokenCacheItems.filter(cacheItem => {\n            const cacheItemDomain = UrlUtils.GetUrlComponents(cacheItem.key.authority).HostNameAndPort;\n            return cacheItemDomain === requestDomain;\n        });\n    }\n}\n", "/*\n * Copyright (c) Microsoft Corporation. All rights reserved.\n * Licensed under the MIT License.\n */\n\nimport { AccessTokenCacheItem } from \"./cache/AccessTokenCacheItem\";\nimport { AccessTokenKey } from \"./cache/AccessTokenKey\";\nimport { AccessTokenValue } from \"./cache/AccessTokenValue\";\nimport { ServerRequestParameters } from \"./ServerRequestParameters\";\nimport { Authority, AuthorityType } from \"./authority/Authority\";\nimport { ClientInfo } from \"./ClientInfo\";\nimport { IdToken } from \"./IdToken\";\nimport { Logger } from \"./Logger\";\nimport { AuthCache } from \"./cache/AuthCache\";\nimport { Account } from \"./Account\";\nimport { ScopeSet } from \"./ScopeSet\";\nimport { StringUtils } from \"./utils/StringUtils\";\nimport { WindowUtils } from \"./utils/WindowUtils\";\nimport { TokenUtils } from \"./utils/TokenUtils\";\nimport { TimeUtils } from \"./utils/TimeUtils\";\nimport { UrlUtils } from \"./utils/UrlUtils\";\nimport { RequestUtils } from \"./utils/RequestUtils\";\nimport { ResponseUtils } from \"./utils/ResponseUtils\";\nimport { AuthorityFactory } from \"./authority/AuthorityFactory\";\nimport { Configuration, buildConfiguration, TelemetryOptions } from \"./Configuration\";\nimport { AuthenticationParameters } from \"./AuthenticationParameters\";\nimport { ClientConfigurationError } from \"./error/ClientConfigurationError\";\nimport { AuthError } from \"./error/AuthError\";\nimport { ClientAuthError, ClientAuthErrorMessage } from \"./error/ClientAuthError\";\nimport { ServerError } from \"./error/ServerError\";\nimport { InteractionRequiredAuthError } from \"./error/InteractionRequiredAuthError\";\nimport { AuthResponse, buildResponseStateOnly } from \"./AuthResponse\";\nimport TelemetryManager from \"./telemetry/TelemetryManager\";\nimport { TelemetryPlatform, TelemetryConfig } from \"./telemetry/TelemetryTypes\";\nimport ApiEvent, { API_EVENT_IDENTIFIER } from \"./telemetry/ApiEvent\";\n\nimport { Constants,\n    ServerHashParamKeys,\n    InteractionType,\n    ResponseTypes,\n    TemporaryCacheKeys,\n    PersistentCacheKeys,\n    ErrorCacheKeys,\n    FramePrefix\n} from \"./utils/Constants\";\nimport { CryptoUtils } from \"./utils/CryptoUtils\";\nimport { TrustedAuthority } from \"./authority/TrustedAuthority\";\nimport { AuthCacheUtils } from \"./utils/AuthCacheUtils\";\n\n// default authority\nconst DEFAULT_AUTHORITY = \"https://login.microsoftonline.com/common\";\n\n/**\n * Interface to handle iFrame generation, Popup Window creation and redirect handling\n */\ndeclare global {\n    // eslint-disable-next-line\n    interface Window {\n        msal: Object;\n        CustomEvent: CustomEvent;\n        Event: Event;\n        activeRenewals: {};\n        renewStates: Array<string>;\n        callbackMappedToRenewStates : {};\n        promiseMappedToRenewStates: {};\n        openedWindows: Array<Window>;\n        requestType: string;\n    }\n}\n\n/**\n * @hidden\n * @ignore\n */\nexport interface CacheResult {\n    errorDesc: string;\n    token: string;\n    error: string;\n}\n\n/**\n * @hidden\n * @ignore\n * Data type to hold information about state returned from the server\n */\nexport type ResponseStateInfo = {\n    state: string;\n    timestamp: number,\n    method: string;\n    stateMatch: boolean;\n    requestType: string;\n};\n\n/**\n * A type alias for an authResponseCallback function.\n * {@link (authResponseCallback:type)}\n * @param authErr error created for failure cases\n * @param response response containing token strings in success cases, or just state value in error cases\n */\nexport type authResponseCallback = (authErr: AuthError, response?: AuthResponse) => void;\n\n/**\n * A type alias for a tokenReceivedCallback function.\n * {@link (tokenReceivedCallback:type)}\n * @returns response of type {@link (AuthResponse:type)}\n * The function that will get the call back once this API is completed (either successfully or with a failure).\n */\nexport type tokenReceivedCallback = (response: AuthResponse) => void;\n\n/**\n * A type alias for a errorReceivedCallback function.\n * {@link (errorReceivedCallback:type)}\n * @returns response of type {@link (AuthError:class)}\n * @returns {string} account state\n */\nexport type errorReceivedCallback = (authErr: AuthError, accountState: string) => void;\n\n/**\n * UserAgentApplication class\n *\n * Object Instance that the developer can use to make loginXX OR acquireTokenXX functions\n */\nexport class UserAgentApplication {\n\n    // input Configuration by the developer/user\n    private config: Configuration;\n\n    // callbacks for token/error\n    private authResponseCallback: authResponseCallback = null;\n    private tokenReceivedCallback: tokenReceivedCallback = null;\n    private errorReceivedCallback: errorReceivedCallback = null;\n\n    // Added for readability as these params are very frequently used\n    private logger: Logger;\n    private clientId: string;\n    private inCookie: boolean;\n    private telemetryManager: TelemetryManager;\n\n    // Cache and Account info referred across token grant flow\n    protected cacheStorage: AuthCache;\n    private account: Account;\n\n    // state variables\n    private silentAuthenticationState: string;\n    private silentLogin: boolean;\n    private redirectResponse: AuthResponse;\n    private redirectError: AuthError;\n\n    // Authority Functionality\n    protected authorityInstance: Authority;\n\n    /**\n     * setter for the authority URL\n     * @param {string} authority\n     */\n    // If the developer passes an authority, create an instance\n    public set authority(val: string) {\n        this.authorityInstance = AuthorityFactory.CreateInstance(val, this.config.auth.validateAuthority);\n    }\n\n    /**\n     * Method to manage the authority URL.\n     *\n     * @returns {string} authority\n     */\n    public get authority(): string {\n        return this.authorityInstance.CanonicalAuthority;\n    }\n\n    /**\n     * Get the current authority instance from the MSAL configuration object\n     *\n     * @returns {@link Authority} authority instance\n     */\n    public getAuthorityInstance(): Authority {\n        return this.authorityInstance;\n    }\n\n    /**\n     * @constructor\n     * Constructor for the UserAgentApplication used to instantiate the UserAgentApplication object\n     *\n     * Important attributes in the Configuration object for auth are:\n     * - clientID: the application ID of your application.\n     * You can obtain one by registering your application with our Application registration portal : https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredAppsPreview\n     * - authority: the authority URL for your application.\n     *\n     * In Azure AD, authority is a URL indicating the Azure active directory that MSAL uses to obtain tokens.\n     * It is of the form https://login.microsoftonline.com/&lt;Enter_the_Tenant_Info_Here&gt;.\n     * If your application supports Accounts in one organizational directory, replace \"Enter_the_Tenant_Info_Here\" value with the Tenant Id or Tenant name (for example, contoso.microsoft.com).\n     * If your application supports Accounts in any organizational directory, replace \"Enter_the_Tenant_Info_Here\" value with organizations.\n     * If your application supports Accounts in any organizational directory and personal Microsoft accounts, replace \"Enter_the_Tenant_Info_Here\" value with common.\n     * To restrict support to Personal Microsoft accounts only, replace \"Enter_the_Tenant_Info_Here\" value with consumers.\n     *\n     *\n     * In Azure B2C, authority is of the form https://&lt;instance&gt;/tfp/&lt;tenant&gt;/&lt;policyName&gt;/\n     *\n     * @param {@link (Configuration:type)} configuration object for the MSAL UserAgentApplication instance\n     */\n    constructor(configuration: Configuration) {\n        \n        // Set the Configuration\n        this.config = buildConfiguration(configuration);\n\n        this.logger = this.config.system.logger;\n        this.clientId = this.config.auth.clientId;\n        this.inCookie = this.config.cache.storeAuthStateInCookie;\n\n        this.telemetryManager = this.getTelemetryManagerFromConfig(this.config.system.telemetry, this.clientId);\n\n        TrustedAuthority.setTrustedAuthoritiesFromConfig(this.config.auth.validateAuthority, this.config.auth.knownAuthorities);\n        AuthorityFactory.saveMetadataFromConfig(this.config.auth.authority, this.config.auth.authorityMetadata);\n\n        // if no authority is passed, set the default: \"https://login.microsoftonline.com/common\"\n        this.authority = this.config.auth.authority || DEFAULT_AUTHORITY;\n        // cache keys msal - typescript throws an error if any value other than \"localStorage\" or \"sessionStorage\" is passed\n        this.cacheStorage = new AuthCache(this.clientId, this.config.cache.cacheLocation, this.inCookie);\n\n        // Initialize window handling code\n        if (!window.activeRenewals) {\n            window.activeRenewals = {};\n        }\n        if (!window.renewStates) {\n            window.renewStates = [];\n        }\n        if (!window.callbackMappedToRenewStates) {\n            window.callbackMappedToRenewStates = {};\n        }\n        if (!window.promiseMappedToRenewStates) {\n            window.promiseMappedToRenewStates = {};\n        }\n        window.msal = this;\n\n        const urlHash = window.location.hash;\n        const urlContainsHash = UrlUtils.urlContainsHash(urlHash);\n\n        // check if back button is pressed\n        WindowUtils.checkIfBackButtonIsPressed(this.cacheStorage);\n\n        // On the server 302 - Redirect, handle this\n        if (urlContainsHash && this.cacheStorage.isInteractionInProgress(true)) {\n            const stateInfo = this.getResponseState(urlHash);\n            if (stateInfo.method === Constants.interactionTypeRedirect) {\n                this.handleRedirectAuthenticationResponse(urlHash);\n            }\n        }\n    }\n\n    // #region Redirect Callbacks\n    /**\n     * @hidden\n     * @ignore\n     * Set the callback functions for the redirect flow to send back the success or error object.\n     * @param {@link (tokenReceivedCallback:type)} successCallback - Callback which contains the AuthResponse object, containing data from the server.\n     * @param {@link (errorReceivedCallback:type)} errorCallback - Callback which contains a AuthError object, containing error data from either the server\n     * or the library, depending on the origin of the error.\n     */\n    handleRedirectCallback(tokenReceivedCallback: tokenReceivedCallback, errorReceivedCallback: errorReceivedCallback): void;\n    handleRedirectCallback(authCallback: authResponseCallback): void;\n    handleRedirectCallback(authOrTokenCallback: authResponseCallback | tokenReceivedCallback, errorReceivedCallback?: errorReceivedCallback): void {\n        if (!authOrTokenCallback) {\n            throw ClientConfigurationError.createInvalidCallbackObjectError(authOrTokenCallback);\n        }\n\n        // Set callbacks\n        if (errorReceivedCallback) {\n            this.tokenReceivedCallback = authOrTokenCallback as tokenReceivedCallback;\n            this.errorReceivedCallback = errorReceivedCallback;\n            this.logger.warning(\"This overload for callback is deprecated - please change the format of the callbacks to a single callback as shown: (err: AuthError, response: AuthResponse).\");\n        } else {\n            this.authResponseCallback = authOrTokenCallback as authResponseCallback;\n        }\n\n        if (this.redirectError) {\n            this.authErrorHandler(Constants.interactionTypeRedirect, this.redirectError, this.redirectResponse);\n        } else if (this.redirectResponse) {\n            this.authResponseHandler(Constants.interactionTypeRedirect, this.redirectResponse);\n        }\n    }\n\n    /**\n     * Public API to verify if the URL contains the hash with known properties\n     * @param hash\n     */\n    public urlContainsHash(hash: string): boolean {\n        this.logger.verbose(\"UrlContainsHash has been called\");\n        return UrlUtils.urlContainsHash(hash);\n    }\n\n    private authResponseHandler(interactionType: InteractionType, response: AuthResponse, resolve?: Function) : void {\n        this.logger.verbose(\"AuthResponseHandler has been called\");\n\n        this.cacheStorage.setInteractionInProgress(false);\n        if (interactionType === Constants.interactionTypeRedirect) {\n            this.logger.verbose(\"Interaction type is redirect\");\n            if (this.errorReceivedCallback) {\n                this.logger.verbose(\"Two callbacks were provided to handleRedirectCallback, calling success callback with response\");\n                this.tokenReceivedCallback(response);\n            } else if (this.authResponseCallback) {\n                this.logger.verbose(\"One callback was provided to handleRedirectCallback, calling authResponseCallback with response\");\n                this.authResponseCallback(null, response);\n            }\n        } else if (interactionType === Constants.interactionTypePopup) {\n            this.logger.verbose(\"Interaction type is popup, resolving\");\n            resolve(response);\n        } else {\n            throw ClientAuthError.createInvalidInteractionTypeError();\n        }\n    }\n\n    private authErrorHandler(interactionType: InteractionType, authErr: AuthError, response: AuthResponse, reject?: Function) : void {\n        this.logger.verbose(\"AuthErrorHandler has been called\");\n\n        // set interaction_status to complete\n        this.cacheStorage.setInteractionInProgress(false);\n        if (interactionType === Constants.interactionTypeRedirect) {\n            this.logger.verbose(\"Interaction type is redirect\");\n            if (this.errorReceivedCallback) {\n                this.logger.verbose(\"Two callbacks were provided to handleRedirectCallback, calling error callback\");\n                this.errorReceivedCallback(authErr, response.accountState);\n            } else if (this.authResponseCallback) {\n                this.logger.verbose(\"One callback was provided to handleRedirectCallback, calling authResponseCallback with error\");\n                this.authResponseCallback(authErr, response);\n            } else {\n                this.logger.verbose(\"handleRedirectCallback has not been called and no callbacks are registered, throwing error\");\n                throw authErr;\n            }\n        } else if (interactionType === Constants.interactionTypePopup) {\n            this.logger.verbose(\"Interaction type is popup, rejecting\");\n            reject(authErr);\n        } else {\n            throw ClientAuthError.createInvalidInteractionTypeError();\n        }\n    }\n\n    // #endregion\n    /**\n     * Use when initiating the login process by redirecting the user's browser to the authorization endpoint.\n     * @param {@link (AuthenticationParameters:type)}\n     */\n    loginRedirect(userRequest?: AuthenticationParameters): void {\n        this.logger.verbose(\"LoginRedirect has been called\");\n\n        // validate request\n        const request: AuthenticationParameters = RequestUtils.validateRequest(userRequest, true, this.clientId, Constants.interactionTypeRedirect);\n        this.acquireTokenInteractive(Constants.interactionTypeRedirect, true, request,  null, null);\n    }\n\n    /**\n     * Use when you want to obtain an access_token for your API by redirecting the user's browser window to the authorization endpoint.\n     * @param {@link (AuthenticationParameters:type)}\n     *\n     * To renew idToken, please pass clientId as the only scope in the Authentication Parameters\n     */\n    acquireTokenRedirect(userRequest: AuthenticationParameters): void {\n        this.logger.verbose(\"AcquireTokenRedirect has been called\");\n\n        // validate request\n        const request: AuthenticationParameters = RequestUtils.validateRequest(userRequest, false, this.clientId, Constants.interactionTypeRedirect);\n        this.acquireTokenInteractive(Constants.interactionTypeRedirect, false, request, null, null);\n    }\n\n    /**\n     * Use when initiating the login process via opening a popup window in the user's browser\n     *\n     * @param {@link (AuthenticationParameters:type)}\n     *\n     * @returns {Promise.<AuthResponse>} - a promise that is fulfilled when this function has completed, or rejected if an error was raised. Returns the {@link AuthResponse} object\n     */\n    loginPopup(userRequest?: AuthenticationParameters): Promise<AuthResponse> {\n        this.logger.verbose(\"LoginPopup has been called\");\n\n        // validate request\n        const request: AuthenticationParameters = RequestUtils.validateRequest(userRequest, true, this.clientId, Constants.interactionTypePopup);\n        const apiEvent: ApiEvent = this.telemetryManager.createAndStartApiEvent(request.correlationId, API_EVENT_IDENTIFIER.LoginPopup);\n\n        return new Promise<AuthResponse>((resolve, reject) => {\n            this.acquireTokenInteractive(Constants.interactionTypePopup, true, request, resolve, reject);\n        })\n            .then((resp) => {\n                this.logger.verbose(\"Successfully logged in\");\n                this.telemetryManager.stopAndFlushApiEvent(request.correlationId, apiEvent, true);\n                return resp;\n            })\n            .catch((error: AuthError) => {\n                this.cacheStorage.resetTempCacheItems(request.state);\n                this.telemetryManager.stopAndFlushApiEvent(request.correlationId, apiEvent, false, error.errorCode);\n                throw error;\n            });\n    }\n\n    /**\n     * Use when you want to obtain an access_token for your API via opening a popup window in the user's browser\n     * @param {@link AuthenticationParameters}\n     *\n     * To renew idToken, please pass clientId as the only scope in the Authentication Parameters\n     * @returns {Promise.<AuthResponse>} - a promise that is fulfilled when this function has completed, or rejected if an error was raised. Returns the {@link AuthResponse} object\n     */\n    acquireTokenPopup(userRequest: AuthenticationParameters): Promise<AuthResponse> {\n        this.logger.verbose(\"AcquireTokenPopup has been called\");\n\n        // validate request\n        const request: AuthenticationParameters = RequestUtils.validateRequest(userRequest, false, this.clientId, Constants.interactionTypePopup);\n        const apiEvent: ApiEvent = this.telemetryManager.createAndStartApiEvent(request.correlationId, API_EVENT_IDENTIFIER.AcquireTokenPopup);\n\n        return new Promise<AuthResponse>((resolve, reject) => {\n            this.acquireTokenInteractive(Constants.interactionTypePopup, false, request, resolve, reject);\n        })\n            .then((resp) => {\n                this.logger.verbose(\"Successfully acquired token\");\n                this.telemetryManager.stopAndFlushApiEvent(request.correlationId, apiEvent, true);\n                return resp;\n            })\n            .catch((error: AuthError) => {\n                this.cacheStorage.resetTempCacheItems(request.state);\n                this.telemetryManager.stopAndFlushApiEvent(request.correlationId, apiEvent, false, error.errorCode);\n                throw error;\n            });\n    }\n\n    // #region Acquire Token\n\n    /**\n     * Use when initiating the login process or when you want to obtain an access_token for your API,\n     * either by redirecting the user's browser window to the authorization endpoint or via opening a popup window in the user's browser.\n     * @param {@link (AuthenticationParameters:type)}\n     *\n     * To renew idToken, please pass clientId as the only scope in the Authentication Parameters\n     */\n    private acquireTokenInteractive(interactionType: InteractionType, isLoginCall: boolean, request: AuthenticationParameters, resolve?: Function, reject?: Function): void {\n        this.logger.verbose(\"AcquireTokenInteractive has been called\");\n\n        // block the request if made from the hidden iframe\n        WindowUtils.blockReloadInHiddenIframes();\n\n        try {\n            this.cacheStorage.setInteractionInProgress(true);\n        } catch (e) {\n            // If already in progress, do not proceed\n            const thrownError = isLoginCall ? ClientAuthError.createLoginInProgressError() : ClientAuthError.createAcquireTokenInProgressError();\n            const stateOnlyResponse = buildResponseStateOnly(this.getAccountState(request.state));\n            this.cacheStorage.resetTempCacheItems(request.state);\n            this.authErrorHandler(interactionType,\n                thrownError,\n                stateOnlyResponse,\n                reject);\n            return;\n        }\n\n        if(interactionType === Constants.interactionTypeRedirect) {\n            this.cacheStorage.setItem(TemporaryCacheKeys.REDIRECT_REQUEST, `${Constants.inProgress}${Constants.resourceDelimiter}${request.state}`);\n        }\n\n        // Get the account object if a session exists\n        let account: Account;\n        if (request && request.account && !isLoginCall) {\n            account = request.account;\n            this.logger.verbose(\"Account set from request\");\n        } else {\n            account = this.getAccount();\n            this.logger.verbose(\"Account set from MSAL Cache\");\n        }\n\n        // If no session exists, prompt the user to login.\n        if (!account && !ServerRequestParameters.isSSOParam(request)) {\n            if (isLoginCall) {\n                // extract ADAL id_token if exists\n                const adalIdToken = this.extractADALIdToken();\n\n                // silent login if ADAL id_token is retrieved successfully - SSO\n                if (adalIdToken && !request.scopes) {\n                    this.logger.info(\"ADAL's idToken exists. Extracting login information from ADAL's idToken\");\n                    const tokenRequest: AuthenticationParameters = this.buildIDTokenRequest(request);\n\n                    this.silentLogin = true;\n                    this.acquireTokenSilent(tokenRequest).then(response => {\n                        this.silentLogin = false;\n                        this.logger.info(\"Unified cache call is successful\");\n\n                        this.authResponseHandler(interactionType, response, resolve);\n                        return;\n                    }, (error) => {\n                        this.silentLogin = false;\n                        this.logger.error(\"Error occurred during unified cache ATS: \" + error);\n\n                        // proceed to login since ATS failed\n                        this.acquireTokenHelper(null, interactionType, isLoginCall, request, resolve, reject);\n                    });\n                }\n                // No ADAL token found, proceed to login\n                else {\n                    this.logger.verbose(\"Login call but no token found, proceed to login\");\n                    this.acquireTokenHelper(null, interactionType, isLoginCall, request, resolve, reject);\n                }\n            }\n            // AcquireToken call, but no account or context given, so throw error\n            else {\n                this.logger.verbose(\"AcquireToken call, no context or account given\");\n                this.logger.info(\"User login is required\");\n                const stateOnlyResponse = buildResponseStateOnly(this.getAccountState(request.state));\n                this.cacheStorage.resetTempCacheItems(request.state);\n                this.authErrorHandler(interactionType,\n                    ClientAuthError.createUserLoginRequiredError(),\n                    stateOnlyResponse,\n                    reject);\n                return;\n            }\n        }\n        // User session exists\n        else {\n            this.logger.verbose(\"User session exists, login not required\");\n            this.acquireTokenHelper(account, interactionType, isLoginCall, request, resolve, reject);\n        }\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     * Helper function to acquireToken\n     *\n     */\n    private async acquireTokenHelper(account: Account, interactionType: InteractionType, isLoginCall: boolean, request: AuthenticationParameters, resolve?: Function, reject?: Function): Promise<void> {\n        this.logger.verbose(\"AcquireTokenHelper has been called\");\n        this.logger.verbose(`Interaction type: ${interactionType}. isLoginCall: ${isLoginCall}`);\n\n        const requestSignature = request.scopes ? request.scopes.join(\" \").toLowerCase() : Constants.oidcScopes.join(\" \");\n        this.logger.verbosePii(`Request signature: ${requestSignature}`);\n\n        let serverAuthenticationRequest: ServerRequestParameters;\n        const acquireTokenAuthority = (request && request.authority) ? AuthorityFactory.CreateInstance(request.authority, this.config.auth.validateAuthority, request.authorityMetadata) : this.authorityInstance;\n        let popUpWindow: Window;\n\n        try {\n            if (!acquireTokenAuthority.hasCachedMetadata()) {\n                this.logger.verbose(\"No cached metadata for authority\");\n                await AuthorityFactory.saveMetadataFromNetwork(acquireTokenAuthority, this.telemetryManager, request.correlationId);\n            } else {\n                this.logger.verbose(\"Cached metadata found for authority\");\n            }\n\n            // On Fulfillment\n            const responseType: string = isLoginCall ? ResponseTypes.id_token : this.getTokenType(account, request.scopes);\n\n            const loginStartPage = request.redirectStartPage || window.location.href;\n\n            serverAuthenticationRequest = new ServerRequestParameters(\n                acquireTokenAuthority,\n                this.clientId,\n                responseType,\n                this.getRedirectUri(request && request.redirectUri),\n                request.scopes,\n                request.state,\n                request.correlationId\n            );\n            this.logger.verbose(\"Finished building server authentication request\");\n\n            this.updateCacheEntries(serverAuthenticationRequest, account, isLoginCall, loginStartPage);\n            this.logger.verbose(\"Updating cache entries\");\n\n            // populate QueryParameters (sid/login_hint) and any other extraQueryParameters set by the developer\n            serverAuthenticationRequest.populateQueryParams(account, request);\n            this.logger.verbose(\"Query parameters populated from account\");\n\n            // Construct urlNavigate\n            const urlNavigate = UrlUtils.createNavigateUrl(serverAuthenticationRequest) + Constants.response_mode_fragment;\n            // set state in cache\n            if (interactionType === Constants.interactionTypeRedirect) {\n                if (!isLoginCall) {\n                    this.cacheStorage.setItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.STATE_ACQ_TOKEN, request.state), serverAuthenticationRequest.state, this.inCookie);\n                    this.logger.verbose(\"State cached for redirect\");\n                    this.logger.verbosePii(`State cached: ${serverAuthenticationRequest.state}`);\n                } else {\n                    this.logger.verbose(\"Interaction type redirect but login call is true. State not cached\");\n                }\n            } else if (interactionType === Constants.interactionTypePopup) {\n                window.renewStates.push(serverAuthenticationRequest.state);\n                window.requestType = isLoginCall ? Constants.login : Constants.renewToken;\n                this.logger.verbose(\"State saved to window\");\n                this.logger.verbosePii(`State saved: ${serverAuthenticationRequest.state}`);\n\n                // Register callback to capture results from server\n                this.registerCallback(serverAuthenticationRequest.state, requestSignature, resolve, reject);\n            } else {\n                this.logger.verbose(\"Invalid interaction error. State not cached\");\n                throw ClientAuthError.createInvalidInteractionTypeError();\n            }\n\n            if (interactionType === Constants.interactionTypePopup) {\n                this.logger.verbose(\"Interaction type is popup. Generating popup window\");\n                // Generate a popup window\n                try {\n                    popUpWindow = this.openPopup(urlNavigate, \"msal\", Constants.popUpWidth, Constants.popUpHeight);\n    \n                    // Push popup window handle onto stack for tracking\n                    WindowUtils.trackPopup(popUpWindow);\n                } catch (e) {\n                    this.logger.info(ClientAuthErrorMessage.popUpWindowError.code + \":\" + ClientAuthErrorMessage.popUpWindowError.desc);\n                    this.cacheStorage.setItem(ErrorCacheKeys.ERROR, ClientAuthErrorMessage.popUpWindowError.code);\n                    this.cacheStorage.setItem(ErrorCacheKeys.ERROR_DESC, ClientAuthErrorMessage.popUpWindowError.desc);\n                    if (reject) {\n                        reject(ClientAuthError.createPopupWindowError());\n                        return;\n                    }\n                }\n    \n                // popUpWindow will be null for redirects, so we dont need to attempt to monitor the window\n                if (popUpWindow) {\n                    try {\n                        const hash = await WindowUtils.monitorPopupForHash(popUpWindow, this.config.system.loadFrameTimeout, urlNavigate, this.logger);\n\n                        this.handleAuthenticationResponse(hash);\n\n                        // Request completed successfully, set to completed\n                        this.cacheStorage.setInteractionInProgress(false);\n                        this.logger.info(\"Closing popup window\");\n\n                        // TODO: Check how this can be extracted for any framework specific code?\n                        if (this.config.framework.isAngular) {\n                            this.broadcast(\"msal:popUpHashChanged\", hash);\n                        }\n                        \n                        WindowUtils.closePopups();\n                    } catch (error) {\n                        if (reject) {\n                            reject(error);\n                        }\n\n                        if (this.config.framework.isAngular) {\n                            this.broadcast(\"msal:popUpClosed\", error.errorCode + Constants.resourceDelimiter + error.errorMessage);\n                        } else {\n                            // Request failed, set to canceled\n                            this.cacheStorage.setInteractionInProgress(false);\n                            popUpWindow.close();\n                        }\n                    }\n                }\n            } else {\n                // If onRedirectNavigate is implemented, invoke it and provide urlNavigate\n                if (request.onRedirectNavigate) {\n                    this.logger.verbose(\"Invoking onRedirectNavigate callback\");\n\n                    const navigate = request.onRedirectNavigate(urlNavigate);\n\n                    // Returning false from onRedirectNavigate will stop navigation\n                    if (navigate !== false) {\n                        this.logger.verbose(\"onRedirectNavigate did not return false, navigating\");\n                        this.navigateWindow(urlNavigate);\n                    } else {\n                        this.logger.verbose(\"onRedirectNavigate returned false, stopping navigation\");\n                    }\n                } else {\n                    // Otherwise, perform navigation\n                    this.logger.verbose(\"Navigating window to urlNavigate\");\n                    this.navigateWindow(urlNavigate);\n                }\n            }\n        } catch (err) {\n            this.logger.error(err);\n            this.cacheStorage.resetTempCacheItems(request.state);\n            this.authErrorHandler(interactionType, ClientAuthError.createEndpointResolutionError(err.toString), buildResponseStateOnly(request.state), reject);\n            if (popUpWindow) {\n                popUpWindow.close();\n            }\n        }\n    }\n\n    /**\n     * API interfacing idToken request when applications already have a session/hint acquired by authorization client applications\n     * @param request\n     */\n    ssoSilent(request: AuthenticationParameters): Promise<AuthResponse> {\n        this.logger.verbose(\"ssoSilent has been called\");\n        \n        // throw an error on an empty request\n        if (!request) {\n            throw ClientConfigurationError.createEmptyRequestError();\n        }\n\n        // throw an error on no hints passed\n        if (!request.sid && !request.loginHint) {\n            throw ClientConfigurationError.createSsoSilentError();\n        }\n\n        return this.acquireTokenSilent({\n            ...request,\n            scopes: Constants.oidcScopes\n        });\n    }\n\n    /**\n     * Use this function to obtain a token before every call to the API / resource provider\n     *\n     * MSAL return's a cached token when available\n     * Or it send's a request to the STS to obtain a new token using a hidden iframe.\n     *\n     * @param {@link AuthenticationParameters}\n     *\n     * To renew idToken, please pass clientId as the only scope in the Authentication Parameters\n     * @returns {Promise.<AuthResponse>} - a promise that is fulfilled when this function has completed, or rejected if an error was raised. Returns the {@link AuthResponse} object\n     *\n     */\n    acquireTokenSilent(userRequest: AuthenticationParameters): Promise<AuthResponse> {\n        this.logger.verbose(\"AcquireTokenSilent has been called\");\n\n        // validate the request\n        const request = RequestUtils.validateRequest(userRequest, false, this.clientId, Constants.interactionTypeSilent);\n        const apiEvent: ApiEvent = this.telemetryManager.createAndStartApiEvent(request.correlationId, API_EVENT_IDENTIFIER.AcquireTokenSilent);\n        const requestSignature = RequestUtils.createRequestSignature(request);\n\n        return new Promise<AuthResponse>(async (resolve, reject) => {\n\n            // block the request if made from the hidden iframe\n            WindowUtils.blockReloadInHiddenIframes();\n\n            const scope = request.scopes.join(\" \").toLowerCase();\n            this.logger.verbosePii(`Serialized scopes: ${scope}`);\n\n            // if the developer passes an account, give that account the priority\n            let account: Account;\n            if (request.account) {\n                account = request.account;\n                this.logger.verbose(\"Account set from request\");\n            } else {\n                account = this.getAccount();\n                this.logger.verbose(\"Account set from MSAL Cache\");\n            }\n\n            // Extract adalIdToken if stashed in the cache to allow for seamless ADAL to MSAL migration\n            const adalIdToken = this.cacheStorage.getItem(Constants.adalIdToken);\n\n            // In the event of no account being passed in the config, no session id, and no pre-existing adalIdToken, user will need to log in\n            if (!account && !(request.sid  || request.loginHint) && StringUtils.isEmpty(adalIdToken) ) {\n                this.logger.info(\"User login is required\");\n                // The promise rejects with a UserLoginRequiredError, which should be caught and user should be prompted to log in interactively\n                return reject(ClientAuthError.createUserLoginRequiredError());\n            }\n\n            // set the response type based on the current cache status / scopes set\n            const responseType = this.getTokenType(account, request.scopes);\n            this.logger.verbose(`Response type: ${responseType}`);\n\n            // create a serverAuthenticationRequest populating the `queryParameters` to be sent to the Server\n            const serverAuthenticationRequest = new ServerRequestParameters(\n                AuthorityFactory.CreateInstance(request.authority, this.config.auth.validateAuthority, request.authorityMetadata),\n                this.clientId,\n                responseType,\n                this.getRedirectUri(request.redirectUri),\n                request.scopes,\n                request.state,\n                request.correlationId,\n            );\n\n            this.logger.verbose(\"Finished building server authentication request\");\n\n            // populate QueryParameters (sid/login_hint) and any other extraQueryParameters set by the developer\n            if (ServerRequestParameters.isSSOParam(request) || account) {\n                serverAuthenticationRequest.populateQueryParams(account, request, null, true);\n                this.logger.verbose(\"Query parameters populated from existing SSO or account\");\n            }\n            // if user didn't pass login_hint/sid and adal's idtoken is present, extract the login_hint from the adalIdToken\n            else if (!account && !StringUtils.isEmpty(adalIdToken)) {\n                // if adalIdToken exists, extract the SSO info from the same\n                const adalIdTokenObject = TokenUtils.extractIdToken(adalIdToken);\n                this.logger.verbose(\"ADAL's idToken exists. Extracting login information from ADAL's idToken to populate query parameters\");\n                serverAuthenticationRequest.populateQueryParams(account, null, adalIdTokenObject, true);\n            }\n            else {\n                this.logger.verbose(\"No additional query parameters added\");\n            }\n\n            const userContainedClaims = request.claimsRequest || serverAuthenticationRequest.claimsValue;\n\n            let authErr: AuthError;\n            let cacheResultResponse;\n\n            // If request.forceRefresh is set to true, force a request for a new token instead of getting it from the cache\n            if (!userContainedClaims && !request.forceRefresh) {\n                try {\n                    cacheResultResponse = this.getCachedToken(serverAuthenticationRequest, account);\n                } catch (e) {\n                    authErr = e;\n                }\n            }\n            \n            // resolve/reject based on cacheResult\n            if (cacheResultResponse) {\n                this.logger.verbose(\"Token found in cache lookup\");\n                this.logger.verbosePii(`Scopes found: ${JSON.stringify(cacheResultResponse.scopes)}`);\n                resolve(cacheResultResponse);\n                return null;\n            }\n            else if (authErr) {\n                this.logger.infoPii(authErr.errorCode + \":\" + authErr.errorMessage);\n                reject(authErr);\n                return null;\n            }\n            // else proceed with login\n            else {\n                \n                let logMessage;\n                if (userContainedClaims) {\n                    logMessage = \"Skipped cache lookup since claims were given\";\n                } else if (request.forceRefresh) {\n                    logMessage = \"Skipped cache lookup since request.forceRefresh option was set to true\";\n                } else {\n                    logMessage = \"No valid token found in cache lookup\";\n                }\n                this.logger.verbose(logMessage);\n                \n                // Cache result can return null if cache is empty. In that case, set authority to default value if no authority is passed to the API.\n                if (!serverAuthenticationRequest.authorityInstance) {\n                    serverAuthenticationRequest.authorityInstance = request.authority ? \n                        AuthorityFactory.CreateInstance(request.authority, this.config.auth.validateAuthority, request.authorityMetadata)\n                        : this.authorityInstance;\n                }    \n                this.logger.verbosePii(`Authority instance: ${serverAuthenticationRequest.authority}`);\n                \n                try {\n                    if (!serverAuthenticationRequest.authorityInstance.hasCachedMetadata()) {\n                        this.logger.verbose(\"No cached metadata for authority\");\n                        await AuthorityFactory.saveMetadataFromNetwork(serverAuthenticationRequest.authorityInstance, this.telemetryManager, request.correlationId);\n                        this.logger.verbose(\"Authority has been updated with endpoint discovery response\");\n                    } else {\n                        this.logger.verbose(\"Cached metadata found for authority\");\n                    }\n\n                    /*\n                     * refresh attempt with iframe\n                     * Already renewing for this scope, callback when we get the token.\n                     */\n                    if (window.activeRenewals[requestSignature]) {\n                        this.logger.verbose(\"Renewing token in progress. Registering callback\");\n                        // Active renewals contains the state for each renewal.\n                        this.registerCallback(window.activeRenewals[requestSignature], requestSignature, resolve, reject);\n                    }\n                    else {\n                        if (request.scopes && ScopeSet.onlyContainsOidcScopes(request.scopes)) {\n                            /*\n                             * App uses idToken to send to api endpoints\n                             * Default scope is tracked as OIDC scopes to store this token\n                             */\n                            this.logger.verbose(\"OpenID Connect scopes only, renewing idToken\");\n                            this.silentLogin = true;\n                            this.renewIdToken(requestSignature, resolve, reject, account, serverAuthenticationRequest);\n                        } else {\n                            // renew access token\n                            this.logger.verbose(\"Renewing access token\");\n                            this.renewToken(requestSignature, resolve, reject, account, serverAuthenticationRequest);\n                        }\n                    }\n                } catch (err) {\n                    this.logger.error(err);\n                    reject(ClientAuthError.createEndpointResolutionError(err.toString()));\n                    return null;\n                }\n            }\n        })\n            .then(res => {\n                this.logger.verbose(\"Successfully acquired token\");\n                this.telemetryManager.stopAndFlushApiEvent(request.correlationId, apiEvent, true);\n                return res;\n            })\n            .catch((error: AuthError) => {\n                this.cacheStorage.resetTempCacheItems(request.state);\n                this.telemetryManager.stopAndFlushApiEvent(request.correlationId, apiEvent, false, error.errorCode);\n                throw error;\n            });\n    }\n\n    // #endregion\n\n    // #region Popup Window Creation\n\n    /**\n     * @hidden\n     *\n     * Configures popup window for login.\n     *\n     * @param urlNavigate\n     * @param title\n     * @param popUpWidth\n     * @param popUpHeight\n     * @ignore\n     * @hidden\n     */\n    private openPopup(urlNavigate: string, title: string, popUpWidth: number, popUpHeight: number) {\n        this.logger.verbose(\"OpenPopup has been called\");\n        try {\n            /**\n             * adding winLeft and winTop to account for dual monitor\n             * using screenLeft and screenTop for IE8 and earlier\n             */\n            const winLeft = window.screenLeft ? window.screenLeft : window.screenX;\n            const winTop = window.screenTop ? window.screenTop : window.screenY;\n            /**\n             * window.innerWidth displays browser window\"s height and width excluding toolbars\n             * using document.documentElement.clientWidth for IE8 and earlier\n             */\n            const width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n            const height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n            const left = ((width / 2) - (popUpWidth / 2)) + winLeft;\n            const top = ((height / 2) - (popUpHeight / 2)) + winTop;\n\n            // open the window\n            const popupWindow = window.open(urlNavigate, title, \"width=\" + popUpWidth + \", height=\" + popUpHeight + \", top=\" + top + \", left=\" + left + \", scrollbars=yes\");\n            if (!popupWindow) {\n                throw ClientAuthError.createPopupWindowError();\n            }\n            if (popupWindow.focus) {\n                popupWindow.focus();\n            }\n\n            return popupWindow;\n        } catch (e) {\n            this.cacheStorage.setInteractionInProgress(false);\n            throw ClientAuthError.createPopupWindowError(e.toString());\n        }\n    }\n\n    // #endregion\n\n    // #region Iframe Management\n\n    /**\n     * @hidden\n     * Calling _loadFrame but with a timeout to signal failure in loadframeStatus. Callbacks are left.\n     * registered when network errors occur and subsequent token requests for same resource are registered to the pending request.\n     * @ignore\n     */\n    private async loadIframeTimeout(urlNavigate: string, frameName: string, requestSignature: string): Promise<void> {\n        // set iframe session to pending\n        const expectedState = window.activeRenewals[requestSignature];\n        this.logger.verbosePii(\"Set loading state to pending for: \" + requestSignature + \":\" + expectedState);\n        this.cacheStorage.setItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.RENEW_STATUS, expectedState), Constants.inProgress);\n\n        // render the iframe synchronously if app chooses no timeout, else wait for the set timer to expire\n        const iframe: HTMLIFrameElement = this.config.system.navigateFrameWait ?\n            await WindowUtils.loadFrame(urlNavigate, frameName, this.config.system.navigateFrameWait, this.logger):\n            WindowUtils.loadFrameSync(urlNavigate, frameName, this.logger);\n\n        try {\n            const hash = await WindowUtils.monitorIframeForHash(iframe.contentWindow, this.config.system.loadFrameTimeout, urlNavigate, this.logger);\n\n            if (hash) {\n                this.handleAuthenticationResponse(hash);\n            }\n        } catch (error) {\n            if (this.cacheStorage.getItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.RENEW_STATUS, expectedState)) === Constants.inProgress) {\n                // fail the iframe session if it's in pending state\n                this.logger.verbose(\"Loading frame has timed out after: \" + (this.config.system.loadFrameTimeout / 1000) + \" seconds for scope/authority \" + requestSignature + \":\" + expectedState);\n                // Error after timeout\n                if (expectedState && window.callbackMappedToRenewStates[expectedState]) {\n                    window.callbackMappedToRenewStates[expectedState](null, error);\n                }\n\n                this.cacheStorage.removeItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.RENEW_STATUS, expectedState));\n            }\n            WindowUtils.removeHiddenIframe(iframe);\n            throw error;\n        }\n        WindowUtils.removeHiddenIframe(iframe);\n    }\n\n    // #endregion\n\n    // #region General Helpers\n\n    /**\n     * @hidden\n     * Used to redirect the browser to the STS authorization endpoint\n     * @param {string} urlNavigate - URL of the authorization endpoint\n     */\n    private navigateWindow(urlNavigate: string, popupWindow?: Window) {\n        // Navigate if valid URL\n        if (urlNavigate && !StringUtils.isEmpty(urlNavigate)) {\n            const navigateWindow: Window = popupWindow ? popupWindow : window;\n            const logMessage: string = popupWindow ? \"Navigated Popup window to:\" + urlNavigate : \"Navigate to:\" + urlNavigate;\n            this.logger.infoPii(logMessage);\n            navigateWindow.location.assign(urlNavigate);\n        }\n        else {\n            this.logger.info(\"Navigate url is empty\");\n            throw AuthError.createUnexpectedError(\"Navigate url is empty\");\n        }\n    }\n\n    /**\n     * @hidden\n     * Used to add the developer requested callback to the array of callbacks for the specified scopes. The updated array is stored on the window object\n     * @param {string} expectedState - Unique state identifier (guid).\n     * @param {string} scope - Developer requested permissions. Not all scopes are guaranteed to be included in the access token returned.\n     * @param {Function} resolve - The resolve function of the promise object.\n     * @param {Function} reject - The reject function of the promise object.\n     * @ignore\n     */\n    private registerCallback(expectedState: string, requestSignature: string, resolve: Function, reject: Function): void {\n        // track active renewals\n        window.activeRenewals[requestSignature] = expectedState;\n\n        // initialize callbacks mapped array\n        if (!window.promiseMappedToRenewStates[expectedState]) {\n            window.promiseMappedToRenewStates[expectedState] = [];\n        }\n        // indexing on the current state, push the callback params to callbacks mapped\n        window.promiseMappedToRenewStates[expectedState].push({ resolve: resolve, reject: reject });\n\n        // Store the server response in the current window??\n        if (!window.callbackMappedToRenewStates[expectedState]) {\n            window.callbackMappedToRenewStates[expectedState] = (response: AuthResponse, error: AuthError) => {\n                // reset active renewals\n                delete window.activeRenewals[requestSignature];\n\n                // for all promiseMappedtoRenewStates for a given 'state' - call the reject/resolve with error/token respectively\n                for (let i = 0; i < window.promiseMappedToRenewStates[expectedState].length; ++i) {\n                    try {\n                        if (error) {\n                            window.promiseMappedToRenewStates[expectedState][i].reject(error);\n                        } else if (response) {\n                            window.promiseMappedToRenewStates[expectedState][i].resolve(response);\n                        } else {\n                            this.cacheStorage.resetTempCacheItems(expectedState);\n                            throw AuthError.createUnexpectedError(\"Error and response are both null\");\n                        }\n                    } catch (e) {\n                        this.logger.warning(e);\n                    }\n                }\n\n                // reset\n                delete window.promiseMappedToRenewStates[expectedState];\n                delete window.callbackMappedToRenewStates[expectedState];\n            };\n        }\n    }\n\n    // #endregion\n\n    // #region Logout\n\n    /**\n     * Use to log out the current user, and redirect the user to the postLogoutRedirectUri.\n     * Default behaviour is to redirect the user to `window.location.href`.\n     */\n    logout(correlationId?: string): void {\n        this.logger.verbose(\"Logout has been called\");\n        this.logoutAsync(correlationId);\n    }\n\n    /**\n     * Async version of logout(). Use to log out the current user.\n     * @param correlationId Request correlationId\n     */\n    private async logoutAsync(correlationId?: string): Promise<void> {\n        const requestCorrelationId = correlationId || CryptoUtils.createNewGuid();\n        const apiEvent = this.telemetryManager.createAndStartApiEvent(requestCorrelationId, API_EVENT_IDENTIFIER.Logout);\n\n        this.clearCache();\n        this.account = null;\n\n        try {\n            if (!this.authorityInstance.hasCachedMetadata()) {\n                this.logger.verbose(\"No cached metadata for authority\");\n                await AuthorityFactory.saveMetadataFromNetwork(this.authorityInstance, this.telemetryManager, correlationId);\n            } else {\n                this.logger.verbose(\"Cached metadata found for authority\");\n            }\n\n            const correlationIdParam = `client-request-id=${requestCorrelationId}`;\n\n            let postLogoutQueryParam: string;\n            if (this.getPostLogoutRedirectUri()) {\n                postLogoutQueryParam = `&post_logout_redirect_uri=${encodeURIComponent(this.getPostLogoutRedirectUri())}`;\n                this.logger.verbose(\"redirectUri found and set\");\n            } else {\n                postLogoutQueryParam = \"\";\n                this.logger.verbose(\"No redirectUri set for app. postLogoutQueryParam is empty\");\n            }\n\n            let urlNavigate: string;\n            if (this.authorityInstance.EndSessionEndpoint) {\n                urlNavigate = `${this.authorityInstance.EndSessionEndpoint}?${correlationIdParam}${postLogoutQueryParam}`;\n                this.logger.verbose(\"EndSessionEndpoint found and urlNavigate set\");\n                this.logger.verbosePii(`urlNavigate set to: ${this.authorityInstance.EndSessionEndpoint}`);\n            } else {\n                urlNavigate = `${this.authority}oauth2/v2.0/logout?${correlationIdParam}${postLogoutQueryParam}`;\n                this.logger.verbose(\"No endpoint, urlNavigate set to default\");\n            }\n\n            this.telemetryManager.stopAndFlushApiEvent(requestCorrelationId, apiEvent, true);\n\n            this.logger.verbose(\"Navigating window to urlNavigate\");\n            this.navigateWindow(urlNavigate);\n        } catch (error) {\n            this.telemetryManager.stopAndFlushApiEvent(requestCorrelationId, apiEvent, false, error.errorCode);\n        }\n    }\n\n    /**\n     * @hidden\n     * Clear all access tokens and ID tokens in the cache.\n     * @ignore\n     */\n    protected clearCache(): void {\n        this.logger.verbose(\"Clearing cache\");\n        window.renewStates = [];\n        const tokenCacheItems = this.cacheStorage.getAllTokens(Constants.clientId, Constants.homeAccountIdentifier);\n        for (let i = 0; i < tokenCacheItems.length; i++) {\n            this.cacheStorage.removeItem(JSON.stringify(tokenCacheItems[i].key));\n        }\n        this.cacheStorage.resetCacheItems();\n        this.cacheStorage.clearMsalCookie();\n        this.logger.verbose(\"Cache cleared\");\n    }\n\n    /**\n     * @hidden\n     * Clear a given access token from the cache.\n     *\n     * @param accessToken\n     */\n    protected clearCacheForScope(accessToken: string): void {\n        this.logger.verbose(\"Clearing access token from cache\");\n        const accessTokenItems = this.cacheStorage.getAllAccessTokens(Constants.clientId, Constants.homeAccountIdentifier);\n        for (let i = 0; i < accessTokenItems.length; i++) {\n            const token = accessTokenItems[i];\n            if (token.value.accessToken === accessToken) {\n                this.cacheStorage.removeItem(JSON.stringify(token.key));\n                this.logger.verbosePii(`Access token removed: ${token.key}`);\n            }\n        }\n    }\n\n    // #endregion\n\n    // #region Response\n\n    /**\n     * @hidden\n     * @ignore\n     * Checks if the redirect response is received from the STS. In case of redirect, the url fragment has either id_token, access_token or error.\n     * @param {string} hash - Hash passed from redirect page.\n     * @returns {Boolean} - true if response contains id_token, access_token or error, false otherwise.\n     */\n    isCallback(hash: string): boolean {\n        this.logger.info(\"isCallback will be deprecated in favor of urlContainsHash in MSAL.js v2.0.\");\n        this.logger.verbose(\"isCallback has been called\");\n        return UrlUtils.urlContainsHash(hash);\n    }\n\n    /**\n     * @hidden\n     * Used to call the constructor callback with the token/error\n     * @param {string} [hash=window.location.hash] - Hash fragment of Url.\n     */\n    private processCallBack(hash: string, respStateInfo: ResponseStateInfo, parentCallback?: Function): void {\n        this.logger.info(\"ProcessCallBack has been called. Processing callback from redirect response\");\n\n        // get the state info from the hash\n        let stateInfo = respStateInfo;\n        if (!stateInfo) {\n            this.logger.verbose(\"StateInfo is null, getting stateInfo from hash\");\n            stateInfo = this.getResponseState(hash);\n        }\n\n        let response : AuthResponse;\n        let authErr : AuthError;\n        // Save the token info from the hash\n        try {\n            response = this.saveTokenFromHash(hash, stateInfo);\n        } catch (err) {\n            authErr = err;\n        }\n\n        try {\n            // Clear the cookie in the hash\n            this.cacheStorage.clearMsalCookie(stateInfo.state);\n            const accountState: string = this.getAccountState(stateInfo.state);\n            if (response) {\n                if ((stateInfo.requestType === Constants.renewToken) || response.accessToken) {\n                    if (window.parent !== window) {\n                        this.logger.verbose(\"Window is in iframe, acquiring token silently\");\n                    } else {\n                        this.logger.verbose(\"Acquiring token interactive in progress\");\n                    }\n                    this.logger.verbose(`Response tokenType set to ${ServerHashParamKeys.ACCESS_TOKEN}`);\n                    response.tokenType = ServerHashParamKeys.ACCESS_TOKEN;\n                }\n                else if (stateInfo.requestType === Constants.login) {\n                    this.logger.verbose(`Response tokenType set to ${ServerHashParamKeys.ID_TOKEN}`);\n                    response.tokenType = ServerHashParamKeys.ID_TOKEN;\n                }\n                if (!parentCallback) {\n                    this.logger.verbose(\"Setting redirectResponse\");\n                    this.redirectResponse = response;\n                    return;\n                }\n            } else if (!parentCallback) {\n                this.logger.verbose(\"Response is null, setting redirectResponse with state\");\n                this.redirectResponse = buildResponseStateOnly(accountState);\n                this.redirectError = authErr;\n                this.cacheStorage.resetTempCacheItems(stateInfo.state);\n                return;\n            }\n\n            this.logger.verbose(\"Calling callback provided to processCallback\");\n            parentCallback(response, authErr);\n        } catch (err) {\n            this.logger.error(\"Error occurred in token received callback function: \" + err);\n            throw ClientAuthError.createErrorInCallbackFunction(err.toString());\n        }\n    }\n\n    /**\n     * @hidden\n     * This method must be called for processing the response received from the STS if using popups or iframes. It extracts the hash, processes the token or error\n     * information and saves it in the cache. It then resolves the promises with the result.\n     * @param {string} [hash=window.location.hash] - Hash fragment of Url.\n     */\n    private handleAuthenticationResponse(hash: string): void {\n        this.logger.verbose(\"HandleAuthenticationResponse has been called\");\n\n        // retrieve the hash\n        const locationHash = hash || window.location.hash;\n\n        // if (window.parent !== window), by using self, window.parent becomes equal to window in getResponseState method specifically\n        const stateInfo = this.getResponseState(locationHash);\n        this.logger.verbose(\"Obtained state from response\");\n\n        const tokenResponseCallback = window.callbackMappedToRenewStates[stateInfo.state];\n        this.processCallBack(locationHash, stateInfo, tokenResponseCallback);\n    }\n\n    /**\n     * @hidden\n     * This method must be called for processing the response received from the STS when using redirect flows. It extracts the hash, processes the token or error\n     * information and saves it in the cache. The result can then be accessed by user registered callbacks.\n     * @param {string} [hash=window.location.hash] - Hash fragment of Url.\n     */\n    private handleRedirectAuthenticationResponse(hash: string): void {\n        this.logger.info(\"Returned from redirect url\");\n        this.logger.verbose(\"HandleRedirectAuthenticationResponse has been called\");\n\n        // clear hash from window\n        WindowUtils.clearUrlFragment(window);\n        this.logger.verbose(\"Window.location.hash cleared\");\n\n        // if (window.parent !== window), by using self, window.parent becomes equal to window in getResponseState method specifically\n        const stateInfo = this.getResponseState(hash);\n        \n        // if set to navigate to loginRequest page post login\n        if (this.config.auth.navigateToLoginRequestUrl && window.parent === window) {\n            this.logger.verbose(\"Window.parent is equal to window, not in popup or iframe. Navigation to login request url after login turned on\");\n            const loginRequestUrl = this.cacheStorage.getItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.LOGIN_REQUEST, stateInfo.state), this.inCookie);\n\n            // Redirect to home page if login request url is null (real null or the string null)\n            if (!loginRequestUrl || loginRequestUrl === \"null\") {\n                this.logger.error(\"Unable to get valid login request url from cache, redirecting to home page\");\n                window.location.assign(\"/\");\n                return;\n            } else {\n                this.logger.verbose(\"Valid login request url obtained from cache\");\n                const currentUrl = UrlUtils.removeHashFromUrl(window.location.href);\n                const finalRedirectUrl = UrlUtils.removeHashFromUrl(loginRequestUrl);\n                if (currentUrl !== finalRedirectUrl) {\n                    this.logger.verbose(\"Current url is not login request url, navigating\");\n                    this.logger.verbosePii(`CurrentUrl: ${currentUrl}, finalRedirectUrl: ${finalRedirectUrl}`);\n                    window.location.assign(`${finalRedirectUrl}${hash}`);\n                    return;\n                } else {\n                    this.logger.verbose(\"Current url matches login request url\");\n                    const loginRequestUrlComponents = UrlUtils.GetUrlComponents(loginRequestUrl);\n                    if (loginRequestUrlComponents.Hash){\n                        this.logger.verbose(\"Login request url contains hash, resetting non-msal hash\");\n                        window.location.hash = loginRequestUrlComponents.Hash;\n                    }\n                }\n            }\n        } else if (!this.config.auth.navigateToLoginRequestUrl) {\n            this.logger.verbose(\"Default navigation to start page after login turned off\");\n        }\n\n        this.processCallBack(hash, stateInfo, null);\n    }\n\n    /**\n     * @hidden\n     * Creates a stateInfo object from the URL fragment and returns it.\n     * @param {string} hash  -  Hash passed from redirect page\n     * @returns {TokenResponse} an object created from the redirect response from AAD comprising of the keys - parameters, requestType, stateMatch, stateResponse and valid.\n     * @ignore\n     */\n    protected getResponseState(hash: string): ResponseStateInfo {\n        this.logger.verbose(\"GetResponseState has been called\");\n\n        const parameters = UrlUtils.deserializeHash(hash);\n        let stateResponse: ResponseStateInfo;\n        if (!parameters) {\n            throw AuthError.createUnexpectedError(\"Hash was not parsed correctly.\");\n        }\n        if (parameters.hasOwnProperty(ServerHashParamKeys.STATE)) {\n            this.logger.verbose(\"Hash contains state. Creating stateInfo object\");\n            const parsedState = RequestUtils.parseLibraryState(parameters[\"state\"]);\n\n            stateResponse = {\n                requestType: Constants.unknown,\n                state: parameters[\"state\"],\n                timestamp: parsedState.ts,\n                method: parsedState.method,\n                stateMatch: false\n            };\n        } else {\n            throw AuthError.createUnexpectedError(\"Hash does not contain state.\");\n        }\n        /*\n         * async calls can fire iframe and login request at the same time if developer does not use the API as expected\n         * incoming callback needs to be looked up to find the request type\n         */\n\n        // loginRedirect\n        if (stateResponse.state === this.cacheStorage.getItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.STATE_LOGIN, stateResponse.state), this.inCookie) || stateResponse.state === this.silentAuthenticationState) {\n            this.logger.verbose(\"State matches cached state, setting requestType to login\");\n            stateResponse.requestType = Constants.login;\n            stateResponse.stateMatch = true;\n            return stateResponse;\n        }\n        // acquireTokenRedirect\n        else if (stateResponse.state === this.cacheStorage.getItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.STATE_ACQ_TOKEN, stateResponse.state), this.inCookie)) {\n            this.logger.verbose(\"State matches cached state, setting requestType to renewToken\");\n            stateResponse.requestType = Constants.renewToken;\n            stateResponse.stateMatch = true;\n            return stateResponse;\n        }\n\n        // external api requests may have many renewtoken requests for different resource\n        if (!stateResponse.stateMatch) {\n            this.logger.verbose(\"State does not match cached state, setting requestType to type from window\");\n            stateResponse.requestType = window.requestType;\n            const statesInParentContext = window.renewStates;\n            for (let i = 0; i < statesInParentContext.length; i++) {\n                if (statesInParentContext[i] === stateResponse.state) {\n                    this.logger.verbose(\"Matching state found for request\");\n                    stateResponse.stateMatch = true;\n                    break;\n                }\n            }\n            if (!stateResponse.stateMatch) {\n                this.logger.verbose(\"Matching state not found for request\");\n            }\n        }\n\n        return stateResponse;\n    }\n\n    // #endregion\n\n    // #region Token Processing (Extract to TokenProcessing.ts)\n\n    /**\n     * @hidden\n     * Used to get token for the specified set of scopes from the cache\n     * @param {@link ServerRequestParameters} - Request sent to the STS to obtain an id_token/access_token\n     * @param {Account} account - Account for which the scopes were requested\n     */\n    private getCachedToken(serverAuthenticationRequest: ServerRequestParameters, account: Account): AuthResponse {\n        this.logger.verbose(\"GetCachedToken has been called\");\n        const scopes = serverAuthenticationRequest.scopes;\n\n        /**\n         * Id Token should be returned in every acquireTokenSilent call. The only exception is a response_type = token\n         * request when a valid ID Token is not present in the cache.\n         */\n        const idToken = this.getCachedIdToken(serverAuthenticationRequest, account);\n        const authResponse = this.getCachedAccessToken(serverAuthenticationRequest, account, scopes);\n        const accountState = this.getAccountState(serverAuthenticationRequest.state);\n        return ResponseUtils.buildAuthResponse(idToken, authResponse, serverAuthenticationRequest, account, scopes, accountState);\n    }\n\n    /**\n     * @hidden\n     * \n     * Uses passed in authority to further filter an array of tokenCacheItems until only the token being searched for remains, then returns that tokenCacheItem.\n     * This method will throw if authority filtering still yields multiple matching tokens and will return null if not tokens match the authority passed in.\n     * \n     * @param authority \n     * @param tokenCacheItems \n     * @param request \n     * @param requestScopes \n     * @param tokenType \n     */\n    private getTokenCacheItemByAuthority(authority: string, tokenCacheItems: Array<AccessTokenCacheItem>, requestScopes: Array<string>, tokenType: string): AccessTokenCacheItem {\n        let filteredAuthorityItems: Array<AccessTokenCacheItem>;\n    \n        if (UrlUtils.isCommonAuthority(authority) || UrlUtils.isOrganizationsAuthority(authority) || UrlUtils.isConsumersAuthority(authority)) {\n            filteredAuthorityItems = AuthCacheUtils.filterTokenCacheItemsByDomain(tokenCacheItems, UrlUtils.GetUrlComponents(authority).HostNameAndPort);\n        } else {\n            filteredAuthorityItems = AuthCacheUtils.filterTokenCacheItemsByAuthority(tokenCacheItems, authority);\n        }\n        if (filteredAuthorityItems.length === 1) {\n            return filteredAuthorityItems[0];\n        }\n        else if (filteredAuthorityItems.length > 1) {\n            this.logger.warning(\"Multiple matching tokens found. Cleaning cache and requesting a new token.\");\n            filteredAuthorityItems.forEach((accessTokenCacheItem) => {\n                this.cacheStorage.removeItem(JSON.stringify(accessTokenCacheItem.key));\n            });\n            return null;\n        }\n        else {\n            this.logger.verbose(`No matching tokens of type ${tokenType} found`);\n            return null;\n        }  \n    }\n\n    /**\n     * \n     * @hidden\n     * \n     * Searches the token cache for an ID Token that matches the request parameter and returns it as an IdToken object.\n     * \n     * @param serverAuthenticationRequest \n     * @param account \n     */\n    private getCachedIdToken(serverAuthenticationRequest: ServerRequestParameters, account: Account): IdToken {\n        this.logger.verbose(\"Getting all cached tokens of type ID Token\");\n        const idTokenCacheItems = this.cacheStorage.getAllIdTokens(this.clientId, account ? account.homeAccountIdentifier : null);\n        const matchAuthority = serverAuthenticationRequest.authority || this.authority;\n        const idTokenCacheItem = this.getTokenCacheItemByAuthority(matchAuthority, idTokenCacheItems, null, ServerHashParamKeys.ID_TOKEN);\n        \n        if (idTokenCacheItem) {\n            this.logger.verbose(\"Evaluating ID token found\");\n            const idTokenIsStillValid = this.evaluateTokenExpiration(idTokenCacheItem);\n\n            if (idTokenIsStillValid) {\n                this.logger.verbose(\"ID token expiration is within offset, using ID token found in cache\");\n                const idTokenValue = idTokenCacheItem.value;\n                if (idTokenValue) {\n                    this.logger.verbose(\"ID Token found in cache is valid and unexpired\");\n                } else {\n                    this.logger.verbose(\"ID Token found in cache is invalid\");\n                }\n        \n                return (idTokenValue) ? new IdToken(idTokenValue.idToken) : null;\n            } else {\n                this.logger.verbose(\"Cached ID token is expired, removing from cache\");\n                this.cacheStorage.removeItem(JSON.stringify(idTokenCacheItem.key));\n                return null;\n            }\n        } else {\n            this.logger.verbose(\"No tokens found\");\n            return null;\n        }\n    }\n\n    /**\n     * \n     * @hidden\n     * \n     * Searches the token cache for an access token that matches the request parameters and returns it as an AuthResponse.\n     * \n     * @param serverAuthenticationRequest \n     * @param account \n     * @param scopes \n     */\n    private getCachedAccessToken(serverAuthenticationRequest: ServerRequestParameters, account: Account, scopes: string[]): AuthResponse {\n        this.logger.verbose(\"Getting all cached tokens of type Access Token\");\n        const tokenCacheItems = this.cacheStorage.getAllAccessTokens(this.clientId, account ? account.homeAccountIdentifier : null);\n        \n        const scopeFilteredTokenCacheItems = AuthCacheUtils.filterTokenCacheItemsByScope(tokenCacheItems, scopes);\n        const matchAuthority = serverAuthenticationRequest.authority || this.authority;\n        // serverAuthenticationRequest.authority can only be common or organizations if not null\n        const accessTokenCacheItem = this.getTokenCacheItemByAuthority(matchAuthority, scopeFilteredTokenCacheItems, scopes, ServerHashParamKeys.ACCESS_TOKEN);\n        \n        if (!accessTokenCacheItem) {\n            this.logger.verbose(\"No matching token found when filtering by scope and authority\");\n            return null;\n        } else {\n            serverAuthenticationRequest.authorityInstance = AuthorityFactory.CreateInstance(accessTokenCacheItem.key.authority, this.config.auth.validateAuthority);\n            this.logger.verbose(\"Evaluating access token found\");\n            const tokenIsStillValid = this.evaluateTokenExpiration(accessTokenCacheItem);\n            // The response value will stay null if token retrieved from the cache is expired, otherwise it will be populated with said token's data\n            \n            if (tokenIsStillValid) {\n                this.logger.verbose(\"Access token expiration is within offset, using access token found in cache\");\n                const responseAccount: Account = account || this.getAccount();\n                if (!responseAccount) {\n                    throw AuthError.createUnexpectedError(\"Account should not be null here.\");\n                }\n\n                const aState = this.getAccountState(serverAuthenticationRequest.state);\n                const response: AuthResponse = {\n                    uniqueId: \"\",\n                    tenantId: \"\",\n                    tokenType: ServerHashParamKeys.ACCESS_TOKEN,\n                    idToken: null,\n                    idTokenClaims: null,\n                    accessToken: accessTokenCacheItem.value.accessToken,\n                    scopes: accessTokenCacheItem.key.scopes.split(\" \"),\n                    expiresOn: new Date(Number(accessTokenCacheItem.value.expiresIn) * 1000),\n                    account: responseAccount,\n                    accountState: aState,\n                    fromCache: true\n                };   \n                \n                return response;\n            } else {\n                this.logger.verbose(\"Access token expired, removing from cache\");\n                this.cacheStorage.removeItem(JSON.stringify(accessTokenCacheItem.key));\n                return null;\n            }\n        }\n    }\n\n    /**\n     * Returns true if the token passed in is within the acceptable expiration time offset, false if it is expired.\n     * @param tokenCacheItem \n     * @param serverAuthenticationRequest \n     */\n    private evaluateTokenExpiration(tokenCacheItem: AccessTokenCacheItem): Boolean {\n        const expiration = Number(tokenCacheItem.value.expiresIn);\n        return TokenUtils.validateExpirationIsWithinOffset(expiration, this.config.system.tokenRenewalOffsetSeconds);\n    }\n\n    /**\n     * @hidden\n     * Check if ADAL id_token exists and return if exists.\n     *\n     */\n    private extractADALIdToken(): object {\n        this.logger.verbose(\"ExtractADALIdToken has been called\");\n        const adalIdToken = this.cacheStorage.getItem(Constants.adalIdToken);\n        return (!StringUtils.isEmpty(adalIdToken)) ? TokenUtils.extractIdToken(adalIdToken) : null;\n    }\n\n    /**\n     * @hidden\n     * Acquires access token using a hidden iframe.\n     * @ignore\n     */\n    private renewToken(requestSignature: string, resolve: Function, reject: Function, account: Account, serverAuthenticationRequest: ServerRequestParameters): void {\n        this.logger.verbose(\"RenewToken has been called\");\n        this.logger.verbosePii(`RenewToken scope and authority: ${requestSignature}`);\n\n        const frameName = WindowUtils.generateFrameName(FramePrefix.TOKEN_FRAME, requestSignature);\n        WindowUtils.addHiddenIFrame(frameName, this.logger);\n\n        this.updateCacheEntries(serverAuthenticationRequest, account, false);\n        this.logger.verbosePii(`RenewToken expected state: ${serverAuthenticationRequest.state}`);\n\n        // Build urlNavigate with \"prompt=none\" and navigate to URL in hidden iFrame\n        const urlNavigate = UrlUtils.urlRemoveQueryStringParameter(UrlUtils.createNavigateUrl(serverAuthenticationRequest), Constants.prompt) + Constants.prompt_none + Constants.response_mode_fragment;\n\n        window.renewStates.push(serverAuthenticationRequest.state);\n        window.requestType = Constants.renewToken;\n        this.logger.verbose(\"Set window.renewState and requestType\");\n        this.registerCallback(serverAuthenticationRequest.state, requestSignature, resolve, reject);\n        this.logger.infoPii(`Navigate to: ${urlNavigate}`);\n        this.loadIframeTimeout(urlNavigate, frameName, requestSignature).catch(error => reject(error));\n    }\n\n    /**\n     * @hidden\n     * Renews idtoken for app's own backend when clientId is passed as a single scope in the scopes array.\n     * @ignore\n     */\n    private renewIdToken(requestSignature: string, resolve: Function, reject: Function, account: Account, serverAuthenticationRequest: ServerRequestParameters): void {\n        this.logger.info(\"RenewIdToken has been called\");\n\n        const frameName = WindowUtils.generateFrameName(FramePrefix.ID_TOKEN_FRAME, requestSignature);\n        WindowUtils.addHiddenIFrame(frameName, this.logger);\n\n        this.updateCacheEntries(serverAuthenticationRequest, account, false);\n\n        this.logger.verbose(`RenewIdToken expected state: ${serverAuthenticationRequest.state}`);\n\n        // Build urlNavigate with \"prompt=none\" and navigate to URL in hidden iFrame\n        const urlNavigate = UrlUtils.urlRemoveQueryStringParameter(UrlUtils.createNavigateUrl(serverAuthenticationRequest), Constants.prompt) + Constants.prompt_none + Constants.response_mode_fragment;\n\n        if (this.silentLogin) {\n            this.logger.verbose(\"Silent login is true, set silentAuthenticationState\");\n            window.requestType = Constants.login;\n            this.silentAuthenticationState = serverAuthenticationRequest.state;\n        } else {\n            this.logger.verbose(\"Not silent login, set window.renewState and requestType\");\n            window.requestType = Constants.renewToken;\n            window.renewStates.push(serverAuthenticationRequest.state);\n        }\n\n        // note: scope here is clientId\n        this.registerCallback(serverAuthenticationRequest.state, requestSignature, resolve, reject);\n        this.logger.infoPii(`Navigate to:\" ${urlNavigate}`);\n        this.loadIframeTimeout(urlNavigate, frameName, requestSignature).catch(error => reject(error));\n    }\n\n    /**\n     * @hidden\n     * \n     * This method builds an Access Token Cache item and saves it to the cache, returning the original\n     * AuthResponse augmented with a parsed expiresOn attribute.\n     * \n     * @param response The AuthResponse object that contains the token to be saved\n     * @param authority The authority under which the ID token will be cached\n     * @param scopes The scopes to be added to the cache item key (undefined for ID token cache items)\n     * @param clientInfo Client Info object that is used to generate the homeAccountIdentifier\n     * @param expiration Token expiration timestamp\n     */\n    private saveToken(response: AuthResponse, authority: string, scopes: string, clientInfo: ClientInfo, expiration: number): AuthResponse {\n        const accessTokenKey = new AccessTokenKey(authority, this.clientId, scopes, clientInfo.uid, clientInfo.utid);\n        const accessTokenValue = new AccessTokenValue(response.accessToken, response.idToken.rawIdToken, expiration.toString(), clientInfo.encodeClientInfo());\n        this.cacheStorage.setItem(JSON.stringify(accessTokenKey), JSON.stringify(accessTokenValue));\n\n        if (expiration) {\n            this.logger.verbose(\"New expiration set for token\");\n            response.expiresOn = new Date(expiration * 1000);\n        } else {\n            this.logger.error(\"Could not parse expiresIn parameter for access token\");\n        }\n\n        return response;\n    }\n\n    /**\n     * @hidden\n     * \n     * This method sets up the elements of an ID Token cache item and calls saveToken to save it in\n     * Access Token Cache item format for the client application to use.\n     * \n     * @param response The AuthResponse object that will be used to build the cache item\n     * @param authority The authority under which the ID token will be cached\n     * @param parameters The response's Hash Params, which contain the ID token returned from the server\n     * @param clientInfo Client Info object that is used to generate the homeAccountIdentifier\n     * @param idTokenObj ID Token object from which the ID token's expiration is extracted\n     */\n    /* tslint:disable:no-string-literal */\n    private saveIdToken(response: AuthResponse, authority: string, parameters: object, clientInfo: ClientInfo, idTokenObj: IdToken): AuthResponse {\n        this.logger.verbose(\"SaveIdToken has been called\");\n        const idTokenResponse = { ...response };\n\n        // Scopes are undefined so they don't show up in ID token cache key\n        let scopes: string;\n\n        idTokenResponse.scopes = Constants.oidcScopes;\n        idTokenResponse.accessToken = parameters[ServerHashParamKeys.ID_TOKEN];\n\n        const expiration = Number(idTokenObj.expiration);\n\n        // Set ID Token item in cache\n        this.logger.verbose(\"Saving ID token to cache\");\n        return this.saveToken(idTokenResponse, authority, scopes, clientInfo, expiration);\n    }\n\n    /**\n     * @hidden\n     * \n     * This method sets up the elements of an Access Token cache item and calls saveToken to save it to the cache\n     * \n     * @param response The AuthResponse object that will be used to build the cache item\n     * @param authority The authority under which the access token will be cached\n     * @param parameters The response's Hash Params, which contain the access token returned from the server\n     * @param clientInfo Client Info object that is used to generate the homeAccountIdentifier\n     */\n    /* tslint:disable:no-string-literal */\n    private saveAccessToken(response: AuthResponse, authority: string, parameters: object, clientInfo: ClientInfo): AuthResponse {\n        this.logger.verbose(\"SaveAccessToken has been called\");\n        const accessTokenResponse = { ...response };\n\n        // read the scopes\n        const scope = parameters[ServerHashParamKeys.SCOPE];\n        const consentedScopes = scope.split(\" \");\n\n        // retrieve all access tokens from the cache, remove the dup scopes\n        const accessTokenCacheItems = this.cacheStorage.getAllAccessTokens(this.clientId, authority);\n        this.logger.verbose(\"Retrieving all access tokens from cache and removing duplicates\");\n\n        for (let i = 0; i < accessTokenCacheItems.length; i++) {\n            const accessTokenCacheItem = accessTokenCacheItems[i];\n\n            if (accessTokenCacheItem.key.homeAccountIdentifier === response.account.homeAccountIdentifier) {\n                const cachedScopes = accessTokenCacheItem.key.scopes.split(\" \");\n                if (ScopeSet.isIntersectingScopes(cachedScopes, consentedScopes)) {\n                    this.cacheStorage.removeItem(JSON.stringify(accessTokenCacheItem.key));\n                }\n            }\n        }\n\n        accessTokenResponse.accessToken  = parameters[ServerHashParamKeys.ACCESS_TOKEN];\n        accessTokenResponse.scopes = consentedScopes;\n\n        const expiresIn = TimeUtils.parseExpiresIn(parameters[ServerHashParamKeys.EXPIRES_IN]);\n        const parsedState = RequestUtils.parseLibraryState(parameters[ServerHashParamKeys.STATE]);\n        const expiration = parsedState.ts + expiresIn;\n\n        this.logger.verbose(\"Saving access token to cache\");\n        return this.saveToken(accessTokenResponse, authority, scope, clientInfo, expiration);\n    }\n\n    /**\n     * @hidden\n     * Saves token or error received in the response from AAD in the cache. In case of id_token, it also creates the account object.\n     * @ignore\n     */\n    protected saveTokenFromHash(hash: string, stateInfo: ResponseStateInfo): AuthResponse {\n        this.logger.verbose(\"SaveTokenFromHash has been called\");\n        this.logger.info(`State status: ${stateInfo.stateMatch}; Request type: ${stateInfo.requestType}`);\n\n        let response : AuthResponse = {\n            uniqueId: \"\",\n            tenantId: \"\",\n            tokenType: \"\",\n            idToken: null,\n            idTokenClaims: null,\n            accessToken: null,\n            scopes: [],\n            expiresOn: null,\n            account: null,\n            accountState: \"\",\n            fromCache: false\n        };\n\n        let error: AuthError;\n        const hashParams = UrlUtils.deserializeHash(hash);\n        let authorityKey: string = \"\";\n        let acquireTokenAccountKey: string = \"\";\n        let idTokenObj: IdToken = null;\n\n        // If server returns an error\n        if (hashParams.hasOwnProperty(ServerHashParamKeys.ERROR_DESCRIPTION) || hashParams.hasOwnProperty(ServerHashParamKeys.ERROR)) {\n            this.logger.verbose(\"Server returned an error\");\n            this.logger.infoPii(`Error : ${hashParams[ServerHashParamKeys.ERROR]}; Error description: ${hashParams[ServerHashParamKeys.ERROR_DESCRIPTION]}`);\n            this.cacheStorage.setItem(ErrorCacheKeys.ERROR, hashParams[ServerHashParamKeys.ERROR]);\n            this.cacheStorage.setItem(ErrorCacheKeys.ERROR_DESC, hashParams[ServerHashParamKeys.ERROR_DESCRIPTION]);\n\n            // login\n            if (stateInfo.requestType === Constants.login) {\n                this.logger.verbose(\"RequestType is login, caching login error, generating authorityKey\");\n                this.cacheStorage.setItem(ErrorCacheKeys.LOGIN_ERROR, hashParams[ServerHashParamKeys.ERROR_DESCRIPTION] + \":\" + hashParams[ServerHashParamKeys.ERROR]);\n                authorityKey = AuthCache.generateAuthorityKey(stateInfo.state);\n            }\n\n            // acquireToken\n            if (stateInfo.requestType === Constants.renewToken) {\n                this.logger.verbose(\"RequestType is renewToken, generating acquireTokenAccountKey\");\n                authorityKey = AuthCache.generateAuthorityKey(stateInfo.state);\n\n                const account: Account = this.getAccount();\n                let accountId;\n\n                if (account && !StringUtils.isEmpty(account.homeAccountIdentifier)) {\n                    accountId = account.homeAccountIdentifier;\n                    this.logger.verbose(\"AccountId is set\");\n                }\n                else {\n                    accountId = Constants.no_account;\n                    this.logger.verbose(\"AccountId is set as no_account\");\n                }\n\n                acquireTokenAccountKey = AuthCache.generateAcquireTokenAccountKey(accountId, stateInfo.state);\n            }\n\n            const hashErr = hashParams[ServerHashParamKeys.ERROR];\n            const hashErrDesc = hashParams[ServerHashParamKeys.ERROR_DESCRIPTION];\n            if (InteractionRequiredAuthError.isInteractionRequiredError(hashErr) ||\n        InteractionRequiredAuthError.isInteractionRequiredError(hashErrDesc)) {\n                error = new InteractionRequiredAuthError(hashParams[ServerHashParamKeys.ERROR], hashParams[ServerHashParamKeys.ERROR_DESCRIPTION]);\n            } else {\n                error = new ServerError(hashParams[ServerHashParamKeys.ERROR], hashParams[ServerHashParamKeys.ERROR_DESCRIPTION]);\n            }\n        }\n        // If the server returns \"Success\"\n        else {\n            this.logger.verbose(\"Server returns success\");\n            // Verify the state from redirect and record tokens to storage if exists\n            if (stateInfo.stateMatch) {\n                this.logger.info(\"State is right\");\n                if (hashParams.hasOwnProperty(ServerHashParamKeys.SESSION_STATE)) {\n                    this.logger.verbose(\"Fragment has session state, caching\");\n                    this.cacheStorage.setItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.SESSION_STATE, stateInfo.state), hashParams[ServerHashParamKeys.SESSION_STATE]);\n                }\n                response.accountState = this.getAccountState(stateInfo.state);\n\n                let clientInfo: ClientInfo;\n\n                // Process access_token\n                if (hashParams.hasOwnProperty(ServerHashParamKeys.ACCESS_TOKEN)) {\n                    this.logger.info(\"Fragment has access token\");\n                    response.accessToken = hashParams[ServerHashParamKeys.ACCESS_TOKEN];\n\n                    if (hashParams.hasOwnProperty(ServerHashParamKeys.SCOPE)) {\n                        response.scopes = hashParams[ServerHashParamKeys.SCOPE].split(\" \");\n                    }\n\n                    // retrieve the id_token from response if present\n                    if (hashParams.hasOwnProperty(ServerHashParamKeys.ID_TOKEN)) {\n                        this.logger.verbose(\"Fragment has id_token\");\n                        idTokenObj = new IdToken(hashParams[ServerHashParamKeys.ID_TOKEN]);\n                    } else {\n                        this.logger.verbose(\"No idToken on fragment, getting idToken from cache\");\n                        idTokenObj = new IdToken(this.cacheStorage.getItem(PersistentCacheKeys.IDTOKEN));\n                    }\n\n                    response = ResponseUtils.setResponseIdToken(response, idTokenObj);\n\n                    // set authority\n                    const authority: string = this.populateAuthority(stateInfo.state, this.inCookie, this.cacheStorage, idTokenObj);\n                    this.logger.verbose(\"Got authority from cache\");\n\n                    // retrieve client_info - if it is not found, generate the uid and utid from idToken\n                    if (hashParams.hasOwnProperty(ServerHashParamKeys.CLIENT_INFO)) {\n                        this.logger.verbose(\"Fragment has clientInfo\");\n                        clientInfo = new ClientInfo(hashParams[ServerHashParamKeys.CLIENT_INFO], authority);\n                    } else if (this.authorityInstance.AuthorityType === AuthorityType.Adfs) {\n                        clientInfo = ClientInfo.createClientInfoFromIdToken(idTokenObj, authority);\n                    } else {\n                        this.logger.warning(\"ClientInfo not received in the response from AAD\");\n                    }\n\n                    response.account = Account.createAccount(idTokenObj, clientInfo);\n                    this.logger.verbose(\"Account object created from response\");\n\n                    let accountKey: string;\n                    if (response.account && !StringUtils.isEmpty(response.account.homeAccountIdentifier)) {\n                        this.logger.verbose(\"AccountKey set\");\n                        accountKey = response.account.homeAccountIdentifier;\n                    }\n                    else {\n                        this.logger.verbose(\"AccountKey set as no_account\");\n                        accountKey = Constants.no_account;\n                    }\n\n                    acquireTokenAccountKey = AuthCache.generateAcquireTokenAccountKey(accountKey, stateInfo.state);\n                    const acquireTokenAccountKey_noaccount = AuthCache.generateAcquireTokenAccountKey(Constants.no_account, stateInfo.state);\n                    this.logger.verbose(\"AcquireTokenAccountKey generated\");\n\n                    const cachedAccount: string = this.cacheStorage.getItem(acquireTokenAccountKey);\n                    let acquireTokenAccount: Account;\n\n                    // Check with the account in the Cache\n                    if (!StringUtils.isEmpty(cachedAccount)) {\n                        acquireTokenAccount = JSON.parse(cachedAccount);\n                        this.logger.verbose(\"AcquireToken request account retrieved from cache\");\n                        if (response.account && acquireTokenAccount && Account.compareAccounts(response.account, acquireTokenAccount)) {\n                            response = this.saveAccessToken(response, authority, hashParams, clientInfo);\n                            this.logger.info(\"The user object received in the response is the same as the one passed in the acquireToken request\");\n                        }\n                        else {\n                            this.logger.warning(\n                                \"The account object created from the response is not the same as the one passed in the acquireToken request\");\n                        }\n                    }\n                    else if (!StringUtils.isEmpty(this.cacheStorage.getItem(acquireTokenAccountKey_noaccount))) {\n                        this.logger.verbose(\"No acquireToken account retrieved from cache\");\n                        response = this.saveAccessToken(response, authority, hashParams, clientInfo);\n                    }\n                }\n\n                // Process id_token\n                if (hashParams.hasOwnProperty(ServerHashParamKeys.ID_TOKEN)) {\n                    this.logger.info(\"Fragment has idToken\");\n\n                    // set the idToken\n                    idTokenObj = new IdToken(hashParams[ServerHashParamKeys.ID_TOKEN]);\n\n                    // set authority\n                    const authority: string = this.populateAuthority(stateInfo.state, this.inCookie, this.cacheStorage, idTokenObj);\n\n                    response = ResponseUtils.setResponseIdToken(response, idTokenObj);\n                    if (hashParams.hasOwnProperty(ServerHashParamKeys.CLIENT_INFO)) {\n                        this.logger.verbose(\"Fragment has clientInfo\");\n                        clientInfo = new ClientInfo(hashParams[ServerHashParamKeys.CLIENT_INFO], authority);\n                    } else if (this.authorityInstance.AuthorityType === AuthorityType.Adfs) {\n                        clientInfo = ClientInfo.createClientInfoFromIdToken(idTokenObj, authority);\n                    } else {\n                        this.logger.warning(\"ClientInfo not received in the response from AAD\");\n                    }\n\n                    this.account = Account.createAccount(idTokenObj, clientInfo);\n                    response.account = this.account;\n                    this.logger.verbose(\"Account object created from response\");\n\n                    if (idTokenObj && idTokenObj.nonce) {\n                        this.logger.verbose(\"IdToken has nonce\");\n                        // check nonce integrity if idToken has nonce - throw an error if not matched\n                        const cachedNonce = this.cacheStorage.getItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.NONCE_IDTOKEN, stateInfo.state), this.inCookie);\n                        if (idTokenObj.nonce !== cachedNonce) {\n                            this.account = null;\n                            this.cacheStorage.setItem(ErrorCacheKeys.LOGIN_ERROR, \"Nonce Mismatch. Expected Nonce: \" + cachedNonce + \",\" + \"Actual Nonce: \" + idTokenObj.nonce);\n                            this.logger.error(`Nonce Mismatch. Expected Nonce: ${cachedNonce}, Actual Nonce: ${idTokenObj.nonce}`);\n                            error = ClientAuthError.createNonceMismatchError(cachedNonce, idTokenObj.nonce);\n                        }\n                        // Save the token\n                        else {\n                            this.logger.verbose(\"Nonce matches, saving idToken to cache\");\n                            this.cacheStorage.setItem(PersistentCacheKeys.IDTOKEN, hashParams[ServerHashParamKeys.ID_TOKEN], this.inCookie);\n                            this.cacheStorage.setItem(PersistentCacheKeys.CLIENT_INFO, clientInfo.encodeClientInfo(), this.inCookie);\n\n                            // Save idToken as access token item for app itself\n                            this.saveIdToken(response, authority, hashParams, clientInfo, idTokenObj);\n                        }\n                    } else {\n                        this.logger.verbose(\"No idToken or no nonce. Cache key for Authority set as state\");\n                        authorityKey = stateInfo.state;\n                        acquireTokenAccountKey = stateInfo.state;\n\n                        this.logger.error(\"Invalid id_token received in the response\");\n                        error = ClientAuthError.createInvalidIdTokenError(idTokenObj);\n                        this.cacheStorage.setItem(ErrorCacheKeys.ERROR, error.errorCode);\n                        this.cacheStorage.setItem(ErrorCacheKeys.ERROR_DESC, error.errorMessage);\n                    }\n                }\n            }\n            // State mismatch - unexpected/invalid state\n            else {\n                this.logger.verbose(\"State mismatch\");\n                authorityKey = stateInfo.state;\n                acquireTokenAccountKey = stateInfo.state;\n\n                const expectedState = this.cacheStorage.getItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.STATE_LOGIN, stateInfo.state), this.inCookie);\n                this.logger.error(`State Mismatch. Expected State: ${expectedState}, Actual State: ${stateInfo.state}`);\n                error = ClientAuthError.createInvalidStateError(stateInfo.state, expectedState);\n                this.cacheStorage.setItem(ErrorCacheKeys.ERROR, error.errorCode);\n                this.cacheStorage.setItem(ErrorCacheKeys.ERROR_DESC, error.errorMessage);\n            }\n        }\n\n        // Set status to completed\n        this.cacheStorage.removeItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.RENEW_STATUS, stateInfo.state));\n        this.cacheStorage.resetTempCacheItems(stateInfo.state);\n        this.logger.verbose(\"Status set to complete, temporary cache cleared\");\n\n        // this is required if navigateToLoginRequestUrl=false\n        if (this.inCookie) {\n            this.logger.verbose(\"InCookie is true, setting authorityKey in cookie\");\n            this.cacheStorage.setItemCookie(authorityKey, \"\", -1);\n            this.cacheStorage.clearMsalCookie(stateInfo.state);\n        }\n        if (error) {\n            // Error case, set status to cancelled\n            throw error;\n        }\n\n        if (!response) {\n            throw AuthError.createUnexpectedError(\"Response is null\");\n        }\n\n        return response;\n    }\n\n    /**\n     * Set Authority when saving Token from the hash\n     * @param state\n     * @param inCookie\n     * @param cacheStorage\n     * @param idTokenObj\n     * @param response\n     */\n    private populateAuthority(state: string, inCookie: boolean, cacheStorage: AuthCache, idTokenObj: IdToken): string {\n        this.logger.verbose(\"PopulateAuthority has been called\");\n        const authorityKey: string = AuthCache.generateAuthorityKey(state);\n        const cachedAuthority: string = cacheStorage.getItem(authorityKey, inCookie);\n\n        // retrieve the authority from cache and replace with tenantID\n        return StringUtils.isEmpty(cachedAuthority) ? cachedAuthority : UrlUtils.replaceTenantPath(cachedAuthority, idTokenObj.tenantId);\n    }\n\n    /* tslint:enable:no-string-literal */\n\n    // #endregion\n\n    // #region Account\n\n    /**\n     * Returns the signed in account\n     * (the account object is created at the time of successful login)\n     * or null when no state is found\n     * @returns {@link Account} - the account object stored in MSAL\n     */\n    getAccount(): Account {\n        // if a session already exists, get the account from the session\n        if (this.account) {\n            return this.account;\n        }\n\n        // frame is used to get idToken and populate the account for the given session\n        const rawIdToken = this.cacheStorage.getItem(PersistentCacheKeys.IDTOKEN, this.inCookie);\n        const rawClientInfo = this.cacheStorage.getItem(PersistentCacheKeys.CLIENT_INFO, this.inCookie);\n\n        if (!StringUtils.isEmpty(rawIdToken) && !StringUtils.isEmpty(rawClientInfo)) {\n            const idToken = new IdToken(rawIdToken);\n            const clientInfo = new ClientInfo(rawClientInfo, \"\");\n            this.account = Account.createAccount(idToken, clientInfo);\n            return this.account;\n        }\n        // if login not yet done, return null\n        return null;\n    }\n\n    /**\n     * @hidden\n     *\n     * Extracts state value from the accountState sent with the authentication request.\n     * @returns {string} scope.\n     * @ignore\n     */\n    getAccountState (state: string): string {\n        if (state) {\n            const splitIndex = state.indexOf(Constants.resourceDelimiter);\n            if (splitIndex > -1 && splitIndex + 1 < state.length) {\n                return state.substring(splitIndex + 1);\n            }\n        }\n        return state;\n    }\n\n    /**\n     * Use to get a list of unique accounts in MSAL cache based on homeAccountIdentifier.\n     *\n     * @param {@link Array<Account>} Account - all unique accounts in MSAL cache.\n     */\n    getAllAccounts(): Array<Account> {\n        const accounts: Array<Account> = [];\n        const accessTokenCacheItems = this.cacheStorage.getAllAccessTokens(Constants.clientId, Constants.homeAccountIdentifier);\n\n        for (let i = 0; i < accessTokenCacheItems.length; i++) {\n            const idToken = new IdToken(accessTokenCacheItems[i].value.idToken);\n            const clientInfo = new ClientInfo(accessTokenCacheItems[i].value.homeAccountIdentifier, \"\");\n            const account: Account = Account.createAccount(idToken, clientInfo);\n            accounts.push(account);\n        }\n\n        return this.getUniqueAccounts(accounts);\n    }\n\n    /**\n     * @hidden\n     *\n     * Used to filter accounts based on homeAccountIdentifier\n     * @param {Array<Account>}  Accounts - accounts saved in the cache\n     * @ignore\n     */\n    private getUniqueAccounts(accounts: Array<Account>): Array<Account> {\n        if (!accounts || accounts.length <= 1) {\n            return accounts;\n        }\n\n        const flags: Array<string> = [];\n        const uniqueAccounts: Array<Account> = [];\n        for (let index = 0; index < accounts.length; ++index) {\n            if (accounts[index].homeAccountIdentifier && flags.indexOf(accounts[index].homeAccountIdentifier) === -1) {\n                flags.push(accounts[index].homeAccountIdentifier);\n                uniqueAccounts.push(accounts[index]);\n            }\n        }\n\n        return uniqueAccounts;\n    }\n\n    // #endregion\n\n    // #region Angular\n\n    /**\n     * @hidden\n     *\n     * Broadcast messages - Used only for Angular?  *\n     * @param eventName\n     * @param data\n     */\n    private broadcast(eventName: string, data: string) {\n        const evt = new CustomEvent(eventName, { detail: data });\n        window.dispatchEvent(evt);\n    }\n\n    /**\n     * @hidden\n     *\n     * Helper function to retrieve the cached token\n     *\n     * @param scopes\n     * @param {@link Account} account\n     * @param state\n     * @return {@link AuthResponse} AuthResponse\n     */\n    protected getCachedTokenInternal(scopes : Array<string> , account: Account, state: string, correlationId?: string): AuthResponse {\n        // Get the current session's account object\n        const accountObject: Account = account || this.getAccount();\n        if (!accountObject) {\n            return null;\n        }\n\n        // Construct AuthenticationRequest based on response type; set \"redirectUri\" from the \"request\" which makes this call from Angular - for this.getRedirectUri()\n        const newAuthority = this.authorityInstance ? this.authorityInstance : AuthorityFactory.CreateInstance(this.authority, this.config.auth.validateAuthority);\n        const responseType = this.getTokenType(accountObject, scopes);\n\n        const serverAuthenticationRequest = new ServerRequestParameters(\n            newAuthority,\n            this.clientId,\n            responseType,\n            this.getRedirectUri(),\n            scopes,\n            state,\n            correlationId\n        );\n\n        // get cached token\n        return this.getCachedToken(serverAuthenticationRequest, account);\n    }\n\n    /**\n     * @hidden\n     *\n     * Get scopes for the Endpoint - Used in Angular to track protected and unprotected resources without interaction from the developer app\n     * Note: Please check if we need to set the \"redirectUri\" from the \"request\" which makes this call from Angular - for this.getRedirectUri()\n     *\n     * @param endpoint\n     */\n    protected getScopesForEndpoint(endpoint: string) : Array<string> {\n        // if user specified list of unprotectedResources, no need to send token to these endpoints, return null.\n        if (this.config.framework.unprotectedResources.length > 0) {\n            for (let i = 0; i < this.config.framework.unprotectedResources.length; i++) {\n                if (endpoint.indexOf(this.config.framework.unprotectedResources[i]) > -1) {\n                    return null;\n                }\n            }\n        }\n\n        // process all protected resources and send the matched one\n        if (this.config.framework.protectedResourceMap.size > 0) {\n            for (const key of Array.from(this.config.framework.protectedResourceMap.keys())) {\n                // configEndpoint is like /api/Todo requested endpoint can be /api/Todo/1\n                if (endpoint.indexOf(key) > -1) {\n                    return this.config.framework.protectedResourceMap.get(key);\n                }\n            }\n        }\n\n        /*\n         * default resource will be clientid if nothing specified\n         * App will use idtoken for calls to itself\n         * check if it's staring from http or https, needs to match with app host\n         */\n        if (endpoint.indexOf(\"http://\") > -1 || endpoint.indexOf(\"https://\") > -1) {\n            if (UrlUtils.getHostFromUri(endpoint) === UrlUtils.getHostFromUri(this.getRedirectUri())) {\n                return new Array<string>(this.clientId);\n            }\n        } else {\n            /*\n             * in angular level, the url for $http interceptor call could be relative url,\n             * if it's relative call, we'll treat it as app backend call.\n             */\n            return new Array<string>(this.clientId);\n        }\n\n        // if not the app's own backend or not a domain listed in the endpoints structure\n        return null;\n    }\n\n    /**\n     * Return boolean flag to developer to help inform if login is in progress\n     * @returns {boolean} true/false\n     */\n    public getLoginInProgress(): boolean {\n        return this.cacheStorage.isInteractionInProgress(true);\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     *\n     * @param loginInProgress\n     */\n    protected setInteractionInProgress(inProgress: boolean): void {\n        this.cacheStorage.setInteractionInProgress(inProgress);\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     *\n     * @param loginInProgress\n     */\n    protected setloginInProgress(loginInProgress : boolean): void {\n        this.setInteractionInProgress(loginInProgress);\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     *\n     * returns the status of acquireTokenInProgress\n     */\n    protected getAcquireTokenInProgress(): boolean {\n        return this.cacheStorage.isInteractionInProgress(true);\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     *\n     * @param acquireTokenInProgress\n     */\n    protected setAcquireTokenInProgress(acquireTokenInProgress : boolean): void {\n        this.setInteractionInProgress(acquireTokenInProgress);\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     *\n     * returns the logger handle\n     */\n    getLogger(): Logger {\n        return this.logger;\n    }\n\n    /**\n     * Sets the logger callback.\n     * @param logger Logger callback\n     */\n    setLogger(logger: Logger): void {\n        this.logger = logger;\n    }\n\n    // #endregion\n\n    // #region Getters and Setters\n\n    /**\n     * Use to get the redirect uri configured in MSAL or null.\n     * Evaluates redirectUri if its a function, otherwise simply returns its value.\n     *\n     * @returns {string} redirect URL\n     */\n    public getRedirectUri(reqRedirectUri?:  string): string {\n        if(reqRedirectUri) {\n            return reqRedirectUri;\n        }\n        else if (typeof this.config.auth.redirectUri === \"function\") {\n            return this.config.auth.redirectUri();\n        }\n        return this.config.auth.redirectUri;\n    }\n\n    /**\n     * Use to get the post logout redirect uri configured in MSAL or null.\n     * Evaluates postLogoutredirectUri if its a function, otherwise simply returns its value.\n     *\n     * @returns {string} post logout redirect URL\n     */\n    public getPostLogoutRedirectUri(): string {\n        if (typeof this.config.auth.postLogoutRedirectUri === \"function\") {\n            return this.config.auth.postLogoutRedirectUri();\n        }\n        return this.config.auth.postLogoutRedirectUri;\n    }\n\n    /**\n     * Use to get the current {@link Configuration} object in MSAL\n     *\n     * @returns {@link Configuration}\n     */\n    public getCurrentConfiguration(): Configuration {\n        if (!this.config) {\n            throw ClientConfigurationError.createNoSetConfigurationError();\n        }\n        return this.config;\n    }\n\n    /**\n     * @ignore\n     *\n     * Utils function to create the Authentication\n     * @param {@link account} account object\n     * @param scopes\n     *\n     * @returns {string} token type: token, id_token or id_token token\n     *\n     */\n    private getTokenType(accountObject: Account, scopes: string[]): string {\n        const accountsMatch = Account.compareAccounts(accountObject, this.getAccount());\n        return ServerRequestParameters.determineResponseType(accountsMatch, scopes);\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     *\n     * Sets the cachekeys for and stores the account information in cache\n     * @param account\n     * @param state\n     * @hidden\n     */\n    private setAccountCache(account: Account, state: string) {\n\n        // Cache acquireTokenAccountKey\n        const accountId = account ? this.getAccountId(account) : Constants.no_account;\n\n        const acquireTokenAccountKey = AuthCache.generateAcquireTokenAccountKey(accountId, state);\n        this.cacheStorage.setItem(acquireTokenAccountKey, JSON.stringify(account));\n    }\n\n    /**\n     * @hidden\n     * @ignore\n     *\n     * Sets the cacheKey for and stores the authority information in cache\n     * @param state\n     * @param authority\n     * @hidden\n     */\n    private setAuthorityCache(state: string, authority: string) {\n        // Cache authorityKey\n        const authorityKey = AuthCache.generateAuthorityKey(state);\n        this.cacheStorage.setItem(authorityKey, UrlUtils.CanonicalizeUri(authority), this.inCookie);\n    }\n\n    /**\n     * Updates account, authority, and nonce in cache\n     * @param serverAuthenticationRequest\n     * @param account\n     * @hidden\n     * @ignore\n     */\n    private updateCacheEntries(serverAuthenticationRequest: ServerRequestParameters, account: Account, isLoginCall: boolean, loginStartPage?: string) {\n        // Cache Request Originator Page\n        if (loginStartPage) {\n            this.cacheStorage.setItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.LOGIN_REQUEST, serverAuthenticationRequest.state), loginStartPage, this.inCookie);\n        }\n\n        // Cache account and authority\n        if (isLoginCall) {\n            // Cache the state\n            this.cacheStorage.setItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.STATE_LOGIN, serverAuthenticationRequest.state), serverAuthenticationRequest.state, this.inCookie);\n        } else {\n            this.setAccountCache(account, serverAuthenticationRequest.state);\n        }\n        // Cache authorityKey\n        this.setAuthorityCache(serverAuthenticationRequest.state, serverAuthenticationRequest.authority);\n\n        // Cache nonce\n        this.cacheStorage.setItem(AuthCache.generateTemporaryCacheKey(TemporaryCacheKeys.NONCE_IDTOKEN, serverAuthenticationRequest.state), serverAuthenticationRequest.nonce, this.inCookie);\n    }\n\n    /**\n     * Returns the unique identifier for the logged in account\n     * @param account\n     * @hidden\n     * @ignore\n     */\n    private getAccountId(account: Account): string {\n        // return `${account.accountIdentifier}` + Constants.resourceDelimiter + `${account.homeAccountIdentifier}`;\n        let accountId: string;\n        if (!StringUtils.isEmpty(account.homeAccountIdentifier)) {\n            accountId = account.homeAccountIdentifier;\n        }\n        else {\n            accountId = Constants.no_account;\n        }\n\n        return accountId;\n    }\n\n    /**\n     * @ignore\n     * @param extraQueryParameters\n     *\n     * Construct 'tokenRequest' from the available data in adalIdToken\n     */\n    private buildIDTokenRequest(request: AuthenticationParameters): AuthenticationParameters {\n\n        const tokenRequest: AuthenticationParameters = {\n            scopes: Constants.oidcScopes,\n            authority: this.authority,\n            account: this.getAccount(),\n            extraQueryParameters: request.extraQueryParameters,\n            correlationId: request.correlationId\n        };\n\n        return tokenRequest;\n    }\n\n    /**\n     * @ignore\n     * @param config\n     * @param clientId\n     *\n     * Construct TelemetryManager from Configuration\n     */\n    private getTelemetryManagerFromConfig(config: TelemetryOptions, clientId: string): TelemetryManager {\n        if (!config) { // if unset\n            return TelemetryManager.getTelemetrymanagerStub(clientId, this.logger);\n        }\n        // if set then validate\n        const { applicationName, applicationVersion, telemetryEmitter } = config;\n        if (!applicationName || !applicationVersion || !telemetryEmitter) {\n            throw ClientConfigurationError.createTelemetryConfigError(config);\n        }\n        // if valid then construct\n        const telemetryPlatform: TelemetryPlatform = {\n            applicationName,\n            applicationVersion\n        };\n        const telemetryManagerConfig: TelemetryConfig = {\n            platform: telemetryPlatform,\n            clientId: clientId\n        };\n        return new TelemetryManager(telemetryManagerConfig, telemetryEmitter, this.logger);\n    }\n\n    // #endregion\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * returns a promise that resolves after specified time\n * @param time in milliseconds\n */\nexport function delay(ms: number): Promise<void> {\n  return new Promise(resolve => {\n    setTimeout(resolve, ms);\n  });\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { AuthenticationHandlerOptions, Middleware } from '@microsoft/microsoft-graph-client';\nimport { GraphEndpoint, MICROSOFT_GRAPH_ENDPOINTS, Providers } from '..';\n\n/**\n * creates an AuthenticationHandlerOptions from scopes array that\n * can be used in the Graph sdk middleware chain\n *\n * @export\n * @param {...string[]} scopes\n * @returns\n */\nexport function prepScopes(...scopes: string[]) {\n  const authProviderOptions = {\n    scopes\n  };\n\n  if (!Providers.globalProvider.isIncrementalConsentDisabled) {\n    return [new AuthenticationHandlerOptions(undefined, authProviderOptions)];\n  } else {\n    return [];\n  }\n}\n\n/**\n * Helper method to chain Middleware when instantiating new Client\n *\n * @param {...Middleware[]} middleware\n * @returns {Middleware}\n */\nexport function chainMiddleware(...middleware: Middleware[]): Middleware {\n  const rootMiddleware = middleware[0];\n  let current = rootMiddleware;\n  for (let i = 1; i < middleware.length; ++i) {\n    const next = middleware[i];\n    if (current.setNext) {\n      current.setNext(next);\n    }\n    current = next;\n  }\n  return rootMiddleware;\n}\n\n/**\n * Helper method to validate a base URL string\n * @param url a URL string\n * @returns GraphEndpoint\n */\nexport function validateBaseURL(url: string): GraphEndpoint {\n  try {\n    const urlObj = new URL(url);\n    const originAsEndpoint = urlObj.origin as GraphEndpoint;\n    if (MICROSOFT_GRAPH_ENDPOINTS.has(originAsEndpoint)) {\n      return originAsEndpoint;\n    }\n  } catch (error) {\n    return;\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { BatchResponse, IBatch } from '../IBatch';\nimport { BatchRequestContent, MiddlewareOptions } from '@microsoft/microsoft-graph-client';\nimport { delay } from '../utils';\nimport { prepScopes } from './GraphHelpers';\nimport { IGraph } from '../IGraph';\n\n/**\n * Represents a request to be executed in a batch\n *\n * @class BatchRequest\n */\nexport class BatchRequest {\n  /**\n   * url used in request\n   *\n   * @type {string}\n   * @memberof BatchRequest\n   */\n  public resource: string;\n\n  /**\n   * method passed to be requested\n   *\n   * @type {string}\n   * @memberof BatchRequest\n   */\n  public method: string;\n\n  /**\n   * The index of the requests as it was added to the queue\n   * Use this value if you need to sort the responses\n   * in the order they were added\n   *\n   * @type {number}\n   * @memberof BatchRequest\n   */\n  public index: number;\n\n  /**\n   * The headers of the request\n   *\n   * @type {{[headerName: string]: string}}\n   * @memberof BatchRequest\n   */\n  public headers: { [header: string]: string };\n\n  /**\n   * The id of the requests\n   *\n   * @type {string}\n   * @memberof BatchRequest\n   */\n  public id: string;\n\n  constructor(index, id, resource: string, method: string) {\n    if (resource.charAt(0) !== '/') {\n      resource = '/' + resource;\n    }\n    this.resource = resource;\n    this.method = method;\n    this.index = index;\n    this.id = id;\n  }\n}\n\n/**\n * Method to reduce repetitive requests to the Graph\n *\n * @export\n * @class Batch\n */\n// tslint:disable-next-line: max-classes-per-file\nexport class Batch implements IBatch {\n  // this doesn't really mater what it is as long as it's a root base url\n  // otherwise a Request assumes the current path and that could change the relative path\n  private static baseUrl = 'https://graph.microsoft.com';\n\n  private allRequests: BatchRequest[];\n  private requestsQueue: number[];\n  private scopes: string[];\n  private retryAfter: number;\n\n  private graph: IGraph;\n\n  private nextIndex: number;\n\n  constructor(graph: IGraph) {\n    this.graph = graph;\n    this.allRequests = [];\n    this.requestsQueue = [];\n    this.scopes = [];\n    this.nextIndex = 0;\n    this.retryAfter = 0;\n  }\n\n  /**\n   * Get whether there are requests that have not been executed\n   *\n   * @readonly\n   * @memberof Batch\n   */\n  public get hasRequests() {\n    return this.requestsQueue.length > 0;\n  }\n\n  /**\n   * sets new request and scopes\n   *\n   * @param {string} id\n   * @param {string} resource\n   * @param {string[]} [scopes]\n   * @memberof Batch\n   */\n  public get(id: string, resource: string, scopes?: string[], headers?: { [header: string]: string }) {\n    const index = this.nextIndex++;\n    const request = new BatchRequest(index, id, resource, 'GET');\n    request.headers = headers;\n    this.allRequests.push(request);\n    this.requestsQueue.push(index);\n    if (scopes) {\n      this.scopes = this.scopes.concat(scopes);\n    }\n  }\n\n  /**\n   * Execute the next set of requests.\n   * This will execute up to 20 requests at a time\n   *\n   * @returns {Promise<Map<string, BatchResponse>>}\n   * @memberof Batch\n   */\n  public async executeNext(): Promise<Map<string, BatchResponse>> {\n    const responses: Map<string, BatchResponse> = new Map();\n\n    if (this.retryAfter) {\n      await delay(this.retryAfter * 1000);\n      this.retryAfter = 0;\n    }\n\n    if (!this.hasRequests) {\n      return responses;\n    }\n\n    // batch can support up to 20 requests\n    const nextBatch = this.requestsQueue.splice(0, 20);\n\n    const batchRequestContent = new BatchRequestContent();\n\n    for (const request of nextBatch.map(i => this.allRequests[i])) {\n      batchRequestContent.addRequest({\n        id: request.index.toString(),\n        request: new Request(Batch.baseUrl + request.resource, {\n          method: request.method,\n          headers: request.headers\n        })\n      });\n    }\n\n    const middlewareOptions: MiddlewareOptions[] = this.scopes.length ? prepScopes(...this.scopes) : [];\n    const batchRequest = this.graph.api('$batch').middlewareOptions(middlewareOptions);\n\n    const batchRequestBody = await batchRequestContent.getContent();\n    const batchResponse = await batchRequest.post(batchRequestBody);\n\n    for (const r of batchResponse.responses) {\n      const response = new BatchResponse();\n      const request = this.allRequests[r.id];\n\n      response.id = request.id;\n      response.index = request.index;\n      response.headers = r.headers;\n\n      if (r.status !== 200) {\n        if (r.status === 429) {\n          // this request was throttled\n          // add request back to queue and set retry wait time\n          this.requestsQueue.unshift(r.id);\n          this.retryAfter = Math.max(this.retryAfter, parseInt(r.headers['Retry-After'], 10) || 1);\n        }\n        continue;\n      } else if (r.headers['Content-Type'].includes('image/jpeg')) {\n        response.content = 'data:image/jpeg;base64,' + r.body;\n      } else if (r.headers['Content-Type'].includes('image/pjpeg')) {\n        response.content = 'data:image/pjpeg;base64,' + r.body;\n      } else if (r.headers['Content-Type'].includes('image/png')) {\n        response.content = 'data:image/png;base64,' + r.body;\n      } else {\n        response.content = r.body;\n      }\n\n      responses.set(request.id, response);\n    }\n\n    return responses;\n  }\n\n  /**\n   * Execute all requests, up to 20 at a time until\n   * all requests have been executed\n   *\n   * @returns {Promise<Map<string, BatchResponse>>}\n   * @memberof Batch\n   */\n  public async executeAll(): Promise<Map<string, BatchResponse>> {\n    const responses: Map<string, BatchResponse> = new Map();\n\n    while (this.hasRequests) {\n      const r = await this.executeNext();\n      for (const [key, value] of r) {\n        responses.set(key, value);\n      }\n    }\n\n    return responses;\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { MiddlewareOptions } from '@microsoft/microsoft-graph-client';\nimport { MgtBaseComponent } from '../components/baseComponent';\n\n/**\n * Middleware Options used for component telemetry\n *\n * @export\n * @class ComponentMiddlewareOptions\n * @implements {MiddlewareOptions}\n */\nexport class ComponentMiddlewareOptions implements MiddlewareOptions {\n  /**\n   * The name of the component\n   *\n   * @type {string}\n   * @memberof ComponentMiddlewareOptions\n   */\n  public componentName: string;\n\n  constructor(component: MgtBaseComponent | string) {\n    if (typeof component === 'string') {\n      this.componentName = component;\n    } else {\n      this.componentName = component.tagName.toLowerCase();\n    }\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { Context, Middleware } from '@microsoft/microsoft-graph-client';\nimport { getRequestHeader, setRequestHeader } from '@microsoft/microsoft-graph-client/lib/es/middleware/MiddlewareUtil';\nimport { ComponentMiddlewareOptions } from './ComponentMiddlewareOptions';\nimport { validateBaseURL } from './GraphHelpers';\n\n/**\n * Implements Middleware for the Graph sdk to inject\n * the toolkit version in the SdkVersion header\n *\n * @class SdkVersionMiddleware\n * @implements {Middleware}\n */\nexport class SdkVersionMiddleware implements Middleware {\n  /**\n   * @private\n   * A member to hold next middleware in the middleware chain\n   */\n  private _nextMiddleware: Middleware;\n  private _packageVersion: string;\n  private _providerName: string;\n\n  constructor(packageVersion: string, providerName?: string) {\n    this._packageVersion = packageVersion;\n    this._providerName = providerName;\n  }\n\n  // tslint:disable-next-line: completed-docs\n  public async execute(context: Context): Promise<void> {\n    try {\n      if (typeof context.request === 'string') {\n        if (validateBaseURL(context.request)) {\n          // Header parts must follow the format: 'name/version'\n          const headerParts: string[] = [];\n\n          const componentOptions = context.middlewareControl.getMiddlewareOptions(\n            ComponentMiddlewareOptions\n          ) as ComponentMiddlewareOptions;\n\n          if (componentOptions) {\n            const componentVersion: string = `${componentOptions.componentName}/${this._packageVersion}`;\n            headerParts.push(componentVersion);\n          }\n\n          if (this._providerName) {\n            const providerVersion: string = `${this._providerName}/${this._packageVersion}`;\n            headerParts.push(providerVersion);\n          }\n\n          // Package version\n          const packageVersion: string = `mgt/${this._packageVersion}`;\n          headerParts.push(packageVersion);\n\n          // Existing SdkVersion header value\n          headerParts.push(getRequestHeader(context.request, context.options, 'SdkVersion'));\n\n          // Join the header parts together and update the SdkVersion request header value\n          const sdkVersionHeaderValue = headerParts.join(', ');\n          setRequestHeader(context.request, context.options, 'SdkVersion', sdkVersionHeaderValue);\n        } else {\n          delete context?.options?.headers['SdkVersion'];\n        }\n      }\n    } catch (error) {\n      // ignore error\n    }\n    return await this._nextMiddleware.execute(context);\n  }\n\n  /**\n   * Handles setting of next middleware\n   *\n   * @param {Middleware} next\n   * @memberof SdkVersionMiddleware\n   */\n  public setNext(next: Middleware): void {\n    this._nextMiddleware = next;\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n// THIS FILE IS AUTO GENERATED\n// ANY CHANGES WILL BE LOST DURING BUILD\n\nexport const PACKAGE_VERSION = '2.9.2';\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  AuthenticationHandler,\n  Client,\n  GraphRequest,\n  HTTPMessageHandler,\n  Middleware,\n  MiddlewareOptions,\n  RetryHandler,\n  RetryHandlerOptions,\n  TelemetryHandler\n} from '@microsoft/microsoft-graph-client';\n\nimport { IGraph } from './IGraph';\nimport { IProvider } from './providers/IProvider';\nimport { Batch } from './utils/Batch';\nimport { ComponentMiddlewareOptions } from './utils/ComponentMiddlewareOptions';\nimport { chainMiddleware } from './utils/GraphHelpers';\nimport { SdkVersionMiddleware } from './utils/SdkVersionMiddleware';\nimport { PACKAGE_VERSION } from './utils/version';\n\n/**\n * The version of the Graph to use for making requests.\n */\nconst GRAPH_VERSION = 'v1.0';\n\n/**\n * The base Graph implementation.\n *\n * @export\n * @abstract\n * @class Graph\n */\nexport class Graph implements IGraph {\n  /**\n   * the internal client used to make graph calls\n   *\n   * @readonly\n   * @type {Client}\n   * @memberof Graph\n   */\n  public get client(): Client {\n    return this._client;\n  }\n\n  /**\n   * the component name appended to Graph request headers\n   *\n   * @readonly\n   * @type {string}\n   * @memberof Graph\n   */\n  public get componentName(): string {\n    return this._componentName;\n  }\n\n  /**\n   * the version of the graph to query\n   *\n   * @readonly\n   * @type {string}\n   * @memberof Graph\n   */\n  public get version(): string {\n    return this._version;\n  }\n\n  private _client: Client;\n  private _componentName: string;\n  private _version: string;\n\n  constructor(client: Client, version: string = GRAPH_VERSION) {\n    this._client = client;\n    this._version = version;\n  }\n\n  /**\n   * Returns a new instance of the Graph using the same\n   * client within the context of the provider.\n   *\n   * @param {Element} component\n   * @returns {IGraph}\n   * @memberof Graph\n   */\n  public forComponent(component: Element | string): Graph {\n    const graph = new Graph(this._client, this._version);\n    graph.setComponent(component);\n    return graph;\n  }\n\n  /**\n   * Returns a new graph request for a specific component\n   * Used internally for analytics purposes\n   *\n   * @param {string} path\n   * @memberof Graph\n   */\n  public api(path: string): GraphRequest {\n    let request = this._client.api(path).version(this._version);\n\n    if (this._componentName) {\n      request.middlewareOptions = (options: MiddlewareOptions[]): GraphRequest => {\n        const requestObj = request as any;\n        requestObj._middlewareOptions = requestObj._middlewareOptions.concat(options);\n        return request;\n      };\n      request = request.middlewareOptions([new ComponentMiddlewareOptions(this._componentName)]);\n    }\n\n    return request;\n  }\n\n  /**\n   * creates a new batch request\n   *\n   * @returns {Batch}\n   * @memberof Graph\n   */\n  public createBatch(): Batch {\n    return new Batch(this);\n  }\n\n  /**\n   * sets the component name used in request headers.\n   *\n   * @protected\n   * @param {Element} component\n   * @memberof Graph\n   */\n  protected setComponent(component: Element | string): void {\n    this._componentName = component instanceof Element ? component.tagName : component;\n  }\n}\n\n/**\n * create a new Graph instance using the specified provider.\n *\n * @static\n * @param {IProvider} provider\n * @returns {Graph}\n * @memberof Graph\n */\nexport function createFromProvider(provider: IProvider, version?: string, component?: Element): Graph {\n  const middleware: Middleware[] = [\n    new AuthenticationHandler(provider),\n    new RetryHandler(new RetryHandlerOptions()),\n    new TelemetryHandler(),\n    new SdkVersionMiddleware(PACKAGE_VERSION, provider.name),\n    new HTTPMessageHandler()\n  ];\n\n  const client = Client.initWithMiddleware({\n    middleware: chainMiddleware(...middleware)\n  });\n\n  const graph = new Graph(client, version);\n  return component ? graph.forComponent(component) : graph;\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { IGraph } from './IGraph';\nimport { Client } from '@microsoft/microsoft-graph-client';\nimport { Graph } from './Graph';\n\n/**\n * The version of the Graph to use for making requests.\n */\nconst GRAPH_VERSION = 'beta';\n\n/**\n * BetaGraph\n *\n * @export\n * @class BetaGraph\n * @extends {BetaGraph}\n */\nexport class BetaGraph extends Graph {\n  /**\n   * get a BetaGraph instance based on an existing IGraph implementation.\n   *\n   * @static\n   * @param {Graph} graph\n   * @returns {BetaGraph}\n   * @memberof BetaGraph\n   */\n  public static fromGraph(graph: IGraph): BetaGraph {\n    const betaGraph = new BetaGraph(graph.client);\n    betaGraph.setComponent(graph.componentName);\n    return betaGraph;\n  }\n\n  constructor(client: Client, version: string = GRAPH_VERSION) {\n    super(client, version);\n  }\n\n  /**\n   * Returns a new instance of the Graph using the same\n   * client within the context of the provider.\n   *\n   * @param {Element} component\n   * @returns {BetaGraph}\n   * @memberof BetaGraph\n   */\n  public forComponent(component: Element | string): BetaGraph {\n    const graph = new BetaGraph(this.client);\n    this.setComponent(component);\n    return graph;\n  }\n}\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\ninterface MaybePolyfilledCe extends CustomElementRegistry {\n  readonly polyfillWrapFlushCallback?: object;\n}\n\n/**\n * True if the custom elements polyfill is in use.\n */\nexport const isCEPolyfill = typeof window !== 'undefined' &&\n    window.customElements != null &&\n    (window.customElements as MaybePolyfilledCe).polyfillWrapFlushCallback !==\n        undefined;\n\n/**\n * Reparents nodes, starting from `start` (inclusive) to `end` (exclusive),\n * into another container (could be the same container), before `before`. If\n * `before` is null, it appends the nodes to the container.\n */\nexport const reparentNodes =\n    (container: Node,\n     start: Node|null,\n     end: Node|null = null,\n     before: Node|null = null): void => {\n      while (start !== end) {\n        const n = start!.nextSibling;\n        container.insertBefore(start!, before);\n        start = n;\n      }\n    };\n\n/**\n * Removes nodes, starting from `start` (inclusive) to `end` (exclusive), from\n * `container`.\n */\nexport const removeNodes =\n    (container: Node, start: Node|null, end: Node|null = null): void => {\n      while (start !== end) {\n        const n = start!.nextSibling;\n        container.removeChild(start!);\n        start = n;\n      }\n    };\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {TemplateResult} from './template-result.js';\n\n/**\n * An expression marker with embedded unique key to avoid collision with\n * possible text in templates.\n */\nexport const marker = `{{lit-${String(Math.random()).slice(2)}}}`;\n\n/**\n * An expression marker used text-positions, multi-binding attributes, and\n * attributes with markup-like text values.\n */\nexport const nodeMarker = `<!--${marker}-->`;\n\nexport const markerRegex = new RegExp(`${marker}|${nodeMarker}`);\n\n/**\n * Suffix appended to all bound attribute names.\n */\nexport const boundAttributeSuffix = '$lit$';\n\n/**\n * An updatable Template that tracks the location of dynamic parts.\n */\nexport class Template {\n  readonly parts: TemplatePart[] = [];\n  readonly element: HTMLTemplateElement;\n\n  constructor(result: TemplateResult, element: HTMLTemplateElement) {\n    this.element = element;\n\n    const nodesToRemove: Node[] = [];\n    const stack: Node[] = [];\n    // Edge needs all 4 parameters present; IE11 needs 3rd parameter to be null\n    const walker = document.createTreeWalker(\n        element.content,\n        133 /* NodeFilter.SHOW_{ELEMENT|COMMENT|TEXT} */,\n        null,\n        false);\n    // Keeps track of the last index associated with a part. We try to delete\n    // unnecessary nodes, but we never want to associate two different parts\n    // to the same index. They must have a constant node between.\n    let lastPartIndex = 0;\n    let index = -1;\n    let partIndex = 0;\n    const {strings, values: {length}} = result;\n    while (partIndex < length) {\n      const node = walker.nextNode() as Element | Comment | Text | null;\n      if (node === null) {\n        // We've exhausted the content inside a nested template element.\n        // Because we still have parts (the outer for-loop), we know:\n        // - There is a template in the stack\n        // - The walker will find a nextNode outside the template\n        walker.currentNode = stack.pop()!;\n        continue;\n      }\n      index++;\n\n      if (node.nodeType === 1 /* Node.ELEMENT_NODE */) {\n        if ((node as Element).hasAttributes()) {\n          const attributes = (node as Element).attributes;\n          const {length} = attributes;\n          // Per\n          // https://developer.mozilla.org/en-US/docs/Web/API/NamedNodeMap,\n          // attributes are not guaranteed to be returned in document order.\n          // In particular, Edge/IE can return them out of order, so we cannot\n          // assume a correspondence between part index and attribute index.\n          let count = 0;\n          for (let i = 0; i < length; i++) {\n            if (endsWith(attributes[i].name, boundAttributeSuffix)) {\n              count++;\n            }\n          }\n          while (count-- > 0) {\n            // Get the template literal section leading up to the first\n            // expression in this attribute\n            const stringForPart = strings[partIndex];\n            // Find the attribute name\n            const name = lastAttributeNameRegex.exec(stringForPart)![2];\n            // Find the corresponding attribute\n            // All bound attributes have had a suffix added in\n            // TemplateResult#getHTML to opt out of special attribute\n            // handling. To look up the attribute value we also need to add\n            // the suffix.\n            const attributeLookupName =\n                name.toLowerCase() + boundAttributeSuffix;\n            const attributeValue =\n                (node as Element).getAttribute(attributeLookupName)!;\n            (node as Element).removeAttribute(attributeLookupName);\n            const statics = attributeValue.split(markerRegex);\n            this.parts.push({type: 'attribute', index, name, strings: statics});\n            partIndex += statics.length - 1;\n          }\n        }\n        if ((node as Element).tagName === 'TEMPLATE') {\n          stack.push(node);\n          walker.currentNode = (node as HTMLTemplateElement).content;\n        }\n      } else if (node.nodeType === 3 /* Node.TEXT_NODE */) {\n        const data = (node as Text).data;\n        if (data.indexOf(marker) >= 0) {\n          const parent = node.parentNode!;\n          const strings = data.split(markerRegex);\n          const lastIndex = strings.length - 1;\n          // Generate a new text node for each literal section\n          // These nodes are also used as the markers for node parts\n          for (let i = 0; i < lastIndex; i++) {\n            let insert: Node;\n            let s = strings[i];\n            if (s === '') {\n              insert = createMarker();\n            } else {\n              const match = lastAttributeNameRegex.exec(s);\n              if (match !== null && endsWith(match[2], boundAttributeSuffix)) {\n                s = s.slice(0, match.index) + match[1] +\n                    match[2].slice(0, -boundAttributeSuffix.length) + match[3];\n              }\n              insert = document.createTextNode(s);\n            }\n            parent.insertBefore(insert, node);\n            this.parts.push({type: 'node', index: ++index});\n          }\n          // If there's no text, we must insert a comment to mark our place.\n          // Else, we can trust it will stick around after cloning.\n          if (strings[lastIndex] === '') {\n            parent.insertBefore(createMarker(), node);\n            nodesToRemove.push(node);\n          } else {\n            (node as Text).data = strings[lastIndex];\n          }\n          // We have a part for each match found\n          partIndex += lastIndex;\n        }\n      } else if (node.nodeType === 8 /* Node.COMMENT_NODE */) {\n        if ((node as Comment).data === marker) {\n          const parent = node.parentNode!;\n          // Add a new marker node to be the startNode of the Part if any of\n          // the following are true:\n          //  * We don't have a previousSibling\n          //  * The previousSibling is already the start of a previous part\n          if (node.previousSibling === null || index === lastPartIndex) {\n            index++;\n            parent.insertBefore(createMarker(), node);\n          }\n          lastPartIndex = index;\n          this.parts.push({type: 'node', index});\n          // If we don't have a nextSibling, keep this node so we have an end.\n          // Else, we can remove it to save future costs.\n          if (node.nextSibling === null) {\n            (node as Comment).data = '';\n          } else {\n            nodesToRemove.push(node);\n            index--;\n          }\n          partIndex++;\n        } else {\n          let i = -1;\n          while ((i = (node as Comment).data.indexOf(marker, i + 1)) !== -1) {\n            // Comment node has a binding marker inside, make an inactive part\n            // The binding won't work, but subsequent bindings will\n            // TODO (justinfagnani): consider whether it's even worth it to\n            // make bindings in comments work\n            this.parts.push({type: 'node', index: -1});\n            partIndex++;\n          }\n        }\n      }\n    }\n\n    // Remove text binding nodes after the walk to not disturb the TreeWalker\n    for (const n of nodesToRemove) {\n      n.parentNode!.removeChild(n);\n    }\n  }\n}\n\nconst endsWith = (str: string, suffix: string): boolean => {\n  const index = str.length - suffix.length;\n  return index >= 0 && str.slice(index) === suffix;\n};\n\n/**\n * A placeholder for a dynamic expression in an HTML template.\n *\n * There are two built-in part types: AttributePart and NodePart. NodeParts\n * always represent a single dynamic expression, while AttributeParts may\n * represent as many expressions are contained in the attribute.\n *\n * A Template's parts are mutable, so parts can be replaced or modified\n * (possibly to implement different template semantics). The contract is that\n * parts can only be replaced, not removed, added or reordered, and parts must\n * always consume the correct number of values in their `update()` method.\n *\n * TODO(justinfagnani): That requirement is a little fragile. A\n * TemplateInstance could instead be more careful about which values it gives\n * to Part.update().\n */\nexport type TemplatePart = {\n  readonly type: 'node'; index: number;\n}|{\n  readonly type: 'attribute';\n  index: number;\n  readonly name: string;\n  readonly strings: ReadonlyArray<string>;\n};\n\nexport const isTemplatePartActive = (part: TemplatePart) => part.index !== -1;\n\n// Allows `document.createComment('')` to be renamed for a\n// small manual size-savings.\nexport const createMarker = () => document.createComment('');\n\n/**\n * This regex extracts the attribute name preceding an attribute-position\n * expression. It does this by matching the syntax allowed for attributes\n * against the string literal directly preceding the expression, assuming that\n * the expression is in an attribute-value position.\n *\n * See attributes in the HTML spec:\n * https://www.w3.org/TR/html5/syntax.html#elements-attributes\n *\n * \" \\x09\\x0a\\x0c\\x0d\" are HTML space characters:\n * https://www.w3.org/TR/html5/infrastructure.html#space-characters\n *\n * \"\\0-\\x1F\\x7F-\\x9F\" are Unicode control characters, which includes every\n * space character except \" \".\n *\n * So an attribute is:\n *  * The name: any character except a control character, space character, ('),\n *    (\"), \">\", \"=\", or \"/\"\n *  * Followed by zero or more space characters\n *  * Followed by \"=\"\n *  * Followed by zero or more space characters\n *  * Followed by:\n *    * Any character except space, ('), (\"), \"<\", \">\", \"=\", (`), or\n *    * (\") then any non-(\"), or\n *    * (') then any non-(')\n */\nexport const lastAttributeNameRegex =\n    // eslint-disable-next-line no-control-regex\n    /([ \\x09\\x0a\\x0c\\x0d])([^\\0-\\x1F\\x7F-\\x9F \"'>=/]+)([ \\x09\\x0a\\x0c\\x0d]*=[ \\x09\\x0a\\x0c\\x0d]*(?:[^ \\x09\\x0a\\x0c\\x0d\"'`<>=]*|\"[^\"]*|'[^']*))$/;\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {isTemplatePartActive, Template, TemplatePart} from './template.js';\n\nconst walkerNodeFilter = 133 /* NodeFilter.SHOW_{ELEMENT|COMMENT|TEXT} */;\n\n/**\n * Removes the list of nodes from a Template safely. In addition to removing\n * nodes from the Template, the Template part indices are updated to match\n * the mutated Template DOM.\n *\n * As the template is walked the removal state is tracked and\n * part indices are adjusted as needed.\n *\n * div\n *   div#1 (remove) <-- start removing (removing node is div#1)\n *     div\n *       div#2 (remove)  <-- continue removing (removing node is still div#1)\n *         div\n * div <-- stop removing since previous sibling is the removing node (div#1,\n * removed 4 nodes)\n */\nexport function removeNodesFromTemplate(\n    template: Template, nodesToRemove: Set<Node>) {\n  const {element: {content}, parts} = template;\n  const walker =\n      document.createTreeWalker(content, walkerNodeFilter, null, false);\n  let partIndex = nextActiveIndexInTemplateParts(parts);\n  let part = parts[partIndex];\n  let nodeIndex = -1;\n  let removeCount = 0;\n  const nodesToRemoveInTemplate = [];\n  let currentRemovingNode: Node|null = null;\n  while (walker.nextNode()) {\n    nodeIndex++;\n    const node = walker.currentNode as Element;\n    // End removal if stepped past the removing node\n    if (node.previousSibling === currentRemovingNode) {\n      currentRemovingNode = null;\n    }\n    // A node to remove was found in the template\n    if (nodesToRemove.has(node)) {\n      nodesToRemoveInTemplate.push(node);\n      // Track node we're removing\n      if (currentRemovingNode === null) {\n        currentRemovingNode = node;\n      }\n    }\n    // When removing, increment count by which to adjust subsequent part indices\n    if (currentRemovingNode !== null) {\n      removeCount++;\n    }\n    while (part !== undefined && part.index === nodeIndex) {\n      // If part is in a removed node deactivate it by setting index to -1 or\n      // adjust the index as needed.\n      part.index = currentRemovingNode !== null ? -1 : part.index - removeCount;\n      // go to the next active part.\n      partIndex = nextActiveIndexInTemplateParts(parts, partIndex);\n      part = parts[partIndex];\n    }\n  }\n  nodesToRemoveInTemplate.forEach((n) => n.parentNode!.removeChild(n));\n}\n\nconst countNodes = (node: Node) => {\n  let count = (node.nodeType === 11 /* Node.DOCUMENT_FRAGMENT_NODE */) ? 0 : 1;\n  const walker = document.createTreeWalker(node, walkerNodeFilter, null, false);\n  while (walker.nextNode()) {\n    count++;\n  }\n  return count;\n};\n\nconst nextActiveIndexInTemplateParts =\n    (parts: TemplatePart[], startIndex = -1) => {\n      for (let i = startIndex + 1; i < parts.length; i++) {\n        const part = parts[i];\n        if (isTemplatePartActive(part)) {\n          return i;\n        }\n      }\n      return -1;\n    };\n\n/**\n * Inserts the given node into the Template, optionally before the given\n * refNode. In addition to inserting the node into the Template, the Template\n * part indices are updated to match the mutated Template DOM.\n */\nexport function insertNodeIntoTemplate(\n    template: Template, node: Node, refNode: Node|null = null) {\n  const {element: {content}, parts} = template;\n  // If there's no refNode, then put node at end of template.\n  // No part indices need to be shifted in this case.\n  if (refNode === null || refNode === undefined) {\n    content.appendChild(node);\n    return;\n  }\n  const walker =\n      document.createTreeWalker(content, walkerNodeFilter, null, false);\n  let partIndex = nextActiveIndexInTemplateParts(parts);\n  let insertCount = 0;\n  let walkerIndex = -1;\n  while (walker.nextNode()) {\n    walkerIndex++;\n    const walkerNode = walker.currentNode as Element;\n    if (walkerNode === refNode) {\n      insertCount = countNodes(node);\n      refNode.parentNode!.insertBefore(node, refNode);\n    }\n    while (partIndex !== -1 && parts[partIndex].index === walkerIndex) {\n      // If we've inserted the node, simply adjust all subsequent parts\n      if (insertCount > 0) {\n        while (partIndex !== -1) {\n          parts[partIndex].index += insertCount;\n          partIndex = nextActiveIndexInTemplateParts(parts, partIndex);\n        }\n        return;\n      }\n      partIndex = nextActiveIndexInTemplateParts(parts, partIndex);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {Part} from './part.js';\n\nconst directives = new WeakMap<object, true>();\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type DirectiveFactory = (...args: any[]) => object;\n\nexport type DirectiveFn = (part: Part) => void;\n\n/**\n * Brands a function as a directive factory function so that lit-html will call\n * the function during template rendering, rather than passing as a value.\n *\n * A _directive_ is a function that takes a Part as an argument. It has the\n * signature: `(part: Part) => void`.\n *\n * A directive _factory_ is a function that takes arguments for data and\n * configuration and returns a directive. Users of directive usually refer to\n * the directive factory as the directive. For example, \"The repeat directive\".\n *\n * Usually a template author will invoke a directive factory in their template\n * with relevant arguments, which will then return a directive function.\n *\n * Here's an example of using the `repeat()` directive factory that takes an\n * array and a function to render an item:\n *\n * ```js\n * html`<ul><${repeat(items, (item) => html`<li>${item}</li>`)}</ul>`\n * ```\n *\n * When `repeat` is invoked, it returns a directive function that closes over\n * `items` and the template function. When the outer template is rendered, the\n * return directive function is called with the Part for the expression.\n * `repeat` then performs it's custom logic to render multiple items.\n *\n * @param f The directive factory function. Must be a function that returns a\n * function of the signature `(part: Part) => void`. The returned function will\n * be called with the part object.\n *\n * @example\n *\n * import {directive, html} from 'lit-html';\n *\n * const immutable = directive((v) => (part) => {\n *   if (part.value !== v) {\n *     part.setValue(v)\n *   }\n * });\n */\nexport const directive = <F extends DirectiveFactory>(f: F): F =>\n    ((...args: unknown[]) => {\n      const d = f(...args);\n      directives.set(d, true);\n      return d;\n    }) as F;\n\nexport const isDirective = (o: unknown): o is DirectiveFn => {\n  return typeof o === 'function' && directives.has(o);\n};\n", "/**\n * @license\n * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * The Part interface represents a dynamic part of a template instance rendered\n * by lit-html.\n */\nexport interface Part {\n  readonly value: unknown;\n\n  /**\n   * Sets the current part value, but does not write it to the DOM.\n   * @param value The value that will be committed.\n   */\n  setValue(value: unknown): void;\n\n  /**\n   * Commits the current part value, causing it to actually be written to the\n   * DOM.\n   *\n   * Directives are run at the start of `commit`, so that if they call\n   * `part.setValue(...)` synchronously that value will be used in the current\n   * commit, and there's no need to call `part.commit()` within the directive.\n   * If directives set a part value asynchronously, then they must call\n   * `part.commit()` manually.\n   */\n  commit(): void;\n}\n\n/**\n * A sentinel value that signals that a value was handled by a directive and\n * should not be written to the DOM.\n */\nexport const noChange = {};\n\n/**\n * A sentinel value that signals a NodePart to fully clear its content.\n */\nexport const nothing = {};\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {isCEPolyfill} from './dom.js';\nimport {Part} from './part.js';\nimport {RenderOptions} from './render-options.js';\nimport {TemplateProcessor} from './template-processor.js';\nimport {isTemplatePartActive, Template, TemplatePart} from './template.js';\n\n/**\n * An instance of a `Template` that can be attached to the DOM and updated\n * with new values.\n */\nexport class TemplateInstance {\n  private readonly __parts: Array<Part|undefined> = [];\n  readonly processor: TemplateProcessor;\n  readonly options: RenderOptions;\n  readonly template: Template;\n\n  constructor(\n      template: Template, processor: TemplateProcessor,\n      options: RenderOptions) {\n    this.template = template;\n    this.processor = processor;\n    this.options = options;\n  }\n\n  update(values: readonly unknown[]) {\n    let i = 0;\n    for (const part of this.__parts) {\n      if (part !== undefined) {\n        part.setValue(values[i]);\n      }\n      i++;\n    }\n    for (const part of this.__parts) {\n      if (part !== undefined) {\n        part.commit();\n      }\n    }\n  }\n\n  _clone(): DocumentFragment {\n    // There are a number of steps in the lifecycle of a template instance's\n    // DOM fragment:\n    //  1. Clone - create the instance fragment\n    //  2. Adopt - adopt into the main document\n    //  3. Process - find part markers and create parts\n    //  4. Upgrade - upgrade custom elements\n    //  5. Update - set node, attribute, property, etc., values\n    //  6. Connect - connect to the document. Optional and outside of this\n    //     method.\n    //\n    // We have a few constraints on the ordering of these steps:\n    //  * We need to upgrade before updating, so that property values will pass\n    //    through any property setters.\n    //  * We would like to process before upgrading so that we're sure that the\n    //    cloned fragment is inert and not disturbed by self-modifying DOM.\n    //  * We want custom elements to upgrade even in disconnected fragments.\n    //\n    // Given these constraints, with full custom elements support we would\n    // prefer the order: Clone, Process, Adopt, Upgrade, Update, Connect\n    //\n    // But Safari does not implement CustomElementRegistry#upgrade, so we\n    // can not implement that order and still have upgrade-before-update and\n    // upgrade disconnected fragments. So we instead sacrifice the\n    // process-before-upgrade constraint, since in Custom Elements v1 elements\n    // must not modify their light DOM in the constructor. We still have issues\n    // when co-existing with CEv0 elements like Polymer 1, and with polyfills\n    // that don't strictly adhere to the no-modification rule because shadow\n    // DOM, which may be created in the constructor, is emulated by being placed\n    // in the light DOM.\n    //\n    // The resulting order is on native is: Clone, Adopt, Upgrade, Process,\n    // Update, Connect. document.importNode() performs Clone, Adopt, and Upgrade\n    // in one step.\n    //\n    // The Custom Elements v1 polyfill supports upgrade(), so the order when\n    // polyfilled is the more ideal: Clone, Process, Adopt, Upgrade, Update,\n    // Connect.\n\n    const fragment = isCEPolyfill ?\n        this.template.element.content.cloneNode(true) as DocumentFragment :\n        document.importNode(this.template.element.content, true);\n\n    const stack: Node[] = [];\n    const parts = this.template.parts;\n    // Edge needs all 4 parameters present; IE11 needs 3rd parameter to be null\n    const walker = document.createTreeWalker(\n        fragment,\n        133 /* NodeFilter.SHOW_{ELEMENT|COMMENT|TEXT} */,\n        null,\n        false);\n    let partIndex = 0;\n    let nodeIndex = 0;\n    let part: TemplatePart;\n    let node = walker.nextNode();\n    // Loop through all the nodes and parts of a template\n    while (partIndex < parts.length) {\n      part = parts[partIndex];\n      if (!isTemplatePartActive(part)) {\n        this.__parts.push(undefined);\n        partIndex++;\n        continue;\n      }\n\n      // Progress the tree walker until we find our next part's node.\n      // Note that multiple parts may share the same node (attribute parts\n      // on a single element), so this loop may not run at all.\n      while (nodeIndex < part.index) {\n        nodeIndex++;\n        if (node!.nodeName === 'TEMPLATE') {\n          stack.push(node!);\n          walker.currentNode = (node as HTMLTemplateElement).content;\n        }\n        if ((node = walker.nextNode()) === null) {\n          // We've exhausted the content inside a nested template element.\n          // Because we still have parts (the outer for-loop), we know:\n          // - There is a template in the stack\n          // - The walker will find a nextNode outside the template\n          walker.currentNode = stack.pop()!;\n          node = walker.nextNode();\n        }\n      }\n\n      // We've arrived at our part's node.\n      if (part.type === 'node') {\n        const part = this.processor.handleTextExpression(this.options);\n        part.insertAfterNode(node!.previousSibling!);\n        this.__parts.push(part);\n      } else {\n        this.__parts.push(...this.processor.handleAttributeExpressions(\n            node as Element, part.name, part.strings, this.options));\n      }\n      partIndex++;\n    }\n\n    if (isCEPolyfill) {\n      document.adoptNode(fragment);\n      customElements.upgrade(fragment);\n    }\n    return fragment;\n  }\n}\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * @module lit-html\n */\n\nimport {reparentNodes} from './dom.js';\nimport {TemplateProcessor} from './template-processor.js';\nimport {boundAttributeSuffix, lastAttributeNameRegex, marker, nodeMarker} from './template.js';\n\ndeclare const trustedTypes: typeof window.trustedTypes;\n/**\n * Our TrustedTypePolicy for HTML which is declared using the html template\n * tag function.\n *\n * That HTML is a developer-authored constant, and is parsed with innerHTML\n * before any untrusted expressions have been mixed in. Therefor it is\n * considered safe by construction.\n */\nconst policy = window.trustedTypes &&\n    trustedTypes!.createPolicy('lit-html', {createHTML: (s) => s});\n\nconst commentMarker = ` ${marker} `;\n\n/**\n * The return type of `html`, which holds a Template and the values from\n * interpolated expressions.\n */\nexport class TemplateResult {\n  readonly strings: TemplateStringsArray;\n  readonly values: readonly unknown[];\n  readonly type: string;\n  readonly processor: TemplateProcessor;\n\n  constructor(\n      strings: TemplateStringsArray, values: readonly unknown[], type: string,\n      processor: TemplateProcessor) {\n    this.strings = strings;\n    this.values = values;\n    this.type = type;\n    this.processor = processor;\n  }\n\n  /**\n   * Returns a string of HTML used to create a `<template>` element.\n   */\n  getHTML(): string {\n    const l = this.strings.length - 1;\n    let html = '';\n    let isCommentBinding = false;\n\n    for (let i = 0; i < l; i++) {\n      const s = this.strings[i];\n      // For each binding we want to determine the kind of marker to insert\n      // into the template source before it's parsed by the browser's HTML\n      // parser. The marker type is based on whether the expression is in an\n      // attribute, text, or comment position.\n      //   * For node-position bindings we insert a comment with the marker\n      //     sentinel as its text content, like <!--{{lit-guid}}-->.\n      //   * For attribute bindings we insert just the marker sentinel for the\n      //     first binding, so that we support unquoted attribute bindings.\n      //     Subsequent bindings can use a comment marker because multi-binding\n      //     attributes must be quoted.\n      //   * For comment bindings we insert just the marker sentinel so we don't\n      //     close the comment.\n      //\n      // The following code scans the template source, but is *not* an HTML\n      // parser. We don't need to track the tree structure of the HTML, only\n      // whether a binding is inside a comment, and if not, if it appears to be\n      // the first binding in an attribute.\n      const commentOpen = s.lastIndexOf('<!--');\n      // We're in comment position if we have a comment open with no following\n      // comment close. Because <-- can appear in an attribute value there can\n      // be false positives.\n      isCommentBinding = (commentOpen > -1 || isCommentBinding) &&\n          s.indexOf('-->', commentOpen + 1) === -1;\n      // Check to see if we have an attribute-like sequence preceding the\n      // expression. This can match \"name=value\" like structures in text,\n      // comments, and attribute values, so there can be false-positives.\n      const attributeMatch = lastAttributeNameRegex.exec(s);\n      if (attributeMatch === null) {\n        // We're only in this branch if we don't have a attribute-like\n        // preceding sequence. For comments, this guards against unusual\n        // attribute values like <div foo=\"<!--${'bar'}\">. Cases like\n        // <!-- foo=${'bar'}--> are handled correctly in the attribute branch\n        // below.\n        html += s + (isCommentBinding ? commentMarker : nodeMarker);\n      } else {\n        // For attributes we use just a marker sentinel, and also append a\n        // $lit$ suffix to the name to opt-out of attribute-specific parsing\n        // that IE and Edge do for style and certain SVG attributes.\n        html += s.substr(0, attributeMatch.index) + attributeMatch[1] +\n            attributeMatch[2] + boundAttributeSuffix + attributeMatch[3] +\n            marker;\n      }\n    }\n    html += this.strings[l];\n    return html;\n  }\n\n  getTemplateElement(): HTMLTemplateElement {\n    const template = document.createElement('template');\n    let value = this.getHTML();\n    if (policy !== undefined) {\n      // this is secure because `this.strings` is a TemplateStringsArray.\n      // TODO: validate this when\n      // https://github.com/tc39/proposal-array-is-template-object is\n      // implemented.\n      value = policy.createHTML(value) as unknown as string;\n    }\n    template.innerHTML = value;\n    return template;\n  }\n}\n\n/**\n * A TemplateResult for SVG fragments.\n *\n * This class wraps HTML in an `<svg>` tag in order to parse its contents in the\n * SVG namespace, then modifies the template to remove the `<svg>` tag so that\n * clones only container the original fragment.\n */\nexport class SVGTemplateResult extends TemplateResult {\n  getHTML(): string {\n    return `<svg>${super.getHTML()}</svg>`;\n  }\n\n  getTemplateElement(): HTMLTemplateElement {\n    const template = super.getTemplateElement();\n    const content = template.content;\n    const svgElement = content.firstChild!;\n    content.removeChild(svgElement);\n    reparentNodes(content, svgElement.firstChild);\n    return template;\n  }\n}\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {isDirective} from './directive.js';\nimport {removeNodes} from './dom.js';\nimport {noChange, nothing, Part} from './part.js';\nimport {RenderOptions} from './render-options.js';\nimport {TemplateInstance} from './template-instance.js';\nimport {TemplateResult} from './template-result.js';\nimport {createMarker} from './template.js';\n\n// https://tc39.github.io/ecma262/#sec-typeof-operator\nexport type Primitive = null|undefined|boolean|number|string|symbol|bigint;\nexport const isPrimitive = (value: unknown): value is Primitive => {\n  return (\n      value === null ||\n      !(typeof value === 'object' || typeof value === 'function'));\n};\nexport const isIterable = (value: unknown): value is Iterable<unknown> => {\n  return Array.isArray(value) ||\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      !!(value && (value as any)[Symbol.iterator]);\n};\n\n/**\n * Writes attribute values to the DOM for a group of AttributeParts bound to a\n * single attribute. The value is only set once even if there are multiple parts\n * for an attribute.\n */\nexport class AttributeCommitter {\n  readonly element: Element;\n  readonly name: string;\n  readonly strings: ReadonlyArray<string>;\n  readonly parts: ReadonlyArray<AttributePart>;\n  dirty = true;\n\n  constructor(element: Element, name: string, strings: ReadonlyArray<string>) {\n    this.element = element;\n    this.name = name;\n    this.strings = strings;\n    this.parts = [];\n    for (let i = 0; i < strings.length - 1; i++) {\n      (this.parts as AttributePart[])[i] = this._createPart();\n    }\n  }\n\n  /**\n   * Creates a single part. Override this to create a differnt type of part.\n   */\n  protected _createPart(): AttributePart {\n    return new AttributePart(this);\n  }\n\n  protected _getValue(): unknown {\n    const strings = this.strings;\n    const l = strings.length - 1;\n    const parts = this.parts;\n\n    // If we're assigning an attribute via syntax like:\n    //    attr=\"${foo}\"  or  attr=${foo}\n    // but not\n    //    attr=\"${foo} ${bar}\" or attr=\"${foo} baz\"\n    // then we don't want to coerce the attribute value into one long\n    // string. Instead we want to just return the value itself directly,\n    // so that sanitizeDOMValue can get the actual value rather than\n    // String(value)\n    // The exception is if v is an array, in which case we do want to smash\n    // it together into a string without calling String() on the array.\n    //\n    // This also allows trusted values (when using TrustedTypes) being\n    // assigned to DOM sinks without being stringified in the process.\n    if (l === 1 && strings[0] === '' && strings[1] === '') {\n      const v = parts[0].value;\n      if (typeof v === 'symbol') {\n        return String(v);\n      }\n      if (typeof v === 'string' || !isIterable(v)) {\n        return v;\n      }\n    }\n    let text = '';\n\n    for (let i = 0; i < l; i++) {\n      text += strings[i];\n      const part = parts[i];\n      if (part !== undefined) {\n        const v = part.value;\n        if (isPrimitive(v) || !isIterable(v)) {\n          text += typeof v === 'string' ? v : String(v);\n        } else {\n          for (const t of v) {\n            text += typeof t === 'string' ? t : String(t);\n          }\n        }\n      }\n    }\n\n    text += strings[l];\n    return text;\n  }\n\n  commit(): void {\n    if (this.dirty) {\n      this.dirty = false;\n      this.element.setAttribute(this.name, this._getValue() as string);\n    }\n  }\n}\n\n/**\n * A Part that controls all or part of an attribute value.\n */\nexport class AttributePart implements Part {\n  readonly committer: AttributeCommitter;\n  value: unknown = undefined;\n\n  constructor(committer: AttributeCommitter) {\n    this.committer = committer;\n  }\n\n  setValue(value: unknown): void {\n    if (value !== noChange && (!isPrimitive(value) || value !== this.value)) {\n      this.value = value;\n      // If the value is a not a directive, dirty the committer so that it'll\n      // call setAttribute. If the value is a directive, it'll dirty the\n      // committer if it calls setValue().\n      if (!isDirective(value)) {\n        this.committer.dirty = true;\n      }\n    }\n  }\n\n  commit() {\n    while (isDirective(this.value)) {\n      const directive = this.value;\n      this.value = noChange;\n      directive(this);\n    }\n    if (this.value === noChange) {\n      return;\n    }\n    this.committer.commit();\n  }\n}\n\n/**\n * A Part that controls a location within a Node tree. Like a Range, NodePart\n * has start and end locations and can set and update the Nodes between those\n * locations.\n *\n * NodeParts support several value types: primitives, Nodes, TemplateResults,\n * as well as arrays and iterables of those types.\n */\nexport class NodePart implements Part {\n  readonly options: RenderOptions;\n  startNode!: Node;\n  endNode!: Node;\n  value: unknown = undefined;\n  private __pendingValue: unknown = undefined;\n\n  constructor(options: RenderOptions) {\n    this.options = options;\n  }\n\n  /**\n   * Appends this part into a container.\n   *\n   * This part must be empty, as its contents are not automatically moved.\n   */\n  appendInto(container: Node) {\n    this.startNode = container.appendChild(createMarker());\n    this.endNode = container.appendChild(createMarker());\n  }\n\n  /**\n   * Inserts this part after the `ref` node (between `ref` and `ref`'s next\n   * sibling). Both `ref` and its next sibling must be static, unchanging nodes\n   * such as those that appear in a literal section of a template.\n   *\n   * This part must be empty, as its contents are not automatically moved.\n   */\n  insertAfterNode(ref: Node) {\n    this.startNode = ref;\n    this.endNode = ref.nextSibling!;\n  }\n\n  /**\n   * Appends this part into a parent part.\n   *\n   * This part must be empty, as its contents are not automatically moved.\n   */\n  appendIntoPart(part: NodePart) {\n    part.__insert(this.startNode = createMarker());\n    part.__insert(this.endNode = createMarker());\n  }\n\n  /**\n   * Inserts this part after the `ref` part.\n   *\n   * This part must be empty, as its contents are not automatically moved.\n   */\n  insertAfterPart(ref: NodePart) {\n    ref.__insert(this.startNode = createMarker());\n    this.endNode = ref.endNode;\n    ref.endNode = this.startNode;\n  }\n\n  setValue(value: unknown): void {\n    this.__pendingValue = value;\n  }\n\n  commit() {\n    if (this.startNode.parentNode === null) {\n      return;\n    }\n    while (isDirective(this.__pendingValue)) {\n      const directive = this.__pendingValue;\n      this.__pendingValue = noChange;\n      directive(this);\n    }\n    const value = this.__pendingValue;\n    if (value === noChange) {\n      return;\n    }\n    if (isPrimitive(value)) {\n      if (value !== this.value) {\n        this.__commitText(value);\n      }\n    } else if (value instanceof TemplateResult) {\n      this.__commitTemplateResult(value);\n    } else if (value instanceof Node) {\n      this.__commitNode(value);\n    } else if (isIterable(value)) {\n      this.__commitIterable(value);\n    } else if (value === nothing) {\n      this.value = nothing;\n      this.clear();\n    } else {\n      // Fallback, will render the string representation\n      this.__commitText(value);\n    }\n  }\n\n  private __insert(node: Node) {\n    this.endNode.parentNode!.insertBefore(node, this.endNode);\n  }\n\n  private __commitNode(value: Node): void {\n    if (this.value === value) {\n      return;\n    }\n    this.clear();\n    this.__insert(value);\n    this.value = value;\n  }\n\n  private __commitText(value: unknown): void {\n    const node = this.startNode.nextSibling!;\n    value = value == null ? '' : value;\n    // If `value` isn't already a string, we explicitly convert it here in case\n    // it can't be implicitly converted - i.e. it's a symbol.\n    const valueAsString: string =\n        typeof value === 'string' ? value : String(value);\n    if (node === this.endNode.previousSibling &&\n        node.nodeType === 3 /* Node.TEXT_NODE */) {\n      // If we only have a single text node between the markers, we can just\n      // set its value, rather than replacing it.\n      // TODO(justinfagnani): Can we just check if this.value is primitive?\n      (node as Text).data = valueAsString;\n    } else {\n      this.__commitNode(document.createTextNode(valueAsString));\n    }\n    this.value = value;\n  }\n\n  private __commitTemplateResult(value: TemplateResult): void {\n    const template = this.options.templateFactory(value);\n    if (this.value instanceof TemplateInstance &&\n        this.value.template === template) {\n      this.value.update(value.values);\n    } else {\n      // Make sure we propagate the template processor from the TemplateResult\n      // so that we use its syntax extension, etc. The template factory comes\n      // from the render function options so that it can control template\n      // caching and preprocessing.\n      const instance =\n          new TemplateInstance(template, value.processor, this.options);\n      const fragment = instance._clone();\n      instance.update(value.values);\n      this.__commitNode(fragment);\n      this.value = instance;\n    }\n  }\n\n  private __commitIterable(value: Iterable<unknown>): void {\n    // For an Iterable, we create a new InstancePart per item, then set its\n    // value to the item. This is a little bit of overhead for every item in\n    // an Iterable, but it lets us recurse easily and efficiently update Arrays\n    // of TemplateResults that will be commonly returned from expressions like:\n    // array.map((i) => html`${i}`), by reusing existing TemplateInstances.\n\n    // If _value is an array, then the previous render was of an\n    // iterable and _value will contain the NodeParts from the previous\n    // render. If _value is not an array, clear this part and make a new\n    // array for NodeParts.\n    if (!Array.isArray(this.value)) {\n      this.value = [];\n      this.clear();\n    }\n\n    // Lets us keep track of how many items we stamped so we can clear leftover\n    // items from a previous render\n    const itemParts = this.value as NodePart[];\n    let partIndex = 0;\n    let itemPart: NodePart|undefined;\n\n    for (const item of value) {\n      // Try to reuse an existing part\n      itemPart = itemParts[partIndex];\n\n      // If no existing part, create a new one\n      if (itemPart === undefined) {\n        itemPart = new NodePart(this.options);\n        itemParts.push(itemPart);\n        if (partIndex === 0) {\n          itemPart.appendIntoPart(this);\n        } else {\n          itemPart.insertAfterPart(itemParts[partIndex - 1]);\n        }\n      }\n      itemPart.setValue(item);\n      itemPart.commit();\n      partIndex++;\n    }\n\n    if (partIndex < itemParts.length) {\n      // Truncate the parts array so _value reflects the current state\n      itemParts.length = partIndex;\n      this.clear(itemPart && itemPart.endNode);\n    }\n  }\n\n  clear(startNode: Node = this.startNode) {\n    removeNodes(\n        this.startNode.parentNode!, startNode.nextSibling!, this.endNode);\n  }\n}\n\n/**\n * Implements a boolean attribute, roughly as defined in the HTML\n * specification.\n *\n * If the value is truthy, then the attribute is present with a value of\n * ''. If the value is falsey, the attribute is removed.\n */\nexport class BooleanAttributePart implements Part {\n  readonly element: Element;\n  readonly name: string;\n  readonly strings: readonly string[];\n  value: unknown = undefined;\n  private __pendingValue: unknown = undefined;\n\n  constructor(element: Element, name: string, strings: readonly string[]) {\n    if (strings.length !== 2 || strings[0] !== '' || strings[1] !== '') {\n      throw new Error(\n          'Boolean attributes can only contain a single expression');\n    }\n    this.element = element;\n    this.name = name;\n    this.strings = strings;\n  }\n\n  setValue(value: unknown): void {\n    this.__pendingValue = value;\n  }\n\n  commit() {\n    while (isDirective(this.__pendingValue)) {\n      const directive = this.__pendingValue;\n      this.__pendingValue = noChange;\n      directive(this);\n    }\n    if (this.__pendingValue === noChange) {\n      return;\n    }\n    const value = !!this.__pendingValue;\n    if (this.value !== value) {\n      if (value) {\n        this.element.setAttribute(this.name, '');\n      } else {\n        this.element.removeAttribute(this.name);\n      }\n      this.value = value;\n    }\n    this.__pendingValue = noChange;\n  }\n}\n\n/**\n * Sets attribute values for PropertyParts, so that the value is only set once\n * even if there are multiple parts for a property.\n *\n * If an expression controls the whole property value, then the value is simply\n * assigned to the property under control. If there are string literals or\n * multiple expressions, then the strings are expressions are interpolated into\n * a string first.\n */\nexport class PropertyCommitter extends AttributeCommitter {\n  readonly single: boolean;\n\n  constructor(element: Element, name: string, strings: ReadonlyArray<string>) {\n    super(element, name, strings);\n    this.single =\n        (strings.length === 2 && strings[0] === '' && strings[1] === '');\n  }\n\n  protected _createPart(): PropertyPart {\n    return new PropertyPart(this);\n  }\n\n  protected _getValue() {\n    if (this.single) {\n      return this.parts[0].value;\n    }\n    return super._getValue();\n  }\n\n  commit(): void {\n    if (this.dirty) {\n      this.dirty = false;\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      (this.element as any)[this.name] = this._getValue();\n    }\n  }\n}\n\nexport class PropertyPart extends AttributePart {}\n\n// Detect event listener options support. If the `capture` property is read\n// from the options object, then options are supported. If not, then the third\n// argument to add/removeEventListener is interpreted as the boolean capture\n// value so we should only pass the `capture` property.\nlet eventOptionsSupported = false;\n\n// Wrap into an IIFE because MS Edge <= v41 does not support having try/catch\n// blocks right into the body of a module\n(() => {\n  try {\n    const options = {\n      get capture() {\n        eventOptionsSupported = true;\n        return false;\n      }\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    window.addEventListener('test', options as any, options);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    window.removeEventListener('test', options as any, options);\n  } catch (_e) {\n    // event options not supported\n  }\n})();\n\ntype EventHandlerWithOptions =\n    EventListenerOrEventListenerObject&Partial<AddEventListenerOptions>;\nexport class EventPart implements Part {\n  readonly element: Element;\n  readonly eventName: string;\n  readonly eventContext?: EventTarget;\n  value: undefined|EventHandlerWithOptions = undefined;\n  private __options?: AddEventListenerOptions;\n  private __pendingValue: undefined|EventHandlerWithOptions = undefined;\n  private readonly __boundHandleEvent: (event: Event) => void;\n\n  constructor(element: Element, eventName: string, eventContext?: EventTarget) {\n    this.element = element;\n    this.eventName = eventName;\n    this.eventContext = eventContext;\n    this.__boundHandleEvent = (e) => this.handleEvent(e);\n  }\n\n  setValue(value: undefined|EventHandlerWithOptions): void {\n    this.__pendingValue = value;\n  }\n\n  commit() {\n    while (isDirective(this.__pendingValue)) {\n      const directive = this.__pendingValue;\n      this.__pendingValue = noChange as EventHandlerWithOptions;\n      directive(this);\n    }\n    if (this.__pendingValue === noChange) {\n      return;\n    }\n\n    const newListener = this.__pendingValue;\n    const oldListener = this.value;\n    const shouldRemoveListener = newListener == null ||\n        oldListener != null &&\n            (newListener.capture !== oldListener.capture ||\n             newListener.once !== oldListener.once ||\n             newListener.passive !== oldListener.passive);\n    const shouldAddListener =\n        newListener != null && (oldListener == null || shouldRemoveListener);\n\n    if (shouldRemoveListener) {\n      this.element.removeEventListener(\n          this.eventName, this.__boundHandleEvent, this.__options);\n    }\n    if (shouldAddListener) {\n      this.__options = getOptions(newListener);\n      this.element.addEventListener(\n          this.eventName, this.__boundHandleEvent, this.__options);\n    }\n    this.value = newListener;\n    this.__pendingValue = noChange as EventHandlerWithOptions;\n  }\n\n  handleEvent(event: Event) {\n    if (typeof this.value === 'function') {\n      this.value.call(this.eventContext || this.element, event);\n    } else {\n      (this.value as EventListenerObject).handleEvent(event);\n    }\n  }\n}\n\n// We copy options because of the inconsistent behavior of browsers when reading\n// the third argument of add/removeEventListener. IE11 doesn't support options\n// at all. Chrome 41 only reads `capture` if the argument is an object.\nconst getOptions = (o: AddEventListenerOptions|undefined) => o &&\n    (eventOptionsSupported ?\n         {capture: o.capture, passive: o.passive, once: o.once} :\n         o.capture as AddEventListenerOptions);\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {TemplateResult} from './template-result.js';\nimport {marker, Template} from './template.js';\n\n/**\n * A function type that creates a Template from a TemplateResult.\n *\n * This is a hook into the template-creation process for rendering that\n * requires some modification of templates before they're used, like ShadyCSS,\n * which must add classes to elements and remove styles.\n *\n * Templates should be cached as aggressively as possible, so that many\n * TemplateResults produced from the same expression only do the work of\n * creating the Template the first time.\n *\n * Templates are usually cached by TemplateResult.strings and\n * TemplateResult.type, but may be cached by other keys if this function\n * modifies the template.\n *\n * Note that currently TemplateFactories must not add, remove, or reorder\n * expressions, because there is no way to describe such a modification\n * to render() so that values are interpolated to the correct place in the\n * template instances.\n */\nexport type TemplateFactory = (result: TemplateResult) => Template;\n\n/**\n * The default TemplateFactory which caches Templates keyed on\n * result.type and result.strings.\n */\nexport function templateFactory(result: TemplateResult) {\n  let templateCache = templateCaches.get(result.type);\n  if (templateCache === undefined) {\n    templateCache = {\n      stringsArray: new WeakMap<TemplateStringsArray, Template>(),\n      keyString: new Map<string, Template>()\n    };\n    templateCaches.set(result.type, templateCache);\n  }\n\n  let template = templateCache.stringsArray.get(result.strings);\n  if (template !== undefined) {\n    return template;\n  }\n\n  // If the TemplateStringsArray is new, generate a key from the strings\n  // This key is shared between all templates with identical content\n  const key = result.strings.join(marker);\n\n  // Check if we already have a Template for this key\n  template = templateCache.keyString.get(key);\n  if (template === undefined) {\n    // If we have not seen this key before, create a new Template\n    template = new Template(result, result.getTemplateElement());\n    // Cache the Template for this key\n    templateCache.keyString.set(key, template);\n  }\n\n  // Cache all future queries for this TemplateStringsArray\n  templateCache.stringsArray.set(result.strings, template);\n  return template;\n}\n\n/**\n * The first argument to JS template tags retain identity across multiple\n * calls to a tag for the same literal, so we can cache work done per literal\n * in a Map.\n *\n * Safari currently has a bug which occasionally breaks this behavior, so we\n * need to cache the Template at two levels. We first cache the\n * TemplateStringsArray, and if that fails, we cache a key constructed by\n * joining the strings array.\n */\nexport interface TemplateCache {\n  readonly stringsArray: WeakMap<TemplateStringsArray, Template>;\n  readonly keyString: Map<string, Template>;\n}\n\nexport const templateCaches = new Map<string, TemplateCache>();\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {removeNodes} from './dom.js';\nimport {NodePart} from './parts.js';\nimport {RenderOptions} from './render-options.js';\nimport {templateFactory} from './template-factory.js';\n\nexport const parts = new WeakMap<Node, NodePart>();\n\n/**\n * Renders a template result or other value to a container.\n *\n * To update a container with new values, reevaluate the template literal and\n * call `render` with the new result.\n *\n * @param result Any value renderable by NodePart - typically a TemplateResult\n *     created by evaluating a template tag like `html` or `svg`.\n * @param container A DOM parent to render to. The entire contents are either\n *     replaced, or efficiently updated if the same result type was previous\n *     rendered there.\n * @param options RenderOptions for the entire render tree rendered to this\n *     container. Render options must *not* change between renders to the same\n *     container, as those changes will not effect previously rendered DOM.\n */\nexport const render =\n    (result: unknown,\n     container: Element|DocumentFragment,\n     options?: Partial<RenderOptions>) => {\n      let part = parts.get(container);\n      if (part === undefined) {\n        removeNodes(container, container.firstChild);\n        parts.set(container, part = new NodePart({\n                               templateFactory,\n                               ...options,\n                             }));\n        part.appendInto(container);\n      }\n      part.setValue(result);\n      part.commit();\n    };\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport {Part} from './part.js';\nimport {AttributeCommitter, BooleanAttributePart, EventPart, NodePart, PropertyCommitter} from './parts.js';\nimport {RenderOptions} from './render-options.js';\nimport {TemplateProcessor} from './template-processor.js';\n\n/**\n * Creates Parts when a template is instantiated.\n */\nexport class DefaultTemplateProcessor implements TemplateProcessor {\n  /**\n   * Create parts for an attribute-position binding, given the event, attribute\n   * name, and string literals.\n   *\n   * @param element The element containing the binding\n   * @param name  The attribute name\n   * @param strings The string literals. There are always at least two strings,\n   *   event for fully-controlled bindings with a single expression.\n   */\n  handleAttributeExpressions(\n      element: Element, name: string, strings: string[],\n      options: RenderOptions): ReadonlyArray<Part> {\n    const prefix = name[0];\n    if (prefix === '.') {\n      const committer = new PropertyCommitter(element, name.slice(1), strings);\n      return committer.parts;\n    }\n    if (prefix === '@') {\n      return [new EventPart(element, name.slice(1), options.eventContext)];\n    }\n    if (prefix === '?') {\n      return [new BooleanAttributePart(element, name.slice(1), strings)];\n    }\n    const committer = new AttributeCommitter(element, name, strings);\n    return committer.parts;\n  }\n  /**\n   * Create parts for a text-position binding.\n   * @param templateFactory\n   */\n  handleTextExpression(options: RenderOptions) {\n    return new NodePart(options);\n  }\n}\n\nexport const defaultTemplateProcessor = new DefaultTemplateProcessor();\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n *\n * Main lit-html module.\n *\n * Main exports:\n *\n * -  [[html]]\n * -  [[svg]]\n * -  [[render]]\n *\n * @packageDocumentation\n */\n\n/**\n * Do not remove this comment; it keeps typedoc from misplacing the module\n * docs.\n */\nimport {defaultTemplateProcessor} from './lib/default-template-processor.js';\nimport {SVGTemplateResult, TemplateResult} from './lib/template-result.js';\n\nexport {DefaultTemplateProcessor, defaultTemplateProcessor} from './lib/default-template-processor.js';\nexport {directive, DirectiveFn, isDirective} from './lib/directive.js';\n// TODO(justinfagnani): remove line when we get NodePart moving methods\nexport {removeNodes, reparentNodes} from './lib/dom.js';\nexport {noChange, nothing, Part} from './lib/part.js';\nexport {AttributeCommitter, AttributePart, BooleanAttributePart, EventPart, isIterable, isPrimitive, NodePart, PropertyCommitter, PropertyPart} from './lib/parts.js';\nexport {RenderOptions} from './lib/render-options.js';\nexport {parts, render} from './lib/render.js';\nexport {templateCaches, templateFactory} from './lib/template-factory.js';\nexport {TemplateInstance} from './lib/template-instance.js';\nexport {TemplateProcessor} from './lib/template-processor.js';\nexport {SVGTemplateResult, TemplateResult} from './lib/template-result.js';\nexport {createMarker, isTemplatePartActive, Template} from './lib/template.js';\n\ndeclare global {\n  interface Window {\n    litHtmlVersions: string[];\n  }\n}\n\n// IMPORTANT: do not change the property name or the assignment expression.\n// This line will be used in regexes to search for lit-html usage.\n// TODO(justinfagnani): inject version number at build time\nif (typeof window !== 'undefined') {\n  (window['litHtmlVersions'] || (window['litHtmlVersions'] = [])).push('1.4.1');\n}\n\n/**\n * Interprets a template literal as an HTML template that can efficiently\n * render to and update a container.\n */\nexport const html = (strings: TemplateStringsArray, ...values: unknown[]) =>\n    new TemplateResult(strings, values, 'html', defaultTemplateProcessor);\n\n/**\n * Interprets a template literal as an SVG template that can efficiently\n * render to and update a container.\n */\nexport const svg = (strings: TemplateStringsArray, ...values: unknown[]) =>\n    new SVGTemplateResult(strings, values, 'svg', defaultTemplateProcessor);\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * Module to add shady DOM/shady CSS polyfill support to lit-html template\n * rendering. See the [[render]] method for details.\n *\n * @packageDocumentation\n */\n\n/**\n * Do not remove this comment; it keeps typedoc from misplacing the module\n * docs.\n */\nimport {removeNodes} from './dom.js';\nimport {insertNodeIntoTemplate, removeNodesFromTemplate} from './modify-template.js';\nimport {RenderOptions} from './render-options.js';\nimport {parts, render as litRender} from './render.js';\nimport {templateCaches} from './template-factory.js';\nimport {TemplateInstance} from './template-instance.js';\nimport {TemplateResult} from './template-result.js';\nimport {marker, Template} from './template.js';\n\nexport {html, svg, TemplateResult} from '../lit-html.js';\n\n// Get a key to lookup in `templateCaches`.\nconst getTemplateCacheKey = (type: string, scopeName: string) =>\n    `${type}--${scopeName}`;\n\nlet compatibleShadyCSSVersion = true;\n\nif (typeof window.ShadyCSS === 'undefined') {\n  compatibleShadyCSSVersion = false;\n} else if (typeof window.ShadyCSS.prepareTemplateDom === 'undefined') {\n  console.warn(\n      `Incompatible ShadyCSS version detected. ` +\n      `Please update to at least @webcomponents/webcomponentsjs@2.0.2 and ` +\n      `@webcomponents/shadycss@1.3.1.`);\n  compatibleShadyCSSVersion = false;\n}\n\n/**\n * Template factory which scopes template DOM using ShadyCSS.\n * @param scopeName {string}\n */\nexport const shadyTemplateFactory = (scopeName: string) =>\n    (result: TemplateResult) => {\n      const cacheKey = getTemplateCacheKey(result.type, scopeName);\n      let templateCache = templateCaches.get(cacheKey);\n      if (templateCache === undefined) {\n        templateCache = {\n          stringsArray: new WeakMap<TemplateStringsArray, Template>(),\n          keyString: new Map<string, Template>()\n        };\n        templateCaches.set(cacheKey, templateCache);\n      }\n\n      let template = templateCache.stringsArray.get(result.strings);\n      if (template !== undefined) {\n        return template;\n      }\n\n      const key = result.strings.join(marker);\n      template = templateCache.keyString.get(key);\n      if (template === undefined) {\n        const element = result.getTemplateElement();\n        if (compatibleShadyCSSVersion) {\n          window.ShadyCSS!.prepareTemplateDom(element, scopeName);\n        }\n        template = new Template(result, element);\n        templateCache.keyString.set(key, template);\n      }\n      templateCache.stringsArray.set(result.strings, template);\n      return template;\n    };\n\nconst TEMPLATE_TYPES = ['html', 'svg'];\n\n/**\n * Removes all style elements from Templates for the given scopeName.\n */\nconst removeStylesFromLitTemplates = (scopeName: string) => {\n  TEMPLATE_TYPES.forEach((type) => {\n    const templates = templateCaches.get(getTemplateCacheKey(type, scopeName));\n    if (templates !== undefined) {\n      templates.keyString.forEach((template) => {\n        const {element: {content}} = template;\n        // IE 11 doesn't support the iterable param Set constructor\n        const styles = new Set<Element>();\n        Array.from(content.querySelectorAll('style')).forEach((s: Element) => {\n          styles.add(s);\n        });\n        removeNodesFromTemplate(template, styles);\n      });\n    }\n  });\n};\n\nconst shadyRenderSet = new Set<string>();\n\n/**\n * For the given scope name, ensures that ShadyCSS style scoping is performed.\n * This is done just once per scope name so the fragment and template cannot\n * be modified.\n * (1) extracts styles from the rendered fragment and hands them to ShadyCSS\n * to be scoped and appended to the document\n * (2) removes style elements from all lit-html Templates for this scope name.\n *\n * Note, <style> elements can only be placed into templates for the\n * initial rendering of the scope. If <style> elements are included in templates\n * dynamically rendered to the scope (after the first scope render), they will\n * not be scoped and the <style> will be left in the template and rendered\n * output.\n */\nconst prepareTemplateStyles =\n    (scopeName: string, renderedDOM: DocumentFragment, template?: Template) => {\n      shadyRenderSet.add(scopeName);\n      // If `renderedDOM` is stamped from a Template, then we need to edit that\n      // Template's underlying template element. Otherwise, we create one here\n      // to give to ShadyCSS, which still requires one while scoping.\n      const templateElement =\n          !!template ? template.element : document.createElement('template');\n      // Move styles out of rendered DOM and store.\n      const styles = renderedDOM.querySelectorAll('style');\n      const {length} = styles;\n      // If there are no styles, skip unnecessary work\n      if (length === 0) {\n        // Ensure prepareTemplateStyles is called to support adding\n        // styles via `prepareAdoptedCssText` since that requires that\n        // `prepareTemplateStyles` is called.\n        //\n        // ShadyCSS will only update styles containing @apply in the template\n        // given to `prepareTemplateStyles`. If no lit Template was given,\n        // ShadyCSS will not be able to update uses of @apply in any relevant\n        // template. However, this is not a problem because we only create the\n        // template for the purpose of supporting `prepareAdoptedCssText`,\n        // which doesn't support @apply at all.\n        window.ShadyCSS!.prepareTemplateStyles(templateElement, scopeName);\n        return;\n      }\n      const condensedStyle = document.createElement('style');\n      // Collect styles into a single style. This helps us make sure ShadyCSS\n      // manipulations will not prevent us from being able to fix up template\n      // part indices.\n      // NOTE: collecting styles is inefficient for browsers but ShadyCSS\n      // currently does this anyway. When it does not, this should be changed.\n      for (let i = 0; i < length; i++) {\n        const style = styles[i];\n        style.parentNode!.removeChild(style);\n        condensedStyle.textContent! += style.textContent;\n      }\n      // Remove styles from nested templates in this scope.\n      removeStylesFromLitTemplates(scopeName);\n      // And then put the condensed style into the \"root\" template passed in as\n      // `template`.\n      const content = templateElement.content;\n      if (!!template) {\n        insertNodeIntoTemplate(template, condensedStyle, content.firstChild);\n      } else {\n        content.insertBefore(condensedStyle, content.firstChild);\n      }\n      // Note, it's important that ShadyCSS gets the template that `lit-html`\n      // will actually render so that it can update the style inside when\n      // needed (e.g. @apply native Shadow DOM case).\n      window.ShadyCSS!.prepareTemplateStyles(templateElement, scopeName);\n      const style = content.querySelector('style');\n      if (window.ShadyCSS!.nativeShadow && style !== null) {\n        // When in native Shadow DOM, ensure the style created by ShadyCSS is\n        // included in initially rendered output (`renderedDOM`).\n        renderedDOM.insertBefore(style.cloneNode(true), renderedDOM.firstChild);\n      } else if (!!template) {\n        // When no style is left in the template, parts will be broken as a\n        // result. To fix this, we put back the style node ShadyCSS removed\n        // and then tell lit to remove that node from the template.\n        // There can be no style in the template in 2 cases (1) when Shady DOM\n        // is in use, ShadyCSS removes all styles, (2) when native Shadow DOM\n        // is in use ShadyCSS removes the style if it contains no content.\n        // NOTE, ShadyCSS creates its own style so we can safely add/remove\n        // `condensedStyle` here.\n        content.insertBefore(condensedStyle, content.firstChild);\n        const removes = new Set<Node>();\n        removes.add(condensedStyle);\n        removeNodesFromTemplate(template, removes);\n      }\n    };\n\nexport interface ShadyRenderOptions extends Partial<RenderOptions> {\n  scopeName: string;\n}\n\n/**\n * Extension to the standard `render` method which supports rendering\n * to ShadowRoots when the ShadyDOM (https://github.com/webcomponents/shadydom)\n * and ShadyCSS (https://github.com/webcomponents/shadycss) polyfills are used\n * or when the webcomponentsjs\n * (https://github.com/webcomponents/webcomponentsjs) polyfill is used.\n *\n * Adds a `scopeName` option which is used to scope element DOM and stylesheets\n * when native ShadowDOM is unavailable. The `scopeName` will be added to\n * the class attribute of all rendered DOM. In addition, any style elements will\n * be automatically re-written with this `scopeName` selector and moved out\n * of the rendered DOM and into the document `<head>`.\n *\n * It is common to use this render method in conjunction with a custom element\n * which renders a shadowRoot. When this is done, typically the element's\n * `localName` should be used as the `scopeName`.\n *\n * In addition to DOM scoping, ShadyCSS also supports a basic shim for css\n * custom properties (needed only on older browsers like IE11) and a shim for\n * a deprecated feature called `@apply` that supports applying a set of css\n * custom properties to a given location.\n *\n * Usage considerations:\n *\n * * Part values in `<style>` elements are only applied the first time a given\n * `scopeName` renders. Subsequent changes to parts in style elements will have\n * no effect. Because of this, parts in style elements should only be used for\n * values that will never change, for example parts that set scope-wide theme\n * values or parts which render shared style elements.\n *\n * * Note, due to a limitation of the ShadyDOM polyfill, rendering in a\n * custom element's `constructor` is not supported. Instead rendering should\n * either done asynchronously, for example at microtask timing (for example\n * `Promise.resolve()`), or be deferred until the first time the element's\n * `connectedCallback` runs.\n *\n * Usage considerations when using shimmed custom properties or `@apply`:\n *\n * * Whenever any dynamic changes are made which affect\n * css custom properties, `ShadyCSS.styleElement(element)` must be called\n * to update the element. There are two cases when this is needed:\n * (1) the element is connected to a new parent, (2) a class is added to the\n * element that causes it to match different custom properties.\n * To address the first case when rendering a custom element, `styleElement`\n * should be called in the element's `connectedCallback`.\n *\n * * Shimmed custom properties may only be defined either for an entire\n * shadowRoot (for example, in a `:host` rule) or via a rule that directly\n * matches an element with a shadowRoot. In other words, instead of flowing from\n * parent to child as do native css custom properties, shimmed custom properties\n * flow only from shadowRoots to nested shadowRoots.\n *\n * * When using `@apply` mixing css shorthand property names with\n * non-shorthand names (for example `border` and `border-width`) is not\n * supported.\n */\nexport const render =\n    (result: unknown,\n     container: Element|DocumentFragment|ShadowRoot,\n     options: ShadyRenderOptions) => {\n      if (!options || typeof options !== 'object' || !options.scopeName) {\n        throw new Error('The `scopeName` option is required.');\n      }\n      const scopeName = options.scopeName;\n      const hasRendered = parts.has(container);\n      const needsScoping = compatibleShadyCSSVersion &&\n          container.nodeType === 11 /* Node.DOCUMENT_FRAGMENT_NODE */ &&\n          !!(container as ShadowRoot).host;\n      // Handle first render to a scope specially...\n      const firstScopeRender = needsScoping && !shadyRenderSet.has(scopeName);\n      // On first scope render, render into a fragment; this cannot be a single\n      // fragment that is reused since nested renders can occur synchronously.\n      const renderContainer =\n          firstScopeRender ? document.createDocumentFragment() : container;\n      litRender(\n          result,\n          renderContainer,\n          {templateFactory: shadyTemplateFactory(scopeName), ...options} as\n              RenderOptions);\n      // When performing first scope render,\n      // (1) We've rendered into a fragment so that there's a chance to\n      // `prepareTemplateStyles` before sub-elements hit the DOM\n      // (which might cause them to render based on a common pattern of\n      // rendering in a custom element's `connectedCallback`);\n      // (2) Scope the template with ShadyCSS one time only for this scope.\n      // (3) Render the fragment into the container and make sure the\n      // container knows its `part` is the one we just rendered. This ensures\n      // DOM will be re-used on subsequent renders.\n      if (firstScopeRender) {\n        const part = parts.get(renderContainer)!;\n        parts.delete(renderContainer);\n        // ShadyCSS might have style sheets (e.g. from `prepareAdoptedCssText`)\n        // that should apply to `renderContainer` even if the rendered value is\n        // not a TemplateInstance. However, it will only insert scoped styles\n        // into the document if `prepareTemplateStyles` has already been called\n        // for the given scope name.\n        const template = part.value instanceof TemplateInstance ?\n            part.value.template :\n            undefined;\n        prepareTemplateStyles(\n            scopeName, renderContainer as DocumentFragment, template);\n        removeNodes(container, container.firstChild);\n        container.appendChild(renderContainer);\n        parts.set(container, part);\n      }\n      // After elements have hit the DOM, update styling if this is the\n      // initial render to this container.\n      // This is needed whenever dynamic changes are made so it would be\n      // safest to do every render; however, this would regress performance\n      // so we leave it up to the user to call `ShadyCSS.styleElement`\n      // for dynamic changes.\n      if (!hasRendered && needsScoping) {\n        window.ShadyCSS!.styleElement((container as ShadowRoot).host);\n      }\n    };\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * Use this module if you want to create your own base class extending\n * [[UpdatingElement]].\n * @packageDocumentation\n */\n\n/*\n * When using Closure Compiler, JSCompiler_renameProperty(property, object) is\n * replaced at compile time by the munged name for object[property]. We cannot\n * alias this function, so we have to use a small shim that has the same\n * behavior when not compiling.\n */\nwindow.JSCompiler_renameProperty =\n    <P extends PropertyKey>(prop: P, _obj: unknown): P => prop;\n\ndeclare global {\n  var JSCompiler_renameProperty: <P extends PropertyKey>(\n      prop: P, _obj: unknown) => P;\n\n  interface Window {\n    JSCompiler_renameProperty: typeof JSCompiler_renameProperty;\n  }\n}\n\n/**\n * Converts property values to and from attribute values.\n */\nexport interface ComplexAttributeConverter<Type = unknown, TypeHint = unknown> {\n  /**\n   * Function called to convert an attribute value to a property\n   * value.\n   */\n  fromAttribute?(value: string|null, type?: TypeHint): Type;\n\n  /**\n   * Function called to convert a property value to an attribute\n   * value.\n   *\n   * It returns unknown instead of string, to be compatible with\n   * https://github.com/WICG/trusted-types (and similar efforts).\n   */\n  toAttribute?(value: Type, type?: TypeHint): unknown;\n}\n\ntype AttributeConverter<Type = unknown, TypeHint = unknown> =\n    ComplexAttributeConverter<Type>|\n    ((value: string|null, type?: TypeHint) => Type);\n\n/**\n * Defines options for a property accessor.\n */\nexport interface PropertyDeclaration<Type = unknown, TypeHint = unknown> {\n  /**\n   * Indicates how and whether the property becomes an observed attribute.\n   * If the value is `false`, the property is not added to `observedAttributes`.\n   * If true or absent, the lowercased property name is observed (e.g. `fooBar`\n   * becomes `foobar`). If a string, the string value is observed (e.g\n   * `attribute: 'foo-bar'`).\n   */\n  readonly attribute?: boolean|string;\n\n  /**\n   * Indicates the type of the property. This is used only as a hint for the\n   * `converter` to determine how to convert the attribute\n   * to/from a property.\n   */\n  readonly type?: TypeHint;\n\n  /**\n   * Indicates how to convert the attribute to/from a property. If this value\n   * is a function, it is used to convert the attribute value a the property\n   * value. If it's an object, it can have keys for `fromAttribute` and\n   * `toAttribute`. If no `toAttribute` function is provided and\n   * `reflect` is set to `true`, the property value is set directly to the\n   * attribute. A default `converter` is used if none is provided; it supports\n   * `Boolean`, `String`, `Number`, `Object`, and `Array`. Note,\n   * when a property changes and the converter is used to update the attribute,\n   * the property is never updated again as a result of the attribute changing,\n   * and vice versa.\n   */\n  readonly converter?: AttributeConverter<Type, TypeHint>;\n\n  /**\n   * Indicates if the property should reflect to an attribute.\n   * If `true`, when the property is set, the attribute is set using the\n   * attribute name determined according to the rules for the `attribute`\n   * property option and the value of the property converted using the rules\n   * from the `converter` property option.\n   */\n  readonly reflect?: boolean;\n\n  /**\n   * A function that indicates if a property should be considered changed when\n   * it is set. The function should take the `newValue` and `oldValue` and\n   * return `true` if an update should be requested.\n   */\n  hasChanged?(value: Type, oldValue: Type): boolean;\n\n  /**\n   * Indicates whether an accessor will be created for this property. By\n   * default, an accessor will be generated for this property that requests an\n   * update when set. If this flag is `true`, no accessor will be created, and\n   * it will be the user's responsibility to call\n   * `this.requestUpdate(propertyName, oldValue)` to request an update when\n   * the property changes.\n   */\n  readonly noAccessor?: boolean;\n}\n\n/**\n * Map of properties to PropertyDeclaration options. For each property an\n * accessor is made, and the property is processed according to the\n * PropertyDeclaration options.\n */\nexport interface PropertyDeclarations {\n  readonly [key: string]: PropertyDeclaration;\n}\n\ntype PropertyDeclarationMap = Map<PropertyKey, PropertyDeclaration>;\n\ntype AttributeMap = Map<string, PropertyKey>;\n\n/**\n * Map of changed properties with old values. Takes an optional generic\n * interface corresponding to the declared element properties.\n */\n// tslint:disable-next-line:no-any\nexport type PropertyValues<T = any> =\n    keyof T extends PropertyKey ? Map<keyof T, unknown>: never;\n\nexport const defaultConverter: ComplexAttributeConverter = {\n\n  toAttribute(value: unknown, type?: unknown): unknown {\n    switch (type) {\n      case Boolean:\n        return value ? '' : null;\n      case Object:\n      case Array:\n        // if the value is `null` or `undefined` pass this through\n        // to allow removing/no change behavior.\n        return value == null ? value : JSON.stringify(value);\n    }\n    return value;\n  },\n\n  fromAttribute(value: string|null, type?: unknown) {\n    switch (type) {\n      case Boolean:\n        return value !== null;\n      case Number:\n        return value === null ? null : Number(value);\n      case Object:\n      case Array:\n        // Type assert to adhere to Bazel's \"must type assert JSON parse\" rule.\n        return JSON.parse(value!) as unknown;\n    }\n    return value;\n  }\n\n};\n\nexport interface HasChanged {\n  (value: unknown, old: unknown): boolean;\n}\n\n/**\n * Change function that returns true if `value` is different from `oldValue`.\n * This method is used as the default for a property's `hasChanged` function.\n */\nexport const notEqual: HasChanged = (value: unknown, old: unknown): boolean => {\n  // This ensures (old==NaN, value==NaN) always returns false\n  return old !== value && (old === old || value === value);\n};\n\nconst defaultPropertyDeclaration: PropertyDeclaration = {\n  attribute: true,\n  type: String,\n  converter: defaultConverter,\n  reflect: false,\n  hasChanged: notEqual\n};\n\nconst STATE_HAS_UPDATED = 1;\nconst STATE_UPDATE_REQUESTED = 1 << 2;\nconst STATE_IS_REFLECTING_TO_ATTRIBUTE = 1 << 3;\nconst STATE_IS_REFLECTING_TO_PROPERTY = 1 << 4;\ntype UpdateState = typeof STATE_HAS_UPDATED|typeof STATE_UPDATE_REQUESTED|\n    typeof STATE_IS_REFLECTING_TO_ATTRIBUTE|\n    typeof STATE_IS_REFLECTING_TO_PROPERTY;\n\n/**\n * The Closure JS Compiler doesn't currently have good support for static\n * property semantics where \"this\" is dynamic (e.g.\n * https://github.com/google/closure-compiler/issues/3177 and others) so we use\n * this hack to bypass any rewriting by the compiler.\n */\nconst finalized = 'finalized';\n\n/**\n * Base element class which manages element properties and attributes. When\n * properties change, the `update` method is asynchronously called. This method\n * should be supplied by subclassers to render updates as desired.\n * @noInheritDoc\n */\nexport abstract class UpdatingElement extends HTMLElement {\n  /*\n   * Due to closure compiler ES6 compilation bugs, @nocollapse is required on\n   * all static methods and properties with initializers.  Reference:\n   * - https://github.com/google/closure-compiler/issues/1776\n   */\n\n  /**\n   * Maps attribute names to properties; for example `foobar` attribute to\n   * `fooBar` property. Created lazily on user subclasses when finalizing the\n   * class.\n   */\n  private static _attributeToPropertyMap: AttributeMap;\n\n  /**\n   * Marks class as having finished creating properties.\n   */\n  protected static[finalized] = true;\n\n  /**\n   * Memoized list of all class properties, including any superclass properties.\n   * Created lazily on user subclasses when finalizing the class.\n   */\n  private static _classProperties?: PropertyDeclarationMap;\n\n  /**\n   * User-supplied object that maps property names to `PropertyDeclaration`\n   * objects containing options for configuring the property.\n   */\n  static properties: PropertyDeclarations;\n\n  /**\n   * Returns a list of attributes corresponding to the registered properties.\n   * @nocollapse\n   */\n  static get observedAttributes() {\n    // note: piggy backing on this to ensure we're finalized.\n    this.finalize();\n    const attributes: string[] = [];\n    // Use forEach so this works even if for/of loops are compiled to for loops\n    // expecting arrays\n    this._classProperties!.forEach((v, p) => {\n      const attr = this._attributeNameForProperty(p, v);\n      if (attr !== undefined) {\n        this._attributeToPropertyMap.set(attr, p);\n        attributes.push(attr);\n      }\n    });\n    return attributes;\n  }\n\n  /**\n   * Ensures the private `_classProperties` property metadata is created.\n   * In addition to `finalize` this is also called in `createProperty` to\n   * ensure the `@property` decorator can add property metadata.\n   */\n  /** @nocollapse */\n  private static _ensureClassProperties() {\n    // ensure private storage for property declarations.\n    if (!this.hasOwnProperty(\n            JSCompiler_renameProperty('_classProperties', this))) {\n      this._classProperties = new Map();\n      // NOTE: Workaround IE11 not supporting Map constructor argument.\n      const superProperties: PropertyDeclarationMap =\n          Object.getPrototypeOf(this)._classProperties;\n      if (superProperties !== undefined) {\n        superProperties.forEach(\n            (v: PropertyDeclaration, k: PropertyKey) =>\n                this._classProperties!.set(k, v));\n      }\n    }\n  }\n\n  /**\n   * Creates a property accessor on the element prototype if one does not exist\n   * and stores a PropertyDeclaration for the property with the given options.\n   * The property setter calls the property's `hasChanged` property option\n   * or uses a strict identity check to determine whether or not to request\n   * an update.\n   *\n   * This method may be overridden to customize properties; however,\n   * when doing so, it's important to call `super.createProperty` to ensure\n   * the property is setup correctly. This method calls\n   * `getPropertyDescriptor` internally to get a descriptor to install.\n   * To customize what properties do when they are get or set, override\n   * `getPropertyDescriptor`. To customize the options for a property,\n   * implement `createProperty` like this:\n   *\n   * static createProperty(name, options) {\n   *   options = Object.assign(options, {myOption: true});\n   *   super.createProperty(name, options);\n   * }\n   *\n   * @nocollapse\n   */\n  static createProperty(\n      name: PropertyKey,\n      options: PropertyDeclaration = defaultPropertyDeclaration) {\n    // Note, since this can be called by the `@property` decorator which\n    // is called before `finalize`, we ensure storage exists for property\n    // metadata.\n    this._ensureClassProperties();\n    this._classProperties!.set(name, options);\n    // Do not generate an accessor if the prototype already has one, since\n    // it would be lost otherwise and that would never be the user's intention;\n    // Instead, we expect users to call `requestUpdate` themselves from\n    // user-defined accessors. Note that if the super has an accessor we will\n    // still overwrite it\n    if (options.noAccessor || this.prototype.hasOwnProperty(name)) {\n      return;\n    }\n    const key = typeof name === 'symbol' ? Symbol() : `__${name}`;\n    const descriptor = this.getPropertyDescriptor(name, key, options);\n    if (descriptor !== undefined) {\n      Object.defineProperty(this.prototype, name, descriptor);\n    }\n  }\n\n  /**\n   * Returns a property descriptor to be defined on the given named property.\n   * If no descriptor is returned, the property will not become an accessor.\n   * For example,\n   *\n   *   class MyElement extends LitElement {\n   *     static getPropertyDescriptor(name, key, options) {\n   *       const defaultDescriptor =\n   *           super.getPropertyDescriptor(name, key, options);\n   *       const setter = defaultDescriptor.set;\n   *       return {\n   *         get: defaultDescriptor.get,\n   *         set(value) {\n   *           setter.call(this, value);\n   *           // custom action.\n   *         },\n   *         configurable: true,\n   *         enumerable: true\n   *       }\n   *     }\n   *   }\n   *\n   * @nocollapse\n   */\n  protected static getPropertyDescriptor(\n      name: PropertyKey, key: string|symbol, options: PropertyDeclaration) {\n    return {\n      // tslint:disable-next-line:no-any no symbol in index\n      get(): any {\n        return (this as {[key: string]: unknown})[key as string];\n      },\n      set(this: UpdatingElement, value: unknown) {\n        const oldValue =\n            (this as {} as {[key: string]: unknown})[name as string];\n        (this as {} as {[key: string]: unknown})[key as string] = value;\n        (this as unknown as UpdatingElement)\n            .requestUpdateInternal(name, oldValue, options);\n      },\n      configurable: true,\n      enumerable: true\n    };\n  }\n\n  /**\n   * Returns the property options associated with the given property.\n   * These options are defined with a PropertyDeclaration via the `properties`\n   * object or the `@property` decorator and are registered in\n   * `createProperty(...)`.\n   *\n   * Note, this method should be considered \"final\" and not overridden. To\n   * customize the options for a given property, override `createProperty`.\n   *\n   * @nocollapse\n   * @final\n   */\n  protected static getPropertyOptions(name: PropertyKey) {\n    return this._classProperties && this._classProperties.get(name) ||\n        defaultPropertyDeclaration;\n  }\n\n  /**\n   * Creates property accessors for registered properties and ensures\n   * any superclasses are also finalized.\n   * @nocollapse\n   */\n  protected static finalize() {\n    // finalize any superclasses\n    const superCtor = Object.getPrototypeOf(this);\n    if (!superCtor.hasOwnProperty(finalized)) {\n      superCtor.finalize();\n    }\n    this[finalized] = true;\n    this._ensureClassProperties();\n    // initialize Map populated in observedAttributes\n    this._attributeToPropertyMap = new Map();\n    // make any properties\n    // Note, only process \"own\" properties since this element will inherit\n    // any properties defined on the superClass, and finalization ensures\n    // the entire prototype chain is finalized.\n    if (this.hasOwnProperty(JSCompiler_renameProperty('properties', this))) {\n      const props = this.properties;\n      // support symbols in properties (IE11 does not support this)\n      const propKeys = [\n        ...Object.getOwnPropertyNames(props),\n        ...(typeof Object.getOwnPropertySymbols === 'function') ?\n            Object.getOwnPropertySymbols(props) :\n            []\n      ];\n      // This for/of is ok because propKeys is an array\n      for (const p of propKeys) {\n        // note, use of `any` is due to TypeSript lack of support for symbol in\n        // index types\n        // tslint:disable-next-line:no-any no symbol in index\n        this.createProperty(p, (props as any)[p]);\n      }\n    }\n  }\n\n  /**\n   * Returns the property name for the given attribute `name`.\n   * @nocollapse\n   */\n  private static _attributeNameForProperty(\n      name: PropertyKey, options: PropertyDeclaration) {\n    const attribute = options.attribute;\n    return attribute === false ?\n        undefined :\n        (typeof attribute === 'string' ?\n             attribute :\n             (typeof name === 'string' ? name.toLowerCase() : undefined));\n  }\n\n  /**\n   * Returns true if a property should request an update.\n   * Called when a property value is set and uses the `hasChanged`\n   * option for the property if present or a strict identity check.\n   * @nocollapse\n   */\n  private static _valueHasChanged(\n      value: unknown, old: unknown, hasChanged: HasChanged = notEqual) {\n    return hasChanged(value, old);\n  }\n\n  /**\n   * Returns the property value for the given attribute value.\n   * Called via the `attributeChangedCallback` and uses the property's\n   * `converter` or `converter.fromAttribute` property option.\n   * @nocollapse\n   */\n  private static _propertyValueFromAttribute(\n      value: string|null, options: PropertyDeclaration) {\n    const type = options.type;\n    const converter = options.converter || defaultConverter;\n    const fromAttribute =\n        (typeof converter === 'function' ? converter : converter.fromAttribute);\n    return fromAttribute ? fromAttribute(value, type) : value;\n  }\n\n  /**\n   * Returns the attribute value for the given property value. If this\n   * returns undefined, the property will *not* be reflected to an attribute.\n   * If this returns null, the attribute will be removed, otherwise the\n   * attribute will be set to the value.\n   * This uses the property's `reflect` and `type.toAttribute` property options.\n   * @nocollapse\n   */\n  private static _propertyValueToAttribute(\n      value: unknown, options: PropertyDeclaration) {\n    if (options.reflect === undefined) {\n      return;\n    }\n    const type = options.type;\n    const converter = options.converter;\n    const toAttribute =\n        converter && (converter as ComplexAttributeConverter).toAttribute ||\n        defaultConverter.toAttribute;\n    return toAttribute!(value, type);\n  }\n\n  private _updateState!: UpdateState;\n  private _instanceProperties?: PropertyValues;\n  // Initialize to an unresolved Promise so we can make sure the element has\n  // connected before first update.\n  private _updatePromise!: Promise<unknown>;\n  private _enableUpdatingResolver: ((r?: unknown) => void)|undefined;\n\n  /**\n   * Map with keys for any properties that have changed since the last\n   * update cycle with previous values.\n   */\n  private _changedProperties!: PropertyValues;\n\n  /**\n   * Map with keys of properties that should be reflected when updated.\n   */\n  private _reflectingProperties?: Map<PropertyKey, PropertyDeclaration>;\n\n  constructor() {\n    super();\n    this.initialize();\n  }\n\n  /**\n   * Performs element initialization. By default captures any pre-set values for\n   * registered properties.\n   */\n  protected initialize() {\n    this._updateState = 0;\n    this._updatePromise =\n        new Promise((res) => this._enableUpdatingResolver = res);\n    this._changedProperties = new Map();\n    this._saveInstanceProperties();\n    // ensures first update will be caught by an early access of\n    // `updateComplete`\n    this.requestUpdateInternal();\n  }\n\n  /**\n   * Fixes any properties set on the instance before upgrade time.\n   * Otherwise these would shadow the accessor and break these properties.\n   * The properties are stored in a Map which is played back after the\n   * constructor runs. Note, on very old versions of Safari (<=9) or Chrome\n   * (<=41), properties created for native platform properties like (`id` or\n   * `name`) may not have default values set in the element constructor. On\n   * these browsers native properties appear on instances and therefore their\n   * default value will overwrite any element default (e.g. if the element sets\n   * this.id = 'id' in the constructor, the 'id' will become '' since this is\n   * the native platform default).\n   */\n  private _saveInstanceProperties() {\n    // Use forEach so this works even if for/of loops are compiled to for loops\n    // expecting arrays\n    (this.constructor as typeof UpdatingElement)\n        ._classProperties!.forEach((_v, p) => {\n          if (this.hasOwnProperty(p)) {\n            const value = this[p as keyof this];\n            delete this[p as keyof this];\n            if (!this._instanceProperties) {\n              this._instanceProperties = new Map();\n            }\n            this._instanceProperties.set(p, value);\n          }\n        });\n  }\n\n  /**\n   * Applies previously saved instance properties.\n   */\n  private _applyInstanceProperties() {\n    // Use forEach so this works even if for/of loops are compiled to for loops\n    // expecting arrays\n    // tslint:disable-next-line:no-any\n    this._instanceProperties!.forEach((v, p) => (this as any)[p] = v);\n    this._instanceProperties = undefined;\n  }\n\n  connectedCallback() {\n    // Ensure first connection completes an update. Updates cannot complete\n    // before connection.\n    this.enableUpdating();\n  }\n\n  protected enableUpdating() {\n    if (this._enableUpdatingResolver !== undefined) {\n      this._enableUpdatingResolver();\n      this._enableUpdatingResolver = undefined;\n    }\n  }\n\n  /**\n   * Allows for `super.disconnectedCallback()` in extensions while\n   * reserving the possibility of making non-breaking feature additions\n   * when disconnecting at some point in the future.\n   */\n  disconnectedCallback() {\n  }\n\n  /**\n   * Synchronizes property values when attributes change.\n   */\n  attributeChangedCallback(name: string, old: string|null, value: string|null) {\n    if (old !== value) {\n      this._attributeToProperty(name, value);\n    }\n  }\n\n  private _propertyToAttribute(\n      name: PropertyKey, value: unknown,\n      options: PropertyDeclaration = defaultPropertyDeclaration) {\n    const ctor = (this.constructor as typeof UpdatingElement);\n    const attr = ctor._attributeNameForProperty(name, options);\n    if (attr !== undefined) {\n      const attrValue = ctor._propertyValueToAttribute(value, options);\n      // an undefined value does not change the attribute.\n      if (attrValue === undefined) {\n        return;\n      }\n      // Track if the property is being reflected to avoid\n      // setting the property again via `attributeChangedCallback`. Note:\n      // 1. this takes advantage of the fact that the callback is synchronous.\n      // 2. will behave incorrectly if multiple attributes are in the reaction\n      // stack at time of calling. However, since we process attributes\n      // in `update` this should not be possible (or an extreme corner case\n      // that we'd like to discover).\n      // mark state reflecting\n      this._updateState = this._updateState | STATE_IS_REFLECTING_TO_ATTRIBUTE;\n      if (attrValue == null) {\n        this.removeAttribute(attr);\n      } else {\n        this.setAttribute(attr, attrValue as string);\n      }\n      // mark state not reflecting\n      this._updateState = this._updateState & ~STATE_IS_REFLECTING_TO_ATTRIBUTE;\n    }\n  }\n\n  private _attributeToProperty(name: string, value: string|null) {\n    // Use tracking info to avoid deserializing attribute value if it was\n    // just set from a property setter.\n    if (this._updateState & STATE_IS_REFLECTING_TO_ATTRIBUTE) {\n      return;\n    }\n    const ctor = (this.constructor as typeof UpdatingElement);\n    // Note, hint this as an `AttributeMap` so closure clearly understands\n    // the type; it has issues with tracking types through statics\n    // tslint:disable-next-line:no-unnecessary-type-assertion\n    const propName = (ctor._attributeToPropertyMap as AttributeMap).get(name);\n    if (propName !== undefined) {\n      const options = ctor.getPropertyOptions(propName);\n      // mark state reflecting\n      this._updateState = this._updateState | STATE_IS_REFLECTING_TO_PROPERTY;\n      this[propName as keyof this] =\n          // tslint:disable-next-line:no-any\n          ctor._propertyValueFromAttribute(value, options) as any;\n      // mark state not reflecting\n      this._updateState = this._updateState & ~STATE_IS_REFLECTING_TO_PROPERTY;\n    }\n  }\n\n  /**\n   * This protected version of `requestUpdate` does not access or return the\n   * `updateComplete` promise. This promise can be overridden and is therefore\n   * not free to access.\n   */\n  protected requestUpdateInternal(\n      name?: PropertyKey, oldValue?: unknown, options?: PropertyDeclaration) {\n    let shouldRequestUpdate = true;\n    // If we have a property key, perform property update steps.\n    if (name !== undefined) {\n      const ctor = this.constructor as typeof UpdatingElement;\n      options = options || ctor.getPropertyOptions(name);\n      if (ctor._valueHasChanged(\n              this[name as keyof this], oldValue, options.hasChanged)) {\n        if (!this._changedProperties.has(name)) {\n          this._changedProperties.set(name, oldValue);\n        }\n        // Add to reflecting properties set.\n        // Note, it's important that every change has a chance to add the\n        // property to `_reflectingProperties`. This ensures setting\n        // attribute + property reflects correctly.\n        if (options.reflect === true &&\n            !(this._updateState & STATE_IS_REFLECTING_TO_PROPERTY)) {\n          if (this._reflectingProperties === undefined) {\n            this._reflectingProperties = new Map();\n          }\n          this._reflectingProperties.set(name, options);\n        }\n      } else {\n        // Abort the request if the property should not be considered changed.\n        shouldRequestUpdate = false;\n      }\n    }\n    if (!this._hasRequestedUpdate && shouldRequestUpdate) {\n      this._updatePromise = this._enqueueUpdate();\n    }\n  }\n\n  /**\n   * Requests an update which is processed asynchronously. This should\n   * be called when an element should update based on some state not triggered\n   * by setting a property. In this case, pass no arguments. It should also be\n   * called when manually implementing a property setter. In this case, pass the\n   * property `name` and `oldValue` to ensure that any configured property\n   * options are honored. Returns the `updateComplete` Promise which is resolved\n   * when the update completes.\n   *\n   * @param name {PropertyKey} (optional) name of requesting property\n   * @param oldValue {any} (optional) old value of requesting property\n   * @returns {Promise} A Promise that is resolved when the update completes.\n   */\n  requestUpdate(name?: PropertyKey, oldValue?: unknown) {\n    this.requestUpdateInternal(name, oldValue);\n    return this.updateComplete;\n  }\n\n  /**\n   * Sets up the element to asynchronously update.\n   */\n  private async _enqueueUpdate() {\n    this._updateState = this._updateState | STATE_UPDATE_REQUESTED;\n    try {\n      // Ensure any previous update has resolved before updating.\n      // This `await` also ensures that property changes are batched.\n      await this._updatePromise;\n    } catch (e) {\n      // Ignore any previous errors. We only care that the previous cycle is\n      // done. Any error should have been handled in the previous update.\n    }\n    const result = this.performUpdate();\n    // If `performUpdate` returns a Promise, we await it. This is done to\n    // enable coordinating updates with a scheduler. Note, the result is\n    // checked to avoid delaying an additional microtask unless we need to.\n    if (result != null) {\n      await result;\n    }\n    return !this._hasRequestedUpdate;\n  }\n\n  private get _hasRequestedUpdate() {\n    return (this._updateState & STATE_UPDATE_REQUESTED);\n  }\n\n  protected get hasUpdated() {\n    return (this._updateState & STATE_HAS_UPDATED);\n  }\n\n  /**\n   * Performs an element update. Note, if an exception is thrown during the\n   * update, `firstUpdated` and `updated` will not be called.\n   *\n   * You can override this method to change the timing of updates. If this\n   * method is overridden, `super.performUpdate()` must be called.\n   *\n   * For instance, to schedule updates to occur just before the next frame:\n   *\n   * ```\n   * protected async performUpdate(): Promise<unknown> {\n   *   await new Promise((resolve) => requestAnimationFrame(() => resolve()));\n   *   super.performUpdate();\n   * }\n   * ```\n   */\n  protected performUpdate(): void|Promise<unknown> {\n    // Abort any update if one is not pending when this is called.\n    // This can happen if `performUpdate` is called early to \"flush\"\n    // the update.\n    if (!this._hasRequestedUpdate) {\n      return;\n    }\n    // Mixin instance properties once, if they exist.\n    if (this._instanceProperties) {\n      this._applyInstanceProperties();\n    }\n    let shouldUpdate = false;\n    const changedProperties = this._changedProperties;\n    try {\n      shouldUpdate = this.shouldUpdate(changedProperties);\n      if (shouldUpdate) {\n        this.update(changedProperties);\n      } else {\n        this._markUpdated();\n      }\n    } catch (e) {\n      // Prevent `firstUpdated` and `updated` from running when there's an\n      // update exception.\n      shouldUpdate = false;\n      // Ensure element can accept additional updates after an exception.\n      this._markUpdated();\n      throw e;\n    }\n    if (shouldUpdate) {\n      if (!(this._updateState & STATE_HAS_UPDATED)) {\n        this._updateState = this._updateState | STATE_HAS_UPDATED;\n        this.firstUpdated(changedProperties);\n      }\n      this.updated(changedProperties);\n    }\n  }\n\n  private _markUpdated() {\n    this._changedProperties = new Map();\n    this._updateState = this._updateState & ~STATE_UPDATE_REQUESTED;\n  }\n\n  /**\n   * Returns a Promise that resolves when the element has completed updating.\n   * The Promise value is a boolean that is `true` if the element completed the\n   * update without triggering another update. The Promise result is `false` if\n   * a property was set inside `updated()`. If the Promise is rejected, an\n   * exception was thrown during the update.\n   *\n   * To await additional asynchronous work, override the `_getUpdateComplete`\n   * method. For example, it is sometimes useful to await a rendered element\n   * before fulfilling this Promise. To do this, first await\n   * `super._getUpdateComplete()`, then any subsequent state.\n   *\n   * @returns {Promise} The Promise returns a boolean that indicates if the\n   * update resolved without triggering another update.\n   */\n  get updateComplete() {\n    return this._getUpdateComplete();\n  }\n\n  /**\n   * Override point for the `updateComplete` promise.\n   *\n   * It is not safe to override the `updateComplete` getter directly due to a\n   * limitation in TypeScript which means it is not possible to call a\n   * superclass getter (e.g. `super.updateComplete.then(...)`) when the target\n   * language is ES5 (https://github.com/microsoft/TypeScript/issues/338).\n   * This method should be overridden instead. For example:\n   *\n   *   class MyElement extends LitElement {\n   *     async _getUpdateComplete() {\n   *       await super._getUpdateComplete();\n   *       await this._myChild.updateComplete;\n   *     }\n   *   }\n   * @deprecated Override `getUpdateComplete()` instead for forward\n   *     compatibility with `lit-element` 3.0 / `@lit/reactive-element`.\n   */\n  protected _getUpdateComplete() {\n    return this.getUpdateComplete();\n  }\n\n  /**\n   * Override point for the `updateComplete` promise.\n   *\n   * It is not safe to override the `updateComplete` getter directly due to a\n   * limitation in TypeScript which means it is not possible to call a\n   * superclass getter (e.g. `super.updateComplete.then(...)`) when the target\n   * language is ES5 (https://github.com/microsoft/TypeScript/issues/338).\n   * This method should be overridden instead. For example:\n   *\n   *   class MyElement extends LitElement {\n   *     async getUpdateComplete() {\n   *       await super.getUpdateComplete();\n   *       await this._myChild.updateComplete;\n   *     }\n   *   }\n   */\n  protected getUpdateComplete() {\n    return this._updatePromise;\n  }\n\n  /**\n   * Controls whether or not `update` should be called when the element requests\n   * an update. By default, this method always returns `true`, but this can be\n   * customized to control when to update.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   */\n  protected shouldUpdate(_changedProperties: PropertyValues): boolean {\n    return true;\n  }\n\n  /**\n   * Updates the element. This method reflects property values to attributes.\n   * It can be overridden to render and keep updated element DOM.\n   * Setting properties inside this method will *not* trigger\n   * another update.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   */\n  protected update(_changedProperties: PropertyValues) {\n    if (this._reflectingProperties !== undefined &&\n        this._reflectingProperties.size > 0) {\n      // Use forEach so this works even if for/of loops are compiled to for\n      // loops expecting arrays\n      this._reflectingProperties.forEach(\n          (v, k) => this._propertyToAttribute(k, this[k as keyof this], v));\n      this._reflectingProperties = undefined;\n    }\n    this._markUpdated();\n  }\n\n  /**\n   * Invoked whenever the element is updated. Implement to perform\n   * post-updating tasks via DOM APIs, for example, focusing an element.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   */\n  protected updated(_changedProperties: PropertyValues) {\n  }\n\n  /**\n   * Invoked when the element is first updated. Implement to perform one time\n   * work on the element after update.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   */\n  protected firstUpdated(_changedProperties: PropertyValues) {\n  }\n}\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/*\n * IMPORTANT: For compatibility with tsickle and the Closure Compiler, all\n * property decorators (but not class decorators) in this file that have\n * an @ExportDecoratedItems annotation must be defined as a regular function,\n * not an arrow function.\n */\n\nimport {LitElement} from '../lit-element.js';\n\nimport {PropertyDeclaration, UpdatingElement} from './updating-element.js';\n\nexport type Constructor<T> = {\n  // tslint:disable-next-line:no-any\n  new (...args: any[]): T\n};\n\n// From the TC39 Decorators proposal\ninterface ClassDescriptor {\n  kind: 'class';\n  elements: ClassElement[];\n  finisher?: <T>(clazz: Constructor<T>) => undefined | Constructor<T>;\n}\n\n// From the TC39 Decorators proposal\ninterface ClassElement {\n  kind: 'field'|'method';\n  key: PropertyKey;\n  placement: 'static'|'prototype'|'own';\n  initializer?: Function;\n  extras?: ClassElement[];\n  finisher?: <T>(clazz: Constructor<T>) => undefined | Constructor<T>;\n  descriptor?: PropertyDescriptor;\n}\n\nconst legacyCustomElement =\n    (tagName: string, clazz: Constructor<HTMLElement>) => {\n      window.customElements.define(tagName, clazz);\n      // Cast as any because TS doesn't recognize the return type as being a\n      // subtype of the decorated class when clazz is typed as\n      // `Constructor<HTMLElement>` for some reason.\n      // `Constructor<HTMLElement>` is helpful to make sure the decorator is\n      // applied to elements however.\n      // tslint:disable-next-line:no-any\n      return clazz as any;\n    };\n\nconst standardCustomElement =\n    (tagName: string, descriptor: ClassDescriptor) => {\n      const {kind, elements} = descriptor;\n      return {\n        kind,\n        elements,\n        // This callback is called once the class is otherwise fully defined\n        finisher(clazz: Constructor<HTMLElement>) {\n          window.customElements.define(tagName, clazz);\n        }\n      };\n    };\n\n/**\n * Class decorator factory that defines the decorated class as a custom element.\n *\n * ```\n * @customElement('my-element')\n * class MyElement {\n *   render() {\n *     return html``;\n *   }\n * }\n * ```\n * @category Decorator\n * @param tagName The name of the custom element to define.\n */\nexport const customElement = (tagName: string) =>\n    (classOrDescriptor: Constructor<HTMLElement>|ClassDescriptor) =>\n        (typeof classOrDescriptor === 'function') ?\n    legacyCustomElement(tagName, classOrDescriptor) :\n    standardCustomElement(tagName, classOrDescriptor);\n\nconst standardProperty =\n    (options: PropertyDeclaration, element: ClassElement) => {\n      // When decorating an accessor, pass it through and add property metadata.\n      // Note, the `hasOwnProperty` check in `createProperty` ensures we don't\n      // stomp over the user's accessor.\n      if (element.kind === 'method' && element.descriptor &&\n          !('value' in element.descriptor)) {\n        return {\n          ...element,\n          finisher(clazz: typeof UpdatingElement) {\n            clazz.createProperty(element.key, options);\n          }\n        };\n      } else {\n        // createProperty() takes care of defining the property, but we still\n        // must return some kind of descriptor, so return a descriptor for an\n        // unused prototype field. The finisher calls createProperty().\n        return {\n          kind: 'field',\n          key: Symbol(),\n          placement: 'own',\n          descriptor: {},\n          // When @babel/plugin-proposal-decorators implements initializers,\n          // do this instead of the initializer below. See:\n          // https://github.com/babel/babel/issues/9260 extras: [\n          //   {\n          //     kind: 'initializer',\n          //     placement: 'own',\n          //     initializer: descriptor.initializer,\n          //   }\n          // ],\n          initializer(this: {[key: string]: unknown}) {\n            if (typeof element.initializer === 'function') {\n              this[element.key as string] = element.initializer.call(this);\n            }\n          },\n          finisher(clazz: typeof UpdatingElement) {\n            clazz.createProperty(element.key, options);\n          }\n        };\n      }\n    };\n\nconst legacyProperty =\n    (options: PropertyDeclaration, proto: Object, name: PropertyKey) => {\n      (proto.constructor as typeof UpdatingElement)\n          .createProperty(name, options);\n    };\n\n/**\n * A property decorator which creates a LitElement property which reflects a\n * corresponding attribute value. A [[`PropertyDeclaration`]] may optionally be\n * supplied to configure property features.\n *\n * This decorator should only be used for public fields. Private or protected\n * fields should use the [[`internalProperty`]] decorator.\n *\n * @example\n * ```ts\n * class MyElement {\n *   @property({ type: Boolean })\n *   clicked = false;\n * }\n * ```\n * @category Decorator\n * @ExportDecoratedItems\n */\nexport function property(options?: PropertyDeclaration) {\n  // tslint:disable-next-line:no-any decorator\n  return (protoOrDescriptor: Object|ClassElement, name?: PropertyKey): any =>\n             (name !== undefined) ?\n      legacyProperty(options!, protoOrDescriptor as Object, name) :\n      standardProperty(options!, protoOrDescriptor as ClassElement);\n}\n\nexport interface InternalPropertyDeclaration<Type = unknown> {\n  /**\n   * A function that indicates if a property should be considered changed when\n   * it is set. The function should take the `newValue` and `oldValue` and\n   * return `true` if an update should be requested.\n   */\n  hasChanged?(value: Type, oldValue: Type): boolean;\n}\n\n/**\n * Declares a private or protected property that still triggers updates to the\n * element when it changes.\n *\n * Properties declared this way must not be used from HTML or HTML templating\n * systems, they're solely for properties internal to the element. These\n * properties may be renamed by optimization tools like the Closure Compiler.\n * @category Decorator\n * @deprecated `internalProperty` has been renamed to `state` in lit-element\n *     3.0. Please update to `state` now to be compatible with 3.0.\n */\nexport function internalProperty(options?: InternalPropertyDeclaration) {\n  return property({attribute: false, hasChanged: options?.hasChanged});\n}\n\n/**\n * Declares a private or protected property that still triggers updates to the\n * element when it changes.\n *\n * Properties declared this way must not be used from HTML or HTML templating\n * systems, they're solely for properties internal to the element. These\n * properties may be renamed by optimization tools like the Closure Compiler.\n * @category Decorator\n */\nexport const state = (options?: InternalPropertyDeclaration) =>\n    internalProperty(options);\n\n/**\n * A property decorator that converts a class property into a getter that\n * executes a querySelector on the element's renderRoot.\n *\n * @param selector A DOMString containing one or more selectors to match.\n * @param cache An optional boolean which when true performs the DOM query only\n * once and caches the result.\n *\n * See: https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector\n *\n * @example\n *\n * ```ts\n * class MyElement {\n *   @query('#first')\n *   first;\n *\n *   render() {\n *     return html`\n *       <div id=\"first\"></div>\n *       <div id=\"second\"></div>\n *     `;\n *   }\n * }\n * ```\n * @category Decorator\n */\nexport function query(selector: string, cache?: boolean) {\n  return (protoOrDescriptor: Object|ClassElement,\n          // tslint:disable-next-line:no-any decorator\n          name?: PropertyKey): any => {\n    const descriptor = {\n      get(this: LitElement) {\n        return this.renderRoot.querySelector(selector);\n      },\n      enumerable: true,\n      configurable: true,\n    };\n    if (cache) {\n      const prop =\n          name !== undefined ? name : (protoOrDescriptor as ClassElement).key;\n      const key = typeof prop === 'symbol' ? Symbol() : `__${prop}`;\n      descriptor.get = function(this: LitElement) {\n        if ((this as unknown as\n             {[key: string]: Element | null})[key as string] === undefined) {\n          ((this as unknown as {[key: string]: Element | null})[key as string] =\n               this.renderRoot.querySelector(selector));\n        }\n        return (\n            this as unknown as {[key: string]: Element | null})[key as string];\n      };\n    }\n    return (name !== undefined) ?\n        legacyQuery(descriptor, protoOrDescriptor as Object, name) :\n        standardQuery(descriptor, protoOrDescriptor as ClassElement);\n  };\n}\n\n// Note, in the future, we may extend this decorator to support the use case\n// where the queried element may need to do work to become ready to interact\n// with (e.g. load some implementation code). If so, we might elect to\n// add a second argument defining a function that can be run to make the\n// queried element loaded/updated/ready.\n/**\n * A property decorator that converts a class property into a getter that\n * returns a promise that resolves to the result of a querySelector on the\n * element's renderRoot done after the element's `updateComplete` promise\n * resolves. When the queried property may change with element state, this\n * decorator can be used instead of requiring users to await the\n * `updateComplete` before accessing the property.\n *\n * @param selector A DOMString containing one or more selectors to match.\n *\n * See: https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelector\n *\n * @example\n * ```ts\n * class MyElement {\n *   @queryAsync('#first')\n *   first;\n *\n *   render() {\n *     return html`\n *       <div id=\"first\"></div>\n *       <div id=\"second\"></div>\n *     `;\n *   }\n * }\n *\n * // external usage\n * async doSomethingWithFirst() {\n *  (await aMyElement.first).doSomething();\n * }\n * ```\n * @category Decorator\n */\nexport function queryAsync(selector: string) {\n  return (protoOrDescriptor: Object|ClassElement,\n          // tslint:disable-next-line:no-any decorator\n          name?: PropertyKey): any => {\n    const descriptor = {\n      async get(this: LitElement) {\n        await this.updateComplete;\n        return this.renderRoot.querySelector(selector);\n      },\n      enumerable: true,\n      configurable: true,\n    };\n    return (name !== undefined) ?\n        legacyQuery(descriptor, protoOrDescriptor as Object, name) :\n        standardQuery(descriptor, protoOrDescriptor as ClassElement);\n  };\n}\n\n/**\n * A property decorator that converts a class property into a getter\n * that executes a querySelectorAll on the element's renderRoot.\n *\n * @param selector A DOMString containing one or more selectors to match.\n *\n * See:\n * https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelectorAll\n *\n * @example\n * ```ts\n * class MyElement {\n *   @queryAll('div')\n *   divs;\n *\n *   render() {\n *     return html`\n *       <div id=\"first\"></div>\n *       <div id=\"second\"></div>\n *     `;\n *   }\n * }\n * ```\n * @category Decorator\n */\nexport function queryAll(selector: string) {\n  return (protoOrDescriptor: Object|ClassElement,\n          // tslint:disable-next-line:no-any decorator\n          name?: PropertyKey): any => {\n    const descriptor = {\n      get(this: LitElement) {\n        return this.renderRoot.querySelectorAll(selector);\n      },\n      enumerable: true,\n      configurable: true,\n    };\n    return (name !== undefined) ?\n        legacyQuery(descriptor, protoOrDescriptor as Object, name) :\n        standardQuery(descriptor, protoOrDescriptor as ClassElement);\n  };\n}\n\nconst legacyQuery =\n    (descriptor: PropertyDescriptor, proto: Object, name: PropertyKey) => {\n      Object.defineProperty(proto, name, descriptor);\n    };\n\nconst standardQuery = (descriptor: PropertyDescriptor, element: ClassElement) =>\n    ({\n      kind: 'method',\n      placement: 'prototype',\n      key: element.key,\n      descriptor,\n    });\n\nconst standardEventOptions =\n    (options: AddEventListenerOptions, element: ClassElement) => {\n      return {\n        ...element,\n        finisher(clazz: typeof UpdatingElement) {\n          Object.assign(\n              clazz.prototype[element.key as keyof UpdatingElement], options);\n        }\n      };\n    };\n\nconst legacyEventOptions =\n    // tslint:disable-next-line:no-any legacy decorator\n    (options: AddEventListenerOptions, proto: any, name: PropertyKey) => {\n      Object.assign(proto[name], options);\n    };\n\n/**\n * Adds event listener options to a method used as an event listener in a\n * lit-html template.\n *\n * @param options An object that specifies event listener options as accepted by\n * `EventTarget#addEventListener` and `EventTarget#removeEventListener`.\n *\n * Current browsers support the `capture`, `passive`, and `once` options. See:\n * https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener#Parameters\n *\n * @example\n * ```ts\n * class MyElement {\n *   clicked = false;\n *\n *   render() {\n *     return html`\n *       <div @click=${this._onClick}`>\n *         <button></button>\n *       </div>\n *     `;\n *   }\n *\n *   @eventOptions({capture: true})\n *   _onClick(e) {\n *     this.clicked = true;\n *   }\n * }\n * ```\n * @category Decorator\n */\nexport function eventOptions(options: AddEventListenerOptions) {\n  // Return value typed as any to prevent TypeScript from complaining that\n  // standard decorator function signature does not match TypeScript decorator\n  // signature\n  // TODO(kschaaf): unclear why it was only failing on this decorator and not\n  // the others\n  return ((protoOrDescriptor: Object|ClassElement, name?: string) =>\n              (name !== undefined) ?\n              legacyEventOptions(options, protoOrDescriptor as Object, name) :\n              standardEventOptions(\n                  options, protoOrDescriptor as ClassElement)) as\n             // tslint:disable-next-line:no-any decorator\n             any;\n}\n\n// x-browser support for matches\n// tslint:disable-next-line:no-any\nconst ElementProto = Element.prototype as any;\nconst legacyMatches =\n    ElementProto.msMatchesSelector || ElementProto.webkitMatchesSelector;\n\n/**\n * A property decorator that converts a class property into a getter that\n * returns the `assignedNodes` of the given named `slot`. Note, the type of\n * this property should be annotated as `NodeListOf<HTMLElement>`.\n *\n * @param slotName A string name of the slot.\n * @param flatten A boolean which when true flattens the assigned nodes,\n * meaning any assigned nodes that are slot elements are replaced with their\n * assigned nodes.\n * @param selector A string which filters the results to elements that match\n * the given css selector.\n *\n * * @example\n * ```ts\n * class MyElement {\n *   @queryAssignedNodes('list', true, '.item')\n *   listItems;\n *\n *   render() {\n *     return html`\n *       <slot name=\"list\"></slot>\n *     `;\n *   }\n * }\n * ```\n * @category Decorator\n */\nexport function queryAssignedNodes(\n    slotName = '', flatten = false, selector = '') {\n  return (protoOrDescriptor: Object|ClassElement,\n          // tslint:disable-next-line:no-any decorator\n          name?: PropertyKey): any => {\n    const descriptor = {\n      get(this: LitElement) {\n        const slotSelector =\n            `slot${slotName ? `[name=${slotName}]` : ':not([name])'}`;\n        const slot = this.renderRoot.querySelector(slotSelector);\n        let nodes = slot && (slot as HTMLSlotElement).assignedNodes({flatten});\n        if (nodes && selector) {\n          nodes = nodes.filter(\n              (node) => node.nodeType === Node.ELEMENT_NODE &&\n                  // tslint:disable-next-line:no-any testing existence on older browsers\n                  ((node as any).matches ?\n                       (node as Element).matches(selector) :\n                       legacyMatches.call(node as Element, selector)));\n        }\n        return nodes;\n      },\n      enumerable: true,\n      configurable: true,\n    };\n    return (name !== undefined) ?\n        legacyQuery(descriptor, protoOrDescriptor as Object, name) :\n        standardQuery(descriptor, protoOrDescriptor as ClassElement);\n  };\n}\n", "/**\n@license\nCopyright (c) 2019 The Polymer Project Authors. All rights reserved.\nThis code may only be used under the BSD style license found at\nhttp://polymer.github.io/LICENSE.txt The complete set of authors may be found at\nhttp://polymer.github.io/AUTHORS.txt The complete set of contributors may be\nfound at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as\npart of the polymer project is also subject to an additional IP rights grant\nfound at http://polymer.github.io/PATENTS.txt\n*/\n\n/**\n * Whether the current browser supports `adoptedStyleSheets`.\n */\nexport const supportsAdoptingStyleSheets = (window.ShadowRoot) &&\n    (window.ShadyCSS === undefined || window.ShadyCSS.nativeShadow) &&\n    ('adoptedStyleSheets' in Document.prototype) &&\n    ('replace' in CSSStyleSheet.prototype);\n\nconst constructionToken = Symbol();\n\nexport class CSSResult {\n  _styleSheet?: CSSStyleSheet|null;\n\n  readonly cssText: string;\n\n  constructor(cssText: string, safeToken: symbol) {\n    if (safeToken !== constructionToken) {\n      throw new Error(\n          'CSSResult is not constructable. Use `unsafeCSS` or `css` instead.');\n    }\n\n    this.cssText = cssText;\n  }\n\n  // Note, this is a getter so that it's lazy. In practice, this means\n  // stylesheets are not created until the first element instance is made.\n  get styleSheet(): CSSStyleSheet|null {\n    if (this._styleSheet === undefined) {\n      // Note, if `supportsAdoptingStyleSheets` is true then we assume\n      // CSSStyleSheet is constructable.\n      if (supportsAdoptingStyleSheets) {\n        this._styleSheet = new CSSStyleSheet();\n        this._styleSheet.replaceSync(this.cssText);\n      } else {\n        this._styleSheet = null;\n      }\n    }\n    return this._styleSheet;\n  }\n\n  toString(): string {\n    return this.cssText;\n  }\n}\n\n/**\n * Wrap a value for interpolation in a [[`css`]] tagged template literal.\n *\n * This is unsafe because untrusted CSS text can be used to phone home\n * or exfiltrate data to an attacker controlled site. Take care to only use\n * this with trusted input.\n */\nexport const unsafeCSS = (value: unknown) => {\n  return new CSSResult(String(value), constructionToken);\n};\n\nconst textFromCSSResult = (value: CSSResult|number) => {\n  if (value instanceof CSSResult) {\n    return value.cssText;\n  } else if (typeof value === 'number') {\n    return value;\n  } else {\n    throw new Error(\n        `Value passed to 'css' function must be a 'css' function result: ${\n            value}. Use 'unsafeCSS' to pass non-literal values, but\n            take care to ensure page security.`);\n  }\n};\n\n/**\n * Template tag which which can be used with LitElement's [[LitElement.styles |\n * `styles`]] property to set element styles. For security reasons, only literal\n * string values may be used. To incorporate non-literal values [[`unsafeCSS`]]\n * may be used inside a template string part.\n */\nexport const css =\n    (strings: TemplateStringsArray, ...values: (CSSResult|number)[]) => {\n      const cssText = values.reduce(\n          (acc, v, idx) => acc + textFromCSSResult(v) + strings[idx + 1],\n          strings[0]);\n      return new CSSResult(cssText, constructionToken);\n    };\n", "/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\n/**\n * The main LitElement module, which defines the [[`LitElement`]] base class and\n * related APIs.\n *\n *  LitElement components can define a template and a set of observed\n * properties. Changing an observed property triggers a re-render of the\n * element.\n *\n *  Import [[`LitElement`]] and [[`html`]] from this module to create a\n * component:\n *\n *  ```js\n * import {LitElement, html} from 'lit-element';\n *\n * class MyElement extends LitElement {\n *\n *   // Declare observed properties\n *   static get properties() {\n *     return {\n *       adjective: {}\n *     }\n *   }\n *\n *   constructor() {\n *     this.adjective = 'awesome';\n *   }\n *\n *   // Define the element's template\n *   render() {\n *     return html`<p>your ${adjective} template here</p>`;\n *   }\n * }\n *\n * customElements.define('my-element', MyElement);\n * ```\n *\n * `LitElement` extends [[`UpdatingElement`]] and adds lit-html templating.\n * The `UpdatingElement` class is provided for users that want to build\n * their own custom element base classes that don't use lit-html.\n *\n * @packageDocumentation\n */\nimport {render, ShadyRenderOptions} from 'lit-html/lib/shady-render.js';\n\nimport {PropertyValues, UpdatingElement} from './lib/updating-element.js';\n\nexport * from './lib/updating-element.js';\nexport {UpdatingElement as ReactiveElement} from './lib/updating-element.js';\nexport * from './lib/decorators.js';\nexport {html, svg, TemplateResult, SVGTemplateResult} from 'lit-html/lit-html.js';\nimport {supportsAdoptingStyleSheets, CSSResult, unsafeCSS} from './lib/css-tag.js';\nexport * from './lib/css-tag.js';\n\ndeclare global {\n  interface Window {\n    litElementVersions: string[];\n  }\n}\n\n// IMPORTANT: do not change the property name or the assignment expression.\n// This line will be used in regexes to search for LitElement usage.\n// TODO(justinfagnani): inject version number at build time\n(window['litElementVersions'] || (window['litElementVersions'] = []))\n    .push('2.5.1');\n\nexport type CSSResultOrNative = CSSResult|CSSStyleSheet;\n\nexport interface CSSResultArray extends\n    Array<CSSResultOrNative|CSSResultArray> {}\n\nexport type CSSResultGroup = CSSResultOrNative|CSSResultArray;\n\n/**\n * Sentinal value used to avoid calling lit-html's render function when\n * subclasses do not implement `render`\n */\nconst renderNotImplemented = {};\n\n/**\n * Base element class that manages element properties and attributes, and\n * renders a lit-html template.\n *\n * To define a component, subclass `LitElement` and implement a\n * `render` method to provide the component's template. Define properties\n * using the [[`properties`]] property or the [[`property`]] decorator.\n */\nexport class LitElement extends UpdatingElement {\n  /**\n   * Ensure this class is marked as `finalized` as an optimization ensuring\n   * it will not needlessly try to `finalize`.\n   *\n   * Note this property name is a string to prevent breaking Closure JS Compiler\n   * optimizations. See updating-element.ts for more information.\n   */\n  protected static['finalized'] = true;\n\n  /**\n   * Reference to the underlying library method used to render the element's\n   * DOM. By default, points to the `render` method from lit-html's shady-render\n   * module.\n   *\n   * **Most users will never need to touch this property.**\n   *\n   * This  property should not be confused with the `render` instance method,\n   * which should be overridden to define a template for the element.\n   *\n   * Advanced users creating a new base class based on LitElement can override\n   * this property to point to a custom render method with a signature that\n   * matches [shady-render's `render`\n   * method](https://lit-html.polymer-project.org/api/modules/shady_render.html#render).\n   *\n   * @nocollapse\n   */\n  static render:\n      (result: unknown, container: Element|DocumentFragment,\n       options: ShadyRenderOptions) => void = render;\n\n  /**\n   * Array of styles to apply to the element. The styles should be defined\n   * using the [[`css`]] tag function or via constructible stylesheets.\n   */\n  static styles?: CSSResultGroup;\n\n  /** @nocollapse */\n  static shadowRootOptions: ShadowRootInit = {mode: 'open'};\n\n  private static _styles: Array<CSSResultOrNative|CSSResult>|undefined;\n\n  /**\n   * Return the array of styles to apply to the element.\n   * Override this method to integrate into a style management system.\n   *\n   * @nocollapse\n   */\n  static getStyles(): CSSResultGroup|undefined {\n    return this.styles;\n  }\n\n  /** @nocollapse */\n  private static _getUniqueStyles() {\n    // Only gather styles once per class\n    if (this.hasOwnProperty(JSCompiler_renameProperty('_styles', this))) {\n      return;\n    }\n    // Take care not to call `this.getStyles()` multiple times since this\n    // generates new CSSResults each time.\n    // TODO(sorvell): Since we do not cache CSSResults by input, any\n    // shared styles will generate new stylesheet objects, which is wasteful.\n    // This should be addressed when a browser ships constructable\n    // stylesheets.\n    const userStyles = this.getStyles();\n\n    if (Array.isArray(userStyles)) {\n      // De-duplicate styles preserving the _last_ instance in the set.\n      // This is a performance optimization to avoid duplicated styles that can\n      // occur especially when composing via subclassing.\n      // The last item is kept to try to preserve the cascade order with the\n      // assumption that it's most important that last added styles override\n      // previous styles.\n      const addStyles = (styles: CSSResultArray, set: Set<CSSResultOrNative>):\n          Set<CSSResultOrNative> => styles.reduceRight(\n              (set: Set<CSSResultOrNative>, s) =>\n                  // Note: On IE set.add() does not return the set\n              Array.isArray(s) ? addStyles(s, set) : (set.add(s), set),\n              set);\n      // Array.from does not work on Set in IE, otherwise return\n      // Array.from(addStyles(userStyles, new Set<CSSResult>())).reverse()\n      const set = addStyles(userStyles, new Set<CSSResultOrNative>());\n      const styles: CSSResultOrNative[] = [];\n      set.forEach((v) => styles.unshift(v));\n      this._styles = styles;\n    } else {\n      this._styles = userStyles === undefined ? [] : [userStyles];\n    }\n\n    // Ensure that there are no invalid CSSStyleSheet instances here. They are\n    // invalid in two conditions.\n    // (1) the sheet is non-constructible (`sheet` of a HTMLStyleElement), but\n    //     this is impossible to check except via .replaceSync or use\n    // (2) the ShadyCSS polyfill is enabled (:. supportsAdoptingStyleSheets is\n    //     false)\n    this._styles = this._styles.map((s) => {\n      if (s instanceof CSSStyleSheet && !supportsAdoptingStyleSheets) {\n        // Flatten the cssText from the passed constructible stylesheet (or\n        // undetectable non-constructible stylesheet). The user might have\n        // expected to update their stylesheets over time, but the alternative\n        // is a crash.\n        const cssText = Array.prototype.slice.call(s.cssRules)\n                            .reduce((css, rule) => css + rule.cssText, '');\n        return unsafeCSS(cssText);\n      }\n      return s;\n    });\n  }\n\n  private _needsShimAdoptedStyleSheets?: boolean;\n\n  /**\n   * Node or ShadowRoot into which element DOM should be rendered. Defaults\n   * to an open shadowRoot.\n   */\n  readonly renderRoot!: Element|DocumentFragment;\n\n  /**\n   * Performs element initialization. By default this calls\n   * [[`createRenderRoot`]] to create the element [[`renderRoot`]] node and\n   * captures any pre-set values for registered properties.\n   */\n  protected initialize() {\n    super.initialize();\n    (this.constructor as typeof LitElement)._getUniqueStyles();\n    (this as {\n      renderRoot: Element|DocumentFragment;\n    }).renderRoot = this.createRenderRoot();\n    // Note, if renderRoot is not a shadowRoot, styles would/could apply to the\n    // element's getRootNode(). While this could be done, we're choosing not to\n    // support this now since it would require different logic around de-duping.\n    if (window.ShadowRoot && this.renderRoot instanceof window.ShadowRoot) {\n      this.adoptStyles();\n    }\n  }\n\n  /**\n   * Returns the node into which the element should render and by default\n   * creates and returns an open shadowRoot. Implement to customize where the\n   * element's DOM is rendered. For example, to render into the element's\n   * childNodes, return `this`.\n   * @returns {Element|DocumentFragment} Returns a node into which to render.\n   */\n  protected createRenderRoot(): Element|ShadowRoot {\n    return this.attachShadow(\n        (this.constructor as typeof LitElement).shadowRootOptions);\n  }\n\n  /**\n   * Applies styling to the element shadowRoot using the [[`styles`]]\n   * property. Styling will apply using `shadowRoot.adoptedStyleSheets` where\n   * available and will fallback otherwise. When Shadow DOM is polyfilled,\n   * ShadyCSS scopes styles and adds them to the document. When Shadow DOM\n   * is available but `adoptedStyleSheets` is not, styles are appended to the\n   * end of the `shadowRoot` to [mimic spec\n   * behavior](https://wicg.github.io/construct-stylesheets/#using-constructed-stylesheets).\n   */\n  protected adoptStyles() {\n    const styles = (this.constructor as typeof LitElement)._styles!;\n    if (styles.length === 0) {\n      return;\n    }\n    // There are three separate cases here based on Shadow DOM support.\n    // (1) shadowRoot polyfilled: use ShadyCSS\n    // (2) shadowRoot.adoptedStyleSheets available: use it\n    // (3) shadowRoot.adoptedStyleSheets polyfilled: append styles after\n    // rendering\n    if (window.ShadyCSS !== undefined && !window.ShadyCSS.nativeShadow) {\n      window.ShadyCSS.ScopingShim!.prepareAdoptedCssText(\n          styles.map((s) => (s as CSSResult).cssText), this.localName);\n    } else if (supportsAdoptingStyleSheets) {\n      (this.renderRoot as ShadowRoot).adoptedStyleSheets =\n          styles.map((s) => s instanceof CSSStyleSheet ? s : s.styleSheet!);\n    } else {\n      // This must be done after rendering so the actual style insertion is done\n      // in `update`.\n      this._needsShimAdoptedStyleSheets = true;\n    }\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    // Note, first update/render handles styleElement so we only call this if\n    // connected after first update.\n    if (this.hasUpdated && window.ShadyCSS !== undefined) {\n      window.ShadyCSS.styleElement(this);\n    }\n  }\n\n  /**\n   * Updates the element. This method reflects property values to attributes\n   * and calls `render` to render DOM via lit-html. Setting properties inside\n   * this method will *not* trigger another update.\n   * @param _changedProperties Map of changed properties with old values\n   */\n  protected update(changedProperties: PropertyValues) {\n    // Setting properties in `render` should not trigger an update. Since\n    // updates are allowed after super.update, it's important to call `render`\n    // before that.\n    const templateResult = this.render();\n    super.update(changedProperties);\n    // If render is not implemented by the component, don't call lit-html render\n    if (templateResult !== renderNotImplemented) {\n      (this.constructor as typeof LitElement)\n          .render(\n              templateResult,\n              this.renderRoot,\n              {scopeName: this.localName, eventContext: this});\n    }\n    // When native Shadow DOM is used but adoptedStyles are not supported,\n    // insert styling after rendering to ensure adoptedStyles have highest\n    // priority.\n    if (this._needsShimAdoptedStyleSheets) {\n      this._needsShimAdoptedStyleSheets = false;\n      (this.constructor as typeof LitElement)._styles!.forEach((s) => {\n        const style = document.createElement('style');\n        style.textContent = (s as CSSResult).cssText;\n        this.renderRoot.appendChild(style);\n      });\n    }\n  }\n\n  /**\n   * Invoked on each update to perform rendering tasks. This method may return\n   * any value renderable by lit-html's `NodePart` - typically a\n   * `TemplateResult`. Setting properties inside this method will *not* trigger\n   * the element to update.\n   */\n  protected render(): unknown {\n    return renderNotImplemented;\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * An EventHandler for custom events\n */\nexport type EventHandler<E> = (event: E) => void;\n\n/**\n * Provider EventDispatcher\n *\n * @export\n * @class EventDispatcher\n * @template E\n */\nexport class EventDispatcher<E> {\n  private eventHandlers: Array<EventHandler<E>> = [];\n  /**\n   * fires event handler\n   *\n   * @param {E} event\n   * @memberof EventDispatcher\n   */\n\n  public fire(event: E) {\n    for (const handler of this.eventHandlers) {\n      handler(event);\n    }\n  }\n\n  /**\n   * adds eventHandler\n   *\n   * @param {EventHandler<E>} eventHandler\n   * @memberof EventDispatcher\n   */\n  public add(eventHandler: EventHandler<E>) {\n    this.eventHandlers.push(eventHandler);\n  }\n\n  /**\n   * removes eventHandler\n   *\n   * @param {EventHandler<E>} eventHandler\n   * @memberof EventDispatcher\n   */\n  public remove(eventHandler: EventHandler<E>) {\n    for (let i = 0; i < this.eventHandlers.length; i++) {\n      if (this.eventHandlers[i] === eventHandler) {\n        this.eventHandlers.splice(i, 1);\n        i--;\n      }\n    }\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { AuthenticationProvider } from '@microsoft/microsoft-graph-client/lib/es/IAuthenticationProvider';\nimport { AuthenticationProviderOptions } from '@microsoft/microsoft-graph-client/lib/es/IAuthenticationProviderOptions';\nimport { IGraph } from '../IGraph';\nimport { EventDispatcher, EventHandler } from '../utils/EventDispatcher';\n\n/**\n * Provider Type to be extended for implmenting new providers\n *\n * @export\n * @abstract\n * @class IProvider\n * @implements {AuthenticationProvider}\n */\nexport abstract class IProvider implements AuthenticationProvider {\n  /**\n   * The Graph object that contains the Graph client sdk\n   *\n   * @type {Graph}\n   * @memberof IProvider\n   */\n  public graph: IGraph;\n  /**\n   * Enable/Disable multi account functionality\n   *\n   * @protected\n   * @type {boolean}\n   * @memberof IProvider\n   */\n  protected isMultipleAccountDisabled: boolean = true;\n  private _state: ProviderState;\n  private _loginChangedDispatcher = new EventDispatcher<LoginChangedEvent>();\n  private _activeAccountChangedDispatcher = new EventDispatcher<ActiveAccountChanged>();\n\n  /**\n   * Enable/Disable incremental consent\n   *\n   * @protected\n   * @type {boolean}\n   * @memberof IProvider\n   */\n  private _isIncrementalConsentDisabled: boolean = false;\n\n  /**\n   * returns state of Provider\n   *\n   * @readonly\n   * @type {ProviderState}\n   * @memberof IProvider\n   */\n  public get state(): ProviderState {\n    return this._state;\n  }\n\n  /**\n   * Incremental consent setting\n   *\n   * @readonly\n   * @memberof IProvider\n   */\n  public get isIncrementalConsentDisabled(): boolean {\n    return this._isIncrementalConsentDisabled;\n  }\n\n  /**\n   * Enable/Disable incremental consent\n   *\n   * @readonly\n   * @memberof IProvider\n   */\n  public set isIncrementalConsentDisabled(disabled: boolean) {\n    this._isIncrementalConsentDisabled = disabled;\n  }\n\n  /**\n   * Name used for analytics\n   *\n   * @readonly\n   * @memberof IProvider\n   */\n  public get name() {\n    return 'MgtIProvider';\n  }\n\n  constructor() {\n    this._state = ProviderState.Loading;\n  }\n\n  /**\n   * sets state of Provider and fires loginchangedDispatcher\n   *\n   * @param {ProviderState} state\n   * @memberof IProvider\n   */\n  public setState(state: ProviderState) {\n    if (state !== this._state) {\n      this._state = state;\n      this._loginChangedDispatcher.fire({});\n    }\n  }\n\n  /**\n   * event handler when login changes\n   *\n   * @param {EventHandler<LoginChangedEvent>} eventHandler\n   * @memberof IProvider\n   */\n  public onStateChanged(eventHandler: EventHandler<LoginChangedEvent>) {\n    this._loginChangedDispatcher.add(eventHandler);\n  }\n  /**\n   * removes event handler for when login changes\n   *\n   * @param {EventHandler<LoginChangedEvent>} eventHandler\n   * @memberof IProvider\n   */\n  public removeStateChangedHandler(eventHandler: EventHandler<LoginChangedEvent>) {\n    this._loginChangedDispatcher.remove(eventHandler);\n  }\n\n  /**\n   * option implementation that can be called to sign in user (required for mgt-login to work)\n   *\n   * @returns {Promise<void>}\n   * @memberof IProvider\n   */\n  public login?(): Promise<void>;\n\n  /**\n   * optional implementation that can be called to sign out user (required for mgt-login to work)\n   *\n   * @returns {Promise<void>}\n   * @memberof IProvider\n   */\n  public logout?(): Promise<void>;\n\n  /**\n   * Returns all signed in accounts.\n   *\n   * @return {*}  {any[]}\n   * @memberof IProvider\n   */\n  public getAllAccounts?(): IProviderAccount[];\n\n  /**\n   * Switch between two signed in accounts\n   *\n   * @param {*} user\n   * @memberof IProvider\n   */\n  public setActiveAccount?(user: IProviderAccount) {\n    this.fireActiveAccountChanged();\n  }\n\n  /**\n   * Event handler when Active account changes\n   *\n   * @param {EventHandler<ActiveAccountChanged>} eventHandler\n   * @memberof IProvider\n   */\n  public onActiveAccountChanged(eventHandler: EventHandler<ActiveAccountChanged>) {\n    this._activeAccountChangedDispatcher.add(eventHandler);\n  }\n\n  /**\n   * Removes event handler for when Active account changes\n   *\n   * @param {EventHandler<ActiveAccountChanged>} eventHandler\n   * @memberof IProvider\n   */\n  public removeActiveAccountChangedHandler(eventHandler: EventHandler<ActiveAccountChanged>) {\n    this._activeAccountChangedDispatcher.remove(eventHandler);\n  }\n\n  /**\n   * Fires event when active account changes\n   *\n   * @memberof IProvider\n   */\n  private fireActiveAccountChanged() {\n    this._activeAccountChangedDispatcher.fire({});\n  }\n\n  /**\n   * uses scopes to recieve access token\n   *\n   * @param {...string[]} scopes\n   * @returns {Promise<string>}\n   * @memberof IProvider\n   */\n  public getAccessTokenForScopes(...scopes: string[]): Promise<string> {\n    return this.getAccessToken({ scopes });\n  }\n\n  /**\n   * Promise to receive access token using Provider options\n   *\n   * @abstract\n   * @param {AuthenticationProviderOptions} [options]\n   * @returns {Promise<string>}\n   * @memberof IProvider\n   */\n  public abstract getAccessToken(options?: AuthenticationProviderOptions): Promise<string>;\n}\n\n/**\n * ActiveAccountChanged Event\n *\n * @export\n * @interface ActiveAccountChanged\n */\nexport interface ActiveAccountChanged {}\n/**\n * loginChangedEvent\n *\n * @export\n * @interface LoginChangedEvent\n */\n// tslint:disable-next-line: no-empty-interface\nexport interface LoginChangedEvent {}\n\n/**\n * LoginType\n *\n * @export\n * @enum {number}\n */\nexport enum LoginType {\n  /**\n   * Popup = 0\n   */\n  Popup,\n  /**\n   * Redirect = 1\n   */\n  Redirect\n}\n\n/**\n * ProviderState\n *\n * @export\n * @enum {number}\n */\nexport enum ProviderState {\n  /**\n   * Loading = 0\n   */\n  Loading,\n  /**\n   * SignedOut = 1\n   */\n  SignedOut,\n  /**\n   * SignedIn = 2\n   */\n  SignedIn\n}\n\n/**\n * Account details\n *\n * @export\n */\nexport type IProviderAccount = {\n  username?: string;\n  id: string;\n};\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { Client } from '@microsoft/microsoft-graph-client';\nimport { User } from '@microsoft/microsoft-graph-types';\n\nimport { EventDispatcher, EventHandler } from '../utils/EventDispatcher';\nimport { IProvider, ProviderState } from './IProvider';\n\n/**\n * Provides implementation for acquiring the necessary access token for calling the Microsoft Graph APIs.\n *\n * @export\n * @class Providers\n */\nexport class Providers {\n  /**\n   * returns the value of provider used globally. All components use this property to get a reference to the provider.\n   *\n   * @static\n   * @type {IProvider}\n   * @memberof Providers\n   */\n  public static get globalProvider(): IProvider {\n    return this._globalProvider;\n  }\n\n  public static set globalProvider(provider: IProvider) {\n    if (provider !== this._globalProvider) {\n      if (this._globalProvider) {\n        this._globalProvider.removeStateChangedHandler(this.handleProviderStateChanged);\n        this._globalProvider.removeActiveAccountChangedHandler(this.handleActiveAccountChanged);\n      }\n\n      if (provider) {\n        provider.onStateChanged(this.handleProviderStateChanged);\n        provider.onActiveAccountChanged(this.handleActiveAccountChanged);\n      }\n\n      this._globalProvider = provider;\n      this._eventDispatcher.fire(ProvidersChangedState.ProviderChanged);\n    }\n  }\n\n  /**\n   * Fires event when Provider changes state\n   *\n   * @static\n   * @param {EventHandler<ProvidersChangedState>} event\n   * @memberof Providers\n   */\n  public static onProviderUpdated(event: EventHandler<ProvidersChangedState>) {\n    this._eventDispatcher.add(event);\n  }\n\n  /**\n   * Remove event handler\n   *\n   * @static\n   * @param {EventHandler<ProvidersChangedState>} event\n   * @memberof Providers\n   */\n  public static removeProviderUpdatedListener(event: EventHandler<ProvidersChangedState>) {\n    this._eventDispatcher.remove(event);\n  }\n\n  /**\n   * Fires event when Provider changes state\n   *\n   * @static\n   * @param {EventHandler<ProvidersChangedState>} event\n   * @memberof Providers\n   */\n  public static onActiveAccountChanged(event: EventHandler<any>) {\n    this._activeAccountChangedDispatcher.add(event);\n  }\n\n  /**\n   * Remove event handler\n   *\n   * @static\n   * @param {EventHandler<ProvidersChangedState>} event\n   * @memberof Providers\n   */\n  public static removeActiveAccountChangedListener(event: EventHandler<any>) {\n    this._activeAccountChangedDispatcher.remove(event);\n  }\n\n  /**\n   * Gets the current signed in user\n   *\n   * @static\n   * @memberof Providers\n   */\n  public static async me() {\n    if (!this._me) {\n      const client = this.client;\n      if (client) {\n        try {\n          const response: User = await client.api('me').get();\n          if (response && response.id) {\n            this._me = response;\n          }\n        } catch {}\n      }\n    }\n\n    return this._me;\n  }\n\n  /**\n   * Gets the current graph client\n   *\n   * @readonly\n   * @static\n   * @type {Client}\n   * @memberof Providers\n   */\n  public static get client(): Client {\n    if (Providers.globalProvider && Providers.globalProvider.state === ProviderState.SignedIn) {\n      return Providers.globalProvider.graph.client;\n    }\n    return null;\n  }\n\n  private static _eventDispatcher: EventDispatcher<ProvidersChangedState> = new EventDispatcher<ProvidersChangedState>();\n\n  private static _activeAccountChangedDispatcher: EventDispatcher<any> = new EventDispatcher<any>();\n\n  private static _globalProvider: IProvider;\n  private static _me: User;\n\n  private static handleProviderStateChanged() {\n    if (!Providers.globalProvider || Providers.globalProvider.state !== ProviderState.SignedIn) {\n      // clear current signed in user info\n      Providers._me = null;\n    }\n\n    Providers._eventDispatcher.fire(ProvidersChangedState.ProviderStateChanged);\n  }\n\n  private static handleActiveAccountChanged() {\n    Providers._activeAccountChangedDispatcher.fire(null);\n  }\n}\n\n/**\n * on Provider Change State\n *\n * @export\n * @enum {number}\n */\nexport enum ProvidersChangedState {\n  /**\n   * ProviderChanged = 0\n   */\n  ProviderChanged,\n  /**\n   * ProviderStateChanged = 1\n   */\n  ProviderStateChanged\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { EventDispatcher, EventHandler } from './EventDispatcher';\n\n/**\n * Helper class for Localization\n *\n *\n * @export\n * @class LocalizationHelper\n */\nexport class LocalizationHelper {\n  static _strings: any;\n\n  static _stringsEventDispatcher: EventDispatcher<any> = new EventDispatcher();\n\n  static _directionEventDispatcher: EventDispatcher<any> = new EventDispatcher();\n\n  private static mutationObserver;\n\n  public static get strings() {\n    return this._strings;\n  }\n\n  /**\n   * Set strings to be localized\n   *\n   * @static\n   * @memberof LocalizationHelper\n   */\n  public static set strings(value: any) {\n    this._strings = value;\n    this._stringsEventDispatcher.fire(null);\n  }\n\n  /**\n   * returns body dir attribute to determine rtl or ltr\n   *\n   * @static\n   * @returns {string} dir\n   * @memberof LocalizationHelper\n   */\n  public static getDocumentDirection() {\n    return document.body?.getAttribute('dir') || document.documentElement?.getAttribute('dir');\n  }\n\n  /**\n   * Fires event when LocalizationHelper changes state\n   *\n   * @static\n   * @param {EventHandler<ProvidersChangedState>} event\n   * @memberof LocalizationHelper\n   */\n  public static onStringsUpdated(event: EventHandler<any>) {\n    this._stringsEventDispatcher.add(event);\n  }\n\n  public static removeOnStringsUpdated(event: EventHandler<any>) {\n    this._stringsEventDispatcher.remove(event);\n  }\n\n  public static onDirectionUpdated(event: EventHandler<any>) {\n    this._directionEventDispatcher.add(event);\n    this.initDirection();\n  }\n\n  public static removeOnDirectionUpdated(event: EventHandler<any>) {\n    this._directionEventDispatcher.remove(event);\n  }\n\n  private static _isDirectionInit = false;\n\n  /**\n   * Checks for direction setup and adds mutationObserver\n   *\n   * @private\n   * @static\n   * @returns\n   * @memberof LocalizationHelper\n   */\n  private static initDirection() {\n    if (this._isDirectionInit) {\n      return;\n    }\n    this._isDirectionInit = true;\n    this.mutationObserver = new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        if (mutation.attributeName == 'dir') {\n          this._directionEventDispatcher.fire(null);\n        }\n      });\n    });\n    const options = { attributes: true, attributeFilter: ['dir'] };\n    this.mutationObserver.observe(document.body, options);\n    this.mutationObserver.observe(document.documentElement, options);\n  }\n\n  /**\n   * Provided helper method to determine localized or defaultString for specific string is returned\n   *\n   * @static updateStringsForTag\n   * @param {string} tagName\n   * @param  stringsObj\n   * @returns\n   * @memberof LocalizationHelper\n   */\n  public static updateStringsForTag(tagName: string, stringObj) {\n    tagName = tagName.toLowerCase();\n\n    if (tagName.startsWith('mgt-')) {\n      tagName = tagName.substring(4);\n    }\n\n    if (this._strings && stringObj) {\n      //check for top level strings, applied per component, overridden by specific component def\n      for (let prop of Object.entries(stringObj)) {\n        if (this._strings[prop[0]]) {\n          stringObj[prop[0]] = this._strings[prop[0]];\n        }\n      }\n      //strings defined component specific\n      if (this._strings['_components'] && this._strings['_components'][tagName]) {\n        let strings: any = this._strings['_components'][tagName];\n        for (let key of Object.keys(strings)) {\n          if (stringObj[key]) {\n            stringObj[key] = strings[key];\n          }\n        }\n      }\n    }\n\n    return stringObj;\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { internalProperty, LitElement, PropertyValues } from 'lit-element';\nimport { ProviderState } from '../providers/IProvider';\nimport { Providers } from '../providers/Providers';\nimport { LocalizationHelper } from '../utils/LocalizationHelper';\n\n/**\n * Defines media query based on component width\n *\n * @export\n * @enum {string}\n */\nexport enum ComponentMediaQuery {\n  /**\n   * devices with width < 768\n   */\n  mobile = '',\n\n  /**\n   * devices with width < 1200\n   */\n  tablet = 'tablet',\n\n  /**\n   * devices with width > 1200\n   */\n  desktop = 'desktop'\n}\n\n/**\n * BaseComponent extends LitElement adding mgt specific features to all components\n *\n * @export  MgtBaseComponent\n * @abstract\n * @class MgtBaseComponent\n * @extends {LitElement}\n */\nexport abstract class MgtBaseComponent extends LitElement {\n  /**\n   * Gets or sets the direction of the component\n   *\n   * @protected\n   * @memberof MgtBaseComponent\n   */\n  @internalProperty() protected direction = 'ltr';\n\n  /**\n   * Gets the ComponentMediaQuery of the component\n   *\n   * @readonly\n   * @type {MgtElement.ComponentMediaQuery}\n   * @memberof MgtBaseComponent\n   */\n  public get mediaQuery(): ComponentMediaQuery {\n    if (this.offsetWidth < 768) {\n      return ComponentMediaQuery.mobile;\n    } else if (this.offsetWidth < 1200) {\n      return ComponentMediaQuery.tablet;\n    } else {\n      return ComponentMediaQuery.desktop;\n    }\n  }\n\n  /**\n   * A flag to check if the component is loading data state.\n   *\n   * @protected\n   * @memberof MgtBaseComponent\n   */\n  protected get isLoadingState(): boolean {\n    return this._isLoadingState;\n  }\n\n  /**\n   * A flag to check if the component has updated once.\n   *\n   * @readonly\n   * @protected\n   * @type {boolean}\n   * @memberof MgtBaseComponent\n   */\n  protected get isFirstUpdated(): boolean {\n    return this._isFirstUpdated;\n  }\n\n  /**\n   * returns component strings\n   *\n   * @readonly\n   * @protected\n   * @memberof MgtBaseComponent\n   */\n  protected get strings(): { [x: string]: string } {\n    return {};\n  }\n\n  /**\n   * determines if login component is in loading state\n   * @type {boolean}\n   */\n  private _isLoadingState: boolean = false;\n\n  private _isFirstUpdated = false;\n  private _currentLoadStatePromise: Promise<unknown>;\n\n  constructor() {\n    super();\n    this.handleLocalizationChanged = this.handleLocalizationChanged.bind(this);\n    this.handleDirectionChanged = this.handleDirectionChanged.bind(this);\n    this.handleProviderUpdates = this.handleProviderUpdates.bind(this);\n    this.handleActiveAccountUpdates = this.handleActiveAccountUpdates.bind(this);\n    this.handleDirectionChanged();\n    this.handleLocalizationChanged();\n  }\n\n  /**\n   * Invoked each time the custom element is appended into a document-connected element\n   *\n   * @memberof MgtBaseComponent\n   */\n  public connectedCallback() {\n    super.connectedCallback();\n    LocalizationHelper.onStringsUpdated(this.handleLocalizationChanged);\n    LocalizationHelper.onDirectionUpdated(this.handleDirectionChanged);\n  }\n\n  /**\n   * Invoked each time the custom element is removed from a document-connected element\n   *\n   * @memberof MgtBaseComponent\n   */\n  public disconnectedCallback() {\n    super.disconnectedCallback();\n    LocalizationHelper.removeOnStringsUpdated(this.handleLocalizationChanged);\n    LocalizationHelper.removeOnDirectionUpdated(this.handleDirectionChanged);\n    Providers.removeProviderUpdatedListener(this.handleProviderUpdates);\n    Providers.removeActiveAccountChangedListener(this.handleActiveAccountUpdates);\n  }\n\n  /**\n   * Invoked when the element is first updated. Implement to perform one time\n   * work on the element after update.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * @param _changedProperties Map of changed properties with old values\n   */\n  protected firstUpdated(changedProperties): void {\n    super.firstUpdated(changedProperties);\n    this._isFirstUpdated = true;\n    Providers.onProviderUpdated(this.handleProviderUpdates);\n    Providers.onActiveAccountChanged(this.handleActiveAccountUpdates);\n    this.requestStateUpdate();\n  }\n\n  /**\n   * load state into the component.\n   * Override this function to provide additional loading logic.\n   */\n  protected loadState(): Promise<void> {\n    return Promise.resolve();\n  }\n\n  protected clearState(): void {}\n\n  /**\n   * helps facilitate creation of events across components\n   *\n   * @protected\n   * @param {string} eventName\n   * @param {*} [detail]\n   * @param {boolean} [bubbles=false]\n   * @param {boolean} [cancelable=false]\n   * @return {*}  {boolean}\n   * @memberof MgtBaseComponent\n   */\n  protected fireCustomEvent(\n    eventName: string,\n    detail?: any,\n    bubbles: boolean = false,\n    cancelable: boolean = false\n  ): boolean {\n    const event = new CustomEvent(eventName, {\n      bubbles,\n      cancelable,\n      detail\n    });\n    return this.dispatchEvent(event);\n  }\n\n  /**\n   * Invoked whenever the element is updated. Implement to perform\n   * post-updating tasks via DOM APIs, for example, focusing an element.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * * @param changedProperties Map of changed properties with old values\n   */\n  protected updated(changedProperties: PropertyValues) {\n    super.updated(changedProperties);\n    const event = new CustomEvent('updated', {\n      bubbles: true,\n      cancelable: true\n    });\n    this.dispatchEvent(event);\n  }\n\n  /**\n   * Request to reload the state.\n   * Use reload instead of load to ensure loading events are fired.\n   *\n   * @protected\n   * @memberof MgtBaseComponent\n   */\n  protected async requestStateUpdate(force: boolean = false): Promise<unknown> {\n    // the component is still bootstraping - wait until first updated\n    if (!this._isFirstUpdated) {\n      return;\n    }\n\n    // Wait for the current load promise to complete (unless forced).\n    if (this.isLoadingState && !force) {\n      await this._currentLoadStatePromise;\n    }\n\n    const provider = Providers.globalProvider;\n\n    if (!provider) {\n      return Promise.resolve();\n    }\n\n    if (provider.state === ProviderState.SignedOut) {\n      // Signed out, clear the component state\n      this.clearState();\n      return;\n    } else if (provider.state === ProviderState.Loading) {\n      // The provider state is indeterminate. Do nothing.\n      return Promise.resolve();\n    } else {\n      // Signed in, load the internal component state\n      const loadStatePromise = new Promise<void>(async (resolve, reject) => {\n        try {\n          this.setLoadingState(true);\n          this.fireCustomEvent('loadingInitiated');\n\n          await this.loadState();\n\n          this.setLoadingState(false);\n          this.fireCustomEvent('loadingCompleted');\n          resolve();\n        } catch (e) {\n          // Loading failed. Clear any partially set data.\n          this.clearState();\n\n          this.setLoadingState(false);\n          this.fireCustomEvent('loadingFailed');\n          reject(e);\n        }\n\n        // Return the load state promise.\n        // If loading + forced, chain the promises.\n        // This is to account for the lack of a cancellation token concept.\n        return (this._currentLoadStatePromise =\n          this.isLoadingState && !!this._currentLoadStatePromise && force\n            ? this._currentLoadStatePromise.then(() => loadStatePromise)\n            : loadStatePromise);\n      });\n    }\n  }\n\n  private setLoadingState(value: boolean) {\n    if (this._isLoadingState === value) {\n      return;\n    }\n\n    this._isLoadingState = value;\n    this.requestUpdate('isLoadingState');\n  }\n\n  private handleProviderUpdates() {\n    this.requestStateUpdate();\n  }\n\n  private async handleActiveAccountUpdates() {\n    this.clearState();\n    this.requestStateUpdate();\n  }\n\n  private handleLocalizationChanged() {\n    LocalizationHelper.updateStringsForTag(this.tagName, this.strings);\n    this.requestUpdate();\n  }\n\n  private handleDirectionChanged() {\n    this.direction = LocalizationHelper.getDocumentDirection();\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { property } from 'lit-element';\nimport { MgtBaseComponent } from './baseComponent';\nimport { IProvider } from '../providers/IProvider';\n\n/**\n * Abstract implementation for provider component\n *\n * @export\n * @abstract\n * @class MgtBaseProvider\n * @extends {MgtBaseComponent}\n */\nexport abstract class MgtBaseProvider extends MgtBaseComponent {\n  /**\n   * The IProvider created by this component\n   *\n   * @memberof MgtBaseProvider\n   */\n  public get provider(): IProvider {\n    return this._provider;\n  }\n\n  public set provider(value: IProvider) {\n    if (this._provider) {\n      this.provider.removeStateChangedHandler(() => this.stateChangedHandler);\n    }\n    this._provider = value;\n    if (this._provider) {\n      this.provider.onStateChanged(() => this.stateChangedHandler);\n    }\n  }\n\n  /**\n   * Gets weather this provider can be used in this environment\n   *\n   * @readonly\n   * @type {boolean}\n   * @memberof MgtBaseProvider\n   */\n  public get isAvailable(): boolean {\n    return true;\n  }\n\n  /**\n   * Higher priority provider that should be initialized before attempting\n   * to initialize this provider. This provider will only be initialized\n   * if all higher priority providers are not available.\n   *\n   * @type {MgtBaseProvider}\n   * @memberof MgtBaseProvider\n   */\n  @property({\n    attribute: 'depends-on',\n    converter: newValue => {\n      return document.querySelector(newValue);\n    },\n    type: String\n  })\n  public dependsOn: MgtBaseProvider;\n\n  private _provider: IProvider;\n\n  /**\n   * Invoked when the element is first updated. Implement to perform one time\n   * work on the element after update.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * * @param _changedProperties Map of changed properties with old values\n   */\n  protected firstUpdated(changedProperties) {\n    super.firstUpdated(changedProperties);\n\n    let higherPriority = false;\n    if (this.dependsOn) {\n      let higherPriorityProvider = this.dependsOn;\n      while (higherPriorityProvider) {\n        if (higherPriorityProvider.isAvailable) {\n          higherPriority = true;\n          break;\n        }\n        higherPriorityProvider = higherPriorityProvider.dependsOn;\n      }\n    }\n\n    if (!higherPriority && this.isAvailable) {\n      this.initializeProvider();\n    }\n  }\n\n  /**\n   * method called to initialize the provider. Each derived class should provide\n   * their own implementation\n   *\n   * @protected\n   * @memberof MgtBaseProvider\n   */\n  // tslint:disable-next-line: no-empty\n  protected initializeProvider() {}\n\n  private stateChangedHandler() {\n    this.fireCustomEvent('onStateChanged', this.provider.state);\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * Crude implementation of equivalence between the two specified arguments.\n *\n * The primary intent of this function is for comparing data contexts, which\n * are expected to be object literals with potentially nested structures and\n * where leaf values are primitives.\n */\nexport function equals(o1: any, o2: any) {\n  return equalsInternal(o1, o2, new Set());\n}\n\n/**\n * Not exposed as it would undesirably leak implementation detail (`refs` argument).\n *\n * The `refs` argument is used to avoid infinite recursion due to circular references.\n *\n * @see equals\n */\nfunction equalsInternal(o1: any, o2: any, refs: Set<object>) {\n  const o1Label = Object.prototype.toString.call(o1);\n  const o2Label = Object.prototype.toString.call(o2);\n  if (o1Label === o2Label && o1Label === '[object Object]' && !refs.has(o1)) {\n    refs.add(o1);\n    for (const k in o1) {\n      if (!equalsInternal(o1[k], o2[k], refs)) {\n        return false;\n      }\n    }\n    for (const k in o2) {\n      if (!o1.hasOwnProperty(k)) {\n        return false;\n      }\n    }\n    return true;\n  }\n  if (o1Label === o2Label && o1Label === '[object Array]' && !refs.has(o1)) {\n    refs.add(o1);\n    if (o1.length !== o2.length) {\n      return false;\n    }\n    for (let i = 0; i < o1.length; i++) {\n      if (!equalsInternal(o1[i], o2[i], refs)) {\n        return false;\n      }\n    }\n    return true;\n  }\n  // Everything else requires strict equality (e.g. primitives, functions, dates)\n  return o1 === o2;\n}\n\n/**\n * Compares two arrays if the elements are equals\n * Should be used for arrays of primitive types\n *\n * @export\n * @template T the type of the elements in the array (should be primitive)\n * @param {T[]} arr1\n * @param {T[]} arr2\n * @returns true if both arrays contain the same items or if both arrays are null or empty\n */\nexport function arraysAreEqual<T>(arr1: T[], arr2: T[]) {\n  if (arr1 === arr2) {\n    return true;\n  }\n\n  if (!arr1 || !arr2) {\n    return false;\n  }\n\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n\n  if (arr1.length === 0) {\n    return true;\n  }\n\n  const setArr1 = new Set(arr1);\n\n  for (const i of arr2) {\n    if (!setArr1.has(i)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * Helper class for Template Instantiation\n *\n * @export\n * @class TemplateHelper\n */\nexport class TemplateHelper {\n  /**\n   * Render a template into a HTMLElement with the appropriate data context\n   *\n   * Ex:\n   * ```\n   * <template>\n   *  <div>{{myObj.someStr}}</div>\n   *  <div data-for=\"key in myObj.list\">\n   *    <div>{{key.anotherStr}}</div>\n   *  </div>\n   * </template>\n   * ```\n   *\n   * @param root the root element to parent the rendered content\n   * @param template the template to render\n   * @param context the data context to be applied\n   */\n  public static renderTemplate(root: HTMLElement, template: HTMLTemplateElement, context: object) {\n    // inherit context from parent template\n    if ((template as any).$parentTemplateContext) {\n      context = { ...context, $parent: (template as any).$parentTemplateContext };\n    }\n\n    let rendered: Node;\n\n    if (template.content && template.content.childNodes.length) {\n      const templateContent = template.content.cloneNode(true);\n      rendered = this.renderNode(templateContent, root, context);\n    } else if (template.childNodes.length) {\n      const div = document.createElement('div');\n      // tslint:disable-next-line: prefer-for-of\n      for (let i = 0; i < template.childNodes.length; i++) {\n        div.appendChild(this.simpleCloneNode(template.childNodes[i]));\n      }\n      rendered = this.renderNode(div, root, context);\n    }\n\n    if (rendered) {\n      root.appendChild(rendered);\n    }\n  }\n\n  /**\n   * Set an alternative binding syntax. Default is {{ <value> }}\n   *\n   * @static\n   * @param {string} startStr start of binding syntax\n   * @param {string} endStr end of binding syntax\n   * @memberof TemplateHelper\n   */\n  public static setBindingSyntax(startStr: string, endStr: string) {\n    this._startExpression = startStr;\n    this._endExpression = endStr;\n\n    const start = this.escapeRegex(this._startExpression);\n    const end = this.escapeRegex(this._endExpression);\n\n    this._expression = new RegExp(`${start}\\\\s*([$\\\\w\\\\.,'\"\\\\s()\\\\[\\\\]]+)\\\\s*${end}`, 'g');\n  }\n\n  /**\n   * Global context containing data or functions available to\n   * all templates for binding\n   *\n   * @readonly\n   * @static\n   * @memberof TemplateHelper\n   */\n  public static get globalContext() {\n    return this._globalContext;\n  }\n\n  private static _globalContext = {};\n\n  private static get expression() {\n    if (!this._expression) {\n      this.setBindingSyntax('{{', '}}');\n    }\n\n    return this._expression;\n  }\n\n  private static _startExpression: string;\n  private static _endExpression: string;\n  private static _expression: RegExp;\n\n  private static escapeRegex(string) {\n    return string.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n  }\n\n  // simple implementation of deep cloneNode\n  // required for nested templates in polyfilled browsers\n  private static simpleCloneNode(node: ChildNode) {\n    if (!node) {\n      return null;\n    }\n\n    const clone = node.cloneNode(false);\n\n    // tslint:disable-next-line:prefer-for-of\n    for (let i = 0; i < node.childNodes.length; i++) {\n      const childClone = this.simpleCloneNode(node.childNodes[i]);\n      if (childClone) {\n        clone.appendChild(childClone);\n      }\n    }\n\n    return clone;\n  }\n\n  private static expandExpressionsAsString(str: string, context: object) {\n    return str.replace(this.expression, (match, p1) => {\n      const value = this.evalInContext(p1 || this.trimExpression(match), context);\n      if (value) {\n        if (typeof value === 'object') {\n          return JSON.stringify(value);\n        } else {\n          return (value as any).toString();\n        }\n      }\n      return '';\n    });\n  }\n\n  private static renderNode(node: Node, root: HTMLElement, context: object) {\n    if (node.nodeName === '#text') {\n      node.textContent = this.expandExpressionsAsString(node.textContent, context);\n      return node;\n    } else if (node.nodeName === 'TEMPLATE') {\n      (node as any).$parentTemplateContext = context;\n      return node;\n    }\n\n    // tslint:disable-next-line: prefer-const\n    let nodeElement = node as HTMLElement;\n\n    // replace attribute values\n    if (nodeElement.attributes) {\n      // tslint:disable-next-line: prefer-for-of\n      for (let i = 0; i < nodeElement.attributes.length; i++) {\n        const attribute = nodeElement.attributes[i];\n\n        if (attribute.name === 'data-props') {\n          const propsValue = this.trimExpression(attribute.value);\n          for (const prop of propsValue.split(',')) {\n            const keyValue = prop.trim().split(':');\n            if (keyValue.length === 2) {\n              const key = keyValue[0].trim();\n              const value = this.evalInContext(keyValue[1].trim(), context);\n\n              if (key.startsWith('@')) {\n                // event\n                if (typeof value === 'function') {\n                  nodeElement.addEventListener(key.substring(1), e => value(e, context, root));\n                }\n              } else {\n                nodeElement[key] = value;\n              }\n            }\n          }\n        } else {\n          nodeElement.setAttribute(attribute.name, this.expandExpressionsAsString(attribute.value, context));\n        }\n      }\n    }\n\n    // don't process nodes that will loop yet, but\n    // keep a reference of them\n    const loopChildren = [];\n\n    // list of children to remove (ex, when data-if == false)\n    const removeChildren = [];\n    let previousChildWasIfAndTrue = false;\n\n    // tslint:disable-next-line: prefer-for-of\n    for (let i = 0; i < node.childNodes.length; i++) {\n      const childNode = node.childNodes[i];\n      const childElement = childNode as HTMLElement;\n      let previousChildWasIfAndTrueSet = false;\n\n      if (childElement.dataset) {\n        let childWillBeRemoved = false;\n\n        if (childElement.dataset.if) {\n          const expression = childElement.dataset.if;\n          if (!this.evalBoolInContext(this.trimExpression(expression), context)) {\n            removeChildren.push(childElement);\n            childWillBeRemoved = true;\n          } else {\n            childElement.removeAttribute('data-if');\n            previousChildWasIfAndTrue = true;\n            previousChildWasIfAndTrueSet = true;\n          }\n        } else if (typeof childElement.dataset.else !== 'undefined') {\n          if (previousChildWasIfAndTrue) {\n            removeChildren.push(childElement);\n            childWillBeRemoved = true;\n          } else {\n            childElement.removeAttribute('data-else');\n          }\n        }\n\n        if (childElement.dataset.for && !childWillBeRemoved) {\n          loopChildren.push(childElement);\n        } else if (!childWillBeRemoved) {\n          this.renderNode(childNode, root, context);\n        }\n      } else {\n        this.renderNode(childNode, root, context);\n      }\n\n      // clear the flag if the current node wasn't data-if\n      // or if it was data-if but it wasn't true\n      if (!previousChildWasIfAndTrueSet && childNode.nodeName !== '#text') {\n        previousChildWasIfAndTrue = false;\n      }\n    }\n\n    // now handle nodes that need to be removed\n    for (const child of removeChildren) {\n      nodeElement.removeChild(child);\n    }\n\n    // now handle nodes that should loop\n    // tslint:disable-next-line: prefer-for-of\n    for (let i = 0; i < loopChildren.length; i++) {\n      const childElement = loopChildren[i] as HTMLElement;\n\n      const loopExpression = childElement.dataset.for;\n      const loopTokens = this.trimExpression(loopExpression).split(/\\s(in|of)\\s/i);\n\n      if (loopTokens.length === 3) {\n        // don't really care what's in the middle at this point\n        const itemName = loopTokens[0].trim();\n        const listKey = loopTokens[2].trim();\n\n        const list = this.evalInContext(listKey, context);\n        if (Array.isArray(list)) {\n          // first remove the child\n          // we will need to make copy of the child for\n          // each element in the list\n          childElement.removeAttribute('data-for');\n\n          for (let j = 0; j < list.length; j++) {\n            const newContext = {\n              $index: j,\n              ...context\n            };\n            newContext[itemName] = list[j];\n\n            const clone = childElement.cloneNode(true);\n            this.renderNode(clone, root, newContext);\n            nodeElement.insertBefore(clone, childElement);\n          }\n        }\n        nodeElement.removeChild(childElement);\n      }\n    }\n\n    return node;\n  }\n\n  private static evalBoolInContext(expression, context) {\n    context = { ...context, ...this.globalContext };\n    return new Function('with(this) { return !!(' + expression + ')}').call(context);\n  }\n\n  private static evalInContext(expression, context) {\n    context = { ...context, ...this.globalContext };\n    const func = new Function('with(this) { return ' + expression + ';}');\n    let result;\n    try {\n      result = func.call(context);\n      // tslint:disable-next-line: no-empty\n    } catch (e) {}\n    return result;\n  }\n\n  private static trimExpression(expression: string) {\n    expression = expression.trim();\n\n    if (expression.startsWith(this._startExpression) && expression.endsWith(this._endExpression)) {\n      expression = expression.substr(\n        this._startExpression.length,\n        expression.length - this._startExpression.length - this._endExpression.length\n      );\n      expression = expression.trim();\n    }\n\n    return expression;\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { html, property, PropertyValues } from 'lit-element';\n\nimport { equals } from '../utils/equals';\nimport { MgtBaseComponent } from './baseComponent';\nimport { TemplateContext } from '../utils/TemplateContext';\nimport { TemplateHelper } from '../utils/TemplateHelper';\n\n/**\n * Lookup for rendered component templates and contexts by slot name.\n */\ninterface RenderedTemplates {\n  [name: string]: {\n    /**\n     * Reference to the data context used to render the slot.\n     */\n    context: any;\n    /**\n     * Reference to the rendered DOM element corresponding to the slot.\n     */\n    slot: HTMLElement;\n  };\n}\n\n/**\n * An abstract class that defines a templatable web component\n *\n * @export\n * @abstract\n * @class MgtTemplatedComponent\n * @extends {MgtBaseComponent}\n *\n * @fires templateRendered - fires when a template is rendered\n */\nexport abstract class MgtTemplatedComponent extends MgtBaseComponent {\n  /**\n   * Additional data context to be used in template binding\n   * Use this to add event listeners or value converters\n   *\n   * @type {MgtElement.TemplateContext}\n   * @memberof MgtTemplatedComponent\n   */\n  @property({ attribute: false }) public templateContext: TemplateContext;\n\n  /**\n   * Holds all templates defined by developer\n   *\n   * @protected\n   * @memberof MgtTemplatedComponent\n   */\n  protected templates = {};\n\n  private _renderedSlots = false;\n  private _renderedTemplates: RenderedTemplates = {};\n  private _slotNamesAddedDuringRender = [];\n\n  constructor() {\n    super();\n\n    this.templateContext = this.templateContext || {};\n  }\n\n  /**\n   * Updates the element. This method reflects property values to attributes.\n   * It can be overridden to render and keep updated element DOM.\n   * Setting properties inside this method will *not* trigger\n   * another update.\n   *\n   * * @param _changedProperties Map of changed properties with old values\n   */\n  protected update(changedProperties) {\n    this.templates = this.getTemplates();\n    this._slotNamesAddedDuringRender = [];\n    super.update(changedProperties);\n  }\n\n  /**\n   * Invoked whenever the element is updated. Implement to perform\n   * post-updating tasks via DOM APIs, for example, focusing an element.\n   *\n   * Setting properties inside this method will trigger the element to update\n   * again after this update cycle completes.\n   *\n   * * @param changedProperties Map of changed properties with old values\n   */\n  protected updated(changedProperties: PropertyValues) {\n    super.updated(changedProperties);\n    this.removeUnusedSlottedElements();\n  }\n\n  /**\n   * Render a <template> by type and return content to render\n   *\n   * @param templateType type of template (indicated by the data-type attribute)\n   * @param context the data context that should be expanded in template\n   * @param slotName the slot name that will be used to host the new rendered template. set to a unique value if multiple templates of this type will be rendered. default is templateType\n   */\n  protected renderTemplate(templateType: string, context: object, slotName?: string) {\n    if (!this.hasTemplate(templateType)) {\n      return null;\n    }\n\n    slotName = slotName || templateType;\n    this._slotNamesAddedDuringRender.push(slotName);\n    this._renderedSlots = true;\n\n    const template = html`\n      <slot name=${slotName}></slot>\n    `;\n\n    const dataContext = { ...context, ...this.templateContext };\n\n    if (this._renderedTemplates.hasOwnProperty(slotName)) {\n      const { context: existingContext, slot } = this._renderedTemplates[slotName];\n      if (equals(existingContext, dataContext)) {\n        return template;\n      }\n      this.removeChild(slot);\n    }\n\n    const div = document.createElement('div');\n    div.slot = slotName;\n    div.dataset.generated = 'template';\n\n    TemplateHelper.renderTemplate(div, this.templates[templateType], dataContext);\n\n    this.appendChild(div);\n\n    this._renderedTemplates[slotName] = { context: dataContext, slot: div };\n\n    this.fireCustomEvent('templateRendered', { templateType, context: dataContext, element: div });\n\n    return template;\n  }\n\n  /**\n   * Check if a specific template has been provided.\n   *\n   * @protected\n   * @param {string} templateName\n   * @returns {boolean}\n   * @memberof MgtTemplatedComponent\n   */\n  protected hasTemplate(templateName: string): boolean {\n    return this.templates && this.templates[templateName];\n  }\n\n  private getTemplates() {\n    const templates: any = {};\n\n    // tslint:disable-next-line: prefer-for-of\n    for (let i = 0; i < this.children.length; i++) {\n      const child = this.children[i];\n      if (child.nodeName === 'TEMPLATE') {\n        const template = child as HTMLElement;\n        if (template.dataset.type) {\n          templates[template.dataset.type] = template;\n        } else {\n          templates.default = template;\n        }\n\n        (template as any).templateOrder = i;\n      }\n    }\n\n    return templates;\n  }\n\n  private removeUnusedSlottedElements() {\n    if (this._renderedSlots) {\n      for (let i = 0; i < this.children.length; i++) {\n        const child = this.children[i] as HTMLElement;\n        if (child.dataset && child.dataset.generated && !this._slotNamesAddedDuringRender.includes(child.slot)) {\n          this.removeChild(child);\n          delete this._renderedTemplates[child.slot];\n          i--;\n        }\n      }\n      this._renderedSlots = false;\n    }\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { AuthenticationProviderOptions } from '@microsoft/microsoft-graph-client/lib/es/IAuthenticationProviderOptions';\nimport { createFromProvider } from '../Graph';\nimport { IProvider } from './IProvider';\n\n/**\n * Facilitates create of new custom provider\n *\n * @export\n * @class SimpleProvider\n * @extends {IProvider}\n */\nexport class SimpleProvider extends IProvider {\n  private _getAccessTokenHandler: (scopes: string[]) => Promise<string>;\n  private _loginHandler: () => Promise<void>;\n  private _logoutHandler: () => Promise<void>;\n\n  /**\n   * Name used for analytics\n   *\n   * @readonly\n   * @memberof IProvider\n   */\n  public get name() {\n    return 'MgtSimpleProvider';\n  }\n\n  constructor(\n    getAccessTokenHandler: (scopes: string[]) => Promise<string>,\n    loginHandler?: () => Promise<void>,\n    logoutHandler?: () => Promise<void>\n  ) {\n    super();\n\n    this._getAccessTokenHandler = getAccessTokenHandler;\n    this._loginHandler = loginHandler;\n    this._logoutHandler = logoutHandler;\n\n    this.graph = createFromProvider(this);\n  }\n\n  /**\n   * Invokes the getAccessToken function\n   *\n   * @param {AuthenticationProviderOptions} [options]\n   * @returns {Promise<string>}\n   * @memberof SimpleProvider\n   */\n  public getAccessToken(options?: AuthenticationProviderOptions): Promise<string> {\n    return this._getAccessTokenHandler(options?.scopes);\n  }\n\n  /**\n   * Invokes login function\n   *\n   * @returns {Promise<void>}\n   * @memberof SimpleProvider\n   */\n  public login(): Promise<void> {\n    return this._loginHandler();\n  }\n\n  /**\n   * Invokes logout function\n   *\n   * @returns {Promise<void>}\n   * @memberof SimpleProvider\n   */\n  public logout(): Promise<void> {\n    return this._logoutHandler();\n  }\n}\n", "const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);\n\nlet idbProxyableTypes;\nlet cursorAdvanceMethods;\n// This is a function to prevent it throwing up in node environments.\nfunction getIdbProxyableTypes() {\n    return (idbProxyableTypes ||\n        (idbProxyableTypes = [\n            IDBDatabase,\n            IDBObjectStore,\n            IDBIndex,\n            IDBCursor,\n            IDBTransaction,\n        ]));\n}\n// This is a function to prevent it throwing up in node environments.\nfunction getCursorAdvanceMethods() {\n    return (cursorAdvanceMethods ||\n        (cursorAdvanceMethods = [\n            IDBCursor.prototype.advance,\n            IDBCursor.prototype.continue,\n            IDBCursor.prototype.continuePrimaryKey,\n        ]));\n}\nconst cursorRequestMap = new WeakMap();\nconst transactionDoneMap = new WeakMap();\nconst transactionStoreNamesMap = new WeakMap();\nconst transformCache = new WeakMap();\nconst reverseTransformCache = new WeakMap();\nfunction promisifyRequest(request) {\n    const promise = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            request.removeEventListener('success', success);\n            request.removeEventListener('error', error);\n        };\n        const success = () => {\n            resolve(wrap(request.result));\n            unlisten();\n        };\n        const error = () => {\n            reject(request.error);\n            unlisten();\n        };\n        request.addEventListener('success', success);\n        request.addEventListener('error', error);\n    });\n    promise\n        .then((value) => {\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\n        // (see wrapFunction).\n        if (value instanceof IDBCursor) {\n            cursorRequestMap.set(value, request);\n        }\n        // Catching to avoid \"Uncaught Promise exceptions\"\n    })\n        .catch(() => { });\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\n    // is because we create many promises from a single IDBRequest.\n    reverseTransformCache.set(promise, request);\n    return promise;\n}\nfunction cacheDonePromiseForTransaction(tx) {\n    // Early bail if we've already created a done promise for this transaction.\n    if (transactionDoneMap.has(tx))\n        return;\n    const done = new Promise((resolve, reject) => {\n        const unlisten = () => {\n            tx.removeEventListener('complete', complete);\n            tx.removeEventListener('error', error);\n            tx.removeEventListener('abort', error);\n        };\n        const complete = () => {\n            resolve();\n            unlisten();\n        };\n        const error = () => {\n            reject(tx.error || new DOMException('AbortError', 'AbortError'));\n            unlisten();\n        };\n        tx.addEventListener('complete', complete);\n        tx.addEventListener('error', error);\n        tx.addEventListener('abort', error);\n    });\n    // Cache it for later retrieval.\n    transactionDoneMap.set(tx, done);\n}\nlet idbProxyTraps = {\n    get(target, prop, receiver) {\n        if (target instanceof IDBTransaction) {\n            // Special handling for transaction.done.\n            if (prop === 'done')\n                return transactionDoneMap.get(target);\n            // Polyfill for objectStoreNames because of Edge.\n            if (prop === 'objectStoreNames') {\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\n            }\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\n            if (prop === 'store') {\n                return receiver.objectStoreNames[1]\n                    ? undefined\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\n            }\n        }\n        // Else transform whatever we get back.\n        return wrap(target[prop]);\n    },\n    set(target, prop, value) {\n        target[prop] = value;\n        return true;\n    },\n    has(target, prop) {\n        if (target instanceof IDBTransaction &&\n            (prop === 'done' || prop === 'store')) {\n            return true;\n        }\n        return prop in target;\n    },\n};\nfunction replaceTraps(callback) {\n    idbProxyTraps = callback(idbProxyTraps);\n}\nfunction wrapFunction(func) {\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\n    // only create one new func per func.\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\n    if (func === IDBDatabase.prototype.transaction &&\n        !('objectStoreNames' in IDBTransaction.prototype)) {\n        return function (storeNames, ...args) {\n            const tx = func.call(unwrap(this), storeNames, ...args);\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\n            return wrap(tx);\n        };\n    }\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\n    // undefined if the end of the cursor has been reached.\n    if (getCursorAdvanceMethods().includes(func)) {\n        return function (...args) {\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n            // the original object.\n            func.apply(unwrap(this), args);\n            return wrap(cursorRequestMap.get(this));\n        };\n    }\n    return function (...args) {\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\n        // the original object.\n        return wrap(func.apply(unwrap(this), args));\n    };\n}\nfunction transformCachableValue(value) {\n    if (typeof value === 'function')\n        return wrapFunction(value);\n    // This doesn't return, it just creates a 'done' promise for the transaction,\n    // which is later returned for transaction.done (see idbObjectHandler).\n    if (value instanceof IDBTransaction)\n        cacheDonePromiseForTransaction(value);\n    if (instanceOfAny(value, getIdbProxyableTypes()))\n        return new Proxy(value, idbProxyTraps);\n    // Return the same value back if we're not going to transform it.\n    return value;\n}\nfunction wrap(value) {\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\n    if (value instanceof IDBRequest)\n        return promisifyRequest(value);\n    // If we've already transformed this value before, reuse the transformed value.\n    // This is faster, but it also provides object equality.\n    if (transformCache.has(value))\n        return transformCache.get(value);\n    const newValue = transformCachableValue(value);\n    // Not all types are transformed.\n    // These may be primitive types, so they can't be WeakMap keys.\n    if (newValue !== value) {\n        transformCache.set(value, newValue);\n        reverseTransformCache.set(newValue, value);\n    }\n    return newValue;\n}\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { reverseTransformCache as a, instanceOfAny as i, replaceTraps as r, unwrap as u, wrap as w };\n", "import { w as wrap, r as replaceTraps } from './wrap-idb-value.js';\nexport { u as unwrap, w as wrap } from './wrap-idb-value.js';\n\n/**\n * Open a database.\n *\n * @param name Name of the database.\n * @param version Schema version.\n * @param callbacks Additional callbacks.\n */\nfunction openDB(name, version, { blocked, upgrade, blocking, terminated } = {}) {\n    const request = indexedDB.open(name, version);\n    const openPromise = wrap(request);\n    if (upgrade) {\n        request.addEventListener('upgradeneeded', (event) => {\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\n        });\n    }\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    openPromise\n        .then((db) => {\n        if (terminated)\n            db.addEventListener('close', () => terminated());\n        if (blocking)\n            db.addEventListener('versionchange', () => blocking());\n    })\n        .catch(() => { });\n    return openPromise;\n}\n/**\n * Delete a database.\n *\n * @param name Name of the database.\n */\nfunction deleteDB(name, { blocked } = {}) {\n    const request = indexedDB.deleteDatabase(name);\n    if (blocked)\n        request.addEventListener('blocked', () => blocked());\n    return wrap(request).then(() => undefined);\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\nconst cachedMethods = new Map();\nfunction getMethod(target, prop) {\n    if (!(target instanceof IDBDatabase &&\n        !(prop in target) &&\n        typeof prop === 'string')) {\n        return;\n    }\n    if (cachedMethods.get(prop))\n        return cachedMethods.get(prop);\n    const targetFuncName = prop.replace(/FromIndex$/, '');\n    const useIndex = prop !== targetFuncName;\n    const isWrite = writeMethods.includes(targetFuncName);\n    if (\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\n        !(isWrite || readMethods.includes(targetFuncName))) {\n        return;\n    }\n    const method = async function (storeName, ...args) {\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\n        let target = tx.store;\n        if (useIndex)\n            target = target.index(args.shift());\n        // Must reject if op rejects.\n        // If it's a write operation, must reject if tx.done rejects.\n        // Must reject with op rejection first.\n        // Must resolve with op value.\n        // Must handle both promises (no unhandled rejections)\n        return (await Promise.all([\n            target[targetFuncName](...args),\n            isWrite && tx.done,\n        ]))[0];\n    };\n    cachedMethods.set(prop, method);\n    return method;\n}\nreplaceTraps((oldTraps) => ({\n    ...oldTraps,\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\n}));\n\nexport { deleteDB, openDB };\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { openDB } from 'idb';\nimport { Providers } from '../providers/Providers';\nimport { ProviderState } from '../providers/IProvider';\n\n/**\n * Holds the cache options for cache store\n *\n * @export\n * @interface CacheConfig\n */\nexport interface CacheConfig {\n  /**\n   * Default global invalidation period\n   *\n   * @type {number}\n   * @memberof CacheConfig\n   */\n  defaultInvalidationPeriod: number;\n  /**\n   * Controls whether the cache is enabled globally\n   *\n   * @type {boolean}\n   * @memberof CacheConfig\n   */\n  isEnabled: boolean;\n  /**\n   * Cache options for groups store\n   *\n   * @type {CacheOptions}\n   * @memberof CacheConfig\n   */\n  groups: CacheOptions;\n  /**\n   * Cache options for people store\n   *\n   * @type {CacheOptions}\n   * @memberof CacheConfig\n   */\n  people: CacheOptions;\n  /**\n   * Cache options for photos store\n   *\n   * @type {CacheOptions}\n   * @memberof CacheConfig\n   */\n  photos: CacheOptions;\n  /**\n   * Cache options for presence store\n   *\n   * @type {CacheOptions}\n   * @memberof CacheConfig\n   */\n\n  presence: CacheOptions;\n  /**\n   * Cache options for users store\n   *\n   * @type {CacheOptions}\n   * @memberof CacheConfig\n   */\n  users: CacheOptions;\n\n  /**\n   * Cache options for a generic response store\n   *\n   * @type {CacheOptions}\n   * @memberof CacheConfig\n   */\n  response: CacheOptions;\n\n  /**\n   * Cache options for files store\n   *\n   * @type {CacheOptions}\n   * @memberof CacheConfig\n   */\n  files: CacheOptions;\n  /**\n   * Cache options for fileLists store\n   *\n   * @type {CacheOptions}\n   * @memberof CacheConfig\n   */\n  fileLists: CacheOptions;\n}\n\n/**\n * Options for each store\n *\n * @export\n * @interface CacheOptions\n */\nexport interface CacheOptions {\n  /**\n   * Defines the time (in ms) for objects in the store to expire\n   *\n   * @type {number}\n   * @memberof CacheOptions\n   */\n  invalidationPeriod: number;\n  /**\n   * Whether the store is enabled or not\n   *\n   * @type {boolean}\n   * @memberof CacheOptions\n   */\n  isEnabled: boolean;\n}\n\n/**\n * class in charge of managing all the caches and their stores\n *\n * @export\n * @class CacheService\n */\n// tslint:disable-next-line: max-classes-per-file\nexport class CacheService {\n  /**\n   *  Looks for existing cache, otherwise creates a new one\n   *\n   * @static\n   * @template T\n   * @param {CacheSchema} schema\n   * @param {string} storeName\n   * @returns {CacheStore<T>}\n   * @memberof CacheService\n   */\n  public static getCache<T extends CacheItem>(schema: CacheSchema, storeName: string): CacheStore<T> {\n    const key = `${schema.name}/${storeName}`;\n\n    if (!this.isInitialized) {\n      this.init();\n    }\n\n    if (!this.cacheStore.has(storeName)) {\n      this.cacheStore.set(key, new CacheStore<T>(schema, storeName));\n    }\n    return this.cacheStore.get(key) as CacheStore<T>;\n  }\n\n  /**\n   * Clears all the stores within the cache\n   */\n  public static clearCaches() {\n    this.cacheStore.forEach(x => indexedDB.deleteDatabase(x.getDBName()));\n  }\n\n  private static cacheStore: Map<string, CacheStore<CacheItem>> = new Map();\n  private static isInitialized: boolean = false;\n\n  private static cacheConfig: CacheConfig = {\n    defaultInvalidationPeriod: 3600000,\n    groups: {\n      invalidationPeriod: null,\n      isEnabled: true\n    },\n    isEnabled: true,\n    people: {\n      invalidationPeriod: null,\n      isEnabled: true\n    },\n    photos: {\n      invalidationPeriod: null,\n      isEnabled: true\n    },\n    presence: {\n      invalidationPeriod: 300000,\n      isEnabled: true\n    },\n    users: {\n      invalidationPeriod: null,\n      isEnabled: true\n    },\n    response: {\n      invalidationPeriod: null,\n      isEnabled: true\n    },\n    files: {\n      invalidationPeriod: null,\n      isEnabled: true\n    },\n    fileLists: {\n      invalidationPeriod: null,\n      isEnabled: true\n    }\n  };\n\n  /**\n   * returns the cacheconfig object\n   *\n   * @readonly\n   * @static\n   * @type {CacheConfig}\n   * @memberof CacheService\n   */\n  public static get config(): CacheConfig {\n    return this.cacheConfig;\n  }\n\n  /**\n   * Checks for current sign in state and see if it has changed from signed-in to signed out\n   *\n   *\n   * @private\n   * @static\n   * @memberof CacheService\n   */\n  private static init() {\n    let previousState: ProviderState;\n    if (Providers.globalProvider) {\n      previousState = Providers.globalProvider.state;\n    }\n\n    Providers.onProviderUpdated(() => {\n      if (previousState === ProviderState.SignedIn && Providers.globalProvider.state === ProviderState.SignedOut) {\n        this.clearCaches();\n      }\n      previousState = Providers.globalProvider.state;\n    });\n    this.isInitialized = true;\n  }\n}\n\n/**\n * Represents organization for a cache\n *\n * @export\n * @interface CacheSchema\n */\nexport interface CacheSchema {\n  /**\n   * version number of cache, useful for upgrading\n   *\n   * @type {number}\n   * @memberof CacheSchema\n   */\n  version: number;\n  /**\n   * name of the cache\n   *\n   * @type {string}\n   * @memberof CacheSchema\n   */\n  name: string;\n  /**\n   * list of stores in the cache\n   *\n   * @type {{ [name: string]: CacheSchemaStore }}\n   * @memberof CacheSchema\n   */\n  stores: { [name: string]: string };\n}\n\n/**\n * item that is stored in cache\n *\n * @export\n * @interface CacheItem\n */\nexport interface CacheItem {\n  /**\n   * date and time that item was retrieved from api/stored in cache\n   *\n   * @type {number}\n   * @memberof CacheItem\n   */\n  timeCached?: number;\n}\n\n/**\n * Represents a store in the cache\n *\n * @class CacheStore\n * @template T\n */\n// tslint:disable-next-line: max-classes-per-file\nexport class CacheStore<T extends CacheItem> {\n  private schema: CacheSchema;\n  private store: string;\n\n  public constructor(schema: CacheSchema, store: string) {\n    if (!(store in schema.stores)) {\n      throw Error('\"store\" must be defined in the \"schema\"');\n    }\n\n    this.schema = schema;\n    this.store = store;\n  }\n\n  /**\n   * gets value from cache for the given key\n   *\n   * @param {string} key\n   * @returns {Promise<T>}\n   * @memberof Cache\n   */\n  public async getValue(key: string): Promise<T> {\n    if (!window.indexedDB) {\n      return null;\n    }\n    try {\n      return (await this.getDb()).get(this.store, key);\n    } catch (e) {\n      return null;\n    }\n  }\n\n  /**\n   * inserts value into cache for the given key\n   *\n   * @param {string} key\n   * @param {T} item\n   * @returns\n   * @memberof Cache\n   */\n  public async putValue(key: string, item: T) {\n    if (!window.indexedDB) {\n      return;\n    }\n    try {\n      await (await this.getDb()).put(this.store, { ...item, timeCached: Date.now() }, key);\n    } catch (e) {\n      return;\n    }\n  }\n\n  /**\n   * Clears the store of all stored values\n   *\n   * @returns\n   * @memberof Cache\n   */\n  public async clearStore() {\n    if (!window.indexedDB) {\n      return;\n    }\n    try {\n      (await this.getDb()).clear(this.store);\n    } catch (e) {\n      return;\n    }\n  }\n\n  /**\n   * Returns the name of the parent DB that the cache store belongs to\n   */\n  public getDBName() {\n    return `mgt-${this.schema.name}`;\n  }\n\n  private getDb() {\n    return openDB(this.getDBName(), this.schema.version, {\n      upgrade: (db, oldVersion, newVersion, transaction) => {\n        for (const storeName in this.schema.stores) {\n          if (this.schema.stores.hasOwnProperty(storeName)) {\n            db.objectStoreNames.contains(storeName) || db.createObjectStore(storeName);\n          }\n        }\n      }\n    });\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * A helper class for interacting with the Teams Client SDK.\n *\n * @export\n * @class TeamsHelper\n */\nexport class TeamsHelper {\n  /**\n   * Optional entry point to the teams library\n   * If this value is not set, the provider will attempt to use\n   * the microsoftTeams global variable.\n   *\n   * @static\n   * @type {*}\n   * @memberof TeamsHelper\n   */\n  public static get microsoftTeamsLib(): any {\n    // tslint:disable-next-line: no-string-literal\n    return this._microsoftTeamsLib || window['microsoftTeams'];\n  }\n  public static set microsoftTeamsLib(value: any) {\n    this._microsoftTeamsLib = value;\n  }\n\n  /**\n   * Gets whether the Teams provider can be used in the current context\n   * (Whether the app is running in Microsoft Teams)\n   *\n   * @readonly\n   * @static\n   * @memberof TeamsHelper\n   */\n  public static get isAvailable(): boolean {\n    if (!this.microsoftTeamsLib) {\n      return false;\n    }\n    if (window.parent === window.self && (window as any).nativeInterface) {\n      // In Teams mobile client\n      return true;\n    } else if (window.name === 'embedded-page-container' || window.name === 'extension-tab-frame') {\n      // In Teams web/desktop client\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Execute a deeplink against the Teams lib.\n   *\n   * @static\n   * @param {string} deeplink\n   * @param {(status: boolean, reason?: string) => void} [onComplete]\n   * @memberof TeamsHelper\n   */\n  public static executeDeepLink(deeplink: string, onComplete?: (status: boolean, reason?: string) => void): void {\n    const teams = this.microsoftTeamsLib;\n    teams.initialize();\n    teams.executeDeepLink(deeplink, onComplete);\n  }\n\n  private static _microsoftTeamsLib: any;\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { GraphRequest } from '@microsoft/microsoft-graph-client';\nimport { IGraph } from '../IGraph';\n\n/**\n * A helper class to assist in getting multiple pages from a resource\n *\n * @export\n * @class GraphPageIterator\n * @template T\n */\nexport class GraphPageIterator<T> {\n  /**\n   * Gets all the items already fetched for this request\n   *\n   * @readonly\n   * @type {T[]}\n   * @memberof GraphPageIterator\n   */\n  public get value(): T[] {\n    return this._value;\n  }\n\n  /**\n   * Gets wheather this request has more pages\n   *\n   * @readonly\n   * @type {boolean}\n   * @memberof GraphPageIterator\n   */\n  public get hasNext(): boolean {\n    return !!this._nextLink;\n  }\n\n  /**\n   * Creates a new GraphPageIterator\n   *\n   * @static\n   * @template T - the type of entities expected from this request\n   * @param {IGraph} graph - the graph instance to use for making requests\n   * @param {GraphRequest} request - the initial request\n   * @param {string} [version] - optional version to use for the requests - by default uses the default version\n   * from the graph parameter\n   * @returns a GraphPageIterator\n   * @memberof GraphPageIterator\n   */\n  public static async create<T>(graph: IGraph, request: GraphRequest, version?: string) {\n    const response = await request.get();\n    if (response && response.value) {\n      const iterator = new GraphPageIterator<T>();\n      iterator._graph = graph;\n      iterator._value = response.value;\n      iterator._nextLink = response['@odata.nextLink'];\n      iterator._version = version || graph.version;\n      return iterator;\n    }\n\n    return null;\n  }\n\n  /**\n   * Creates a new GraphPageIterator from existing value\n   *\n   * @static\n   * @template T - the type of entities expected from this request\n   * @param {IGraph} graph - the graph instance to use for making requests\n   * @param value - the existing value\n   * @param nextLink - optional nextLink to use to get the next page\n   * from the graph parameter\n   * @returns a GraphPageIterator\n   * @memberof GraphPageIterator\n   */\n  public static createFromValue<T>(graph: IGraph, value, nextLink?) {\n    let iterator = new GraphPageIterator<T>();\n\n    // create iterator from values\n    iterator._graph = graph;\n    iterator._value = value;\n    iterator._nextLink = nextLink ? nextLink : null;\n    iterator._version = graph.version;\n\n    return iterator || null;\n  }\n\n  private _graph: IGraph;\n  private _nextLink: string;\n  private _version: string;\n  private _value: T[];\n\n  /**\n   * Gets the next page for this request\n   *\n   * @returns {Promise<T[]>}\n   * @memberof GraphPageIterator\n   */\n  public async next(): Promise<T[]> {\n    if (this._nextLink) {\n      const nextResource = this._nextLink.split(this._version)[1];\n      const response = await this._graph.api(nextResource).version(this._version).get();\n      if (response && response.value && response.value.length) {\n        this._value = this._value.concat(response.value);\n        this._nextLink = response['@odata.nextLink'];\n        return response.value;\n      }\n    }\n    return null;\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * Wrapper around the window.sessionStorage API. Use\n * this to set, get and clear session items.\n */\nexport class SessionCache {\n  private session: Storage;\n\n  constructor() {\n    this.session = window.sessionStorage;\n  }\n\n  setItem(key: string, value: string) {\n    this.session.setItem(key, value);\n  }\n\n  getItem(key: string): string {\n    return this.session.getItem(key);\n  }\n\n  clear() {\n    this.session.clear();\n  }\n}\n\n/**\n * Checks if a sessionStorage or a localStorage is available\n * for use in a browser.\n * @param storageType can be 'sessionStorage' or 'localStorage'.\n * @returns true if the storage is available for use.\n */\nexport function storageAvailable(storageType: string): boolean {\n  let storage: Storage;\n  try {\n    storage = window[storageType];\n    const x = '__storage_test__';\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (e) {\n    return (\n      e instanceof DOMException &&\n      // everything except Firefox\n      (e.code === 22 ||\n        // Firefox\n        e.code === 1014 ||\n        // test name field too, because code might not be present\n        // everything except Firefox\n        e.name === 'QuotaExceededError' ||\n        // Firefox\n        e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&\n      // acknowledge QuotaExceededError only if there's something already stored\n      storage &&\n      storage.length !== 0\n    );\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  AuthenticationHandler,\n  Client,\n  Context,\n  HTTPMessageHandler,\n  Middleware,\n  RetryHandler,\n  RetryHandlerOptions,\n  TelemetryHandler\n} from '@microsoft/microsoft-graph-client';\nimport { SessionCache, storageAvailable } from '../utils/SessionCache';\nimport { MgtBaseComponent } from '../components/baseComponent';\nimport { Graph } from '../Graph';\nimport { chainMiddleware } from '../utils/GraphHelpers';\nimport { MockProvider } from './MockProvider';\n\n/**\n * MockGraph Instance\n *\n * @export\n * @class MockGraph\n * @extends {Graph}\n */\n// tslint:disable-next-line: max-classes-per-file\nexport class MockGraph extends Graph {\n  constructor(mockProvider: MockProvider) {\n    const middleware: Middleware[] = [\n      new AuthenticationHandler(mockProvider),\n      new RetryHandler(new RetryHandlerOptions()),\n      new TelemetryHandler(),\n      new MockMiddleware(),\n      new HTTPMessageHandler()\n    ];\n\n    super(\n      Client.initWithMiddleware({\n        middleware: chainMiddleware(...middleware)\n      })\n    );\n  }\n\n  /**\n   * Returns an instance of the Graph in the context of the provided component.\n   *\n   * @param {MgtBaseComponent} component\n   * @returns\n   * @memberof Graph\n   */\n  public forComponent(component: MgtBaseComponent): MockGraph {\n    // The purpose of the forComponent pattern is to update the headers of any outgoing Graph requests.\n    // The MockGraph isn't making real Graph requests, so we can simply no-op and return the same instance.\n    return this;\n  }\n}\n\n/**\n * Implements Middleware for the Mock Client to escape\n * the graph url from the request\n *\n * @class MockMiddleware\n * @implements {Middleware}\n */\n// tslint:disable-next-line: max-classes-per-file\nclass MockMiddleware implements Middleware {\n  /**\n   * @private\n   * A member to hold next middleware in the middleware chain\n   */\n  private _nextMiddleware: Middleware;\n\n  private _baseUrl: string;\n\n  private _session: SessionCache;\n\n  constructor() {\n    if (storageAvailable('sessionStorage')) {\n      this._session = new SessionCache();\n    }\n  }\n\n  // tslint:disable-next-line: completed-docs\n  public async execute(context: Context): Promise<void> {\n    try {\n      const baseUrl = await this.getBaseUrl();\n      context.request = baseUrl + encodeURIComponent(context.request as string);\n    } catch (error) {\n      // ignore error\n    }\n    return await this._nextMiddleware.execute(context);\n  }\n  /**\n   * Handles setting of next middleware\n   *\n   * @param {Middleware} next\n   * @memberof SdkVersionMiddleware\n   */\n  public setNext(next: Middleware): void {\n    this._nextMiddleware = next;\n  }\n\n  private async getBaseUrl() {\n    if (!this._baseUrl) {\n      const sessionEndpoint = this._session?.getItem('endpointURL');\n      if (sessionEndpoint) {\n        this._baseUrl = sessionEndpoint;\n      } else {\n        try {\n          // get the url we should be using from the endpoint service\n          let response = await fetch('https://cdn.graph.office.net/en-us/graph/api/proxy/endpoint');\n          this._baseUrl = (await response.json()) + '?url=';\n        } catch {\n          // fallback to hardcoded value\n          this._baseUrl = 'https://proxy.apisandbox.msdn.microsoft.com/svc?url=';\n        }\n        this._session?.setItem('endpointURL', this._baseUrl);\n      }\n    }\n\n    return this._baseUrl;\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { IProvider, ProviderState } from '../providers/IProvider';\nimport { MockGraph } from './MockGraph';\n\n/**\n * Mock Provider access token for Microsoft Graph APIs\n *\n * @export\n * @class MockProvider\n * @extends {IProvider}\n */\nexport class MockProvider extends IProvider {\n  // tslint:disable-next-line: completed-docs\n  public provider: any;\n\n  /**\n   * new instance of mock graph provider\n   *\n   * @memberof MockProvider\n   */\n  public graph = new MockGraph(this);\n  constructor(signedIn: boolean = false) {\n    super();\n    if (signedIn) {\n      this.setState(ProviderState.SignedIn);\n    } else {\n      this.setState(ProviderState.SignedOut);\n    }\n  }\n\n  /**\n   * sets Provider state to SignedIn\n   *\n   * @returns {Promise<void>}\n   * @memberof MockProvider\n   */\n  public async login(): Promise<void> {\n    this.setState(ProviderState.Loading);\n    await new Promise(resolve => setTimeout(resolve, 3000));\n    this.setState(ProviderState.SignedIn);\n  }\n\n  /**\n   * sets Provider state to signed out\n   *\n   * @returns {Promise<void>}\n   * @memberof MockProvider\n   */\n  public async logout(): Promise<void> {\n    this.setState(ProviderState.Loading);\n    await new Promise(resolve => setTimeout(resolve, 3000));\n    this.setState(ProviderState.SignedOut);\n  }\n\n  /**\n   * Promise returning token from graph.microsoft.com\n   *\n   * @returns {Promise<string>}\n   * @memberof MockProvider\n   */\n  public getAccessToken(): Promise<string> {\n    return Promise.resolve('{token:https://graph.microsoft.com/}');\n  }\n\n  /**\n   * Name used for analytics\n   *\n   * @readonly\n   * @memberof IProvider\n   */\n  public get name() {\n    return 'MgtMockProvider';\n  }\n}\n", "/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { customElement, property } from 'lit-element';\nimport { MgtBaseProvider } from '../components/baseProvider';\nimport { Providers } from '../providers/Providers';\nimport { MockProvider } from './MockProvider';\n/**\n * Sets global provider to a mock Provider\n *\n * @export\n * @class MgtMockProvider\n * @extends {LitElement}\n */\n@customElement('mgt-mock-provider')\nexport class MgtMockProvider extends MgtBaseProvider {\n  /**\n   * A property to allow the developer to start the sample logged out if they desired.\n   *\n   * @memberof MgtMockProvider\n   */\n  @property({\n    attribute: 'signed-out',\n    type: Boolean\n  })\n  public signedOut;\n\n  /**\n   * method called to initialize the provider. Each derived class should provide\n   * their own implementation\n   *\n   * @protected\n   * @memberof MgtBaseProvider\n   */\n  protected initializeProvider() {\n    Providers.globalProvider = new MockProvider(!this.signedOut);\n  }\n}\n"],
  "mappings": "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",
  "names": ["RequestMethod", "FeatureUsageFlag", "delay", "delay", "parts", "ChaosStrategy", "error", "ResponseType", "DocumentType", "ContentType", "ContentTypeRegexStr", "path", "property", "version", "d", "b", "__assign", "__awaiter", "CryptoUtils", "Constants", "ServerHashParamKeys", "TemporaryCacheKeys", "PersistentCacheKeys", "ErrorCacheKeys", "SSOTypes", "AuthError", "StringUtils", "ClientAuthError", "ClientConfigurationError", "_a", "ScopeSet", "state", "UrlUtils", "AccessTokenKey", "AccessTokenValue", "ServerRequestParameters", "state", "_a", "XhrClient", "TrustedAuthority", "_a", "AuthorityType", "Authority", "_a", "ClientInfo", "policy", "TimeUtils", "TokenUtils", "IdToken", "AccessTokenCacheItem", "BrowserStorage", "RequestUtils", "state", "AuthCache", "state", "Account", "WindowUtils", "state", "ResponseUtils", "AuthorityFactory", "_a", "LogLevel", "Logger", "_a", "_a", "ServerError", "InteractionRequiredAuthError", "state", "TelemetryEvent", "_a", "DefaultEvent", "API_CODE", "API_EVENT_IDENTIFIER", "ApiEvent", "EVENT_KEYS", "HttpEvent", "TelemetryManager", "_a", "AuthCacheUtils", "DEFAULT_AUTHORITY", "UserAgentApplication", "_a", "__awaiter", "state", "_a", "PACKAGE_VERSION", "version", "PACKAGE_VERSION", "GRAPH_VERSION", "version", "length", "strings", "parts", "parts", "part", "html", "parts", "directive", "committer", "style", "render", "_a", "styles", "set", "css", "render", "state", "LoginType", "ProviderState", "_a", "ProvidersChangedState", "_a", "ComponentMediaQuery", "__awaiter", "__decorate", "__decorate", "version", "target", "version", "_a", "MgtMockProvider", "__decorate"]
}
